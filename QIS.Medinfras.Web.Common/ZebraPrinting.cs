using System;
using System.Collections.Generic;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Web;
using System.Security.Cryptography;
using QIS.Medinfras.Data.Service;

namespace QIS.Medinfras.Web.Common
{
    public static class ZebraPrinting
    {
        public enum PrintingGroup
        {
            Cover,
            DrugLabel,
            Registration,
            Diagnostic,
            Imaging,
            Laboratory,
            Order,
            PatientLabel,
            ProductionLabel,
            Tracer,
            Wristband,
            UDD,
            NutritionLabel,
            AssetLabel
        }

        public enum LabelGroup
        {
            DrugLabel,
            MRLabel
        }

        public enum LabelSize
        {
            Label_4x2,
            Label_5x3,
            Label_7x3,
            Label_8x3
        }

        public const string WRISTBAND_TYPE_CLIP = "CLIP";
        public const string WRISTBAND_TYPE_ADHESIVE = "ADHESIVE";
        public const string WRISTBAND_TYPE_ECONOMY = "ECONOMY";

        public const string INFANT_WRISTBAND_TYPE_ECONOMY = "SOFT";

        public const string CARTRIDGE_TYPE_Adult_Clip = "ADULT-CLIP";
        public const string CARTRIDGE_TYPE_Adult_Adhesive = "ADULT-ADHESIVE";
        public const string CARTRIDGE_TYPE_Infant_Clip = "INFANT-CLIP";
        public const string CARTRIDGE_Type_Adult_Economy = "ADULT-ECONOMY"; // User manually change the printer catridge
        public const string CARTRIDGE_Type_Adult_Splash_Blue = "ADULT-Economy (Blue)";
        public const string CARTRIDGE_Type_Adult_Splash_Pink = "ADULT-Economy (Pink)";
        public const string CARTRIDGE_Type_Adult_Splash_Red = "ADULT-Economy (Red)";
        public const string CARTRIDGE_Type_Adult_Splash_Yellow = "ADULT-Economy (Yellow)";
        public const string CARTRIDGE_Type_Adult_Splash_Purple = "ADULT-Economy (Purple)";
        public const string CARTRIDGE_Type_Adult_Comfort_Blue = "ADULT-Comfort (Blue)";
        public const string CARTRIDGE_Type_Adult_Comfort_Pink = "ADULT-Comfort (Pink)";
        public const string CARTRIDGE_Type_Soft_Infant = "Soft Infant";

        public const string MR_Label_Size_4x2 = "Label_4x2";
        public const string MR_Label_Size_5x3 = "Label_5x3";
        public const string MR_Label_Size_7x3 = "Label_7x3";
        public const string MR_Label_Size_8x3 = "Label_8x3";

        public const string Meal_Label_Size_8x3 = "Label_8x3";

        private static string line1, line2, line3, line4, line5, line6 = string.Empty;
        private static string allergyInfo = string.Empty;

        #region Zebra Label Print

        #region Print Method
        [Obsolete("This method is deprecated, use PrintMRLabel(vConsultVisit) instead", true)]
        public static void PrintMRLabel(ConsultVisit entityVisit, string labelSize = Meal_Label_Size_8x3, int labelCount = 1)
        {
            try
            {
                DirectPrinting print = new DirectPrinting();
                HealthcareParameter param = BusinessLayer.GetHealthcareParameter(AppSession.UserLogin.HealthcareID, Constant.SettingParameter.LABEL_PRINTER_NAME);

                if (param != null && !string.IsNullOrEmpty(param.ParameterValue))
                {
                    //Initialize Printer
                    string command = GenerateMRLabelZPLCommand(entityVisit, labelSize);

                    for (int i = 1; i <= labelCount; i++)
                    {
                        print.OpenPrinter(param.ParameterValue);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(command.ToString());
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                }
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        public static void PrintPatientWristband(ConsultVisit entityVisit, string sex = "0003^M", bool isChildren = false, string wristbandType = CARTRIDGE_TYPE_Adult_Clip)
        {
            try
            {
                DirectPrinting print = new DirectPrinting();
                string paramCodeList = string.Format("('{0}','{1}','{2}','{3}')", Constant.SettingParameter.IS_USING_MULTI_WRISTBAND_PRINTER,
                    Constant.SettingParameter.MALE_WRISTBAND_PRINTER_NAME,
                    Constant.SettingParameter.FEMALE_WRISTBAND_PRINTER_NAME,
                    Constant.SettingParameter.INFANT_WRISTBAND_PRINTER_NAME);
                string paramFilterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN {1}", AppSession.UserLogin.HealthcareID, paramCodeList);

                List<HealthcareParameter> lstParam = BusinessLayer.GetHealthcareParameterList(paramFilterExp);

                if (lstParam != null)
                {
                    bool IsUsingMultiWristbandPrinter = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.IS_USING_MULTI_WRISTBAND_PRINTER).FirstOrDefault().ParameterValue.ToString() == "1" ? true : false;
                    string malePrinterAddress = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.MALE_WRISTBAND_PRINTER_NAME).FirstOrDefault().ParameterValue.ToString();
                    string femalePrinterAddress = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.FEMALE_WRISTBAND_PRINTER_NAME).FirstOrDefault().ParameterValue.ToString();
                    string infantPrinterAddress = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.INFANT_WRISTBAND_PRINTER_NAME).FirstOrDefault().ParameterValue.ToString();

                    string printerName = string.Empty;

                    if (IsUsingMultiWristbandPrinter)
                    {
                        if (wristbandType == ZebraPrinting.CARTRIDGE_TYPE_Infant_Clip)
                        {
                            printerName = infantPrinterAddress;
                        }
                        else
                        {
                            if (sex == "0003^M")
                                printerName = malePrinterAddress;
                            else
                                printerName = femalePrinterAddress;
                        }
                    }
                    else
                    {
                        HealthcareParameter param = BusinessLayer.GetHealthcareParameter(AppSession.UserLogin.HealthcareID, Constant.SettingParameter.WRISTBAND_PRINTER_NAME);
                        printerName = param.ParameterValue.ToString();
                    }


                    if (!string.IsNullOrEmpty(printerName))
                    {
                        //Initialize Printer
                        print.OpenPrinter(printerName);
                        string command = GenerateWristbandZPLCommand(entityVisit, wristbandType);

                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(command.ToString());
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                }
                else
                {
                    throw new Exception("Cannot find Printer Configuration");
                }
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        public static void PrintMealLabel(vNutritionOrderDtCustom entityVisit, string labelSize = Meal_Label_Size_8x3, int labelCount = 1)
        {
            try
            {
                DirectPrinting print = new DirectPrinting();
                HealthcareParameter param = BusinessLayer.GetHealthcareParameter(AppSession.UserLogin.HealthcareID, Constant.SettingParameter.NT_JENIS_PRINTER_ETIKET_GIZI);

                if (param != null && !string.IsNullOrEmpty(param.ParameterValue))
                {
                    //Initialize Printer
                    string command = GenerateMealLabelZPLCommand(entityVisit, labelSize);

                    for (int i = 1; i <= labelCount; i++)
                    {
                        print.OpenPrinter(param.ParameterValue);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(command.ToString());
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                }
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        public static void PrintMealLabelDistribution(vNutritionOrderDtCustom order, string printerUrl1)
        {
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            string patientName = string.Empty;
            int count = order.PatientName.Count();
            if (count > 26)
            {
                patientName = order.PatientName.Substring(0, 26);
            }
            else
            {
                patientName = order.PatientName;
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,22\r\n");
            sb.Append("^FO240,15^FD" + string.Format("{0}", entityHealthcare.HealthcareName) + "^FS\r\n");
            sb.Append("^FO250,35^FD" + string.Format("Telp:{0} Fax:{1}", entityHealthcare.PhoneNo1, entityHealthcare.FaxNo1) + "^FS\r\n");
            sb.Append("^FO170,60^GB490,1,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO160,75^FD" + string.Format("{0}", patientName) + "^FS\r\n");
            sb.Append("^FO160,100^FD" + string.Format("TGL LAHIR: {0}", order.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^FO160,125^FD" + string.Format("MR: {0}", order.MedicalNo) + "^FS\r\n");
            sb.Append("^FO435,60^GB1,130,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO450,75^FD" + string.Format("{0}", order.MealTime) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO450,100^FD" + string.Format("{0}", order.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO450,125^FD" + string.Format("{0}", order.ServiceUnitName) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO450,150^FD" + string.Format("{0}", order.BedCode) + "^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO170,190^GB490,70,3^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO180,200^FD" + string.Format("{0}", order.cfDietNotes) + "^FS\r\n");
            sb.Append("^FO180,225^FD" + string.Format("Catatan:{0}", order.RemarksHd) + "^FS\r\n");
            sb.Append("^CF0,14\r\n");
            sb.Append("^FO210,270^FDMAKANLAH MAKANAN DARI RUMAH SAKIT, IKUTI ANJURAN DIET^FS\r\n");
            sb.Append("^FO170,290^FDKONSUMSILAH MAKSIMAL 1 JAM SETELAH PENYAJIAN. SEMOGA SEGERA PULIH^FS\r\n");
            sb.Append("^XZ\r\n");
            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }

        public static void PrintMealLabelDistributionSOBA(vNutritionOrderDtCustom order, string printerUrl1)
        {
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            string patientName = string.Empty;
            int count = order.PatientName.Count();
            if (count > 26)
            {
                patientName = order.PatientName.Substring(0, 26);
            }
            else
            {
                patientName = order.PatientName;
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,22\r\n");
            sb.Append("^FO300,25^FD" + string.Format("{0}", entityHealthcare.HealthcareName) + "^FS\r\n");
            sb.Append("^FO160,50^GB550,1,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO170,65^FD" + string.Format("{0}", patientName) + "^FS\r\n");
            sb.Append("^FO170,90^FD" + string.Format("TGL LAHIR: {0}", order.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^FO170,115^FD" + string.Format("MR: {0}", order.MedicalNo) + "^FS\r\n");
            sb.Append("^CF0,24\r\n");
            sb.Append("^FO170,140^FD" + string.Format("{0}", order.MealPlanName) + "^FS\r\n");
            sb.Append("^FO450,50^GB1,120,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,65^FD" + string.Format("{0}", order.MealTime) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO460,90^FD" + string.Format("{0}", order.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,115^FD" + string.Format("{0}", order.ServiceUnitName) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,140^FD" + string.Format("{0}", order.BedCode) + "^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO150,170^GB550,70,3^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO170,180^FD" + string.Format("{0}", order.cfDietNotes1) + "^FS\r\n");
            sb.Append("^FO170,210^FD" + string.Format("{0}", order.RemarksHd) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO180,250^FDMAKANAN MAKSIMAL DIKONSUMSI 2 JAM SETELAH PENYAJIAN^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }

        public static void PrintMealLabelDistributionRSUKRIDA(vNutritionOrderDtCustom order, string printerUrl1)
        {
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            string patientName = string.Empty;
            int count = order.PatientName.Count();
            if (count > 26)
            {
                patientName = order.PatientName.Substring(0, 26);
            }
            else
            {
                patientName = order.PatientName;
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,22\r\n");
            sb.Append("^FO300,25^FD" + string.Format("{0}", entityHealthcare.HealthcareName) + "^FS\r\n");
            sb.Append("^FO160,50^GB550,1,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO170,65^FD" + string.Format("{0}", patientName) + "^FS\r\n");
            sb.Append("^FO170,90^FD" + string.Format("TGL LAHIR: {0}", order.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^FO170,115^FD" + string.Format("MR: {0}", order.MedicalNo) + "^FS\r\n");
            sb.Append("^CF0,24\r\n");
            sb.Append("^FO170,140^FD" + string.Format("{0}", order.MealPlanName) + "^FS\r\n");
            sb.Append("^FO450,50^GB1,120,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,65^FD" + string.Format("{0}", order.MealTime) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO460,90^FD" + string.Format("{0}", order.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,115^FD" + string.Format("{0}", order.ServiceUnitName) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO460,140^FD" + string.Format("{0}", order.BedCode) + "^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO150,170^GB550,70,3^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO170,180^FD" + string.Format("{0}", order.cfDietNotes1) + "^FS\r\n");
            sb.Append("^FO170,210^FD" + string.Format("{0}", order.RemarksHd) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO180,250^FDMAKANAN MAKSIMAL DIKONSUMSI 2 JAM SETELAH PENYAJIAN^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }

        public static void PrintMealLabelDistributionRSCK(vNutritionOrderDtCustom order, string printerUrl1)
        {
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            string patientName = string.Empty;
            int count = order.PatientName.Count();
            if (count > 26)
            {
                patientName = order.PatientName.Substring(0, 26);
            }
            else
            {
                patientName = order.PatientName;
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,25^FDHari/Tgl^FS\r\n");
            sb.Append("^FO175,25^FD:^FS\r\n");
            sb.Append("^FO190,25^FD" + string.Format("{0}", order.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,55^FDNo.RM^FS\r\n");
            sb.Append("^FO175,55^FD:^FS\r\n");
            sb.Append("^FO190,55^FD" + string.Format("{0}", order.MedicalNo) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,85^FDNama^FS\r\n");
            sb.Append("^FO175,85^FD:^FS\r\n");
            sb.Append("^FO190,85^FD" + string.Format("{0}", patientName) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,115^FDTgl. Lahir^FS\r\n");
            sb.Append("^FO175,115^FD:^FS\r\n");
            sb.Append("^FO190,115^FD" + string.Format("{0}", order.DateOfBirthInString) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,145^FDRuang^FS\r\n");
            sb.Append("^FO175,145^FD:^FS\r\n");
            sb.Append("^FO190,145^FD" + string.Format("{0}", order.ServiceUnitName) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,175^FDKamar^FS\r\n");
            sb.Append("^FO175,175^FD:^FS\r\n");
            sb.Append("^FO190,175^FD" + string.Format("{0}", order.RoomCode) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO330,175^FDBed^FS\r\n");
            sb.Append("^FO370,175^FD:^FS\r\n");
            sb.Append("^FO390,175^FD" + string.Format("{0}", order.BedCode) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,205^FDDiet^FS\r\n");
            sb.Append("^FO175,205^FD:^FS\r\n");
            sb.Append("^FO190,205^FD" + string.Format("{0}", order.MultiDiet) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,235^FDBentuk Makanan^FS\r\n");
            sb.Append("^FO235,235^FD:^FS\r\n");
            sb.Append("^FO255,235^FD" + string.Format("{0}", order.MealPlanName) + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO65,265^FDExp. Jam^FS\r\n");
            sb.Append("^FO175,265^FD:^FS\r\n");
            sb.Append("^FO190,265^" + "" + "^FS\r\n");

            sb.Append("^CF0,24\r\n");
            sb.Append("^FO290,295^FD(Selamat Menikmati)^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }

        public static void PrintMealLabelDistributionRSRTH(vNutritionOrderDtCustom order, string printerUrl1)
        {
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            string patientName = string.Empty;
            int count = order.PatientName.Count();
            if (count > 26)
            {
                patientName = order.PatientName.Substring(0, 26);
            }
            else
            {
                patientName = order.PatientName;
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^LL210\r\n");
            sb.Append("^PW600\r\n");
            sb.Append("^LH2,1^MD10\r\n");
            sb.Append("^CF0,22\r\n");
            sb.Append("^FO175,25^FD" + string.Format("{0}", entityHealthcare.HealthcareName) + "^FS\r\n");
            sb.Append("^FO1,50^GB580,1,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO8,65^FD" + string.Format("{0}", patientName) + "^FS\r\n");
            sb.Append("^FO8,90^FD" + string.Format("TGL LAHIR: {0}", order.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^FO8,115^FD" + string.Format("MR: {0}", order.MedicalNo) + "^FS\r\n");
            sb.Append("^CF0,24\r\n");
            sb.Append("^FO8,140^FD" + string.Format("{0}", order.MealPlanName) + "^FS\r\n");
            sb.Append("^FO305,50^GB1,120,3^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO315,65^FD" + string.Format("{0}", order.MealTime) + "^FS\r\n");
            sb.Append("^CF0,18\r\n");
            sb.Append("^FO315,90^FD" + string.Format("{0}", order.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO315,115^FD" + string.Format("{0}", order.ServiceUnitName) + "^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO315,140^FD" + string.Format("{0}", order.BedCode) + "^FS\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO1,170^GB580,70,3^FS\r\n");
            sb.Append("^CF0,20\r\n");
            sb.Append("^FO10,180^FD" + string.Format("{0}", order.cfDietNotes1) + "^FS\r\n");
            sb.Append("^FO10,210^FD" + string.Format("{0}", order.RemarksHd) + "^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion

        #region EtiketGizi
        public static void PrintNutritionLabel(string printFormat, String lstNutritionOrderDtID = "", string printerUrl1 = "", int labelCount = 0, string lstExpiredDate = "", string lstExpiredTime = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vNutritionOrderDtCustom> lstEntity = BusinessLayer.GetvNutritionOrderDtCustomList(String.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID));

            if (lstEntity.Count > 0)
            {
                if (!string.IsNullOrEmpty(printerName1))
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.NutritionLabel, printFormat);

                    List<string> lstField = GetMetadata(PrintingGroup.NutritionLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        string filterExpression = string.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID.ToString());
                        List<vNutritionOrderDtCustom> lstDetail = BusinessLayer.GetvNutritionOrderDtCustomList(filterExpression);

                        string[] expiredDates = lstExpiredDate.Split(',');
                        string[] expiredTimes = lstExpiredTime.Split(',');

                        int index = 0;
                        foreach (vNutritionOrderDtCustom item in lstDetail)
                        {
                            #region Get Header Information
                            string registrationno = item.RegistrationNo;
                            string patientLocation = string.Format("{0} {1}", item.ServiceUnitName, item.BedCode);

                            string patientName = "";
                            string medicalNo = "";
                            string dateOfBirth = "";
                            string sex = "";
                            string cfPatientNameInLabel = "";
                            string scheduleDate = "";
                            string patientName1 = "";
                            string stapleFood = "";
                            string numberOfCalories = "";
                            string allergy = "";

                            if (patientLocation.Length > 30)
                            {
                                patientLocation = patientLocation.Substring(0, 30);
                            }

                            List<PatientAllergy> entityAllergyLst = new List<PatientAllergy>();
                            Healthcare entityHSU = BusinessLayer.GetHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                            if (entityHSU.Initial == "PHS")
                            {
                                entityAllergyLst = BusinessLayer.GetPatientAllergyList(string.Format("MRN = {0} AND IsDeleted = 0 AND GCAllergenType IN ('{1}','{2}')", item.MRN, Constant.AllergenType.DRUG, Constant.AllergenType.FOOD));
                            }
                            else
                            {
                                entityAllergyLst = BusinessLayer.GetPatientAllergyList(string.Format("MRN = {0} AND IsDeleted = 0 AND GCAllergenType = '{1}'", item.MRN, Constant.AllergenType.DRUG));
                            }

                            if (entityAllergyLst.Count() > 0)
                            {
                                allergy = entityAllergyLst.FirstOrDefault().Allergen;
                            }
                            else
                            {
                                allergy = "Tidak Ada";
                            }


                            patientName = item.PatientName;
                            medicalNo = item.MedicalNo;
                            dateOfBirth = item.DateOfBirthInString;
                            scheduleDate = item.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT);
                            sex = item.GCGender == "0003^M" ? "L" : "P";
                            numberOfCalories = item.NumberOfCalories.ToString("N2");

                            int count = item.PatientName.Count();
                            if (count > 26)
                            {
                                patientName1 = item.PatientName.Substring(0, 26);
                            }
                            else
                            {
                                patientName1 = item.PatientName;
                            }

                            cfPatientNameInLabel = item.PatientName; ;
                            string[] names = cfPatientNameInLabel.Split(' ');

                            if (names.Length >= 3)
                            {
                                cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                            }

                            if (cfPatientNameInLabel.Length > 25)
                            {
                                cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                            }

                            if (item.StapleFood != null)
                            {
                                stapleFood = item.StapleFood;
                            }
                            #endregion

                            string expiredDate = expiredDates.Length > index ? expiredDates[index] : "";
                            string expiredTime = expiredTimes.Length > index ? expiredTimes[index] : "";

                            var labelInfo = new Dictionary<string, string>();
                            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                            labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                            labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                            labelInfo.Add("PatientName", patientName);
                            labelInfo.Add("PatientName1", patientName1);
                            labelInfo.Add("PatientNameInLabel", cfPatientNameInLabel);
                            labelInfo.Add("cfPatientNameSalutation", item.cfPatientNameSalutation);
                            labelInfo.Add("MedicalNo", medicalNo);
                            labelInfo.Add("RegistrationNo", registrationno);
                            labelInfo.Add("DateOfBirthInString", dateOfBirth);
                            labelInfo.Add("Sex", sex);
                            labelInfo.Add("MealPlanName", item.MealPlanName);
                            labelInfo.Add("MealTime", item.MealTime);
                            labelInfo.Add("MultiDiet", item.MultiDiet);
                            labelInfo.Add("ScheduleDate", scheduleDate);
                            labelInfo.Add("ServiceUnitName", item.ServiceUnitName);
                            labelInfo.Add("CustomerType", item.CustomerType);
                            labelInfo.Add("BusinessPartnerName", item.BusinessPartnerName);
                            labelInfo.Add("ClassCode", item.ClassCode);
                            labelInfo.Add("ClassName", item.ClassName);
                            labelInfo.Add("RoomCode", item.RoomCode);
                            labelInfo.Add("RoomName", item.RoomName);
                            labelInfo.Add("BedCode", item.BedCode);
                            labelInfo.Add("cfDietNotes", item.cfDietNotes);
                            labelInfo.Add("cfDietNotes1", item.cfDietNotes1);
                            labelInfo.Add("Remarks", item.Remarks);
                            labelInfo.Add("RemarksHd", item.RemarksHd);
                            labelInfo.Add("StapleFood", stapleFood);
                            labelInfo.Add("NumberOfCalories", numberOfCalories);
                            labelInfo.Add("Allergy", allergy);
                            labelInfo.Add("ScheduleTime", item.ScheduleTime);

                            labelInfo.Add("ExpiredDate", expiredDate);
                            labelInfo.Add("ExpiredTime", expiredTime);

                            #region Replace Nutrition Label Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            int a = 0;
                            int noOfPrint = 1;
                            int noOfPrintAll = labelCount;

                            if (labelCount > 1)
                            {
                                a = noOfPrintAll;
                            }
                            else
                            {
                                a = noOfPrint;
                            }

                            DirectPrinting printer = new DirectPrinting();
                            string printerName = printerName1;
                            for (int i = 1; i <= a; i++)
                            {
                                printer.OpenPrinter(printerName);
                                printer.StartDocPrinter();
                                printer.Send("\n");
                                printer.Send("n\n");
                                printer.Send(labelCommand);
                                printer.Send("p1\n");
                                printer.EndDocPrinter();
                            }
                            #endregion

                            index++;
                        }
                    }
                }
                else
                {
                    throw new Exception("Please setup the printer address in System Parameter!");
                }
            }
        }
        #endregion

        #region EtiketGiziDotMatrix
        public static void PrintNutritionLabelDotMatrix(String lstNutritionOrderDtID = "", string printerUrl1 = "", int labelCount = 0, string lstExpiredDate = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vNutritionOrderDtCustom2> lstEntity = BusinessLayer.GetvNutritionOrderDtCustom2List(String.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID));

            if (lstEntity.Count > 0)
            {
                string filterExpression = string.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID.ToString());
                List<vNutritionOrderDtCustom2> lstDetail = BusinessLayer.GetvNutritionOrderDtCustom2List(filterExpression);
                foreach (vNutritionOrderDtCustom2 item in lstDetail)
                {
                    const char ESC = '\x1B';    // ESCAPE
                    string GS1 = Convert.ToString((char)29);
                    string ESC1 = Convert.ToString((char)27);

                    string fontItalic = "\x1b\x34\x01";
                    string fontItalicEnd = "\x1b\x34\x00";

                    string fontBold = "\x1b\x45\x01";
                    string fontDoubleHeight = "\x1b\x21\x10";
                    string fontBoldEnd = "\x1b\x45\x00";
                    string fontDoubleHeightEnd = "\x1b\x21\x00";
                    StringBuilder sb = new StringBuilder();

                    string numberOfCalories = Convert.ToString(item.NumberOfCalories);
                    string calories = "";
                    if (item.NumberOfCalories == 0)
                    {
                        calories = "";
                    }
                    else
                    {
                        calories = string.Format("{0} kkal", numberOfCalories);
                    }

                    #region Print Detail
                    sb.Append(ESC + "a1");
                    sb.Append(fontDoubleHeight);
                    sb.Append(fontBold);
                    sb.AppendLine("ETIKET MAKAN");
                    sb.AppendLine("INSTALASI GIZI");
                    sb.AppendLine(string.Format("{0}", entityHealthcare.HealthcareName));
                    sb.Append(fontBoldEnd);
                    sb.Append(fontDoubleHeightEnd);
                    sb.AppendLine("=================================");
                    sb.Append(ESC + "a0");
                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("{0}", item.PatientName));
                    sb.AppendLine(string.Format("NO. RM     : {0}", item.MedicalNo));
                    sb.AppendLine(string.Format("TGL. LAHIR : {0} / {1}", item.DateOfBirthInString, item.cfInitialGender));
                    sb.AppendLine(string.Format("RUANG      : {0}", item.ServiceUnitName));
                    sb.AppendLine(string.Format("KAMAR/KLS   : {0} / {1}", item.BedCode, item.ClassName));
                    sb.AppendLine(string.Format("DIET       : {0} / {1}", item.MealPlanName, item.MultiDiet));
                    sb.AppendLine(string.Format("TGL.DIET   : {0}", item.ScheduleDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    sb.AppendLine(string.Format("ALERGI     : {0}", item.PatientAllergy));
                    sb.AppendLine(string.Format("KETERANGAN :"));
                    sb.AppendLine(string.Format("{0}", item.RemarksHd));
                    sb.AppendLine("");
                    sb.Append(fontItalic);
                    sb.AppendLine(string.Format("*Konsumsi makanan paling lambat 1 jam setelah makan diterima.*"));
                    sb.Append(fontItalicEnd);
                    sb.Append(fontBoldEnd);
                    sb.Append(ESC + "a1");
                    sb.AppendLine("=================================");
                    sb.Append(ESC + "a0");
                    sb.AppendLine(string.Format("{0}", DateTime.Now.ToString(Constant.FormatString.DATE_TIME_FORMAT_4)));
                    for (int i = 0; i <= 3; i++)
                    {
                        sb.AppendLine("");
                    }

                    //Send Auto-Cut Command
                    string command = "";
                    command = ESC1 + "@";
                    command += GS1 + "V" + (char)48;

                    sb.AppendLine(command);
                    #endregion

                    #region Send Command to Printer

                    int a = 0;
                    int noOfPrint = 1;
                    int noOfPrintAll = labelCount;

                    if (labelCount > 1)
                    {
                        a = noOfPrintAll;
                    }
                    else
                    {
                        a = noOfPrint;
                    }

                    RawPrinterHelper print = new RawPrinterHelper();
                    for (int i = 1; i <= a; i++)
                    {
                        //Initialize Printer
                        print.OpenPrint(printerUrl1);
                        print.SendStringToPrinter(sb.ToString());
                        print.ClosePrint();
                    }
                }
                    #endregion
            }
        }

        public static void PrintNutritionLabelDotMatrixRSSES(String lstNutritionOrderDtID = "", string printerUrl1 = "", int labelCount = 0, string lstExpiredDate = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vNutritionOrderDtCustom2> lstEntity = BusinessLayer.GetvNutritionOrderDtCustom2List(String.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID));

            if (lstEntity.Count > 0)
            {
                string filterExpression = string.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID.ToString());
                List<vNutritionOrderDtCustom2> lstDetail = BusinessLayer.GetvNutritionOrderDtCustom2List(filterExpression);
                foreach (vNutritionOrderDtCustom2 item in lstDetail)
                {
                    const char ESC = '\x1B';    // ESCAPE
                    string GS1 = Convert.ToString((char)29);
                    string ESC1 = Convert.ToString((char)27);

                    string fontItalic = "\x1b\x34\x01";
                    string fontItalicEnd = "\x1b\x34\x00";

                    string fontBold = "\x1b\x45\x01";
                    string fontDoubleHeight = "\x1b\x21\x10";
                    string fontBoldEnd = "\x1b\x45\x00";
                    string fontDoubleHeightEnd = "\x1b\x21\x00";
                    StringBuilder sb = new StringBuilder();

                    string numberOfCalories = Convert.ToString(item.NumberOfCalories);
                    string calories = "";
                    if (item.NumberOfCalories == 0)
                    {
                        calories = "";
                    }
                    else
                    {
                        calories = string.Format("{0} kkal", numberOfCalories);
                    }

                    #region Print Detail
                    sb.Append(ESC + "a1");
                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("YAYASAN ELISABETH"));
                    sb.AppendLine(string.Format("RUMAH SAKIT ST. ELISABETH SEMARANG"));
                    sb.Append(fontBoldEnd);
                    sb.AppendLine("=================================");
                    sb.Append(ESC + "a0");
                    sb.AppendLine(string.Format("{0}    ({1})           {2}", item.RoomName, item.BedCode, item.MealTime));
                    sb.AppendLine("");
                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("{0}    {1}", item.MedicalNo, item.ScheduleDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    sb.AppendLine(string.Format("{0} ({1})", item.PatientName.ToUpper(), item.DateOfBirthInString));
                    sb.AppendLine("");
                    sb.Append(fontBoldEnd);
                    sb.AppendLine(string.Format("{0} {1} {2}", item.MultiDiet, calories, item.Remarks));
                    sb.AppendLine("");
                    sb.AppendLine(string.Format("catatan : {0}", item.RemarksHd));
                    sb.AppendLine("");
                    sb.Append(ESC + "a1");
                    sb.Append(fontBold);
                    sb.Append(fontItalic);
                    sb.AppendLine(string.Format("*Makanan Mohon Segera Dikonsumsi"));
                    sb.AppendLine(string.Format("(tidak lebih dari 2 jam setelah disajikan)"));
                    sb.Append(fontItalicEnd);
                    sb.Append(fontBoldEnd);
                    sb.Append(ESC + "a0");
                    sb.Append(ESC + "a1");
                    sb.AppendLine("=================================");
                    sb.Append(ESC + "a0");
                    for (int i = 0; i <= 3; i++)
                    {
                        sb.AppendLine("");
                    }

                    //Send Auto-Cut Command
                    sb.AppendLine(CreateAutoCutCommand());

                    #endregion

                    #region Send Command to Printer

                    int a = 0;
                    int noOfPrint = 1;
                    int noOfPrintAll = labelCount;

                    if (labelCount > 1)
                    {
                        a = noOfPrintAll;
                    }
                    else
                    {
                        a = noOfPrint;
                    }

                    RawPrinterHelper print = new RawPrinterHelper();
                    for (int i = 1; i <= a; i++)
                    {
                        //Initialize Printer
                        print.OpenPrint(printerUrl1);
                        print.SendStringToPrinter(sb.ToString());
                        print.ClosePrint();
                    }
                }
                    #endregion
            }
        }
        #endregion

        #region Helper Methods
        private static List<string> GetMetadata(PrintingGroup printingGroup)
        {
            List<string> metadata = new List<string>();
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\print_format\{1}\{1}.ddl", filePath, printingGroup.ToString().ToLower());
            IEnumerable<string> lstField = File.ReadAllLines(fileName);
            metadata = lstField.ToList();
            return metadata;
        }

        private static string GetPrintFormat(PrintingGroup printGroup, string printFormat = "X215^01", bool isDirectTextPrinting = false)
        {
            #region Get Print Format
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");

            //supaya jika printFormat kosong tidak error
            if (String.IsNullOrEmpty(printFormat))
            {
                printFormat = "X225^01";
            }

            string fileName = string.Format(@"{0}\print_format\{1}\{2}.rdl", filePath, printGroup.ToString().ToLower(), printFormat.Replace('^', '_'));
            IEnumerable<string> lstCommand = File.ReadAllLines(fileName);
            StringBuilder commandText = new StringBuilder();
            foreach (string command in lstCommand)
            {
                commandText.AppendLine(command);
            }
            string result = commandText.ToString();
            #endregion
            return result;
        }

        private static List<string> GetPrintFormatPerLine(PrintingGroup printGroup, string printFormat = "X215^01")
        {
            #region Get Print Format
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\print_format\{1}\{2}.rdl", filePath, printGroup.ToString().ToLower(), printFormat.Replace('^', '_'));
            IEnumerable<string> lstCommand = File.ReadAllLines(fileName);
            #endregion
            return lstCommand.ToList();
        }

        public static object GetPropertyValue(object src, string propName)
        {
            return src.GetType().GetProperty(propName).GetValue(src, null);
        }
        #endregion

        #region Bukti Pendaftaran
        #region PrintBuktiPendaftaran
        public static void PrintBuktiPendaftaran(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Registration, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Registration);

                if (!string.IsNullOrEmpty(command))
                {

                    #region Store Registration Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    print.OpenPrinter(printerUrl);
                    print.StartDocPrinter();
                    print.Send("\n");
                    print.Send("n\n"); // clear the image buffer
                    print.Send(labelCommand);
                    print.Send("p1\n"); //print one label
                    print.EndDocPrinter();
                    #endregion
                }
            }
        }
        #endregion

        //FORMAT RSPB
        #region PrintBuktiPendaftaran3
        public static void PrintBuktiPendaftaran3(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                List<string> command = new List<string>();
                command = GetPrintFormatPerLine(PrintingGroup.Registration, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Registration);

                if (!string.IsNullOrEmpty(command.ToString()))
                {

                    #region Store Registration Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    StringBuilder cmdText = new StringBuilder();
                    foreach (string commandLine in command)
                    {
                        string printLine = commandLine;
                        foreach (string fieldName in lstField)
                        {
                            printLine = printLine.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        cmdText.AppendLine(printLine);
                    }

                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    print.OpenPrinter(printerUrl);
                    print.StartDocPrinter();
                    print.Send(cmdText.ToString());
                    print.EndDocPrinter();
                    #endregion
                }
            }
        }
        #endregion

        #endregion

        #region PrintLabelPasienRadiologi
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintLabelPasienRadiologi(vLabelPatientRegistrationImaging oLabel, string printerUrl)
        {
            String streetName = "";
            String itemName = "";
            //String referrerName = "";
            //String lineRujukan = "";
            //String linePemeriksa = "";

            if (oLabel.StreetName.Length > 100)
            {
                streetName = oLabel.StreetName.Substring(0, 100);
            }
            else
            {
                streetName = oLabel.StreetName;
            }

            if (oLabel.ItemName.Length > 40)
            {
                itemName = oLabel.ItemName.Substring(0, 40);
            }
            else
            {
                itemName = oLabel.ItemName;
            }

            //if (oLabel.DokterRujukan != "")
            //{
            //    referrerName = oLabel.RefererrName;
            //}
            //else
            //{
            //    referrerName = oLabel.ParamedicOrder;
            //}

            //if (oLabel.ItemName1 != "")
            //{
            //    lineRujukan = string.Format("      Rujukan    : {0}", oLabel.ParamedicName);
            //    linePemeriksa = string.Format("      Pemeriksa  : {0}", oLabel.ParamedicOrder);
            //}
            //else
            //{
            //    lineRujukan = string.Format("      Rujukan    : {0}", referrerName);
            //    linePemeriksa = string.Format("      Pemeriksa  : {0}", oLabel.ParamedicName);
            //}

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.Append(string.Format("      No. RM     : {0}        Tgl. Lahir : {1}", oLabel.MedicalNo, oLabel.DateOfBirthInString));

                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pasien     : {0}", oLabel.cfPatientName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Alamat     : {0}", streetName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Tanggal    : {0}         Hp  : {1}", oLabel.cfTransactionDateInString, oLabel.MobilePhoneNo1));
                dotMatrix.Append("\n");
                //dotMatrix.Append(string.Format("      Pemeriksaan: {0}", oLabel.cfItemName));
                dotMatrix.Append(string.Format("      Pemeriksaan: {0}", itemName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Rujukan    : {0}", oLabel.DokterRujukan));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pemeriksa  : {0}", oLabel.DokterPemeriksa));
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region PrintLabelPasienRadiologiRSCK
        #region EPL
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintLabelPasienRadiologiRSCK(vLabelPatientRegistrationImaging oLabel, string printerUrl)
        {
            String streetName = "";
            String itemName = "";

            if (oLabel.ItemName.Length > 40)
            {
                itemName = oLabel.ItemName.Substring(0, 40);
            }
            else
            {
                itemName = oLabel.ItemName;
            }

            if (oLabel.StreetName.Length > 45)
            {
                streetName = oLabel.StreetName.Substring(0, 45);
            }
            else
            {
                streetName = oLabel.StreetName;
            }

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      No. RM     : {0}     No Rad : {1}", oLabel.MedicalNo, oLabel.TransactionNo));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pasien     : {0}", oLabel.cfPatientName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Tgl. Lahir : {0}", oLabel.DateOfBirthInString));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Alamat     : {0}", streetName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Tanggal    : {0}         Hp  : {1}", oLabel.cfTransactionDateInString, oLabel.MobilePhoneNo1));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pemeriksaan: {0}", itemName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Rujukan    : {0}", oLabel.DokterRujukan));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pemeriksa  : {0}", oLabel.DokterPemeriksa));
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.SetFont15cpi();
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #region ZPL
        public static void PrintLabelPasienRadiologiRSCK_ZPL(string printFormat, int id = 0, string printerUrl = "")
        {
            string printerName1 = printerUrl;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            if (!string.IsNullOrEmpty(printerName1))
            {
                if (printFormat == Constant.PrintFormat.LABEL_COVER_REGISTRASI_RADIOLOGI_RSCK)
                {
                    #region RSCK
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.Imaging, printFormat);

                    List<string> lstField = GetMetadata(PrintingGroup.Imaging);
                    if (!string.IsNullOrEmpty(command))
                    {
                        vLabelPatientRegistrationImaging Entity = BusinessLayer.GetvLabelPatientRegistrationImagingList(string.Format("TransactionID = {0}", id)).FirstOrDefault();

                        if (Entity != null)
                        {
                            var labelInfo = new Dictionary<string, string>();
                            labelInfo.Add("HealthcareName", string.Empty);
                            labelInfo.Add("TransactionNo", Entity.TransactionNo);
                            labelInfo.Add("MedicalNo", Entity.MedicalNo);
                            labelInfo.Add("Salutation", Entity.Salutation);
                            labelInfo.Add("PatientName", Entity.PatientName);
                            labelInfo.Add("StreetName", Entity.StreetName);
                            labelInfo.Add("cfDateOfBirth", Entity.DateOfBirthInString);
                            labelInfo.Add("RegistrationDate", Entity.RegistrationDateInString);
                            labelInfo.Add("PhoneNo", Entity.MobilePhoneNo1);
                            labelInfo.Add("ItemName", Entity.ItemName);
                            labelInfo.Add("RegistrationPhysicianName", Entity.DokterRujukan);
                            labelInfo.Add("PhysicianOrder", Entity.DokterPemeriksa);
                            labelInfo.Add("cfGenderInitial1", string.Empty);
                            labelInfo.Add("cfTransactionDate", Entity.cfTransactionDateInString);
                            labelInfo.Add("cfItemDetailListForLabel", string.Empty);
                            labelInfo.Add("PhotoNumber", string.Empty);
                            
                            #region Replace Label Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            int a = 0;
                            int noOfPrint = 1;
                            a = noOfPrint;

                            DirectPrinting printer = new DirectPrinting();
                            string printerName = printerName1;
                            for (int i = 1; i <= a; i++)
                            {
                                printer.OpenPrinter(printerName);
                                printer.StartDocPrinter();
                                printer.Send("\n");
                                printer.Send("n\n");
                                printer.Send(labelCommand);
                                printer.Send("p1\n");
                                printer.EndDocPrinter();
                            }
                            #endregion
                        }
                    }
                    #endregion
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #endregion

        #region PrintLabelPasienLaboratorium
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintLabelPasienLaboratorium(vLabelPatientRegistration oLabel, string printerUrl)
        {
            String paramedicOrder = "";
            String paramedicName = "";
            String serviceUnitName = "";
            int padRight = 44;
            int newPadRight = 0;

            if (oLabel.RefererrName != "")
            {
                if (oLabel.RefererrName.Length >= 20)
                {
                    paramedicOrder = oLabel.RefererrName.Substring(0, 20);
                }
                else
                {
                    paramedicOrder = oLabel.RefererrName;
                }
            }
            else
            {
                paramedicOrder = "";
            }

            if (oLabel.ParamedicName != "")
            {
                if (oLabel.ParamedicName.Length >= 20)
                {
                    paramedicName = oLabel.ParamedicName.Substring(0, 20);
                }
                else
                {
                    paramedicName = oLabel.ParamedicName;
                }
            }
            else
            {
                paramedicName = "";
            }

            if (oLabel.ServiceUnitNameOrder != "")
            {
                serviceUnitName = oLabel.ServiceUnitNameOrder;
                if (serviceUnitName.Length < 24)
                {
                    newPadRight = padRight - serviceUnitName.Length;
                }
            }
            else
            {
                serviceUnitName = oLabel.ServiceUnitName;
                if (serviceUnitName.Length < 24)
                {
                    newPadRight = padRight - serviceUnitName.Length;
                }
            }

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                string line1 = string.Format("    {0} {1}                         ", oLabel.MedicalNo, oLabel.cfPatientName).Substring(0, 50);
                string line2 = string.Format("    Tgl. Lhr : {0} ({1}Thn{2}Bln{3}Hr)", oLabel.DateOfBirthInString, oLabel.AgeInYear, oLabel.AgeInMonth, oLabel.AgeInDay);
                string line3 = string.Format("    Dokter   : {0}                ", paramedicName);
                string line4 = string.Format("    Perujuk  : {0}                ", paramedicOrder);
                string line5 = string.Format("    Tgl. Dft : {0} {1}                ", oLabel.RegistrationDateInString, oLabel.RegistrationTime);
                string line6 = string.Format("    Unit     : {0}    ", serviceUnitName.PadRight(newPadRight));

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont12cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0} {1} {2}", line1.PadRight(39), line1.PadRight(40), line1));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.SetFont12cpi();

                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}{1}{2}", line2.PadRight(51), line2.PadRight(51), line2));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}{1}{2}", line3.PadRight(51), line3.PadRight(51), line3));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}{1}{2}", line4.PadRight(51), line4.PadRight(51), line4));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}{1}{2}", line5.PadRight(51), line5.PadRight(51), line5));
                dotMatrix.Append("\n");
                //dotMatrix.Append(string.Format("{0}{1}{2}", line6.PadRight(43), line6.PadRight(44), line6));
                dotMatrix.Append(string.Format("{0}{1}{2}", line6, line6, line6));
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");

                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region PrintLabelPasienCathLab
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintLabelPasienCathLab(vLabelPatientRegistrationCathLab oLabel, string printerUrl)
        {
            String streetName = "";
            String itemName = "";
            //String referrerName = "";
            //String lineRujukan = "";
            //String linePemeriksa = "";

            if (oLabel.StreetName.Length > 100)
            {
                streetName = oLabel.StreetName.Substring(0, 100);
            }
            else
            {
                streetName = oLabel.StreetName;
            }

            if (oLabel.ItemName.Length > 40)
            {
                itemName = oLabel.ItemName.Substring(0, 40);
            }
            else
            {
                itemName = oLabel.ItemName;
            }

            //if (oLabel.DokterRujukan != "")
            //{
            //    referrerName = oLabel.RefererrName;
            //}
            //else
            //{
            //    referrerName = oLabel.ParamedicOrder;
            //}

            //if (oLabel.ItemName1 != "")
            //{
            //    lineRujukan = string.Format("      Rujukan    : {0}", oLabel.ParamedicName);
            //    linePemeriksa = string.Format("      Pemeriksa  : {0}", oLabel.ParamedicOrder);
            //}
            //else
            //{
            //    lineRujukan = string.Format("      Rujukan    : {0}", referrerName);
            //    linePemeriksa = string.Format("      Pemeriksa  : {0}", oLabel.ParamedicName);
            //}

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.Append(string.Format("      No. RM     : {0}        Tgl. Lahir : {1}", oLabel.MedicalNo, oLabel.DateOfBirthInString));

                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pasien     : {0}", oLabel.cfPatientName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Alamat     : {0}", streetName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Tanggal    : {0}         Hp  : {1}", oLabel.cfTransactionDateInString, oLabel.MobilePhoneNo1));
                dotMatrix.Append("\n");
                //dotMatrix.Append(string.Format("      Pemeriksaan: {0}", oLabel.cfItemName));
                dotMatrix.Append(string.Format("      Pemeriksaan: {0}", itemName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Rujukan    : {0}", oLabel.DokterRujukan));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("      Pemeriksa  : {0}", oLabel.DokterPemeriksa));
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region RSMD
        public static String PrintBuktiPendaftaran4(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                StringBuilder sb = new StringBuilder();
                string fileName = "";

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit.RegistrationID)).FirstOrDefault();

                string reportTitle = "BUKTI PENDAFTARAN";
                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                //switch (oVisit.DepartmentID)
                //{
                //    case Constant.Facility.EMERGENCY:
                //        reportTitle = string.Format("{0} {1}", reportTitle, "RAWAT DARURAT");
                //        break;
                //    case Constant.Facility.OUTPATIENT:
                //        reportTitle = string.Format("{0} {1}", reportTitle, "RAWAT JALAN");
                //        serviceUnit = "Poliklinik";
                //        break;
                //    case Constant.Facility.INPATIENT:
                //        reportTitle = string.Format("{0} {1}", reportTitle, "RAWAT INAP");
                //        serviceUnit = "Ruang Perawatan";
                //        break;
                //    case Constant.Facility.DIAGNOSTIC:
                //        reportTitle = string.Format("{0} {1}", reportTitle, "PENUNJANG MEDIS");
                //        serviceUnit = "Penunjang Medis";
                //        break;
                //    default:
                //        break;
                //}

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(33);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", oHealthcare.HealthcareName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.SetFont12cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}", oHealthcare.StreetName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0} {1}", oHealthcare.City, oHealthcare.State));
                dotMatrix.Append("\n");

                #endregion

                #region Print Report Title
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetTittleFont(reportTitle);
                dotMatrix.Append("\n");
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("------------------------------------------------------------");
                #endregion

                #region Print Detail
                dotMatrix.SelectCondensedMode();
                sb.Append("\n");
                sb.Append(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit.ActualVisitDateInString, oVisit.ActualVisitTime));
                sb.Append("\n");
                sb.Append(string.Format("No. Registrasi     : {0}", oVisit.RegistrationNo));
                sb.Append("\n");
                sb.Append(string.Format("No. Rekam Medis    : {0}", oVisit.MedicalNo));
                sb.Append("\n");
                sb.Append(string.Format("Nama Pasien / JK   : {0} / {1}", oVisit.PatientName, gender));
                sb.Append("\n");
                sb.Append(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit.DateOfBirthInString, oVisit.AgeInYear, oVisit.AgeInMonth, oVisit.AgeInDay));
                if (oVisit.DepartmentID != Constant.Facility.EMERGENCY)
                {
                    sb.Append("\n");
                    sb.Append(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit.ServiceUnitName));

                }
                sb.Append("\n");
                sb.Append(string.Format("Nama Dokter        : {0}", oVisit.ParamedicName));
                sb.Append("\n");
                sb.Append(string.Format("Nama Ruang         : {0}", oVisit.RoomName));
                sb.Append("\n");
                sb.Append(string.Format("Kiriman Dari       : -"));
                sb.Append("\n");
                sb.Append(string.Format("Penjamin Bayar     : {0}", oVisit.BusinessPartner));
                if (oVisit.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    sb.Append("\n");
                    sb.Append(string.Format("No. Antrian        : {0}", oVisit.QueueNo));

                }
                sb.Append("\n");
                sb.Append(string.Format(""));
                sb.Append("\n");
                sb.Append(string.Format("DIAGNOSA           : ..........................."));
                sb.Append("\n");
                sb.Append(string.Format("Petugas            : {0}", reg.CtreatedByName));
                //                sb.Append(string.Format("Petugas            : {0}", AppSession.UserLogin.UserFullName));
                sb.Append("\n");
                sb.Append(string.Format("\n[] Farmasi  [] Laboratorium  [] Radiologi"));
                sb.Append("\n");
                sb.Append(string.Format("[] ...................."));
                dotMatrix.Append(sb.ToString());
                dotMatrix.CancelCondensedMode();

                #endregion

                dotMatrix.FormFeed();

                #region Send Command to Printer

                //RawPrinterHelper print = new RawPrinterHelper();

                ////Initialize Printer
                //print.OpenPrint(printerUrl);
                //print.SendStringToPrinter(dotMatrix.ToString());
                //print.ClosePrint();

                #endregion
                string command = dotMatrix.ToString();

                if (!string.IsNullOrEmpty(command))
                {
                    #region Create Temporary Text File to be printed by Printer Client Service
                    fileName = CreateTemporayFile(command, "BPN");
                    #endregion
                }
                return fileName;
            }
            else
            {
                return "";
            }

        }

        public static String PrintBuktiPendaftaranThermal(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder builder = new StringBuilder();
                string fileName = "";
                int lebar = 40;

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration3 reg = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", oVisit.RegistrationID)).FirstOrDefault();
                UserAttribute ua = BusinessLayer.GetUserAttribute(reg.CreatedBy);
                string gender = oVisit.GCGender == Constant.Gender.FEMALE ? "PEREMPUAN" : "LAKI-LAKI";

                string dateOfBirth = "";

                if (reg.DateOfBirth.ToString("dd-MM-yyyy") != Constant.ConstantDate.DEFAULT_NULL)
                {
                    dateOfBirth = reg.cfDateOfBirthInString;
                }

                builder.Append((char)27 + "@" + (char)27 + (char)101 + (char)2 + (char)27 + (char)101 + (char)2);
                builder.Append(PADC("RS.MEDISTRA", lebar) + "\n\r");
                builder.Append(PADC("BUKTI PENDAFTARAN PASIEN", lebar) + "\n\r");
                builder.Append("Tgl.Reg   : " + String.Format("{0:dd-MM-yyyy}", reg.RegistrationDate) + " / " + reg.RegistrationTime + "\n\r");
                builder.Append("No.Reg    : " + reg.RegistrationNo.ToString().Trim() + "\n\r");
                builder.Append("No.RM     : " + reg.MedicalNo.ToString().Trim() + "\n\r");
                builder.Append("Pasien    : " + BagiStr(reg.PatientName.ToString().Trim(), 28, 12) + "\n\r");
                builder.Append("J.Kelamin : " + gender + "\n\r");
                builder.Append("Tgl.Lahir : " + dateOfBirth + " / " + oVisit.PatientAge + "\n\r");
                builder.Append("Klinik    : " + BagiStr(reg.ServiceUnitName.ToString().Trim(), 28, 12) + "\n\r");
                builder.Append("Ruang     : " + BagiStr(reg.RoomName.ToString().Trim(), 28, 12) + "\n\r");
                builder.Append("Pembayar  : " + BagiStr(reg.BusinessPartnerName.ToString().Trim(), 28, 12) + "\n\r");
                builder.Append("Dokter    : " + BagiStr(reg.ParamedicName.ToString().Trim(), 28, 12) + "\n\r");
                builder.Append("No.Antrian: " + oVisit.QueueNo.ToString().Trim() + "\n\r\n\r");
                builder.Append("Petugas   : " + BagiStr(ua.FullName.ToString().Trim(), 28, 12) + "\n\r\n\r");
                builder.Append(repchr('-', lebar) + "\n\r\n\r\n\r");
                builder.Append("DIAGNOSA  : ............................" + "\n\r");
                // // LineFeed 25 Line & Cutter
                builder.Append("\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r");
                //builder.Append((char)27 + (char)100 + (char)25 + (char)27 + "m" + (char)27 + (char)100 + (char)4);
                builder.Append((char)29 + "V" + (char)65 + (char)0);
                builder.Append("\n\r\n\r\n\r\n\r");
                //Chr(29) & "V" & Chr(65) & Chr(0) ' Sends "GS V m n" command. (paper feed & cut)

                string command = builder.ToString();

                if (!string.IsNullOrEmpty(command))
                {
                    #region Create Temporary Text File to be printed by Printer Client Service
                    fileName = CreateTemporayFile(command, "TRM");
                    #endregion
                }
                return fileName;
            }
            else
            {
                return "";
            }
        }
        #region Kwitansi RSSES
        public static void PintKwitansiIndoRSSES(int ReceiptID, string printerUrl)
        {
            String NoRM = "";
            String PrintAsName = "";
            String AmountInStringIndo = "";
            String AmountInStringEng = "";
            String Amount = "";
            String Remarks1 = "";
            String Remarks2 = "";
            String PrintDateTime = "";
            String PrintTo = "";
            String CashierName = "";
            String TanggalMasuk = "";
            String TanggalPulang = "";
            String DepartmentID = "";
            GetPaymentReceiptCustom oData = BusinessLayer.GetPaymentReceiptCustomList(ReceiptID).FirstOrDefault();
            List<vRegistrationJKN> lstJKN = new List<vRegistrationJKN>();
            if (oData != null)
            {
                NoRM = oData.MedicalNo;
                PrintAsName = oData.PrintAsName;
                AmountInStringIndo = oData.cfReceiptAmountInStringInd;
                AmountInStringEng = oData.cfReceiptAmountInStringEng;
                Amount = oData.cfReceiptAmountInString;
                Remarks1 = string.Format("{0} {1} | {2} | {3}", oData.MedicalNo, oData.PatientName, oData.RegistrationNo, oData.PaymentReceiptNo);
                Remarks2 = oData.Remarks;
                CashierName = oData.cfSignName;
                string receiptDate = Convert.ToDateTime(oData.ReceiptDate).ToString(Constant.FormatString.DATE_FORMAT);
                string createdDate = Convert.ToDateTime(oData.CreatedDate).ToString(Constant.FormatString.DATE_FORMAT);

                if (receiptDate != "01-Jan-1900")
                {
                    PrintDateTime = string.Format("{0}", receiptDate);
                }
                else
                {
                    PrintDateTime = string.Format("{0}", createdDate);
                }

                PrintTo = string.Format("cetakan ke-{0}", oData.PrintNumber);

                lstJKN = BusinessLayer.GetvRegistrationJKNList(string.Format("RegistrationID='{0}' AND IsDeleted = 0 ORDER BY ClassCode ASC", oData.RegistrationID));

                vConsultVisit10 ov = BusinessLayer.GetvConsultVisit10List(string.Format("RegistrationID='{0}'", oData.RegistrationID)).FirstOrDefault();
                if (ov != null)
                {
                    if (ov.DepartmentID == Constant.Facility.INPATIENT)
                    {
                        TanggalMasuk = ov.ActualVisitDateInString;
                        TanggalPulang = ov.DischargeDateInString;
                        Remarks1 = string.Format("{0} {1} | {2} | Tanggal Masuk {3} s.d Tanggal Keluar {4}", oData.MedicalNo, oData.PatientName, oData.RegistrationNo, TanggalMasuk, TanggalPulang);

                    }
                }


            }

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);

                #region Print Healthcare Information
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont10cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                {0}", NoRM));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                {0}", PrintAsName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                        {0}", AmountInStringIndo));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("                        {0}", AmountInStringEng));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("                        {0}", Remarks1));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("                        {0}", Remarks2));
                dotMatrix.CancelEmphasizedMode();

                if (lstJKN.Count > 0)
                {
                    dotMatrix.Append("\n");
                    string naikKelas = string.Empty;
                    decimal NilaiHakKelas = 0;
                    foreach (vRegistrationJKN row in lstJKN)
                    {
                        if (row.IsNilaiIur == false)
                        {
                            dotMatrix.Append(string.Format("                        Paket INACBG's {0}          :Rp. {1}", row.ClassName, row.NilaiHakKelas.ToString(Constant.FormatString.NUMERIC_2)));
                            dotMatrix.Append("\n");
                        }
                        else
                        {
                            naikKelas = row.ClassName;
                            NilaiHakKelas = row.NilaiHakKelas;
                        }


                    }
                    if (!string.IsNullOrEmpty(naikKelas))
                    {
                        dotMatrix.Append(string.Format("                        Iur Max 75% INACBG's {0}    :Rp. {1}", naikKelas, NilaiHakKelas.ToString(Constant.FormatString.NUMERIC_2)));
                    }
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("                        Total Iur Dibayar Pasien        :Rp. {0}", Amount));
                }
                else
                {
                    dotMatrix.Append("\n");
                }
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                ///dotMatrix.SelectItalicMode();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                                                                                                {0}", PrintDateTime));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                   {0}", Amount));
                dotMatrix.CancelEmphasizedMode();
                ///dotMatrix.CancelItalicMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("                                                                              {0}", CashierName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", PrintTo));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
            //
        }
        #endregion

        public static String PrintKwitansi(String ReceiptID, string printerUrl)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            String[] receiptIDPerRow = ReceiptID.Split('|');
            var guid = Guid.NewGuid();
            string title;

            SettingParameterDt setvarDt = BusinessLayer.GetSettingParameterDt(AppSession.UserLogin.HealthcareID, Constant.SettingParameter.LB_KODE_PENUNJANG_LABORATORIUM);
            Int32 hsuIDLab = Convert.ToInt32(setvarDt.ParameterValue);

            for (int countPR = 0; countPR < receiptIDPerRow.Count(); countPR++)
            {
                #region initialization
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                #endregion

                #region take data master
                String filterReceipt = String.Format("PaymentReceiptID = {0}", receiptIDPerRow[countPR]);
                vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();
                List<vPatientPaymentHd> entityPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentReceiptId = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));
                List<vPatientPaymentDt> entityPaymentDt = BusinessLayer.GetvPatientPaymentDtList(string.Format("IsDeleted = 0 AND PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE PaymentReceiptID = {0})", entityReceipt.PaymentReceiptID));

                Decimal Cash = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CASH).Sum(x => x.PaymentAmount));
                Decimal UangTitipan = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.UANG_TITIPAN).Sum(x => x.PaymentAmount));
                Decimal CreditCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT_CARD).Sum(x => x.PaymentAmount);
                Decimal DebitCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEBIT_CARD).Sum(x => x.PaymentAmount);
                Decimal BankTransfer = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BANK_TRANSFER).Sum(x => x.PaymentAmount);
                Decimal Piutang = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT).Sum(x => x.PaymentAmount);
                Decimal Voucher = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.VOUCHER).Sum(x => x.PaymentAmount);
                Decimal BRIPeduli = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BRI_PEDULI).Sum(x => x.PaymentAmount);
                Decimal OVOPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.OVO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal OnlinePayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.ONLINE_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal QRISFelloPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.QRIS_FELLO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal DepositOut = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEPOSIT_OUT).Sum(x => x.PaymentAmount);

                if (Cash != 0 && UangTitipan == 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (UangTitipan != 0 && Cash == 0)
                {
                    UangTitipan = UangTitipan - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (Cash != 0 && UangTitipan != 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }


                String CashInString = Cash.ToString("N2");
                String UangTitipanInString = UangTitipan.ToString("N2");
                String CreditCardInString = CreditCard.ToString("N2");
                String DebitCardInString = DebitCard.ToString("N2");
                String BankTransferInString = BankTransfer.ToString("N2");
                String PiutangInString = Piutang.ToString("N2");
                String VoucherInString = Voucher.ToString("N2");
                String BRIPeduliInString = BRIPeduli.ToString("N2");
                String OVOPaymentInString = OVOPayment.ToString("N2");
                String OnlinePaymentInString = OnlinePayment.ToString("N2");
                String QRISFelloPaymentInString = QRISFelloPayment.ToString("N2");
                String DepositOutInString = DepositOut.ToString("N2");

                if (CashInString != "0.00")
                {
                    if (CashInString.Length > 16)
                    {
                        CashInString = CashInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CashInString.Length;
                        CashInString = AddCharBefore(CashInString, count);
                    }
                }

                if (UangTitipanInString != "0.00")
                {
                    if (UangTitipanInString.Length > 16)
                    {
                        UangTitipanInString = UangTitipanInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - UangTitipanInString.Length;
                        UangTitipanInString = AddCharBefore(UangTitipanInString, count);
                    }
                }

                if (CreditCardInString != "0.00")
                {
                    if (CreditCardInString.Length > 16)
                    {
                        CreditCardInString = CreditCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CreditCardInString.Length;
                        CreditCardInString = AddCharBefore(CreditCardInString, count);
                    }
                }

                if (DebitCardInString != "0.00")
                {
                    if (DebitCardInString.Length > 16)
                    {
                        DebitCardInString = DebitCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DebitCardInString.Length;
                        DebitCardInString = AddCharBefore(DebitCardInString, count);
                    }
                }

                if (BankTransferInString != "0.00")
                {
                    if (BankTransferInString.Length > 16)
                    {
                        BankTransferInString = BankTransferInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BankTransferInString.Length;
                        BankTransferInString = AddCharBefore(BankTransferInString, count);
                    }
                }

                if (PiutangInString != "0.00")
                {
                    if (PiutangInString.Length > 16)
                    {
                        PiutangInString = PiutangInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - PiutangInString.Length;
                        PiutangInString = AddCharBefore(PiutangInString, count);
                    }
                }

                if (VoucherInString != "0.00")
                {
                    if (VoucherInString.Length > 16)
                    {
                        VoucherInString = VoucherInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - VoucherInString.Length;
                        VoucherInString = AddCharBefore(VoucherInString, count);
                    }
                }

                if (BRIPeduliInString != "0.00")
                {
                    if (BRIPeduliInString.Length > 16)
                    {
                        BRIPeduliInString = BRIPeduliInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BRIPeduliInString.Length;
                        BRIPeduliInString = AddCharBefore(BRIPeduliInString, count);
                    }
                }

                if (OVOPaymentInString != "0.00")
                {
                    if (OVOPaymentInString.Length > 16)
                    {
                        OVOPaymentInString = OVOPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OVOPaymentInString.Length;
                        OVOPaymentInString = AddCharBefore(OVOPaymentInString, count);
                    }
                }

                if (OnlinePaymentInString != "0.00")
                {
                    if (OnlinePaymentInString.Length > 16)
                    {
                        OnlinePaymentInString = OnlinePaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OnlinePaymentInString.Length;
                        OnlinePaymentInString = AddCharBefore(OnlinePaymentInString, count);
                    }
                }

                if (QRISFelloPaymentInString != "0.00")
                {
                    if (QRISFelloPaymentInString.Length > 16)
                    {
                        QRISFelloPaymentInString = QRISFelloPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - QRISFelloPaymentInString.Length;
                        QRISFelloPaymentInString = AddCharBefore(QRISFelloPaymentInString, count);
                    }
                }

                if (DepositOutInString != "0.00")
                {
                    if (DepositOutInString.Length > 16)
                    {
                        DepositOutInString = DepositOutInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DepositOutInString.Length;
                        DepositOutInString = AddCharBefore(DepositOutInString, count);
                    }
                }

                #endregion

                vRegistration reg = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();

                if (reg.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
                {
                    #region NON MCU

                    #region take data detail
                    string filterCharges = String.Format("ChargedQuantity != 0 AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);
                    List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);
                    var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList().OrderBy(x => x.DepartmentID);

                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "BUKTI";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "KWITANSI";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "BUKTI DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "BUKTI PIUTANG";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "BUKTI TERIMA UANG MUKA";
                    }


                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.LineAmount).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Nomor             : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Sudah Terima Dari : {0}", printAsName));
                    lstHeader.Add(string.Format("   Tanggal Periksa   : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Nama Pasien       : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Dokter            : {0}", paramedicNameRegis));

                    if (reg.HealthcareServiceUnitID == hsuIDLab)
                    {
                        string reffName = "";
                        if (!String.IsNullOrEmpty(reg.ReferrerParamedicName))
                        {
                            reffName = reg.ReferrerParamedicName;
                        }
                        else if (!String.IsNullOrEmpty(reg.ReferrerName))
                        {
                            reffName = reg.ReferrerName;
                        }

                        if (!string.IsNullOrEmpty(reffName))
                        {
                            if (reffName.Length > 35)
                            {
                                reffName = reffName.Substring(0, 34);
                            }

                            lstHeader.Add(string.Format("   Dokter Rujukan    : {0}", reffName));
                        }
                    }

                    lstHeader.Add(string.Format("   Penjamin Bayar    : {0}", penjamin));
                    lstHeader.Add(string.Format("   Transaksi / Pembelian Obat tidak dapat dikembalikan"));
                    lstHeader.Add(string.Format("   Barang yang tidak diambil dalam jangka 1 bulan,"));
                    lstHeader.Add(string.Format("   menjadi milik rumah sakit"));
                    lstHeader.Add(string.Format("      TERIMA KASIH                       Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DETAIL DEPOSIT :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("DETIL TRANSAKSI :                                 "));
                    }

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (vPatientChargesDt7 group in result)
                    {
                        List<vPatientChargesDt7> gr = entityDt.Where(x => x.DepartmentID == group.DepartmentID).ToList();
                        foreach (vPatientChargesDt7 entity in gr)
                        {
                            string name = entity.ItemName1;
                            string qty = entity.ChargedQuantity.ToString();
                            string amount = (entity.LineAmount + entity.DiscountAmount).ToString("N2");

                            if (name.Length > 20)
                            {
                                name = name.Substring(0, 20);
                            }
                            else if (name.Length < 20)
                            {
                                int count = 20 - name.Length;
                                name = AddChar(name, count);
                            }

                            if (qty.Length > 6)
                            {
                                qty = qty.Substring(0, 6);
                            }
                            else
                            {
                                int count = 6 - qty.Length;
                                qty = AddChar(qty, count);
                            }

                            if (amount.Length > 16)
                            {
                                amount = amount.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - amount.Length;
                                amount = AddCharBefore(amount, count);
                            }

                            if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                if (entity.DepartmentID.Length > 40)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 40);
                                }
                                else
                                {
                                    int count = 40 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaksi {0}", deptName));
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }
                            }
                            else if (entity == gr.LastOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (deptName.Length > 23)
                                {
                                    deptName = deptName.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                            else if (gr.Count() == 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (entity.DepartmentID.Length > 40)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 40);
                                }
                                else
                                {
                                    int count = 40 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaksi {0}", deptName));
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }

                                if (entity.DepartmentID.Length > 23)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - entity.DepartmentID.Length;
                                    deptName = AddChar(entity.DepartmentID, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                            else
                            {
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = entityDt.Select(ix => ix.LineAmount).Sum() + entityDt.Select(ix => ix.DiscountAmount).Sum();

                    if (title == "KWITANSI")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG INSTANSI           : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI PIUTANG")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG PASIEN             : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "BUKTI DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSAKSI               : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Uang Titipan        ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Piutang             ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    if (DepositOutInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "DEPOSIT             ", DepositOutInString));
                    }

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title != "BUKTI PIUTANG")
                    {
                        lstDetail.Add(string.Format("                                ----------------  "));
                        if (title == "BUKTI DEPOSIT")
                        {
                            lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                        }
                        else
                        {
                            lstDetail.Add(string.Format("TOTAL PEMBAYARAN              : {0}  ", totalBayarInString));
                        }
                    }
                    #endregion

                    string terbilang = Function.NumberInWords(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Terbilang :                                       "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "BUKTI DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Keterangan :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                    #endregion
                }
                else
                {
                    #region MCU

                    #region take data detail
                    List<GetPatientChargesHdDtAllMCUReceipt> entityDt = BusinessLayer.GetPatientChargesHdDtAllMCUReceipt(reg.RegistrationID);
                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "BUKTI";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "KWITANSI";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "BUKTI DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "BUKTI PIUTANG";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "BUKTI TERIMA UANG MUKA";
                    }

                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.MainTariff).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Nomor             : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Sudah Terima Dari : {0}", printAsName));
                    lstHeader.Add(string.Format("   Tanggal Periksa   : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Nama Pasien       : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Dokter            : {0}", paramedicNameRegis));
                    lstHeader.Add(string.Format("   Penjamin Bayar    : {0}", penjamin));
                    lstHeader.Add(string.Format("   Transaksi / Pembelian Obat tidak dapat dikembalikan"));
                    lstHeader.Add(string.Format("   Barang yang tidak diambil dalam jangka 1 bulan,"));
                    lstHeader.Add(string.Format("   menjadi milik rumah sakit"));
                    lstHeader.Add(string.Format("      TERIMA KASIH                       Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DETAIL DEPOSIT :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("DETIL TRANSAKSI :                                 "));
                    }

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (GetPatientChargesHdDtAllMCUReceipt entity in entityDt)
                    {
                        string name = entity.ItemName1;
                        string qty = entity.Quantity.ToString();
                        string amount = (entity.MainTariff + entity.DiscountAmount).ToString("N2");

                        if (name.Length > 20)
                        {
                            name = name.Substring(0, 20);
                        }
                        else if (name.Length < 20)
                        {
                            int count = 20 - name.Length;
                            name = AddChar(name, count);
                        }

                        if (qty.Length > 6)
                        {
                            qty = qty.Substring(0, 6);
                        }
                        else
                        {
                            int count = 6 - qty.Length;
                            qty = AddChar(qty, count);
                        }

                        if (amount.Length > 16)
                        {
                            amount = amount.Substring(0, 16);
                        }
                        else
                        {
                            int count = 16 - amount.Length;
                            amount = AddCharBefore(amount, count);
                        }

                        lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                        //tambah nama dokter jika boleh
                        ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                        if (itemService != null)
                        {
                            if (itemService.IsPrintWithDoctorName)
                            {
                                string paramedicName = entity.ParamedicName;

                                if (paramedicName.Length > 48)
                                {
                                    paramedicName = paramedicName.Substring(0, 48);
                                }
                                else
                                {
                                    int count = 48 - paramedicName.Length;
                                    paramedicName = AddChar(paramedicName, count);
                                }

                                lstDetail.Add(string.Format("{0}  ", paramedicName));
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = (entityDt.Select(ix => ix.MainTariff).Sum() + entityDt.Select(ix => ix.DiscountAmount).Sum());

                    if (title == "KWITANSI")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG INSTANSI           : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI PIUTANG")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG PASIEN             : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "BUKTI DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSAKSI               : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Uang Titipan        ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Piutang             ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    if (DepositOutInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "DEPOSIT             ", DepositOutInString));
                    }

                    lstDetail.Add(string.Format("                                ----------------  "));

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title != "BUKTI PIUTANG")
                    {
                        lstDetail.Add(string.Format("                                ----------------  "));
                        if (title == "BUKTI DEPOSIT")
                        {
                            lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                        }
                        else
                        {
                            lstDetail.Add(string.Format("TOTAL PEMBAYARAN              : {0}  ", totalBayarInString));
                        }
                    }
                    #endregion

                    string terbilang = Function.NumberInWords(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Terbilang :                                       "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "BUKTI DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Keterangan :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                    #endregion
                }

                #region Print
                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(33);
                dotMatrix.SelectDraftMode();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.SetTittleFont(string.Format("                    {0}                    \n", title));
                dotMatrix.Append("\n");
                dotMatrix.Append(lstDetail[0]);
                dotMatrix.Append(lstHeader[0]);
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");

                if (lstDetail.Count() > 0)
                {
                    int i = 0;
                    int totalLineTemp = lstDetail.Count();

                    if (lstDetail.Count() < lstHeader.Count())
                    {
                        totalLineTemp = lstHeader.Count();
                    }

                    if (totalLineTemp < 18)
                    {
                        totalLineTemp = 18;
                    }

                    while (i < totalLineTemp)
                    {
                        if (i > 0)
                        {
                            if (i < lstDetail.Count())
                            {
                                dotMatrix.Append(lstDetail[i]);
                            }
                            else
                            {
                                dotMatrix.Append("                                                  ");
                            }

                            if (i < 8)
                            {
                                dotMatrix.SelectEmphasizedMode();
                                dotMatrix.Append(lstHeader[i]);
                                dotMatrix.CancelEmphasizedMode();
                            }
                            else if (i == 9)
                            {
                                dotMatrix.Append(lstHeader[8]);
                            }
                            else if (i == 10)
                            {
                                dotMatrix.Append(lstHeader[9]);
                            }
                            else if (i == 11)
                            {
                                dotMatrix.Append(lstHeader[10]);
                            }
                            else if (i == 13)
                            {
                                dotMatrix.Append(lstHeader[11]);
                            }
                            else if (i == 16)
                            {
                                dotMatrix.Append(lstHeader[12]);
                            }
                            //else if (i == 18)
                            //{
                            //    dotMatrix.Append(lstHeader[13]);
                            //}
                            //else if (i == 19)
                            //{
                            //    dotMatrix.Append(lstHeader[14]);
                            //}
                            //else if (i == 20)
                            //{
                            //    if (lstHeader.Count == 16)
                            //    {
                            //        dotMatrix.Append(lstHeader[15]);
                            //    }
                            //}
                            dotMatrix.Append("\n");
                        }
                        i = i + 1;

                    }
                    dotMatrix.FormFeed();
                }
                #endregion

                #region Send Command to Printer

                //RawPrinterHelper print = new RawPrinterHelper();

                ////Initialize Printer
                //print.OpenPrint(printerUrl);
                //print.SendStringToPrinter(dotMatrix.ToString());
                //print.ClosePrint();

                #endregion
            }

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "KW");
                #endregion
            }
            return fileName;
        }

        public static String PrintKwitansiHaloDoc(String ReceiptID)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            String[] receiptIDPerRow = ReceiptID.Split('|');
            var guid = Guid.NewGuid();
            string title;

            for (int countPR = 0; countPR < receiptIDPerRow.Count(); countPR++)
            {
                #region initialization
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                #endregion

                #region take data master
                String filterReceipt = String.Format("PaymentReceiptID = {0}", receiptIDPerRow[countPR]);
                vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();
                List<vPatientPaymentHd> entityPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentReceiptId = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));
                List<vPatientPaymentDt> entityPaymentDt = BusinessLayer.GetvPatientPaymentDtList(string.Format("IsDeleted = 0 AND PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE PaymentReceiptID = {0})", entityReceipt.PaymentReceiptID));

                Decimal Cash = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CASH).Sum(x => x.PaymentAmount));
                Decimal UangTitipan = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.UANG_TITIPAN).Sum(x => x.PaymentAmount));
                Decimal CreditCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT_CARD).Sum(x => x.PaymentAmount);
                Decimal DebitCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEBIT_CARD).Sum(x => x.PaymentAmount);
                Decimal BankTransfer = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BANK_TRANSFER).Sum(x => x.PaymentAmount);
                Decimal Piutang = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT).Sum(x => x.PaymentAmount);
                Decimal Voucher = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.VOUCHER).Sum(x => x.PaymentAmount);
                Decimal BRIPeduli = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BRI_PEDULI).Sum(x => x.PaymentAmount);
                Decimal OVOPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.OVO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal OnlinePayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.ONLINE_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal QRISFelloPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.QRIS_FELLO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal DepositOut = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEPOSIT_OUT).Sum(x => x.PaymentAmount);

                if (Cash != 0 && UangTitipan == 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (UangTitipan != 0 && Cash == 0)
                {
                    UangTitipan = UangTitipan - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (Cash != 0 && UangTitipan != 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }

                String CashInString = Cash.ToString("N2");
                String UangTitipanInString = UangTitipan.ToString("N2");
                String CreditCardInString = CreditCard.ToString("N2");
                String DebitCardInString = DebitCard.ToString("N2");
                String BankTransferInString = BankTransfer.ToString("N2");
                String PiutangInString = Piutang.ToString("N2");
                String VoucherInString = Voucher.ToString("N2");
                String BRIPeduliInString = BRIPeduli.ToString("N2");
                String OVOPaymentInString = OVOPayment.ToString("N2");
                String OnlinePaymentInString = OnlinePayment.ToString("N2");
                String QRISFelloPaymentInString = QRISFelloPayment.ToString("N2");
                String DepositOutInString = DepositOut.ToString("N2");

                if (CashInString != "0.00")
                {
                    if (CashInString.Length > 16)
                    {
                        CashInString = CashInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CashInString.Length;
                        CashInString = AddCharBefore(CashInString, count);
                    }
                }

                if (UangTitipanInString != "0.00")
                {
                    if (UangTitipanInString.Length > 16)
                    {
                        UangTitipanInString = UangTitipanInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - UangTitipanInString.Length;
                        UangTitipanInString = AddCharBefore(UangTitipanInString, count);
                    }
                }

                if (CreditCardInString != "0.00")
                {
                    if (CreditCardInString.Length > 16)
                    {
                        CreditCardInString = CreditCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CreditCardInString.Length;
                        CreditCardInString = AddCharBefore(CreditCardInString, count);
                    }
                }

                if (DebitCardInString != "0.00")
                {
                    if (DebitCardInString.Length > 16)
                    {
                        DebitCardInString = DebitCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DebitCardInString.Length;
                        DebitCardInString = AddCharBefore(DebitCardInString, count);
                    }
                }

                if (BankTransferInString != "0.00")
                {
                    if (BankTransferInString.Length > 16)
                    {
                        BankTransferInString = BankTransferInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BankTransferInString.Length;
                        BankTransferInString = AddCharBefore(BankTransferInString, count);
                    }
                }

                if (PiutangInString != "0.00")
                {
                    if (PiutangInString.Length > 16)
                    {
                        PiutangInString = PiutangInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - PiutangInString.Length;
                        PiutangInString = AddCharBefore(PiutangInString, count);
                    }
                }

                if (VoucherInString != "0.00")
                {
                    if (VoucherInString.Length > 16)
                    {
                        VoucherInString = VoucherInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - VoucherInString.Length;
                        VoucherInString = AddCharBefore(VoucherInString, count);
                    }
                }

                if (BRIPeduliInString != "0.00")
                {
                    if (BRIPeduliInString.Length > 16)
                    {
                        BRIPeduliInString = BRIPeduliInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BRIPeduliInString.Length;
                        BRIPeduliInString = AddCharBefore(BRIPeduliInString, count);
                    }
                }

                if (OVOPaymentInString != "0.00")
                {
                    if (OVOPaymentInString.Length > 16)
                    {
                        OVOPaymentInString = OVOPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OVOPaymentInString.Length;
                        OVOPaymentInString = AddCharBefore(OVOPaymentInString, count);
                    }
                }

                if (OnlinePaymentInString != "0.00")
                {
                    if (OnlinePaymentInString.Length > 16)
                    {
                        OnlinePaymentInString = OnlinePaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OnlinePaymentInString.Length;
                        OnlinePaymentInString = AddCharBefore(OnlinePaymentInString, count);
                    }
                }

                if (QRISFelloPaymentInString != "0.00")
                {
                    if (QRISFelloPaymentInString.Length > 16)
                    {
                        QRISFelloPaymentInString = QRISFelloPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - QRISFelloPaymentInString.Length;
                        QRISFelloPaymentInString = AddCharBefore(QRISFelloPaymentInString, count);
                    }
                }

                if (DepositOutInString != "0.00")
                {
                    if (DepositOutInString.Length > 16)
                    {
                        DepositOutInString = DepositOutInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DepositOutInString.Length;
                        DepositOutInString = AddCharBefore(DepositOutInString, count);
                    }
                }
                #endregion

                vRegistration reg = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();

                if (reg.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
                {
                    #region take data detail
                    string filterCharges = String.Format("ChargedQuantity != 0 AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);
                    List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);
                    var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList().OrderBy(x => x.DepartmentID);

                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "BUKTI";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "KWITANSI";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "BUKTI DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "BUKTI PIUTANG";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "BUKTI TERIMA UANG MUKA";
                    }


                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.LineAmount).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Nomor             : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   No.Reg / No.RM    : {0} / {1}", "-", entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Sudah Terima Dari : {0}", printAsName));
                    lstHeader.Add(string.Format("   Tanggal Periksa   : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Nama Pasien       : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Dokter            : -"));
                    lstHeader.Add(string.Format("   Penjamin Bayar    : -"));
                    lstHeader.Add(string.Format("   Transaksi / Pembelian Obat tidak dapat dikembalikan"));
                    lstHeader.Add(string.Format("   Barang yang tidak diambil dalam jangka 1 bulan,"));
                    lstHeader.Add(string.Format("   menjadi milik rumah sakit"));
                    lstHeader.Add(string.Format("      TERIMA KASIH                       Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DETAIL DEPOSIT :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("DETIL TRANSAKSI :                                 "));
                    }

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (vPatientChargesDt7 group in result)
                    {
                        List<vPatientChargesDt7> gr = entityDt.Where(x => x.DepartmentID == group.DepartmentID).ToList();
                        foreach (vPatientChargesDt7 entity in gr)
                        {
                            if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                if (entity.DepartmentID.Length > 40)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 40);
                                }
                                else
                                {
                                    int count = 40 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaksi {0}", deptName));
                            }
                            else if (entity == gr.LastOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (deptName.Length > 23)
                                {
                                    deptName = deptName.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                            else if (gr.Count() == 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (entity.DepartmentID.Length > 40)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 40);
                                }
                                else
                                {
                                    int count = 40 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaksi {0}", deptName));

                                if (entity.DepartmentID.Length > 23)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - entity.DepartmentID.Length;
                                    deptName = AddChar(entity.DepartmentID, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = entityDt.Select(ix => ix.LineAmount).Sum();

                    if (title == "KWITANSI")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + result.Sum(i => i.DiscountAmount);
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG INSTANSI           : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI PIUTANG")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + result.Sum(i => i.DiscountAmount);
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG PASIEN             : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "BUKTI DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSAKSI               : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Uang Titipan        ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Piutang             ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title != "BUKTI PIUTANG")
                    {
                        lstDetail.Add(string.Format("                                ----------------  "));
                        if (title == "BUKTI DEPOSIT")
                        {
                            lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                        }
                        else
                        {
                            lstDetail.Add(string.Format("TOTAL PEMBAYARAN              : {0}  ", totalBayarInString));
                        }
                    }
                    #endregion

                    string terbilang = Function.NumberInWords(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Terbilang :                                       "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "BUKTI DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Keterangan :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                }
                else
                {
                    #region take data detail
                    List<GetPatientChargesHdDtAllMCUReceipt> entityDt = BusinessLayer.GetPatientChargesHdDtAllMCUReceipt(reg.RegistrationID);
                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "BUKTI";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "KWITANSI";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "BUKTI DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "BUKTI PIUTANG";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "BUKTI TERIMA UANG MUKA";
                    }

                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.MainTariff).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Nomor             : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Sudah Terima Dari : {0}", printAsName));
                    lstHeader.Add(string.Format("   Tanggal Periksa   : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Nama Pasien       : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Dokter            : {0}", paramedicNameRegis));
                    lstHeader.Add(string.Format("   Penjamin Bayar    : {0}", penjamin));
                    lstHeader.Add(string.Format("   Transaksi / Pembelian Obat tidak dapat dikembalikan"));
                    lstHeader.Add(string.Format("   Barang yang tidak diambil dalam jangka 1 bulan,"));
                    lstHeader.Add(string.Format("   menjadi milik rumah sakit"));
                    lstHeader.Add(string.Format("      TERIMA KASIH                       Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DETAIL DEPOSIT :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("DETIL TRANSAKSI :                                 "));
                    }

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (GetPatientChargesHdDtAllMCUReceipt entity in entityDt)
                    {

                        string name = entity.ItemName1;
                        string qty = entity.Quantity.ToString();
                        string amount = (entity.MainTariff + entity.DiscountAmount).ToString("N2");

                        if (name.Length > 20)
                        {
                            name = name.Substring(0, 20);
                        }
                        else if (name.Length < 20)
                        {
                            int count = 20 - name.Length;
                            name = AddChar(name, count);
                        }

                        if (qty.Length > 6)
                        {
                            qty = qty.Substring(0, 6);
                        }
                        else
                        {
                            int count = 6 - qty.Length;
                            qty = AddChar(qty, count);
                        }

                        if (amount.Length > 16)
                        {
                            amount = amount.Substring(0, 16);
                        }
                        else
                        {
                            int count = 16 - amount.Length;
                            amount = AddCharBefore(amount, count);
                        }

                        lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                        //tambah nama dokter jika boleh
                        ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                        if (itemService != null)
                        {
                            if (itemService.IsPrintWithDoctorName)
                            {
                                string paramedicName = entity.ParamedicName;

                                if (paramedicName.Length > 48)
                                {
                                    paramedicName = paramedicName.Substring(0, 48);
                                }
                                else
                                {
                                    int count = 48 - paramedicName.Length;
                                    paramedicName = AddChar(paramedicName, count);
                                }

                                lstDetail.Add(string.Format("{0}  ", paramedicName));
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = (entityDt.Select(ix => ix.MainTariff).Sum() + entityDt.Select(ix => ix.DiscountAmount).Sum());

                    if (title == "KWITANSI")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG INSTANSI           : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI PIUTANG")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("DITANGGUNG PASIEN             : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISKON                        : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "BUKTI DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "BUKTI DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSAKSI               : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Uang Titipan        ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Piutang             ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    if (DepositOutInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "DEPOSIT             ", DepositOutInString));
                    }

                    lstDetail.Add(string.Format("                                ----------------  "));

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title == "BUKTI DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("TOTAL PEMBAYARAN              : {0}  ", totalBayarInString));
                    }
                    #endregion

                    string terbilang = Function.NumberInWords(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Terbilang :                                       "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "BUKTI DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Keterangan :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                }

                #region Print
                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(33);
                dotMatrix.SelectDraftMode();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.SetTittleFont(string.Format("                    {0}                    \n", title));
                dotMatrix.Append("\n");
                dotMatrix.Append(lstDetail[0]);
                dotMatrix.Append(lstHeader[0]);
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");

                if (lstDetail.Count() > 0)
                {
                    int i = 0;
                    int totalLineTemp = lstDetail.Count();

                    if (lstDetail.Count() < lstHeader.Count())
                    {
                        totalLineTemp = lstHeader.Count();
                    }

                    if (totalLineTemp < 18)
                    {
                        totalLineTemp = 18;
                    }

                    while (i < totalLineTemp)
                    {
                        if (i > 0)
                        {
                            if (i < lstDetail.Count())
                            {
                                dotMatrix.Append(lstDetail[i]);
                            }
                            else
                            {
                                dotMatrix.Append("                                                  ");
                            }

                            if (i < 8)
                            {
                                dotMatrix.SelectEmphasizedMode();
                                dotMatrix.Append(lstHeader[i]);
                                dotMatrix.CancelEmphasizedMode();
                            }
                            else if (i == 9)
                            {
                                dotMatrix.Append(lstHeader[8]);
                            }
                            else if (i == 10)
                            {
                                dotMatrix.Append(lstHeader[9]);
                            }
                            else if (i == 11)
                            {
                                dotMatrix.Append(lstHeader[10]);
                            }
                            else if (i == 13)
                            {
                                dotMatrix.Append(lstHeader[11]);
                            }
                            else if (i == 16)
                            {
                                dotMatrix.Append(lstHeader[12]);
                            }
                            //else if (i == 18)
                            //{
                            //    dotMatrix.Append(lstHeader[13]);
                            //}
                            //else if (i == 19)
                            //{
                            //    dotMatrix.Append(lstHeader[14]);
                            //}
                            //else if (i == 20)
                            //{
                            //    if (lstHeader.Count == 16)
                            //    {
                            //        dotMatrix.Append(lstHeader[15]);
                            //    }
                            //}
                            dotMatrix.Append("\n");
                        }
                        i = i + 1;

                    }
                    dotMatrix.FormFeed();
                }
                #endregion

                #region Send Command to Printer

                //RawPrinterHelper print = new RawPrinterHelper();

                ////Initialize Printer
                //print.OpenPrint(printerUrl);
                //print.SendStringToPrinter(dotMatrix.ToString());
                //print.ClosePrint();

                #endregion
            }

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "KW");
                #endregion
            }
            return fileName;
        }

        public static String PrintKwitansiEng(String ReceiptID, string printerUrl)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            String[] receiptIDPerRow = ReceiptID.Split('|');
            var guid = Guid.NewGuid();
            string title;

            for (int countPR = 0; countPR < receiptIDPerRow.Count(); countPR++)
            {
                #region initialization
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                #endregion

                #region take data master
                String filterReceipt = String.Format("PaymentReceiptID = {0}", receiptIDPerRow[countPR]);
                vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();
                List<vPatientPaymentHd> entityPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentReceiptId = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));
                List<vPatientPaymentDt> entityPaymentDt = BusinessLayer.GetvPatientPaymentDtList(string.Format("IsDeleted = 0 AND PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE PaymentReceiptID = {0})", entityReceipt.PaymentReceiptID));

                Decimal Cash = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CASH).Sum(x => x.PaymentAmount));
                Decimal UangTitipan = (entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.UANG_TITIPAN).Sum(x => x.PaymentAmount));
                Decimal CreditCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT_CARD).Sum(x => x.PaymentAmount);
                Decimal DebitCard = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEBIT_CARD).Sum(x => x.PaymentAmount);
                Decimal BankTransfer = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BANK_TRANSFER).Sum(x => x.PaymentAmount);
                Decimal Piutang = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.CREDIT).Sum(x => x.PaymentAmount);
                Decimal Voucher = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.VOUCHER).Sum(x => x.PaymentAmount);
                Decimal BRIPeduli = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.BRI_PEDULI).Sum(x => x.PaymentAmount);
                Decimal OVOPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.OVO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal OnlinePayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.ONLINE_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal QRISFelloPayment = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.QRIS_FELLO_PAYMENT).Sum(x => x.PaymentAmount);
                Decimal DepositOut = entityPaymentDt.Where(t => t.GCPaymentMethod == Constant.PaymentMethod.DEPOSIT_OUT).Sum(x => x.PaymentAmount);

                if (Cash != 0 && UangTitipan == 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (UangTitipan != 0 && Cash == 0)
                {
                    UangTitipan = UangTitipan - entityPaymentHd.Sum(f => f.CashBackAmount);
                }
                else if (Cash != 0 && UangTitipan != 0)
                {
                    Cash = Cash - entityPaymentHd.Sum(f => f.CashBackAmount);
                }

                String CashInString = Cash.ToString("N2");
                String UangTitipanInString = UangTitipan.ToString("N2");
                String CreditCardInString = CreditCard.ToString("N2");
                String DebitCardInString = DebitCard.ToString("N2");
                String BankTransferInString = BankTransfer.ToString("N2");
                String PiutangInString = Piutang.ToString("N2");
                String VoucherInString = Voucher.ToString("N2");
                String BRIPeduliInString = BRIPeduli.ToString("N2");
                String OVOPaymentInString = OVOPayment.ToString("N2");
                String OnlinePaymentInString = OnlinePayment.ToString("N2");
                String QRISFelloPaymentInString = QRISFelloPayment.ToString("N2");
                String DepositOutInString = DepositOut.ToString("N2");

                if (CashInString != "0.00")
                {
                    if (CashInString.Length > 16)
                    {
                        CashInString = CashInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CashInString.Length;
                        CashInString = AddCharBefore(CashInString, count);
                    }
                }

                if (UangTitipanInString != "0.00")
                {
                    if (UangTitipanInString.Length > 16)
                    {
                        UangTitipanInString = UangTitipanInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - UangTitipanInString.Length;
                        UangTitipanInString = AddCharBefore(UangTitipanInString, count);
                    }
                }

                if (CreditCardInString != "0.00")
                {
                    if (CreditCardInString.Length > 16)
                    {
                        CreditCardInString = CreditCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - CreditCardInString.Length;
                        CreditCardInString = AddCharBefore(CreditCardInString, count);
                    }
                }

                if (DebitCardInString != "0.00")
                {
                    if (DebitCardInString.Length > 16)
                    {
                        DebitCardInString = DebitCardInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DebitCardInString.Length;
                        DebitCardInString = AddCharBefore(DebitCardInString, count);
                    }
                }

                if (BankTransferInString != "0.00")
                {
                    if (BankTransferInString.Length > 16)
                    {
                        BankTransferInString = BankTransferInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BankTransferInString.Length;
                        BankTransferInString = AddCharBefore(BankTransferInString, count);
                    }
                }

                if (PiutangInString != "0.00")
                {
                    if (PiutangInString.Length > 16)
                    {
                        PiutangInString = PiutangInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - PiutangInString.Length;
                        PiutangInString = AddCharBefore(PiutangInString, count);
                    }
                }

                if (VoucherInString != "0.00")
                {
                    if (VoucherInString.Length > 16)
                    {
                        VoucherInString = VoucherInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - VoucherInString.Length;
                        VoucherInString = AddCharBefore(VoucherInString, count);
                    }
                }

                if (BRIPeduliInString != "0.00")
                {
                    if (BRIPeduliInString.Length > 16)
                    {
                        BRIPeduliInString = BRIPeduliInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - BRIPeduliInString.Length;
                        BRIPeduliInString = AddCharBefore(BRIPeduliInString, count);
                    }
                }

                if (OVOPaymentInString != "0.00")
                {
                    if (OVOPaymentInString.Length > 16)
                    {
                        OVOPaymentInString = OVOPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OVOPaymentInString.Length;
                        OVOPaymentInString = AddCharBefore(OVOPaymentInString, count);
                    }
                }

                if (OnlinePaymentInString != "0.00")
                {
                    if (OnlinePaymentInString.Length > 16)
                    {
                        OnlinePaymentInString = OnlinePaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - OnlinePaymentInString.Length;
                        OnlinePaymentInString = AddCharBefore(OnlinePaymentInString, count);
                    }
                }

                if (QRISFelloPaymentInString != "0.00")
                {
                    if (QRISFelloPaymentInString.Length > 16)
                    {
                        QRISFelloPaymentInString = QRISFelloPaymentInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - QRISFelloPaymentInString.Length;
                        QRISFelloPaymentInString = AddCharBefore(QRISFelloPaymentInString, count);
                    }
                }

                if (DepositOutInString != "0.00")
                {
                    if (DepositOutInString.Length > 16)
                    {
                        DepositOutInString = DepositOutInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - DepositOutInString.Length;
                        DepositOutInString = AddCharBefore(DepositOutInString, count);
                    }
                }
                #endregion

                vRegistration reg = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();

                if (reg.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
                {
                    #region take data detail
                    string filterCharges = String.Format("ChargedQuantity != 0 AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);
                    List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);
                    var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList().OrderBy(x => x.DepartmentID);

                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "PROFF";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "RECEIPT";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "PROOF OF DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "PROOF OF RECEIVABLES";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "DOWN PAYMENT RECEIPT";
                    }


                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.LineAmount).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Number            : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   Reg No / MR No    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Received From     : {0}", printAsName));
                    lstHeader.Add(string.Format("   Examination Date  : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Patient Name      : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Paramedic Name    : {0}", paramedicNameRegis));
                    lstHeader.Add(string.Format("   Business Partner  : {0}", penjamin));
                    lstHeader.Add(string.Format("   Transaction / Medication Payment can't be returned."));
                    lstHeader.Add(string.Format("   Items not taken within a month,"));
                    lstHeader.Add(string.Format("   belong to hospital"));
                    lstHeader.Add(string.Format("      THANK YOU                          Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DEPOSIT DETAIL :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("TRANSACTION DETAIL :                              "));
                    }

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (vPatientChargesDt7 group in result)
                    {
                        List<vPatientChargesDt7> gr = entityDt.Where(x => x.DepartmentID == group.DepartmentID).ToList();
                        foreach (vPatientChargesDt7 entity in gr)
                        {
                            string name = entity.ItemName2;
                            string qty = entity.ChargedQuantity.ToString();
                            string amount = (entity.LineAmount + entity.DiscountAmount).ToString("N2");

                            if (name.Length > 20)
                            {
                                name = name.Substring(0, 20);
                            }
                            else if (name.Length < 20)
                            {
                                int count = 20 - name.Length;
                                name = AddChar(name, count);
                            }

                            if (qty.Length > 6)
                            {
                                qty = qty.Substring(0, 6);
                            }
                            else
                            {
                                int count = 6 - qty.Length;
                                qty = AddChar(qty, count);
                            }

                            if (amount.Length > 16)
                            {
                                amount = amount.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - amount.Length;
                                amount = AddCharBefore(amount, count);
                            }

                            if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                if (entity.DepartmentID.Length > 38)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 38);
                                }
                                else
                                {
                                    int count = 38 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaction {0}", deptName));
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }
                            }
                            else if (entity == gr.LastOrDefault() && gr.Count() > 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (deptName.Length > 23)
                                {
                                    deptName = deptName.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                            else if (gr.Count() == 1)
                            {
                                string deptName = entity.DepartmentID;
                                string totalSub = (gr.Sum(i => i.LineAmount) + gr.Sum(i => i.DiscountAmount)).ToString("N2");

                                if (entity.DepartmentID.Length > 40)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 40);
                                }
                                else
                                {
                                    int count = 40 - deptName.Length;
                                    deptName = AddChar(deptName, count);
                                }

                                lstDetail.Add(string.Format("Transaksi {0}", deptName));
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }

                                if (entity.DepartmentID.Length > 23)
                                {
                                    deptName = entity.DepartmentID.Substring(0, 23);
                                }
                                else
                                {
                                    int count = 23 - entity.DepartmentID.Length;
                                    deptName = AddChar(entity.DepartmentID, count);
                                }

                                if (totalSub.Length > 16)
                                {
                                    totalSub = totalSub.Substring(0, 16);
                                }
                                else
                                {
                                    int count = 16 - totalSub.Length;
                                    totalSub = AddCharBefore(totalSub, count);
                                }

                                lstDetail.Add(string.Format("                                ----------------  "));
                                lstDetail.Add(string.Format("TOTAL {0}   {1}  ", deptName, totalSub));
                                lstDetail.Add(string.Format("                                                  "));
                            }
                            else
                            {
                                lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                                //tambah nama dokter jika boleh
                                ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                                if (itemService != null)
                                {
                                    if (itemService.IsPrintWithDoctorName)
                                    {
                                        string paramedicName = entity.ParamedicCharges;

                                        if (paramedicName.Length > 48)
                                        {
                                            paramedicName = paramedicName.Substring(0, 48);
                                        }
                                        else
                                        {
                                            int count = 48 - paramedicName.Length;
                                            paramedicName = AddChar(paramedicName, count);
                                        }

                                        lstDetail.Add(string.Format("{0}  ", paramedicName));
                                    }
                                }
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = entityDt.Select(ix => ix.LineAmount).Sum() + entityDt.Select(ix => ix.DiscountAmount).Sum();

                    if (title == "RECEIPT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("PAYER AMOUNT                  : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISCOUNT                      : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "PROOF OF RECEIVABLES")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("PATIENT AMOUNT                : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISCOUNT                      : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "PROOF OF DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "PROOF OF DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSACTION             : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Deposit             ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Account Receivables ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    if (DepositOutInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "DEPOSIT             ", DepositOutInString));
                    }

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title != "PROOF OF RECEIVABLES")
                    {
                        lstDetail.Add(string.Format("                                ----------------  "));
                        if (title == "PROOF OF DEPOSIT")
                        {
                            lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                        }
                        else
                        {
                            lstDetail.Add(string.Format("TOTAL PAYMENT                 : {0}  ", totalBayarInString));
                        }
                    }
                    #endregion

                    string terbilang = Function.NumberInWordsInEnglish(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Amount In Words :                                 "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "PROOF OF DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Remarks :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                }
                else
                {
                    #region take data detail
                    List<GetPatientChargesHdDtAllMCUReceipt> entityDt = BusinessLayer.GetPatientChargesHdDtAllMCUReceipt(reg.RegistrationID);
                    List<PatientPaymentHd> lstPayment = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0} AND GCTransactionStatus != '{1}'", entityReceipt.PaymentReceiptID, Constant.TransactionStatus.VOID));

                    string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
                    List<PatientBill> entityBill = BusinessLayer.GetPatientBillList(filterBill);

                    List<PatientPaymentHd> lstPelunasan = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.SETTLEMENT).ToList();
                    List<PatientPaymentHd> lstDepositIN = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DEPOSIT_IN).ToList();
                    List<PatientPaymentHd> lstPiutang = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.AR_PATIENT || t.GCPaymentType == Constant.PaymentType.AR_PAYER).ToList();
                    List<PatientPaymentHd> lstUangMuka = lstPayment.Where(t => t.GCPaymentType == Constant.PaymentType.DOWN_PAYMENT).ToList();

                    title = "PROFF";
                    if (lstPelunasan.Count > 0)
                    {
                        title = "RECEIPT";
                    }
                    else if (lstDepositIN.Count > 0)
                    {
                        title = "PROOF OF DEPOSIT";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count > 0)
                    {
                        title = "PROOF OF RECEIVABLES";
                    }
                    else if (lstPelunasan.Count <= 0 && lstPiutang.Count <= 0 && lstUangMuka.Count > 0)
                    {
                        title = "DOWN PAYMENT RECEIPT";
                    }

                    //ambil grandtotal
                    string amountTotal = entityDt.Select(ix => ix.MainTariff).Sum().ToString("N2");
                    if (amountTotal.Length > 16)
                    {
                        amountTotal = amountTotal.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - amountTotal.Length;
                        amountTotal = AddCharBefore(amountTotal, count);
                    }
                    #endregion

                    #region fill data into ArrayString
                    string printAsName = entityReceipt.PrintAsName;
                    string patientName = entityReceipt.PatientName;
                    string paramedicNameRegis = reg.ParamedicName;
                    string officer = entityPaymentHd.LastOrDefault().CreatedByUser;
                    string penjamin = reg.BusinessPartnerName;

                    //validasi panjang cetak atas nama
                    if (printAsName.Length > 35)
                    {
                        printAsName = printAsName.Substring(0, 34);
                    }

                    //validasi panjang nama pasien
                    if (patientName.Length > 35)
                    {
                        patientName = patientName.Substring(0, 34);
                    }

                    if (paramedicNameRegis.Length > 35)
                    {
                        paramedicNameRegis = paramedicNameRegis.Substring(0, 34);
                    }

                    if (officer.Length > 15)
                    {
                        officer = officer.Substring(0, 15);
                    }

                    if (penjamin.Length > 35)
                    {
                        penjamin = penjamin.Substring(0, 34);
                    }

                    lstHeader.Add(string.Format("   Number            : {0}", entityReceipt.PaymentReceiptNo));
                    lstHeader.Add(string.Format("   Reg No / MR No    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
                    lstHeader.Add(string.Format("   Received From     : {0}", printAsName));
                    lstHeader.Add(string.Format("   Examination Date  : {0}", entityReceipt.RegistrationDateInString));
                    lstHeader.Add(string.Format("   Patient Name      : {0}", patientName));
                    lstHeader.Add(string.Format("   Department        : {0}", reg.DepartmentID));
                    lstHeader.Add(string.Format("   Paramedic Name    : {0}", paramedicNameRegis));
                    lstHeader.Add(string.Format("   Business Partner  : {0}", penjamin));
                    lstHeader.Add(string.Format("   Transaction / Medication Payment can't be returned."));
                    lstHeader.Add(string.Format("   Items not taken within a month,"));
                    lstHeader.Add(string.Format("   belong to hospital"));
                    lstHeader.Add(string.Format("      THANK YOU                          Jakarta, {0}", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    lstHeader.Add(string.Format("   [{0} {1}:{2}]                     ({3})", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), entityReceipt.ReceiptTime.Substring(0, 2), entityReceipt.ReceiptTime.Substring(3, 2), officer));

                    if (lstDepositIN.Count > 0)
                    {
                        lstDetail.Add(string.Format("DEPOSIT DETAIL :                                  "));
                    }
                    else
                    {
                        lstDetail.Add(string.Format("TRANSACTION DETAIL :                              "));
                    }


                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(33);

                    foreach (GetPatientChargesHdDtAllMCUReceipt entity in entityDt)
                    {
                        string name = entity.ItemName2;
                        string qty = entity.Quantity.ToString();
                        string amount = (entity.MainTariff + entity.DiscountAmount).ToString("N2");

                        if (name.Length > 20)
                        {
                            name = name.Substring(0, 20);
                        }
                        else if (name.Length < 20)
                        {
                            int count = 20 - name.Length;
                            name = AddChar(name, count);
                        }

                        if (qty.Length > 6)
                        {
                            qty = qty.Substring(0, 6);
                        }
                        else
                        {
                            int count = 6 - qty.Length;
                            qty = AddChar(qty, count);
                        }

                        if (amount.Length > 16)
                        {
                            amount = amount.Substring(0, 16);
                        }
                        else
                        {
                            int count = 16 - amount.Length;
                            amount = AddCharBefore(amount, count);
                        }

                        lstDetail.Add(string.Format("{0}   {1}   {2}  ", name, qty, amount));

                        //tambah nama dokter jika boleh
                        ItemService itemService = BusinessLayer.GetItemService(entity.ItemID);
                        if (itemService != null)
                        {
                            if (itemService.IsPrintWithDoctorName)
                            {
                                string paramedicName = entity.ParamedicName;

                                if (paramedicName.Length > 48)
                                {
                                    paramedicName = paramedicName.Substring(0, 48);
                                }
                                else
                                {
                                    int count = 48 - paramedicName.Length;
                                    paramedicName = AddChar(paramedicName, count);
                                }

                                lstDetail.Add(string.Format("{0}  ", paramedicName));
                            }
                        }
                    }

                    lstDetail.Add(string.Format("------------------------------------------------  "));

                    Decimal TotalBayar = 0;
                    Decimal TotalTransaksi = (entityDt.Select(ix => ix.MainTariff).Sum() + entityDt.Select(ix => ix.DiscountAmount).Sum());

                    if (title == "RECEIPT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungInstansi = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungInstansi > 0)
                        {
                            String DitanggungInstansiInString = DitanggungInstansi.ToString("N2");

                            if (DitanggungInstansiInString.Length > 16)
                            {
                                DitanggungInstansiInString = DitanggungInstansiInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungInstansiInString.Length;
                                DitanggungInstansiInString = AddCharBefore(DitanggungInstansiInString, count);
                            }
                            lstDetail.Add(string.Format("PAYER AMOUNT                  : {0}  ", DitanggungInstansiInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISCOUNT                      : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "PROOF OF RECEIVABLES")
                    {
                        TotalBayar = Piutang;
                        Decimal TotalDiskon = entityBill.Sum(t => t.PatientDiscountAmount) + entityBill.Sum(x => x.PayerDiscountAmount) + entityDt.Select(ix => ix.DiscountAmount).Sum();
                        Decimal DitanggungPasien = TotalTransaksi - TotalBayar - TotalDiskon;

                        if (DitanggungPasien > 0)
                        {
                            String DitanggungPasienInString = DitanggungPasien.ToString("N2");

                            if (DitanggungPasienInString.Length > 16)
                            {
                                DitanggungPasienInString = DitanggungPasienInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - DitanggungPasienInString.Length;
                                DitanggungPasienInString = AddCharBefore(DitanggungPasienInString, count);
                            }
                            lstDetail.Add(string.Format("PATIENT AMOUNT                : {0}  ", DitanggungPasienInString));
                        }
                        if (TotalDiskon > 0)
                        {
                            String TotalDiskonInString = TotalDiskon.ToString("N2");

                            if (TotalDiskonInString.Length > 16)
                            {
                                TotalDiskonInString = TotalDiskonInString.Substring(0, 16);
                            }
                            else
                            {
                                int count = 16 - TotalDiskonInString.Length;
                                TotalDiskonInString = AddCharBefore(TotalDiskonInString, count);
                            }
                            lstDetail.Add(string.Format("DISCOUNT                      : {0}  ", TotalDiskonInString));
                        }
                    }
                    else if (title == "PROOF OF DEPOSIT")
                    {
                        TotalBayar = Cash + UangTitipan + CreditCard + DebitCard + BankTransfer + Voucher + BRIPeduli + OVOPayment + OnlinePayment + QRISFelloPayment + DepositOut;

                        lstDetail.Add(string.Format("                                                  "));
                        lstDetail.Add(string.Format("                                                  "));
                    }

                    if (title != "PROOF OF DEPOSIT")
                    {
                        lstDetail.Add(string.Format("TOTAL TRANSACTION             : {0}  ", amountTotal));
                        lstDetail.Add(string.Format("                                ----------------  "));
                    }

                    if (CashInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Cash                ", CashInString));
                    }

                    if (UangTitipanInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Deposit             ", UangTitipanInString));
                    }

                    if (CreditCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Credit Card         ", CreditCardInString));
                    }

                    if (DebitCardInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Debit Card          ", DebitCardInString));
                    }

                    if (BankTransferInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Bank Transfer       ", BankTransferInString));
                    }

                    if (PiutangInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Account Receivables ", PiutangInString));
                    }

                    if (VoucherInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Voucher             ", VoucherInString));
                    }

                    if (BRIPeduliInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "BRI Peduli          ", BRIPeduliInString));
                    }

                    if (OVOPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "OVO Payment         ", OVOPaymentInString));
                    }

                    if (OnlinePaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "Online Payment      ", OnlinePaymentInString));
                    }

                    if (QRISFelloPaymentInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "QRIS Fello Payment  ", QRISFelloPaymentInString));
                    }

                    if (DepositOutInString != "0.00")
                    {
                        lstDetail.Add(string.Format("     {0}     : {1}  ", "DEPOSIT             ", DepositOutInString));
                    }

                    lstDetail.Add(string.Format("                                ----------------  "));

                    string totalBayarInString = TotalBayar.ToString("N2");
                    if (totalBayarInString.Length > 16)
                    {
                        totalBayarInString = totalBayarInString.Substring(0, 16);
                    }
                    else
                    {
                        int count = 16 - totalBayarInString.Length;
                        totalBayarInString = AddCharBefore(totalBayarInString, count);
                    }

                    decimal selisih = TotalTransaksi - TotalBayar;
                    if (title != "PROOF OF RECEIVABLES")
                    {
                        lstDetail.Add(string.Format("                                ----------------  "));
                        if (title == "PROOF OF DEPOSIT")
                        {
                            lstDetail.Add(string.Format("TOTAL DEPOSIT                 : {0}  ", totalBayarInString));
                        }
                        else
                        {
                            lstDetail.Add(string.Format("TOTAL PAYMENT                 : {0}  ", totalBayarInString));
                        }
                    }
                    #endregion

                    string terbilang = Function.NumberInWordsInEnglish(Convert.ToInt32(TotalBayar), true);
                    lstDetail.Add(string.Format("Amount In Words :                                 "));

                    if (terbilang.Length > 50)
                    {
                        int max = terbilang.Length - 50;
                        string t1 = terbilang.Substring(0, 50);
                        string t2 = terbilang.Substring(50, max);

                        if (t2.Length > 50)
                        {
                            t2 = t2.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - t2.Length;
                            t2 = AddChar(t2, count);
                        }

                        lstDetail.Add(string.Format("{0}", t1));
                        lstDetail.Add(string.Format("{0}", t2));
                    }
                    else
                    {
                        if (terbilang.Length > 50)
                        {
                            terbilang = terbilang.Substring(0, 50);
                        }
                        else
                        {
                            int count = 50 - terbilang.Length;
                            terbilang = AddChar(terbilang, count);
                        }

                        lstDetail.Add(string.Format("{0}", terbilang));
                    }

                    if (title == "PROOF OF DEPOSIT")
                    {
                        string keterangan = lstDepositIN.FirstOrDefault().Remarks;
                        lstDetail.Add(string.Format("Remarks :                                      "));

                        if (keterangan.Length > 50)
                        {
                            int max = keterangan.Length - 50;
                            string t1 = keterangan.Substring(0, 50);
                            string t2 = keterangan.Substring(50, max);

                            if (t2.Length > 50)
                            {
                                t2 = t2.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - t2.Length;
                                t2 = AddChar(t2, count);
                            }

                            lstDetail.Add(string.Format("{0}", t1));
                            lstDetail.Add(string.Format("{0}", t2));
                        }
                        else
                        {
                            if (keterangan.Length > 50)
                            {
                                keterangan = keterangan.Substring(0, 50);
                            }
                            else
                            {
                                int count = 50 - keterangan.Length;
                                keterangan = AddChar(keterangan, count);
                            }

                            lstDetail.Add(string.Format("{0}", keterangan));
                        }
                    }
                }

                #region Print
                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(33);
                dotMatrix.SelectDraftMode();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.SetTittleFont(string.Format("                    {0}                    \n", title));
                dotMatrix.Append("\n");
                dotMatrix.Append(lstDetail[0]);
                dotMatrix.Append(lstHeader[0]);
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");

                if (lstDetail.Count() > 0)
                {
                    int i = 0;
                    int totalLineTemp = lstDetail.Count();

                    if (lstDetail.Count() < lstHeader.Count())
                    {
                        totalLineTemp = lstHeader.Count();
                    }

                    if (totalLineTemp < 18)
                    {
                        totalLineTemp = 18;
                    }

                    while (i < totalLineTemp)
                    {
                        if (i > 0)
                        {
                            if (i < lstDetail.Count())
                            {
                                dotMatrix.Append(lstDetail[i]);
                            }
                            else
                            {
                                dotMatrix.Append("                                                  ");
                            }

                            if (i < 8)
                            {
                                dotMatrix.SelectEmphasizedMode();
                                dotMatrix.Append(lstHeader[i]);
                                dotMatrix.CancelEmphasizedMode();
                            }
                            else if (i == 9)
                            {
                                dotMatrix.Append(lstHeader[8]);
                            }
                            else if (i == 10)
                            {
                                dotMatrix.Append(lstHeader[9]);
                            }
                            else if (i == 11)
                            {
                                dotMatrix.Append(lstHeader[10]);
                            }
                            else if (i == 13)
                            {
                                dotMatrix.Append(lstHeader[11]);
                            }
                            else if (i == 16)
                            {
                                dotMatrix.Append(lstHeader[12]);
                            }
                            //else if (i == 18)
                            //{
                            //    dotMatrix.Append(lstHeader[13]);
                            //}
                            //else if (i == 19)
                            //{
                            //    dotMatrix.Append(lstHeader[14]);
                            //}
                            //else if (i == 20)
                            //{
                            //    if (lstHeader.Count == 16)
                            //    {
                            //        dotMatrix.Append(lstHeader[15]);
                            //    }
                            //}
                            dotMatrix.Append("\n");
                        }
                        i = i + 1;

                    }
                    dotMatrix.FormFeed();
                }
                #endregion

                #region Send Command to Printer

                //RawPrinterHelper print = new RawPrinterHelper();

                ////Initialize Printer
                //print.OpenPrint(printerUrl);
                //print.SendStringToPrinter(dotMatrix.ToString());
                //print.ClosePrint();

                #endregion
            }

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "KW");
                #endregion
            }
            return fileName;
        }

        public static String PrintBuktiPemeriksaan(Int32 chargesID, string printerUrl, string printFormat)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            List<string> lstHeader = new List<string>();
            List<string> lstDetail = new List<string>();
            List<string> lstFooter = new List<string>();

            #region take data
            String filter = String.Format("TransactionID = {0} ORDER BY ItemGroupID", chargesID);
            List<vPatientChargesDetailReport> lst = BusinessLayer.GetvPatientChargesDetailReportList(filter);

            string TotalTransaction = lst.Sum(t => t.LineAmount).ToString("N2");

            if (TotalTransaction.Length > 20)
            {
                TotalTransaction = TotalTransaction.Substring(0, 19);
            }
            else
            {
                int count = 20 - TotalTransaction.Length;
                TotalTransaction = AddCharBefore(TotalTransaction, count);
            }
            #endregion

            #region fill data into ArrayString
            string deptName = lst.FirstOrDefault().ChargesDepartmentID;
            string patientFrom = lst.FirstOrDefault().FromDepartmentID;
            string patientName = lst.FirstOrDefault().PatientName;
            string patientAddress = lst.FirstOrDefault().PatientAddress;
            string businessPartnerName = lst.FirstOrDefault().BusinessPartnerName;
            string total = "";
            string officer = "";

            if (deptName.Length > 15)
            {
                deptName = deptName.Substring(0, 15);
            }
            else
            {
                int count = 15 - deptName.Length;
                deptName = AddChar(deptName, count);
            }

            if (patientFrom.Length > 9)
            {
                patientFrom = patientFrom.Substring(0, 9);
            }
            else
            {
                int count = 9 - patientFrom.Length;
                patientFrom = AddChar(patientFrom, count);
            }

            if (patientName.Length > 89)
            {
                patientName = patientName.Substring(0, 89);
            }

            if (patientAddress.Length > 89)
            {
                patientAddress = patientAddress.Substring(0, 89);
            }

            if (businessPartnerName.Length > 89)
            {
                businessPartnerName = businessPartnerName.Substring(0, 89);
            }

            if (lst.FirstOrDefault().CreatedByName.Length > 7)
            {
                officer = lst.FirstOrDefault().CreatedByName.Substring(0, 7);
            }
            else
            {
                officer = lst.FirstOrDefault().CreatedByName;
            }

            total = lst.Sum(t => t.LineAmount).ToString("N2");

            if (total.Length > 30)
            {
                total = total.Substring(0, 30);
            }
            else
            {
                int count = 30 - total.Length;
                total = AddCharBefore(total, count);
            }

            lstHeader.Add(string.Format("BUKTI PEMERIKSAAN {0}\n", deptName));
            lstHeader.Add(string.Format("                                       Jenis Pasien : PASIEN {0} /                                       \n", patientFrom));
            lstHeader.Add(string.Format("No. Pemeriksaan    : {0}", lst.FirstOrDefault().TransactionNo));
            lstHeader.Add(string.Format("No. RM             : {0}", lst.FirstOrDefault().MedicalNo));
            lstHeader.Add(string.Format("Nama               : {0}", patientName));
            lstHeader.Add(string.Format("Alamat             : {0}", patientAddress));
            lstHeader.Add(string.Format("Penjamin           : {0}", businessPartnerName));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("Perincian TEST"));


            foreach (vPatientChargesDetailReport entity in lst)
            {
                string name = entity.ItemName1;
                string qty = entity.ChargedQuantity.ToString();
                string amount = entity.LineAmount.ToString("N2");

                if (name.Length > 60)
                {
                    name = name.Substring(0, 60);
                }
                else
                {
                    int count = 60 - name.Length;
                    name = AddChar(name, count);
                }

                if (qty.Length > 10)
                {
                    qty = qty.Substring(0, 10);
                }
                else
                {
                    int count = 10 - qty.Length;
                    qty = AddChar(qty, count);
                }

                if (amount.Length > 30)
                {
                    amount = amount.Substring(0, 30);
                }
                else
                {
                    int count = 30 - amount.Length;
                    amount = AddCharBefore(amount, count);
                }

                lstDetail.Add(string.Format("{0}{1}{2}\n", name, qty, amount));

                if (entity == lst.LastOrDefault())
                {
                    lstDetail.Add(string.Format("                                                                                --------------------\n"));
                    lstDetail.Add(string.Format("                                  Total     :                         {0}\n", total));
                    lstDetail.Add(string.Format("                                                                                 --------------------\n"));
                    lstDetail.Add(string.Format("                                                                                 --------------------\n\n"));
                }
            }
            lstFooter.Add(string.Format("                                                                     Jakarta, {0}        \n\n\n", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT)));
            lstFooter.Add(string.Format("                                                                         ( {0} )     \n", officer));
            lstFooter.Add(string.Format("                                                                           petugas       "));
            #endregion

            #region Print
            dotMatrix.InitPrinter();
            dotMatrix.SetPageLengthInLines(33);
            dotMatrix.SelectDraftMode();

            foreach (String z in lstHeader)
            {
                if (z == lstHeader.FirstOrDefault())
                {
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.SetTittleFont(z);
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }
                else if (z == lstHeader[1] || z == lstHeader[8])
                {
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.Append(z);
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }
                else
                {
                    dotMatrix.Append(z);
                    dotMatrix.Append("\n");
                }
            }

            if (lstDetail.Count <= 13)
            {
                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                }

                int count = 13 - lstDetail.Count;

                for (int i = 0; i < count; i++)
                {
                    dotMatrix.Append("\n");
                }

                foreach (string z in lstFooter)
                {
                    dotMatrix.Append(z);
                }
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("Halaman 1/1"));
                dotMatrix.FormFeed();
            }
            else
            {
                int temp = 0;
                int totalPer13 = Convert.ToInt32(Math.Ceiling((double)lstDetail.Count() / 13));

                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                    temp = temp + 1;

                    if (temp % 13 == 0 || temp == lstDetail.Count())
                    {

                        int hal = temp / 13;

                        if (temp % 13 == 0 && temp != lstDetail.Count())
                        {
                            for (int z = 0; z < 6; z++)
                            {
                                dotMatrix.Append("\n");
                            }

                            dotMatrix.Append(string.Format("Halaman {0}/{1}", hal, totalPer13));
                            dotMatrix.FormFeed();

                            foreach (String z in lstHeader)
                            {
                                if (z == lstHeader.FirstOrDefault())
                                {
                                    dotMatrix.SelectEmphasizedMode();
                                    dotMatrix.SetFont15cpi();
                                    dotMatrix.SetTittleFont(z);
                                    dotMatrix.CancelEmphasizedMode();
                                    dotMatrix.Append("\n");
                                }
                                else
                                {
                                    dotMatrix.Append(z);
                                    dotMatrix.Append("\n");
                                }
                            }
                        }
                        else if (temp % 13 != 0 && temp == lstDetail.Count())
                        {
                            int count = ((13 * totalPer13) - lstDetail.Count);

                            for (int i = 0; i < count; i++)
                            {
                                dotMatrix.Append("\n");
                            }

                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append("\n");
                            dotMatrix.Append(string.Format("Halaman {0}/{0}", totalPer13));
                            dotMatrix.FormFeed();
                        }
                        else if (temp % 13 == 0 && temp == lstDetail.Count())
                        {
                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append("\n");
                            dotMatrix.Append(string.Format("Halaman {0}/{0}", totalPer13));
                            dotMatrix.FormFeed();
                        }
                    }
                }
            }
            #endregion

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(dotMatrix.ToString());
            //print.ClosePrint();
            #endregion

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "BPR");
                #endregion
            }
            return fileName;
        }

        public static String PrintBuktiPemeriksaanLab(Int32 chargesID)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

            #region take data
            String filter = String.Format("TransactionID = {0}", chargesID);
            vPatientChargesHd chargesHd = BusinessLayer.GetvPatientChargesHdList(filter).FirstOrDefault();

            List<vPatientChargesDt> chargesDt = BusinessLayer.GetvPatientChargesDtList(string.Format(
                "TransactionID = {0} AND IsDeleted = 0 AND ISNULL(GCTransactionDetailStatus,'') != '{1}'", chargesHd.TransactionID, Constant.TransactionStatus.VOID));
            var result = chargesDt.GroupBy(test => test.ItemGroupID).Select(grp => grp.First()).ToList();

            TestOrderHd order = BusinessLayer.GetTestOrderHd(chargesHd.TestOrderID);
            vRegistration registration = BusinessLayer.GetvRegistrationList(string.Format("VisitID = {0}", chargesHd.VisitID)).FirstOrDefault();
            #endregion

            #region setLength
            string numberInfo = string.Format("{0} / {1}", chargesHd.TransactionNo, registration.RegistrationNo);
            string paramedicName = registration.ParamedicName;
            string notes = "-";
            string infoOrder = "-";

            if (order != null)
            {
                numberInfo = string.Format("{0} / {1}", order.TestOrderNo, registration.RegistrationNo);
                infoOrder = order.TestOrderDate.ToString(Constant.FormatString.DATE_FORMAT);
                notes = order.Remarks.Replace("\n", "");
            }

            string patientName = registration.PatientName;
            string gender = "";
            string roomInfo = "";

            if (registration.GCGender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            string SexAge = string.Format("{0} / {1} Tahun {2} Bulan", gender, registration.AgeInYear, registration.AgeInMonth);

            //if (numberInfo.Length > 32)
            //{
            //    numberInfo = numberInfo.Substring(0, 32);
            //}

            if (patientName.Length > 32)
            {
                patientName = patientName.Substring(0, 32);
            }

            if (SexAge.Length > 32)
            {
                SexAge = SexAge.Substring(0, 32);
            }

            if (paramedicName.Length > 32)
            {
                paramedicName = paramedicName.Substring(0, 32);
            }

            if (registration.DepartmentID == Constant.Facility.INPATIENT)
            {
                roomInfo = string.Format("{0} / {1} / {2}", registration.RoomCode, registration.RoomName, registration.BedCode);

                if (roomInfo.Length > 32)
                {
                    roomInfo = roomInfo.Substring(0, 32);
                }
            }
            #endregion

            #region Print
            foreach (vPatientChargesDt group in result)
            {
                List<vPatientChargesDt> gr = chargesDt.Where(x => x.ItemGroupID == group.ItemGroupID).ToList();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(33);
                dotMatrix.SelectDraftMode();
                dotMatrix.SetFont15cpi();
                dotMatrix.Append(string.Format("RUMAH SAKIT MEDISTRA\n"));
                dotMatrix.Append(string.Format("UNIT LABORATORIUM\n\n"));
                dotMatrix.SetTittleFont(string.Format("BUKTI PEMERIKSAAN LABORATORIUM\n"));
                dotMatrix.Append(string.Format("------------------------------------------------------------\n"));
                dotMatrix.SetFont12cpi();
                dotMatrix.Append(string.Format("No Order / No. Registrasi : {0}\n", numberInfo));
                dotMatrix.Append(string.Format("Tanggal Order             : {0}\n", infoOrder));
                dotMatrix.Append(string.Format("Nama Pasien               : {0}\n", patientName));
                dotMatrix.Append(string.Format("No. Rekam Medis           : {0}\n", registration.MedicalNo));
                dotMatrix.Append(string.Format("Tanggal Lahir             : {0}\n", registration.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT)));
                dotMatrix.Append(string.Format("Sex / Umur                : {0}\n", SexAge));
                dotMatrix.Append(string.Format("Dokter                    : {0}\n", paramedicName));
                dotMatrix.Append(string.Format("Ruang                     : {0}\n", roomInfo));

                if (notes.Length > 54)
                {
                    Int32 length = notes.Length;
                    string noteLine1 = notes.Substring(0, 54);
                    dotMatrix.Append(string.Format("Catatan Klinis            : {0}\n", noteLine1));
                    length = length - 54;
                    if (length > 0)
                    {
                        if (length >= 54)
                        {
                            string noteLine2 = notes.Substring(54, 54);
                            dotMatrix.Append(string.Format("                            {0}\n", noteLine2));
                            length = length - 54;

                            if (length > 0)
                            {
                                if (length >= 54)
                                {
                                    string noteLine3 = notes.Substring(109, 54);
                                    dotMatrix.Append(string.Format("                            {0}\n", noteLine3));
                                    length = length - 54;

                                    if (length > 0)
                                    {
                                        if (length >= 54)
                                        {
                                            string noteLine4 = notes.Substring(163, 54);
                                            dotMatrix.Append(string.Format("                            {0}\n", noteLine4));
                                            length = length - 54;
                                        }
                                        else
                                        {
                                            string noteLine4 = notes.Substring(163, length - 1);
                                            if (!String.IsNullOrEmpty(noteLine4))
                                            {
                                                dotMatrix.Append(string.Format("                            {0}\n", noteLine4));
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    string noteLine3 = notes.Substring(108, length - 1);
                                    if (!String.IsNullOrEmpty(noteLine3))
                                    {
                                        dotMatrix.Append(string.Format("                            {0}\n", noteLine3));
                                    }
                                }
                            }
                        }
                        else
                        {
                            string noteLine2 = notes.Substring(54, length);
                            if (!String.IsNullOrEmpty(noteLine2))
                            {
                                dotMatrix.Append(string.Format("                            {0}\n", noteLine2));
                            }
                        }
                    }
                }
                else
                {
                    dotMatrix.Append(string.Format("Catatan Klinis            : {0}\n", notes));
                }

                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}\n", group.ItemGroupName1));
                dotMatrix.CancelEmphasizedMode();
                foreach (vPatientChargesDt entity in gr)
                {
                    string name = entity.ItemName1;
                    if (name.Length > 60)
                    {
                        name = name.Substring(0, 60);
                    }
                    dotMatrix.Append(string.Format("{0}\n", name));
                }
                dotMatrix.FormFeed();
            }

            #endregion

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(dotMatrix.ToString());
            //print.ClosePrint();
            #endregion

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "BPL");
                #endregion
            }
            return fileName;
        }

        public static String PrintCopyKwitansi(String ReceiptID, string printerUrl)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            List<string> lstHeader = new List<string>();
            List<string> lstDetail = new List<string>();
            List<string> lstFooter = new List<string>();

            #region use small paper
            //#region take data
            //String filterReceipt = String.Format("PaymentReceiptID = {0}", ReceiptID);
            //vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();

            //string receiptTotal = entityReceipt.ReceiptAmount.ToString("N2");

            //if (receiptTotal.Length > 20)
            //{
            //    receiptTotal = receiptTotal.Substring(0, 19);
            //}
            //else
            //{
            //    int count = 20 - receiptTotal.Length;
            //    receiptTotal = AddCharBefore(receiptTotal, count);
            //}

            //string paymentMethod = entityReceipt.PaymentMethod;

            //if (paymentMethod.Length > 20)
            //{
            //    paymentMethod = paymentMethod.Substring(0, 19);
            //}
            //else
            //{
            //    int count = 20 - paymentMethod.Length;
            //    paymentMethod = AddChar(paymentMethod, count);
            //}

            //string filterCharges = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            //List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);

            //string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1})))", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            //List<PatientBill> lstBilling = BusinessLayer.GetPatientBillList(filterBill);
            //decimal totalDiscount = lstBilling.Sum(t => t.PatientDiscountAmount) + lstBilling.Sum(x => x.PayerDiscountAmount);
            //decimal totalAdmin = lstBilling.Sum(t => t.AdministrationFeeAmount) + lstBilling.Sum(x => x.PatientAdminFeeAmount);
            //decimal totalService = lstBilling.Sum(t => t.ServiceFeeAmount) + lstBilling.Sum(x => x.PatientServiceFeeAmount);

            //vRegistration registration = BusinessLayer.GetvRegistrationList(String.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();
            //var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList();
            //decimal amountTotal = entityDt.Select(ix => ix.LineAmount).Sum();
            //string TotalInWord = entityReceipt.ReceiptAmountInStringInd;

            //if (TotalInWord.Length > 41)
            //{
            //    TotalInWord = TotalInWord.Substring(0, 40);
            //}
            //else
            //{
            //    int count = 20 - TotalInWord.Length;
            //    TotalInWord = AddChar(TotalInWord, count);
            //}

            //string receiptOfficerName = entityReceipt.CreatedByUserName;
            //if (receiptOfficerName.Length > 17)
            //{
            //    receiptOfficerName = receiptOfficerName.Substring(0, 16);
            //}
            //else
            //{
            //    int count = 17 - receiptOfficerName.Length;
            //    receiptOfficerName = AddChar(receiptOfficerName, count);
            //}
            //#endregion

            //#region fill data into ArrayString
            //lstHeader.Add(string.Format("          COPY KWITANSI {0}", registration.DepartmentID));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));
            //lstHeader.Add(string.Format("          No.Kwitansi       : {0}", entityReceipt.PaymentReceiptNo));
            //lstHeader.Add(string.Format("          No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
            //lstHeader.Add(string.Format("          Sudah Terima Dari : {0}", entityReceipt.PrintAsName));
            //lstHeader.Add(string.Format("          Nama Pasien       : {0}", entityReceipt.PatientName));
            //lstHeader.Add(string.Format("          Dokter            : {0}", registration.ParamedicName));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));

            //foreach (vPatientChargesDt7 entity in result)
            //{
            //    List<vPatientChargesDt7> en = entityDt.Where(t => t.DepartmentID == entity.DepartmentID).ToList();

            //    int number = 1;
            //    foreach (vPatientChargesDt7 eGroup in en)
            //    {
            //        string name = eGroup.ItemName1;
            //        string qty = eGroup.ChargedQuantity.ToString();
            //        string amount = eGroup.LineAmount.ToString("N2");
            //        string subtotal = en.Select(ix => ix.LineAmount).Sum().ToString("N2");
            //        string deptIDValid = eGroup.DepartmentID;

            //        if (name.Length > 20)
            //        {
            //            name = name.Substring(0, 20);
            //        }
            //        else
            //        {
            //            int count = 20 - name.Length;
            //            name = AddChar(name, count);
            //        }

            //        if (qty.Length > 6)
            //        {
            //            qty = qty.Substring(0, 6);
            //        }
            //        else
            //        {
            //            int count = 6 - qty.Length;
            //            qty = AddChar(qty, count);
            //        }

            //        if (amount.Length > 16)
            //        {
            //            amount = amount.Substring(0, 16);
            //        }
            //        else
            //        {
            //            int count = 16 - amount.Length;
            //            amount = AddCharBefore(amount, count);
            //        }

            //        if (subtotal.Length > 20)
            //        {
            //            subtotal = amount.Substring(0, 20);
            //        }
            //        else
            //        {
            //            int count = 20 - subtotal.Length;
            //            subtotal = AddCharBefore(subtotal, count);
            //        }

            //        string numberInString = "";
            //        if (number < 10)
            //        {
            //            numberInString = "0" + number.ToString();
            //        }
            //        else
            //        {
            //            numberInString = number.ToString();
            //        }

            //        if (numberInString.Length > 4)
            //        {
            //            numberInString = amount.Substring(0, 4);
            //        }
            //        else if (numberInString.Length < 4)
            //        {
            //            int count = 4 - numberInString.Length;
            //            numberInString = AddChar(numberInString, count);
            //        }

            //        if (deptIDValid.Length > 14)
            //        {
            //            deptIDValid = deptIDValid.Substring(0, 14);
            //        }
            //        else
            //        {
            //            int count = 14 - deptIDValid.Length;
            //            deptIDValid = AddChar(deptIDValid, count);
            //        }

            //        if (eGroup == en.FirstOrDefault())
            //        {
            //            lstDetail.Add(string.Format("            Transaksi {0}", eGroup.DepartmentID));
            //        }
            //        lstDetail.Add(string.Format("          {0} {1}   {2}   {3}", numberInString, name, qty, amount));

            //        if (eGroup == en.LastOrDefault())
            //        {
            //            lstDetail.Add(string.Format("                                                  -------------"));
            //            lstDetail.Add(string.Format("            TOTAL Transaksi {0} {1}", deptIDValid, subtotal));
            //        }

            //        number = number + 1;
            //    }
            //}

            //lstDetail.Add(string.Format("          -----------------------------------------------------"));


            //if (totalAdmin > 0)
            //{
            //    string admin = totalAdmin.ToString("N2");

            //    if (admin.Length > 20)
            //    {
            //        admin = admin.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - admin.Length;
            //        admin = AddCharBefore(admin, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL ADMINISTRASI   : {0}", admin));
            //    amountTotal = amountTotal + totalAdmin;
            //}

            //if (totalService > 0)
            //{
            //    string service = totalService.ToString("N2");

            //    if (service.Length > 20)
            //    {
            //        service = service.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - service.Length;
            //        service = AddCharBefore(service, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL PELAYANAN      : {0}", service));
            //    amountTotal = amountTotal + totalService;
            //}

            //if (totalDiscount > 0)
            //{
            //    string discount = totalDiscount.ToString("N2");

            //    if (discount.Length > 20)
            //    {
            //        discount = discount.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - discount.Length;
            //        discount = AddCharBefore(discount, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL DISKON         : {0}", discount));
            //    amountTotal = amountTotal - totalDiscount;
            //}

            //string totalTransaction = amountTotal.ToString("N2");
            //if (totalTransaction.Length > 20)
            //{
            //    totalTransaction = totalTransaction.Substring(0, 20);
            //}
            //else
            //{
            //    int count = 20 - totalTransaction.Length;
            //    totalTransaction = AddCharBefore(totalTransaction, count);
            //}

            //lstDetail.Add(string.Format("                    TOTAL TRANSAKSI      : {0}", totalTransaction));
            //lstDetail.Add(string.Format("                                                  -------------"));
            //lstDetail.Add(string.Format("               {0}      : {1}", paymentMethod, receiptTotal));
            //lstDetail.Add(string.Format("                                                  -------------"));
            //lstDetail.Add(string.Format("                   TOTAL PEMBAYARAN      : {0}", receiptTotal));
            //lstDetail.Add(string.Format("\n            Terbilang : {0}", TotalInWord));

            //lstFooter.Add(string.Format("\n          ** TERIMA KASIH **                Jakarta, {0}\n", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
            //lstFooter.Add(string.Format("\n\n            [{0} {1}]             ( {2} )", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT), DateTime.Now.ToString("HH:mm"), receiptOfficerName));
            //lstFooter.Add(string.Format("\n          * Transaksi/Pembelian Obat tidak dapat dikembalikan"));
            //lstFooter.Add(string.Format("\n          * Barang yang tdk diambil dalam jangka waktu 1 bulan,"));
            //lstFooter.Add(string.Format("\n            menjadi milik rumah sakit."));
            //#endregion

            //#region Print
            //dotMatrix.InitPrinter();
            //dotMatrix.SetPageLengthInLines(33);

            //foreach (String z in lstHeader)
            //{
            //    if (z == lstHeader.FirstOrDefault())
            //    {
            //        dotMatrix.SelectEmphasizedMode();
            //        dotMatrix.SetFont15cpi();
            //        dotMatrix.SetTittleFont(z);
            //        dotMatrix.CancelEmphasizedMode();
            //        dotMatrix.Append("\n");
            //    }
            //    else
            //    {
            //        dotMatrix.Append(z);
            //        dotMatrix.Append("\n");
            //    }
            //}

            //if (lstDetail.Count <= 12)
            //{
            //    foreach (string k in lstDetail)
            //    {
            //        dotMatrix.Append(k);
            //        dotMatrix.Append("\n");
            //    }

            //    int count = 12 - lstDetail.Count;

            //    for (int i = 0; i < count; i++)
            //    {
            //        dotMatrix.Append("\n");
            //    }

            //    foreach (string z in lstFooter)
            //    {
            //        dotMatrix.Append(z);
            //    }

            //    dotMatrix.Append(string.Format("\n          Halaman 1/1"));
            //    dotMatrix.FormFeed();
            //}
            //else
            //{
            //    int temp = 0;
            //    int totalPer12 = Convert.ToInt32(Math.Ceiling((double)lstDetail.Count() / 12));

            //    foreach (string k in lstDetail)
            //    {
            //        dotMatrix.Append(k);
            //        dotMatrix.Append("\n");
            //        temp = temp + 1;

            //        if (temp % 12 == 0 || temp == lstDetail.Count())
            //        {

            //            int hal = temp / 12;

            //            if (temp % 12 == 0 && temp != lstDetail.Count())
            //            {
            //                for (int z = 0; z < 8; z++)
            //                {
            //                    dotMatrix.Append("\n");
            //                }

            //                dotMatrix.Append(string.Format("          Halaman {0}/{1}", hal, totalPer12));
            //                dotMatrix.FormFeed();

            //                foreach (String z in lstHeader)
            //                {
            //                    if (z == lstHeader.FirstOrDefault())
            //                    {
            //                        dotMatrix.SelectEmphasizedMode();
            //                        dotMatrix.SetFont15cpi();
            //                        dotMatrix.SetTittleFont(z);
            //                        dotMatrix.CancelEmphasizedMode();
            //                        dotMatrix.Append("\n");
            //                    }
            //                    else
            //                    {
            //                        dotMatrix.Append(z);
            //                        dotMatrix.Append("\n");
            //                    }
            //                }
            //            }
            //            else if (temp == lstDetail.Count() && temp % 11 != 0)
            //            {
            //                int count = ((12 * totalPer12) - lstDetail.Count);

            //                for (int i = 0; i < count; i++)
            //                {
            //                    dotMatrix.Append("\n");
            //                }

            //                foreach (string z in lstFooter)
            //                {
            //                    dotMatrix.Append(z);
            //                }

            //                dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
            //                dotMatrix.FormFeed();
            //            }
            //            else if (temp == lstDetail.Count() && temp % 12 == 0)
            //            {
            //                foreach (string z in lstFooter)
            //                {
            //                    dotMatrix.Append(z);
            //                }

            //                dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
            //                dotMatrix.FormFeed();
            //            }
            //        }
            //    }
            //}
            //#endregion
            #endregion

            #region use 1/2 A4
            #region take data
            String filterReceipt = String.Format("PaymentReceiptID = {0}", ReceiptID);
            vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();

            string receiptTotal = entityReceipt.ReceiptAmount.ToString("N2");
            string printAsName = entityReceipt.PrintAsName;
            string patientName = entityReceipt.PatientName;

            if (receiptTotal.Length > 30)
            {
                receiptTotal = receiptTotal.Substring(0, 30);
            }
            else
            {
                int count = 30 - receiptTotal.Length;
                receiptTotal = AddCharBefore(receiptTotal, count);
            }

            string paymentMethod = entityReceipt.PaymentMethod;

            if (paymentMethod.Length > 50)
            {
                paymentMethod = paymentMethod.Substring(0, 50);
            }
            else
            {
                int count = 50 - paymentMethod.Length;
                paymentMethod = AddChar(paymentMethod, count);
            }

            if (printAsName.Length > 90)
            {
                printAsName = printAsName.Substring(0, 90);
            }
            else
            {
                int count = 90 - printAsName.Length;
                printAsName = AddChar(printAsName, count);
            }

            if (patientName.Length > 90)
            {
                patientName = patientName.Substring(0, 90);
            }
            else
            {
                int count = 90 - patientName.Length;
                patientName = AddChar(patientName, count);
            }

            string filterCharges = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);

            string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1})))", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            List<PatientBill> lstBilling = BusinessLayer.GetPatientBillList(filterBill);

            decimal totalDiscount = lstBilling.Sum(t => t.PatientDiscountAmount) + lstBilling.Sum(x => x.PayerDiscountAmount);
            decimal totalAdmin = lstBilling.Sum(t => t.AdministrationFeeAmount) + lstBilling.Sum(x => x.PatientAdminFeeAmount);
            decimal totalService = lstBilling.Sum(t => t.ServiceFeeAmount) + lstBilling.Sum(x => x.PatientServiceFeeAmount);

            vRegistration registration = BusinessLayer.GetvRegistrationList(String.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();
            string paramedicName = registration.ParamedicName;
            var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList();
            decimal amountTotal = entityDt.Select(ix => ix.LineAmount).Sum();
            string TotalInWord = entityReceipt.ReceiptAmountInStringInd;

            if (TotalInWord.Length > 86)
            {
                TotalInWord = TotalInWord.Substring(0, 86);
            }
            else
            {
                int count = 86 - TotalInWord.Length;
                TotalInWord = AddChar(TotalInWord, count);
            }

            string receiptOfficerName = entityReceipt.CreatedByUserName;
            if (receiptOfficerName.Length > 17)
            {
                receiptOfficerName = receiptOfficerName.Substring(0, 17);
            }
            else
            {
                int count = 17 - receiptOfficerName.Length;
                receiptOfficerName = AddChar(receiptOfficerName, count);
            }
            #endregion

            #region fill data into ArrayString
            lstHeader.Add(string.Format("COPY KWITANSI {0}", registration.DepartmentID));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("No.Kwitansi       : {0}", entityReceipt.PaymentReceiptNo));
            lstHeader.Add(string.Format("No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
            lstHeader.Add(string.Format("Sudah Terima Dari : {0}", printAsName));
            lstHeader.Add(string.Format("Nama Pasien       : {0}", patientName));
            lstHeader.Add(string.Format("Dokter            : {0}", paramedicName));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));

            foreach (vPatientChargesDt7 entity in result)
            {
                List<vPatientChargesDt7> en = entityDt.Where(t => t.DepartmentID == entity.DepartmentID).ToList();

                int number = 1;
                foreach (vPatientChargesDt7 eGroup in en)
                {
                    string name = eGroup.ItemName1;
                    string qty = eGroup.ChargedQuantity.ToString();
                    string amount = eGroup.LineAmount.ToString("N2");
                    string subtotal = en.Select(ix => ix.LineAmount).Sum().ToString("N2");
                    string deptIDValid = eGroup.DepartmentID;

                    if (name.Length > 55)
                    {
                        name = name.Substring(0, 55);
                    }
                    else
                    {
                        int count = 55 - name.Length;
                        name = AddChar(name, count);
                    }

                    if (qty.Length > 10)
                    {
                        qty = qty.Substring(0, 10);
                    }
                    else
                    {
                        int count = 10 - qty.Length;
                        qty = AddChar(qty, count);
                    }

                    if (amount.Length > 30)
                    {
                        amount = amount.Substring(0, 30);
                    }
                    else
                    {
                        int count = 30 - amount.Length;
                        amount = AddCharBefore(amount, count);
                    }

                    if (subtotal.Length > 30)
                    {
                        subtotal = amount.Substring(0, 30);
                    }
                    else
                    {
                        int count = 30 - subtotal.Length;
                        subtotal = AddCharBefore(subtotal, count);
                    }

                    string numberInString = "";
                    if (number < 10)
                    {
                        numberInString = "0" + number.ToString();
                    }
                    else
                    {
                        numberInString = number.ToString();
                    }

                    if (numberInString.Length > 5)
                    {
                        numberInString = amount.Substring(0, 5);
                    }
                    else if (numberInString.Length < 5)
                    {
                        int count = 5 - numberInString.Length;
                        numberInString = AddChar(numberInString, count);
                    }

                    if (deptIDValid.Length > 48)
                    {
                        deptIDValid = deptIDValid.Substring(0, 48);
                    }
                    else
                    {
                        int count = 48 - deptIDValid.Length;
                        deptIDValid = AddChar(deptIDValid, count);
                    }

                    if (eGroup == en.FirstOrDefault())
                    {
                        lstDetail.Add(string.Format("     Transaksi {0}", eGroup.DepartmentID));
                    }
                    lstDetail.Add(string.Format("{0}{1}{2}{3}", numberInString, name, qty, amount));

                    if (eGroup == en.LastOrDefault())
                    {
                        lstDetail.Add(string.Format("                                                                                --------------------"));
                        lstDetail.Add(string.Format("     TOTAL Transaksi {0} {1}", deptIDValid, subtotal));
                    }

                    number = number + 1;
                }
            }

            lstDetail.Add(string.Format("----------------------------------------------------------------------------------------------------"));

            if (totalAdmin > 0)
            {
                string admin = totalAdmin.ToString("N2");

                if (admin.Length > 30)
                {
                    admin = admin.Substring(0, 30);
                }
                else
                {
                    int count = 30 - admin.Length;
                    admin = AddCharBefore(admin, count);
                }

                lstDetail.Add(string.Format("              TOTAL ADMINISTRASI                                     :{0}", admin));
                amountTotal = amountTotal + totalAdmin;
            }

            if (totalService > 0)
            {
                string service = totalService.ToString("N2");

                if (service.Length > 30)
                {
                    service = service.Substring(0, 30);
                }
                else
                {
                    int count = 30 - service.Length;
                    service = AddCharBefore(service, count);
                }

                lstDetail.Add(string.Format("              TOTAL PELAYANAN                                        :{0}", service));
                amountTotal = amountTotal + totalService;
            }

            if (totalDiscount > 0)
            {
                string discount = totalDiscount.ToString("N2");

                if (discount.Length > 30)
                {
                    discount = discount.Substring(0, 30);
                }
                else
                {
                    int count = 30 - discount.Length;
                    discount = AddCharBefore(discount, count);
                }

                lstDetail.Add(string.Format("              TOTAL DISKON                                          :{0}", discount));
                amountTotal = amountTotal - totalDiscount;
            }

            string totalTransaction = amountTotal.ToString("N2");
            if (totalTransaction.Length > 30)
            {
                totalTransaction = totalTransaction.Substring(0, 30);
            }
            else
            {
                int count = 30 - totalTransaction.Length;
                totalTransaction = AddCharBefore(totalTransaction, count);
            }

            lstDetail.Add(string.Format("              TOTAL TRANSAKSI                                        :{0}", totalTransaction));
            lstDetail.Add(string.Format("                                                                                --------------------"));
            lstDetail.Add(string.Format("                   {0}:{1}", paymentMethod, receiptTotal));
            lstDetail.Add(string.Format("                                                                                --------------------"));
            lstDetail.Add(string.Format("              TOTAL PEMBAYARAN                                       :{0}", receiptTotal));
            lstDetail.Add(string.Format("\n            Terbilang : {0}", TotalInWord));

            lstFooter.Add(string.Format("\n          ** TERIMA KASIH **                                                      Jakarta, {0}\n", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
            lstFooter.Add(string.Format("\n\n            [{0} {1}]                                                  ( {2} )", entityReceipt.ReceiptDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT), DateTime.Now.ToString("HH:mm"), receiptOfficerName));
            lstFooter.Add(string.Format("\n          * Transaksi/Pembelian Obat tidak dapat dikembalikan"));
            lstFooter.Add(string.Format("\n          * Barang yang tidak diambil dalam jangka waktu 1 bulan, menjadi milik rumah sakit."));
            #endregion

            #region Print
            dotMatrix.InitPrinter();
            dotMatrix.SetPageLengthInLines(33);
            dotMatrix.SelectDraftMode();

            foreach (String z in lstHeader)
            {
                if (z == lstHeader.FirstOrDefault())
                {
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.SetTittleFont(z);
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }
                else
                {
                    dotMatrix.Append(z);
                    dotMatrix.Append("\n");
                }
            }

            if (lstDetail.Count <= 12)
            {
                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                    dotMatrix.Append("\n");
                }

                int count = 12 - lstDetail.Count;

                for (int i = 0; i < count; i++)
                {
                    dotMatrix.Append("\n");
                }

                foreach (string z in lstFooter)
                {
                    dotMatrix.Append(z);
                }

                dotMatrix.Append(string.Format("\n          Halaman 1/1"));
                dotMatrix.FormFeed();
            }
            else
            {
                int temp = 0;
                int totalPer12 = Convert.ToInt32(Math.Ceiling((double)lstDetail.Count() / 12));

                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                    dotMatrix.Append("\n");
                    temp = temp + 1;

                    if (temp % 12 == 0 || temp == lstDetail.Count())
                    {

                        int hal = temp / 12;

                        if (temp % 12 == 0 && temp != lstDetail.Count())
                        {
                            for (int z = 0; z < 8; z++)
                            {
                                dotMatrix.Append("\n");
                            }

                            dotMatrix.Append(string.Format("          Halaman {0}/{1}", hal, totalPer12));
                            dotMatrix.FormFeed();

                            foreach (String z in lstHeader)
                            {
                                if (z == lstHeader.FirstOrDefault())
                                {
                                    dotMatrix.SelectEmphasizedMode();
                                    dotMatrix.SetFont15cpi();
                                    dotMatrix.SetTittleFont(z);
                                    dotMatrix.CancelEmphasizedMode();
                                    dotMatrix.Append("\n");
                                }
                                else
                                {
                                    dotMatrix.Append(z);
                                    dotMatrix.Append("\n");
                                }
                            }
                        }
                        else if (temp == lstDetail.Count() && temp % 11 != 0)
                        {
                            int count = ((12 * totalPer12) - lstDetail.Count);

                            for (int i = 0; i < count; i++)
                            {
                                dotMatrix.Append("\n");
                            }

                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
                            dotMatrix.FormFeed();
                        }
                        else if (temp == lstDetail.Count() && temp % 12 == 0)
                        {
                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
                            dotMatrix.FormFeed();
                        }
                    }
                }
            }
            #endregion
            #endregion

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(dotMatrix.ToString());
            //print.ClosePrint();
            #endregion

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "CKW");
                #endregion
            }
            return fileName;
        }

        public static String PrintCopyBuktiTransaksi(String ReceiptID, string printerUrl)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            List<string> lstHeader = new List<string>();
            List<string> lstDetail = new List<string>();
            List<string> lstFooter = new List<string>();

            #region use small paper
            //#region take data
            //String filterReceipt = String.Format("PaymentReceiptID = {0}", ReceiptID);
            //vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();

            //string receiptTotal = entityReceipt.ReceiptAmount.ToString("N2");

            //if (receiptTotal.Length > 20)
            //{
            //    receiptTotal = receiptTotal.Substring(0, 19);
            //}
            //else
            //{
            //    int count = 20 - receiptTotal.Length;
            //    receiptTotal = AddCharBefore(receiptTotal, count);
            //}

            //string paymentMethod = entityReceipt.PaymentMethod;

            //if (paymentMethod.Length > 20)
            //{
            //    paymentMethod = paymentMethod.Substring(0, 19);
            //}
            //else
            //{
            //    int count = 20 - paymentMethod.Length;
            //    paymentMethod = AddChar(paymentMethod, count);
            //}

            //string filterCharges = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            //List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);

            //string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1})))", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            //List<PatientBill> lstBilling = BusinessLayer.GetPatientBillList(filterBill);
            //decimal totalDiscount = lstBilling.Sum(t => t.PatientDiscountAmount) + lstBilling.Sum(x => x.PayerDiscountAmount);
            //decimal totalAdmin = lstBilling.Sum(t => t.AdministrationFeeAmount) + lstBilling.Sum(x => x.PatientAdminFeeAmount);
            //decimal totalService = lstBilling.Sum(t => t.ServiceFeeAmount) + lstBilling.Sum(x => x.PatientServiceFeeAmount);

            //vRegistration registration = BusinessLayer.GetvRegistrationList(String.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();

            //var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList();

            //decimal amountTotal = entityDt.Select(ix => ix.LineAmount).Sum();

            //string TotalInWord = entityReceipt.ReceiptAmountInStringInd;

            //if (TotalInWord.Length > 41)
            //{
            //    TotalInWord = TotalInWord.Substring(0, 40);
            //}
            //else
            //{
            //    int count = 20 - TotalInWord.Length;
            //    TotalInWord = AddChar(TotalInWord, count);
            //}

            //string receiptOfficerName = entityReceipt.CreatedByUserName;
            //if (receiptOfficerName.Length > 17)
            //{
            //    receiptOfficerName = receiptOfficerName.Substring(0, 16);
            //}
            //else
            //{
            //    int count = 17 - receiptOfficerName.Length;
            //    receiptOfficerName = AddChar(receiptOfficerName, count);
            //}
            //#endregion

            //#region fill data into ArrayString
            //lstHeader.Add(string.Format("          COPY BUKTI TRANSAKSI {0}", registration.DepartmentID));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));
            //lstHeader.Add(string.Format("          No.Kwitansi       : {0}", entityReceipt.PaymentReceiptNo));
            //lstHeader.Add(string.Format("          No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
            //lstHeader.Add(string.Format("          Sudah Terima Dari : {0}", entityReceipt.PrintAsName));
            //lstHeader.Add(string.Format("          Nama Pasien       : {0}", entityReceipt.PatientName));
            //lstHeader.Add(string.Format("          Instansi          : {0}", registration.BusinessPartnerName));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));
            //lstHeader.Add(string.Format("          -----------------------------------------------------"));

            //foreach (vPatientChargesDt7 entity in result)
            //{
            //    List<vPatientChargesDt7> en = entityDt.Where(t => t.DepartmentID == entity.DepartmentID).ToList();

            //    int number = 1;
            //    foreach (vPatientChargesDt7 eGroup in en)
            //    {
            //        string name = eGroup.ItemName1;
            //        string qty = eGroup.ChargedQuantity.ToString();
            //        string amount = eGroup.LineAmount.ToString("N2");
            //        string subtotal = en.Select(ix => ix.LineAmount).Sum().ToString("N2");
            //        string deptIDValid = eGroup.DepartmentID;

            //        if (name.Length > 20)
            //        {
            //            name = name.Substring(0, 20);
            //        }
            //        else
            //        {
            //            int count = 20 - name.Length;
            //            name = AddChar(name, count);
            //        }

            //        if (qty.Length > 6)
            //        {
            //            qty = qty.Substring(0, 6);
            //        }
            //        else
            //        {
            //            int count = 6 - qty.Length;
            //            qty = AddChar(qty, count);
            //        }

            //        if (amount.Length > 16)
            //        {
            //            amount = amount.Substring(0, 16);
            //        }
            //        else
            //        {
            //            int count = 16 - amount.Length;
            //            amount = AddCharBefore(amount, count);
            //        }

            //        if (subtotal.Length > 20)
            //        {
            //            subtotal = amount.Substring(0, 20);
            //        }
            //        else
            //        {
            //            int count = 20 - subtotal.Length;
            //            subtotal = AddCharBefore(subtotal, count);
            //        }

            //        string numberInString = "";
            //        if (number < 10)
            //        {
            //            numberInString = "0" + number.ToString();
            //        }
            //        else
            //        {
            //            numberInString = number.ToString();
            //        }

            //        if (numberInString.Length > 4)
            //        {
            //            numberInString = amount.Substring(0, 4);
            //        }
            //        else if (numberInString.Length < 4)
            //        {
            //            int count = 4 - numberInString.Length;
            //            numberInString = AddChar(numberInString, count);
            //        }

            //        if (deptIDValid.Length > 14)
            //        {
            //            deptIDValid = deptIDValid.Substring(0, 14);
            //        }
            //        else
            //        {
            //            int count = 14 - deptIDValid.Length;
            //            deptIDValid = AddChar(deptIDValid, count);
            //        }

            //        if (eGroup == en.FirstOrDefault())
            //        {
            //            lstDetail.Add(string.Format("            Transaksi {0}", eGroup.DepartmentID));
            //        }
            //        lstDetail.Add(string.Format("          {0} {1}   {2}   {3}", numberInString, name, qty, amount));

            //        if (eGroup == en.LastOrDefault())
            //        {
            //            lstDetail.Add(string.Format("                                                  -------------"));
            //            lstDetail.Add(string.Format("            TOTAL Transaksi {0} {1}", deptIDValid, subtotal));
            //        }

            //        number = number + 1;
            //    }
            //}

            //lstDetail.Add(string.Format("          -----------------------------------------------------"));


            //if (totalAdmin > 0)
            //{
            //    string admin = totalAdmin.ToString("N2");

            //    if (admin.Length > 20)
            //    {
            //        admin = admin.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - admin.Length;
            //        admin = AddCharBefore(admin, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL ADMINISTRASI   : {0}", admin));
            //    amountTotal = amountTotal + totalAdmin;
            //}

            //if (totalService > 0)
            //{
            //    string service = totalService.ToString("N2");

            //    if (service.Length > 20)
            //    {
            //        service = service.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - service.Length;
            //        service = AddCharBefore(service, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL PELAYANAN      : {0}", service));
            //    amountTotal = amountTotal + totalService;
            //}

            //if (totalDiscount > 0)
            //{
            //    string discount = totalDiscount.ToString("N2");

            //    if (discount.Length > 20)
            //    {
            //        discount = discount.Substring(0, 20);
            //    }
            //    else
            //    {
            //        int count = 20 - discount.Length;
            //        discount = AddCharBefore(discount, count);
            //    }
            //    lstDetail.Add(string.Format("                    TOTAL DISKON         : {0}", discount));
            //    amountTotal = amountTotal - totalDiscount;
            //}

            //string totalTransaction = amountTotal.ToString("N2");
            //if (totalTransaction.Length > 20)
            //{
            //    totalTransaction = totalTransaction.Substring(0, 20);
            //}
            //else
            //{
            //    int count = 20 - totalTransaction.Length;
            //    totalTransaction = AddCharBefore(totalTransaction, count);
            //}

            //lstDetail.Add(string.Format("                    TOTAL TRANSAKSI      : {0}", totalTransaction));
            //lstDetail.Add(string.Format("                                                  -------------"));
            //lstDetail.Add(string.Format("               {0}      : {1}", paymentMethod, receiptTotal));
            //lstDetail.Add(string.Format("                                                  -------------"));
            //lstDetail.Add(string.Format("                   TOTAL PEMBAYARAN      : {0}", receiptTotal));
            //lstDetail.Add(string.Format("\n            Terbilang : {0}", TotalInWord));

            //lstFooter.Add(string.Format("\n          ** TERIMA KASIH **                Jakarta, {0}\n", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
            //lstFooter.Add(string.Format("\n\n            [{0} {1}]             ( {2} )", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT), DateTime.Now.ToString("HH:mm"), receiptOfficerName));
            //lstFooter.Add(string.Format("\n          * Transaksi/Pembelian Obat tidak dapat dikembalikan"));
            //lstFooter.Add(string.Format("\n          * Barang yang tdk diambil dalam jangka waktu 1 bulan,"));
            //lstFooter.Add(string.Format("\n            menjadi milik rumah sakit."));
            //#endregion

            //#region Print
            //dotMatrix.InitPrinter();
            //dotMatrix.SetPageLengthInLines(33);

            //foreach (String z in lstHeader)
            //{
            //    if (z == lstHeader.FirstOrDefault())
            //    {
            //        dotMatrix.SelectEmphasizedMode();
            //        dotMatrix.SetFont15cpi();
            //        dotMatrix.SetTittleFont(z);
            //        dotMatrix.CancelEmphasizedMode();
            //        dotMatrix.Append("\n");
            //    }
            //    else
            //    {
            //        dotMatrix.Append(z);
            //        dotMatrix.Append("\n");
            //    }
            //}

            //if (lstDetail.Count <= 12)
            //{
            //    foreach (string k in lstDetail)
            //    {
            //        dotMatrix.Append(k);
            //        dotMatrix.Append("\n");
            //    }

            //    int count = 12 - lstDetail.Count;

            //    for (int i = 0; i < count; i++)
            //    {
            //        dotMatrix.Append("\n");
            //    }

            //    foreach (string z in lstFooter)
            //    {
            //        dotMatrix.Append(z);
            //    }

            //    dotMatrix.Append(string.Format("\n          Halaman 1/1"));
            //    dotMatrix.FormFeed();
            //}
            //else
            //{
            //    int temp = 0;
            //    int totalPer12 = Convert.ToInt32(Math.Ceiling((double)lstDetail.Count() / 12));

            //    foreach (string k in lstDetail)
            //    {
            //        dotMatrix.Append(k);
            //        dotMatrix.Append("\n");
            //        temp = temp + 1;

            //        if (temp % 12 == 0 || temp == lstDetail.Count())
            //        {

            //            int hal = temp / 12;

            //            if (temp % 12 == 0 && temp != lstDetail.Count())
            //            {
            //                for (int z = 0; z < 8; z++)
            //                {
            //                    dotMatrix.Append("\n");
            //                }

            //                dotMatrix.Append(string.Format("          Halaman {0}/{1}", hal, totalPer12));
            //                dotMatrix.FormFeed();

            //                foreach (String z in lstHeader)
            //                {
            //                    if (z == lstHeader.FirstOrDefault())
            //                    {
            //                        dotMatrix.SelectEmphasizedMode();
            //                        dotMatrix.SetFont15cpi();
            //                        dotMatrix.SetTittleFont(z);
            //                        dotMatrix.CancelEmphasizedMode();
            //                        dotMatrix.Append("\n");
            //                    }
            //                    else
            //                    {
            //                        dotMatrix.Append(z);
            //                        dotMatrix.Append("\n");
            //                    }
            //                }
            //            }
            //            else if (temp == lstDetail.Count() && temp % 11 != 0)
            //            {
            //                int count = ((12 * totalPer12) - lstDetail.Count);

            //                for (int i = 0; i < count; i++)
            //                {
            //                    dotMatrix.Append("\n");
            //                }

            //                foreach (string z in lstFooter)
            //                {
            //                    dotMatrix.Append(z);
            //                }

            //                dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
            //                dotMatrix.FormFeed();
            //            }
            //            else if (temp == lstDetail.Count() && temp % 12 == 0)
            //            {
            //                foreach (string z in lstFooter)
            //                {
            //                    dotMatrix.Append(z);
            //                }

            //                dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
            //                dotMatrix.FormFeed();
            //            }
            //        }
            //    }
            //}
            //#endregion
            #endregion

            #region use 1/2 A4
            #region take data
            String filterReceipt = String.Format("PaymentReceiptID = {0}", ReceiptID);
            vPaymentReceipt entityReceipt = BusinessLayer.GetvPaymentReceiptList(filterReceipt).FirstOrDefault();

            string receiptTotal = entityReceipt.ReceiptAmount.ToString("N2");
            string printAsName = entityReceipt.PrintAsName;
            string patientName = entityReceipt.PatientName;

            if (receiptTotal.Length > 30)
            {
                receiptTotal = receiptTotal.Substring(0, 30);
            }
            else
            {
                int count = 30 - receiptTotal.Length;
                receiptTotal = AddCharBefore(receiptTotal, count);
            }

            string paymentMethod = entityReceipt.PaymentMethod;

            if (paymentMethod.Length > 50)
            {
                paymentMethod = paymentMethod.Substring(0, 50);
            }
            else
            {
                int count = 50 - paymentMethod.Length;
                paymentMethod = AddChar(paymentMethod, count);
            }

            if (printAsName.Length > 90)
            {
                printAsName = printAsName.Substring(0, 90);
            }
            else
            {
                int count = 90 - printAsName.Length;
                printAsName = AddChar(printAsName, count);
            }

            if (patientName.Length > 90)
            {
                patientName = patientName.Substring(0, 90);
            }
            else
            {
                int count = 90 - patientName.Length;
                patientName = AddChar(patientName, count);
            }

            string filterCharges = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1}))) AND IsDeleted = 0 AND ISNULL(GCTransactionStatus,'') != '{0}'", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            List<vPatientChargesDt7> entityDt = BusinessLayer.GetvPatientChargesDt7List(filterCharges);

            string filterBill = String.Format("PatientBillingID IN (SELECT PatientBillingID FROM PatientBill WHERE GCTransactionStatus != '{0}' AND PatientBillingID IN (SELECT PatientBillingID FROM PatientBillPayment WHERE PaymentID IN (SELECT PaymentID FROM PatientPaymentHd WHERE GCTransactionStatus != '{0}' AND PaymentReceiptID = {1})))", Constant.TransactionStatus.VOID, entityReceipt.PaymentReceiptID);
            List<PatientBill> lstBilling = BusinessLayer.GetPatientBillList(filterBill);

            decimal totalDiscount = lstBilling.Sum(t => t.PatientDiscountAmount) + lstBilling.Sum(x => x.PayerDiscountAmount);
            decimal totalAdmin = lstBilling.Sum(t => t.AdministrationFeeAmount) + lstBilling.Sum(x => x.PatientAdminFeeAmount);
            decimal totalService = lstBilling.Sum(t => t.ServiceFeeAmount) + lstBilling.Sum(x => x.PatientServiceFeeAmount);

            vRegistration registration = BusinessLayer.GetvRegistrationList(String.Format("RegistrationID = {0}", entityReceipt.RegistrationID)).FirstOrDefault();
            string paramedicName = registration.ParamedicName;
            var result = entityDt.GroupBy(test => test.DepartmentID).Select(grp => grp.First()).ToList();
            decimal amountTotal = entityDt.Select(ix => ix.LineAmount).Sum();
            string TotalInWord = entityReceipt.ReceiptAmountInStringInd;

            if (TotalInWord.Length > 86)
            {
                TotalInWord = TotalInWord.Substring(0, 86);
            }
            else
            {
                int count = 86 - TotalInWord.Length;
                TotalInWord = AddChar(TotalInWord, count);
            }

            string receiptOfficerName = entityReceipt.CreatedByUserName;
            if (receiptOfficerName.Length > 17)
            {
                receiptOfficerName = receiptOfficerName.Substring(0, 17);
            }
            else
            {
                int count = 17 - receiptOfficerName.Length;
                receiptOfficerName = AddChar(receiptOfficerName, count);
            }
            #endregion

            #region fill data into ArrayString
            lstHeader.Add(string.Format("COPY BUKTI TRANSAKSI {0}", registration.DepartmentID));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("No.Kwitansi       : {0}", entityReceipt.PaymentReceiptNo));
            lstHeader.Add(string.Format("No.Reg / No.RM    : {0} / {1}", entityReceipt.RegistrationNo, entityReceipt.MedicalNo));
            lstHeader.Add(string.Format("Sudah Terima Dari : {0}", printAsName));
            lstHeader.Add(string.Format("Nama Pasien       : {0}", patientName));
            lstHeader.Add(string.Format("Instansi          : {0}", registration.BusinessPartnerName));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("----------------------------------------------------------------------------------------------------"));

            foreach (vPatientChargesDt7 entity in result)
            {
                List<vPatientChargesDt7> en = entityDt.Where(t => t.DepartmentID == entity.DepartmentID).ToList();

                int number = 1;
                foreach (vPatientChargesDt7 eGroup in en)
                {
                    string name = eGroup.ItemName1;
                    string qty = eGroup.ChargedQuantity.ToString();
                    string amount = eGroup.LineAmount.ToString("N2");
                    string subtotal = en.Select(ix => ix.LineAmount).Sum().ToString("N2");
                    string deptIDValid = eGroup.DepartmentID;

                    if (name.Length > 55)
                    {
                        name = name.Substring(0, 55);
                    }
                    else
                    {
                        int count = 55 - name.Length;
                        name = AddChar(name, count);
                    }

                    if (qty.Length > 10)
                    {
                        qty = qty.Substring(0, 10);
                    }
                    else
                    {
                        int count = 10 - qty.Length;
                        qty = AddChar(qty, count);
                    }

                    if (amount.Length > 30)
                    {
                        amount = amount.Substring(0, 30);
                    }
                    else
                    {
                        int count = 30 - amount.Length;
                        amount = AddCharBefore(amount, count);
                    }

                    if (subtotal.Length > 30)
                    {
                        subtotal = amount.Substring(0, 30);
                    }
                    else
                    {
                        int count = 30 - subtotal.Length;
                        subtotal = AddCharBefore(subtotal, count);
                    }

                    string numberInString = "";
                    if (number < 10)
                    {
                        numberInString = "0" + number.ToString();
                    }
                    else
                    {
                        numberInString = number.ToString();
                    }

                    if (numberInString.Length > 5)
                    {
                        numberInString = amount.Substring(0, 5);
                    }
                    else if (numberInString.Length < 5)
                    {
                        int count = 5 - numberInString.Length;
                        numberInString = AddChar(numberInString, count);
                    }

                    if (deptIDValid.Length > 48)
                    {
                        deptIDValid = deptIDValid.Substring(0, 48);
                    }
                    else
                    {
                        int count = 48 - deptIDValid.Length;
                        deptIDValid = AddChar(deptIDValid, count);
                    }

                    if (eGroup == en.FirstOrDefault())
                    {
                        lstDetail.Add(string.Format("     Transaksi {0}", eGroup.DepartmentID));
                    }
                    lstDetail.Add(string.Format("{0}{1}{2}{3}", numberInString, name, qty, amount));

                    if (eGroup == en.LastOrDefault())
                    {
                        lstDetail.Add(string.Format("                                                                                --------------------"));
                        lstDetail.Add(string.Format("     TOTAL Transaksi {0} {1}", deptIDValid, subtotal));
                    }

                    number = number + 1;
                }
            }

            lstDetail.Add(string.Format("----------------------------------------------------------------------------------------------------"));

            if (totalAdmin > 0)
            {
                string admin = totalAdmin.ToString("N2");

                if (admin.Length > 30)
                {
                    admin = admin.Substring(0, 30);
                }
                else
                {
                    int count = 30 - admin.Length;
                    admin = AddCharBefore(admin, count);
                }

                lstDetail.Add(string.Format("              TOTAL ADMINISTRASI                                     :{0}", admin));
                amountTotal = amountTotal + totalAdmin;
            }

            if (totalService > 0)
            {
                string service = totalService.ToString("N2");

                if (service.Length > 30)
                {
                    service = service.Substring(0, 30);
                }
                else
                {
                    int count = 30 - service.Length;
                    service = AddCharBefore(service, count);
                }

                lstDetail.Add(string.Format("              TOTAL PELAYANAN                                        :{0}", service));
                amountTotal = amountTotal + totalService;
            }

            if (totalDiscount > 0)
            {
                string discount = totalDiscount.ToString("N2");

                if (discount.Length > 30)
                {
                    discount = discount.Substring(0, 30);
                }
                else
                {
                    int count = 30 - discount.Length;
                    discount = AddCharBefore(discount, count);
                }

                lstDetail.Add(string.Format("              TOTAL DISKON                                          :{0}", discount));
                amountTotal = amountTotal - totalDiscount;
            }

            string totalTransaction = amountTotal.ToString("N2");
            if (totalTransaction.Length > 30)
            {
                totalTransaction = totalTransaction.Substring(0, 30);
            }
            else
            {
                int count = 30 - totalTransaction.Length;
                totalTransaction = AddCharBefore(totalTransaction, count);
            }

            lstDetail.Add(string.Format("              TOTAL TRANSAKSI                                        :{0}", totalTransaction));
            lstDetail.Add(string.Format("                                                                                --------------------"));
            lstDetail.Add(string.Format("                   {0}:{1}", paymentMethod, receiptTotal));
            lstDetail.Add(string.Format("                                                                                --------------------"));
            lstDetail.Add(string.Format("              TOTAL PEMBAYARAN                                       :{0}", receiptTotal));
            lstDetail.Add(string.Format("\n            Terbilang : {0}", TotalInWord));

            lstFooter.Add(string.Format("\n          ** TERIMA KASIH **                                                      Jakarta, {0}\n", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
            lstFooter.Add(string.Format("\n\n            [{0} {1}]                                                  ( {2} )", DateTime.Now.ToString(Constant.FormatString.DATE_PICKER_FORMAT), DateTime.Now.ToString("HH:mm"), receiptOfficerName));
            lstFooter.Add(string.Format("\n          * Transaksi/Pembelian Obat tidak dapat dikembalikan"));
            lstFooter.Add(string.Format("\n          * Barang yang tidak diambil dalam jangka waktu 1 bulan, menjadi milik rumah sakit."));
            #endregion

            #region Print
            dotMatrix.InitPrinter();
            dotMatrix.SetPageLengthInLines(33);
            dotMatrix.SelectDraftMode();

            foreach (String z in lstHeader)
            {
                if (z == lstHeader.FirstOrDefault())
                {
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.SetTittleFont(z);
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }
                else
                {
                    dotMatrix.Append(z);
                    dotMatrix.Append("\n");
                }
            }

            if (lstDetail.Count <= 12)
            {
                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                    dotMatrix.Append("\n");
                }

                int count = 12 - lstDetail.Count;

                for (int i = 0; i < count; i++)
                {
                    dotMatrix.Append("\n");
                }

                foreach (string z in lstFooter)
                {
                    dotMatrix.Append(z);
                }

                dotMatrix.Append(string.Format("\n          Halaman 1/1"));
                dotMatrix.FormFeed();
            }
            else
            {
                int temp = 0;
                int totalPer12 = Convert.ToInt32(Math.Ceiling((double)lstDetail.Count() / 12));

                foreach (string k in lstDetail)
                {
                    dotMatrix.Append(k);
                    dotMatrix.Append("\n");
                    temp = temp + 1;

                    if (temp % 12 == 0 || temp == lstDetail.Count())
                    {

                        int hal = temp / 12;

                        if (temp % 12 == 0 && temp != lstDetail.Count())
                        {
                            for (int z = 0; z < 8; z++)
                            {
                                dotMatrix.Append("\n");
                            }

                            dotMatrix.Append(string.Format("          Halaman {0}/{1}", hal, totalPer12));
                            dotMatrix.FormFeed();

                            foreach (String z in lstHeader)
                            {
                                if (z == lstHeader.FirstOrDefault())
                                {
                                    dotMatrix.SelectEmphasizedMode();
                                    dotMatrix.SetFont15cpi();
                                    dotMatrix.SetTittleFont(z);
                                    dotMatrix.CancelEmphasizedMode();
                                    dotMatrix.Append("\n");
                                }
                                else
                                {
                                    dotMatrix.Append(z);
                                    dotMatrix.Append("\n");
                                }
                            }
                        }
                        else if (temp == lstDetail.Count() && temp % 11 != 0)
                        {
                            int count = ((12 * totalPer12) - lstDetail.Count);

                            for (int i = 0; i < count; i++)
                            {
                                dotMatrix.Append("\n");
                            }

                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
                            dotMatrix.FormFeed();
                        }
                        else if (temp == lstDetail.Count() && temp % 12 == 0)
                        {
                            foreach (string z in lstFooter)
                            {
                                dotMatrix.Append(z);
                            }

                            dotMatrix.Append(string.Format("\n          Halaman {0}/{0}", totalPer12));
                            dotMatrix.FormFeed();
                        }
                    }
                }
            }
            #endregion
            #endregion

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(dotMatrix.ToString());
            //print.ClosePrint();
            #endregion

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "CBT");
                #endregion
            }
            return fileName;
        }

        public static String PrintDaftarPasienRanap()
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
            String visitDate = DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT_112);

            #region take data
            List<string> lstHeader = new List<string>();
            List<string> lstDetail = new List<string>();

            lstHeader.Add(string.Format("LAPORAN PASIEN RAWAT INAP - PER TANGGAL {0} JAM {1}", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
            lstHeader.Add("");
            lstHeader.Add(string.Format("---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------"));
            lstHeader.Add(string.Format("No.    Kelas       No.TT    No.Rekam Medis      Nama Pasien                               L/P   Umur                     DPJP                                     Masuk ke RS                Masuk Ke Kamar            Penjamin Bayar            Keterangan   "));
            lstHeader.Add(string.Format("------ -------     -------  ------------------- ----------------------------------------- ----- ------------------------ ---------------------------------------- -------------------------- ------------------------- ------------------------- --------------------"));

            List<vConsultVisit> lstVisit = BusinessLayer.GetvConsultVisitList(string.Format("GCVisitStatus = '{0}' AND DepartmentID = '{1}' AND IsMainVisit = 1 ORDER BY BedID, ClassID", Constant.VisitStatus.CHECKED_IN, Constant.Facility.INPATIENT));

            int no = 1;
            foreach (vConsultVisit lst in lstVisit)
            {
                string number = no.ToString();
                string roomName = lst.RoomName;
                string className = lst.ClassName;
                string bedName = lst.BedCode;
                string MedicalNo = lst.MedicalNo;
                string patientName = lst.PatientName;
                string gender = lst.GCGender;
                string age = lst.PatientAge;
                string dpjp = lst.ParamedicName;
                string visitDateString = lst.ActualVisitDateInString + " " + lst.ActualVisitTime;
                string confirmatonDate = "";
                string businessPartner = lst.BusinessPartnerName;

                if (lst.StartServiceDate.ToString("dd-MM-yyyy") != Constant.ConstantDate.DEFAULT_NULL)
                {
                    confirmatonDate = lst.StartServiceDate.ToString("dd-MMM-yyyy") + " " + lst.StartServiceTime;
                }

                #region validate number
                if (number.Length > 7)
                {
                    number = number.Substring(0, 7);
                }
                else
                {
                    int count = 7 - number.Length;
                    number = AddChar(number, count);
                }
                #endregion

                #region validate roomName
                if (roomName.Length > 12)
                {
                    roomName = roomName.Substring(0, 12);
                }
                else
                {
                    int count = 12 - roomName.Length;
                    roomName = AddChar(roomName, count);
                }
                #endregion

                #region validate className
                if (className.Length > 7)
                {
                    className = className.Substring(0, 7);
                }
                else
                {
                    int count = 7 - className.Length;
                    className = AddChar(className, count);
                }
                #endregion

                #region validate bedName
                if (bedName.Length > 8)
                {
                    bedName = bedName.Substring(0, 8);
                }
                else
                {
                    int count = 8 - bedName.Length;
                    bedName = AddChar(bedName, count);
                }
                #endregion

                #region validate MedicalNo
                if (MedicalNo.Length > 20)
                {
                    MedicalNo = MedicalNo.Substring(0, 20);
                }
                else
                {
                    int count = 20 - MedicalNo.Length;
                    MedicalNo = AddChar(MedicalNo, count);
                }
                #endregion

                #region validate patientName
                if (patientName.Length > 42)
                {
                    patientName = patientName.Substring(0, 42);
                }
                else
                {
                    int count = 42 - patientName.Length;
                    patientName = AddChar(patientName, count);
                }
                #endregion

                #region validate gender
                if (gender == Constant.Gender.FEMALE)
                {
                    gender = "P";
                }
                else
                {
                    gender = "L";
                }

                gender = AddChar(gender, 5);

                #endregion

                #region validate age
                if (age.Length > 25)
                {
                    age = age.Substring(0, 25);
                }
                else
                {
                    int count = 25 - age.Length;
                    age = AddChar(age, count);
                }
                #endregion

                #region validate dpjp
                if (dpjp.Length > 35)
                {
                    dpjp = dpjp.Substring(0, 35);
                }
                else
                {
                    int count = 35 - dpjp.Length;
                    dpjp = AddChar(dpjp, count);
                }
                #endregion

                #region validate visitDate
                if (visitDateString.Length > 27)
                {
                    visitDateString = visitDateString.Substring(0, 27);
                }
                else
                {
                    int count = 27 - visitDateString.Length;
                    visitDateString = AddChar(visitDateString, count);
                }
                #endregion

                #region validate confirmatonDate
                if (confirmatonDate.Length > 26)
                {
                    confirmatonDate = confirmatonDate.Substring(0, 26);
                }
                else
                {
                    int count = 26 - confirmatonDate.Length;
                    confirmatonDate = AddChar(confirmatonDate, count);
                }
                #endregion

                #region validate businessPartner
                if (businessPartner.Length > 20)
                {
                    businessPartner = businessPartner.Substring(0, 20);
                }
                else
                {
                    int count = 20 - businessPartner.Length;
                    businessPartner = AddChar(businessPartner, count);
                }
                #endregion

                lstDetail.Add(string.Format("{0}{1}     {2} {3}{4}{5}{6}{7}      {8}{9}{10}      .............", number, className, bedName, MedicalNo, patientName, gender, age, dpjp, visitDateString, confirmatonDate, businessPartner));
                no = no + 1;
            }
            #endregion

            #region print
            dotMatrix.InitPrinter();
            dotMatrix.SetPageLengthInLines(66);
            dotMatrix.SelectDraftMode();
            dotMatrix.SetLeftMargin(0);
            dotMatrix.SetRightMargin(0);

            int baris = 0;
            int jumlahbaris = 64;
            int hal = 0;
            foreach (string detail in lstDetail)
            {
                // cetak header
                if (baris == 0)
                {
                    foreach (string head in lstHeader)
                    {
                        dotMatrix.Append(head);
                        dotMatrix.Append("\n");
                    }
                    baris += 5;
                    hal++;
                }

                dotMatrix.Append(detail);
                dotMatrix.Append("\n");
                baris = baris + 1;

                if (baris == (jumlahbaris - 1))
                {
                    dotMatrix.Append(string.Format("Halaman {0}", hal));
                    dotMatrix.FormFeed();
                    baris = 0;
                }
            }
            // cetak footer
            if (baris > 0)
            {
                dotMatrix.Append(string.Format("Halaman {0}", hal));
                dotMatrix.FormFeed();
            }
            #endregion

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(dotMatrix.ToString());
            //print.ClosePrint();
            #endregion

            string command = dotMatrix.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "DPB");
                #endregion
            }
            return fileName;
        }

        public static String PrintLabelMR(Int32 mrn, string printerUrl)
        {
            Patient p = BusinessLayer.GetPatient(mrn);
            LabelMR code = new LabelMR();
            string fileName = "";

            string name = p.FullName;
            if (name.Length > 25)
            {
                name = name.Substring(0, 25);
            }

            string command = code.GetLabelMRCode(p.MedicalNo, p.FullName);

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "CBT");
                #endregion
            }
            return fileName;
        }

        public static void PrintStikerGelang(Int32 registrationID, string printerUrl, Int32 count)
        {
            vRegistration registration = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", registrationID)).FirstOrDefault();
            string gender = registration.GCGender == Constant.Gender.FEMALE ? "P" : "L";

            StringBuilder sPrint = new StringBuilder();
            sPrint.AppendLine(@"SIZE 16.5 mm, 292 mm");
            sPrint.AppendLine(@"DIRECTION 0,0");
            sPrint.AppendLine(@"REFERENCE 0,0");
            sPrint.AppendLine(@"OFFSET 0 mm");
            sPrint.AppendLine(@"SET PEEL OFF");
            sPrint.AppendLine(@"SET CUTTER OFF");
            sPrint.AppendLine(@"SET PARTIAL_CUTTER OFF");
            sPrint.AppendLine(@"SET TEAR ON");
            sPrint.AppendLine(@"CLS");
            sPrint.AppendLine(@"CODEPAGE 1252");
            sPrint.AppendLine(string.Format("TEXT 122,100,\"ROMAN.TTF\",90,1,12,\"{0}\"", registration.PatientName));
            sPrint.AppendLine(string.Format("TEXT 82,100,\"ROMAN.TTF\",90,1,12,\"NORM: {0} / {1} \"", registration.MedicalNo, gender));
            sPrint.AppendLine(string.Format("TEXT 42,100,\"ROMAN.TTF\",90,1,12,\"Tgl Lahir: {0}\"", registration.DateOfBirthInString));
            sPrint.AppendLine(@"PRINT 1,1");
            sPrint.AppendLine("");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sPrint.ToString());
            print.ClosePrint();
            #endregion
        }

        public static String PrintStikerRI(Int32 registrationID, string printerUrl)
        {
            string fileName = "";
            vRegistration registration = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", registrationID)).FirstOrDefault();
            int iMaxLen = 34;

            string gender = registration.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";
            string name = "";

            name = registration.PatientName;

            if (name.Length > 30)
            {
                name = name.Substring(0, 30);
            }

            name = name + ' ' + gender;
            string cbar1 = name.PadRight(34, ' ').Substring(0, iMaxLen);
            string cbar2 = (registration.RegistrationNo + " / " + registration.MedicalNo + "     (" + registration.Gender + ")").PadRight(34, ' ').Substring(0, iMaxLen);
            //string cbar3 = (rr.kdkelas + " / " + rr.nott + "".PadLeft(4, ' ') + pasien.umurTahunSekarang + " TH / " + pasien.umurBulanSekarang + " BL").PadRight(34, ' ').Substring(0, iMaxLen); // "SVIP / 802-1    199 TH / 12 BL    ";
            string cbar3 = (registration.BedCode + " / " + registration.ClassName + "".PadLeft(4, ' ') + registration.DateOfBirth.ToString(Constant.FormatString.DATE_PICKER_FORMAT)).PadRight(34, ' ').Substring(0, iMaxLen); // "SVIP / 802-1    199 TH / 12 BL    ";


            //string cbar2 = (registration.RegistrationNo + " / " + registration.DateOfBirth.ToString(Constant.FormatString.DATE_PICKER_FORMAT).PadRight(34, ' ').Substring(0, iMaxLen) + "     (" + registration.Gender + ")").PadRight(34, ' ').Substring(0, iMaxLen);
            //string cbar3 = (rr.kdkelas + " / " + rr.nott + "".PadLeft(4, ' ') + pasien.umurTahunSekarang + " TH / " + pasien.umurBulanSekarang + " BL").PadRight(34, ' ').Substring(0, iMaxLen); // "SVIP / 802-1    199 TH / 12 BL    ";
            //string cbar3 = (registration.MedicalNo + registration.BedCode + "/" + registration.RoomCode + "".PadLeft(4, ' ')); // "SVIP / 802-1    199 TH / 12 BL    ";
            string cbar4 = (registration.ParamedicName).PadRight(34, ' ').Substring(0, iMaxLen);

            //            RawPrinterHelper.PRNCommand.EpsonPrnCode ep = new PrintDirect.Net.PRNCommand.EpsonPrnCode();
            DotMatrixPrinter ep = new DotMatrixPrinter();
            //StringBuilder txtprn = new StringBuilder();

            ep.InitPrinter();
            int iRow = 6;
            for (int i = 0; i < iRow; i++)
            {
                ep.SetFont10cpi();
                ep.SelectDoubleStrikeMode();
                ep.SelectCondensedMode();
                ep.SelectDraftMode();
                // 10 cpi esc+P
                //txtprn.Append((char)(27) + (char)(64) + (char)(27) + "P");  //reset + setcpi
                //                ep.se;
                ep.Append(cbar1 + "".PadLeft(7, ' ') + cbar1 + "".PadLeft(6, ' ') + cbar1);
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.CancelCondensedMode();
                ep.CancelDoubleStrikeMode();
                ep.CancelEmphasizedMode();

                ep.SetFont12cpi();
                ep.SelectCondensedMode();
                ep.Append(cbar2 + "".PadLeft(14, ' ') + cbar2 + "".PadLeft(13, ' ') + cbar2);
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.CancelCondensedMode();

                ep.SelectCondensedMode();
                ep.Append(cbar3 + "".PadLeft(14, ' ') + cbar3 + "".PadLeft(13, ' ') + cbar3);
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.CancelCondensedMode();

                ep.SelectCondensedMode();
                ep.Append(cbar4 + "".PadLeft(14, ' ') + cbar4 + "".PadLeft(13, ' ') + cbar4);
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.Append(((char)10).ToString() + ((char)13).ToString());

                ep.CancelCondensedMode();
            }
            ep.SelectCondensedMode();
            // lewatkan sejumlah x kolom stiker setelah print
            //var iRowBlankAfterPrint = 2;
            //for (var i = 0; i < iRowBlankAfterPrint; i++)
            //{
            //    for (var j = 0; j < 6; j++)
            //    {
            //        ep.Append(((char)10).ToString() + ((char)13).ToString());
            //    }
            //}
            ep.CancelCondensedMode();

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(ep.ToString());
            //print.ClosePrint();
            #endregion

            string command = ep.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "SRI");
                #endregion
            }
            return fileName;
        }

        public static String PrintStikerRJ(Int32 MRN, string printerUrl)
        {
            string fileName = "";
            Patient p = BusinessLayer.GetPatient(MRN);
            string gender = p.GCGender == Constant.Gender.FEMALE ? "P" : "L";

            int iRow = 2;
            DotMatrixPrinter ep = new DotMatrixPrinter();
            ep.InitPrinter();
            //ep.FormFeed();            

            for (int ir = 0; ir < iRow; ir++)
            {
                StringBuilder sPrint = new StringBuilder();
                int iPad = 24;
                int iMaxCharLen = 22; // not more than iPad
                //ep.InitPrinter();
                ep.CancelCondensedMode();
                ep.SelectDraftMode();
                ep.SetFont10cpi();
                ep.SelectDoubleStrikeMode();
                string[] name = GetLinesBasedOnSpace(p.FullName, iMaxCharLen);
                if (name[1] != "")
                {
                    // print 2 lines of name
                    ep.Append((name[0]).PadRight(iPad) + (name[0]).PadRight(iPad) + (name[0]).PadRight(iPad));
                    ep.Append(((char)10).ToString() + ((char)13).ToString());
                    ep.Append((name[1]).PadRight(iPad) + (name[1]).PadRight(iPad) + (name[1]).PadRight(iPad));
                    ep.Append(((char)10).ToString() + ((char)13).ToString());
                }
                else
                {
                    // print single line of name followed by empty line
                    ep.Append((name[0]).PadRight(iPad) + (name[0]).PadRight(iPad) + (name[0]).PadRight(iPad));
                    ep.Append(((char)10).ToString() + ((char)13).ToString());
                    ep.Append(((char)10).ToString() + ((char)13).ToString());
                }
                //ep.SelectCondensedMode();
                ep.Append(("No.RM :" + p.MedicalNo).PadRight(iPad) + ("No.RM :" + p.MedicalNo).PadRight(iPad) + ("No.RM :" + p.MedicalNo).PadRight(iPad));
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.Append(
                    ("Lahir :" + String.Format("{0:dd/MM/yyyy}", p.DateOfBirth) + " (" + gender + ")").PadRight(iPad) +
                    ("Lahir :" + String.Format("{0:dd/MM/yyyy}", p.DateOfBirth) + " (" + gender + ")").PadRight(iPad) +
                    ("Lahir :" + String.Format("{0:dd/MM/yyyy}", p.DateOfBirth) + " (" + gender + ")").PadRight(iPad)
                );
                //ep.CancelCondensedMode();
                ep.CancelDoubleStrikeMode();
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.Append(((char)10).ToString() + ((char)13).ToString());
                ep.Append(((char)10).ToString() + ((char)13).ToString());
            }
            // lewatkan sejumlah x kolom stiker setelah print
            //var iRowBlankAfterPrint = 2;
            //for (var i = 0; i < iRowBlankAfterPrint; i++)
            //{
            //    for (var j = 0; j < 6; j++)
            //    {
            //        ep.Append(((char)10).ToString() + ((char)13).ToString());
            //    }
            //}
            //ep.CancelCondensedMode();

            #region Send Command to Printer
            //RawPrinterHelper print = new RawPrinterHelper();

            ////Initialize Printer
            //print.OpenPrint(printerUrl);
            //print.SendStringToPrinter(ep.ToString());
            //print.ClosePrint();
            #endregion

            string command = ep.ToString();

            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "SRJ");
                #endregion
            }
            return fileName;
        }

        public static void printLabelProductionDotMatrix(vItemProductionHd oHeader, string printerUrl1, string printerUrl2)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            StringBuilder sb = new StringBuilder();
            bool isExternalMedication = true;

            DrugInfo info = BusinessLayer.GetDrugInfo(oHeader.ItemID);
            Healthcare healthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
            isExternalMedication = info.IsExternalMedication;

            sb.Append("^XA\r\n");
            sb.Append("^FX");
            sb.Append("^CFA,15");
            sb.Append(string.Format("^FO170,10^FD{0}^FS", healthcare.HealthcareName));
            sb.Append("^FO133,30^FDPRODUKSI PENGEMASAN KEMBALI ^FS");
            sb.Append("^CFA,15");
            sb.Append(string.Format("^FO10,60^FD{0}^FS", oHeader.ProductionNo));
            sb.Append(string.Format("^FO380,60^FD{0}^FS", oHeader.ProductionDateInString));
            sb.Append(string.Format("^FO120,100^FD{0}^FS", oHeader.ItemName1));
            sb.Append("^FO80,150^FDJUMLAH :  ^FS");
            sb.Append(string.Format("^FO180,150^FD{0}^FS", oHeader.Quantity));
            sb.Append("^FO82,176^FDED^FS");
            sb.Append("^FO164,176^FD:^FS");
            sb.Append("^FO180,176^FD^FS");
            sb.Append("^XZ");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            if (isExternalMedication)
                printerUrl = printerUrl2;

            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }

        public static void PrintDrugLabelDotMatrix(PrescriptionOrderHd oHeader, string lstPrescriptionOrderDetailID, string printerUrl1, string printerUrl2, string prescriptionType)
        {
            vRegistrationEtiketRSMD regis = BusinessLayer.GetvRegistrationEtiketRSMDList(string.Format("VisitID = {0}", oHeader.VisitID)).FirstOrDefault();

            if (prescriptionType == Constant.PrescriptionType.ODD)
            {
                printODDThermalIP(regis, oHeader, lstPrescriptionOrderDetailID, printerUrl1, printerUrl2, prescriptionType);
            }
            else
            {
                if (regis.DepartmentID == Constant.Facility.INPATIENT)
                {
                    printODDThermalIP(regis, oHeader, lstPrescriptionOrderDetailID, printerUrl1, printerUrl2, prescriptionType);
                }
                else if (regis.DepartmentID == Constant.Facility.EMERGENCY)
                {
                    printODDThermalEM(regis, oHeader, lstPrescriptionOrderDetailID, printerUrl1, printerUrl2, prescriptionType);
                }
                else if (regis.DepartmentID == Constant.Facility.PHARMACY)
                {
                    printODDThermalBebas(regis, oHeader, lstPrescriptionOrderDetailID, printerUrl1, printerUrl2, prescriptionType);
                }
                else
                {
                    printODDThermalOP(regis, oHeader, lstPrescriptionOrderDetailID, printerUrl1, printerUrl2, prescriptionType);
                }
            }
        }

        public static void printODDThermalIP(vRegistrationEtiketRSMD regis, PrescriptionOrderHd oHeader, string lstPrescriptionOrderDetailID, string printerUrl1, string printerUrl2, string prescriptionType)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            string[] detailIDLst = lstPrescriptionOrderDetailID.Split(',');
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = regis.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            for (int ix = 0; ix < detailIDLst.Count(); ix++)
            {
                StringBuilder sb = new StringBuilder();
                vPrescriptionOrderDt7 entity = BusinessLayer.GetvPrescriptionOrderDt7List(string.Format("PrescriptionOrderDetailID = {0} AND ParentID IS NULL", detailIDLst[ix])).FirstOrDefault();
                if (entity != null)
                {
                    int nlebar = 42;
                    int initBrs = 330;
                    string sisiracik = string.Empty;
                    string tempStr = null;
                    string[] words = null;

                    string sracikan = string.Empty;
                    string stipeResep = BusinessLayer.GetStandardCodeList(string.Format("StandardCodeID = '{0}'", oHeader.GCPrescriptionType)).FirstOrDefault().Notes;

                    sb.Append("^XA\r\n");
                    sb.Append("^MMT\r\n");
                    sb.Append("^PW519\r\n");
                    sb.Append("^LL0440\r\n");
                    sb.Append("^LS0\r\n");
                    sb.Append("^FT83,50^A0N,31,31^FH\\^FD" + healthcare.HealthcareName.Trim() + "^FS\r\n");
                    //sb.Append("^FT10,44^A0N,23,24^FH\\^FD" + stipeResep + "^FS\r\n");
                    sb.Append("^A0N,21,18");
                    sb.Append("^FT10,87^FD" + entity.TransactionNo.ToString().Trim() + "^FS\r\n");
                    sb.Append("^FT195,87^A0N,21,18^FH\\^FD" + (regis.RegistrationDate != null ? String.Format("{0:dd-MM-yyyy}", regis.RegistrationDate) : "") + "^FS\r\n");
                    sb.Append("^FT322,87^A0N,21,18^FH\\^FDMR." + (regis.MedicalNo != null ? regis.MedicalNo.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,128^A0N,28,28^FH\\^FD" + (regis.PatientName != null ? regis.PatientName.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,164^A0N,23,24^FH\\^FDDOB/Age/Sex: " + (regis.DateOfBirth != null ? String.Format("{0:dd-MM-yyyy}", regis.DateOfBirth) : "") + " / " +
                             (regis.AgeInYear != null ? regis.AgeInYear.ToString() : "") + " thn " +
                             (regis.AgeInMonth != null ? regis.AgeInMonth.ToString() : "") + " bln / " +
                             (gender != null ? gender.ToString() : "") + "^FS\r\n");


                    //if (oHeader.GCPrescriptionType == Constant.PrescriptionType.ODD)
                    if (prescriptionType == Constant.PrescriptionType.ODD)
                    {
                        sb.Append(string.Format("^FT10,215^A0N,23,24^FH\\^FD07-08 / 13-14 / 19-20 / 22-23^FS\r\n"));
                    }
                    else
                    {
                        // ini jika pagi/siang/sore tampil sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");
                        if (!String.IsNullOrEmpty(entity.SignaName1))
                        {
                            if (entity.SignaLabel == "s imm")
                            {
                                sb.Append("^FT10,195^A0N,23,24^FH\\^FD" + "Pemakaian sudah diketahui" + "^FS\r\n");
                            }

                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.SignaName1 != null ? entity.SignaName1.Trim() : " " + entity.cfPRN) + "^FS\r\n");
                            sb.Append("^FT10,240^A0N,23,24^FH\\^FD" + (entity.cfPRN) + "^FS\r\n");
                        }
                        else
                        {
                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel : "") + "^FS\r\n");
                        }
                    }

                    sb.Append("^FT10,270^A0N,23,24^FH\\^FDORAL / INJEKSI / RECTAL / NEB / ^FS\r\n");


                    string racikan = null;
                    bool isExternalMedication = entity.IsExternalMedication;

                    if (entity.ParentID == 0 && entity.IsRFlag == true && entity.IsCompound == true)
                    {
                        string nama = "Racikan";
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ") " + (nama != null ? nama.Trim() : "") + "^FS\r\n");

                        List<vPrescriptionOrderDt> lstRacik = BusinessLayer.GetvPrescriptionOrderDtList(string.Format("ParentID = {0} AND GCChargesTransactionStatus != '{1}' AND GCPrescriptionOrderStatus != '{2}' AND IsDeleted = 0", entity.PrescriptionOrderDetailID, Constant.TransactionStatus.VOID, Constant.TestOrderStatus.CANCELLED));
                        vPrescriptionOrderDt e = BusinessLayer.GetvPrescriptionOrderDtList(String.Format("PrescriptionOrderDetailID = {0}", entity.PrescriptionOrderDetailID)).FirstOrDefault();
                        lstRacik.Add(e);

                        int ExternalMedicationCount = lstRacik.Where(t => t.IsExternalMedication == true).ToList().Count;
                        if (ExternalMedicationCount > 0)
                        {
                            isExternalMedication = true;
                        }

                        foreach (vPrescriptionOrderDt ra in lstRacik)
                        {
                            //                            isExternalMedication = ra.IsExternalMedication;
                            if (racikan == null)
                            {
                                racikan = ra.ItemName1;
                            }
                            else
                            {
                                racikan = racikan + '|' + ra.ItemName1;
                            }
                        }
                    }
                    else
                    {
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ")" + (entity.cfItemName != null ? entity.cfItemName.ToString().Trim() : "") + "^FS\r\n");
                    }

                    sisiracik = (racikan != null ? racikan.ToString().Trim() : "");
                    words = sisiracik.Split('|');
                    tempStr = "";
                    //hasilStr = LibStr.repchr(' ', 0);

                    //for (int i = 0; i < words.Count(); i++)
                    //{
                    //    // Eliminate punctuation
                    //    if ((tempStr.Length + words[i].Length) > nlebar)
                    //    {
                    //        sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //        tempStr = "";
                    //        initBrs += 23;
                    //    }
                    //    tempStr = tempStr + words[i] + " ";
                    //}
                    //if (tempStr.Length > 0)
                    //{
                    //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //}

                    for (int i = 0; i < words.Count(); i++)
                    {
                        // Eliminate punctuation
                        //if ((tempStr.Length + words[i].Length) > nlebar)
                        //{
                        //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                        //    tempStr = "";
                        //    initBrs += 23;
                        //}
                        if (i != (words.Count() - 1))
                        {
                            tempStr = tempStr + words[i] + ", ";
                        }
                        else
                        {
                            tempStr = tempStr + words[i];
                        }
                    }

                    string line1 = "";
                    string line2 = "";
                    string line3 = "";
                    string line4 = "";
                    Int32 countLine2 = tempStr.Length - 42;
                    Int32 countLine3 = tempStr.Length - 84;
                    Int32 countLine4 = tempStr.Length - 168;

                    if (tempStr.Length > 42)
                    {
                        line1 = tempStr.Substring(0, 42);
                    }
                    else
                    {
                        line1 = tempStr;
                    }

                    if (tempStr.Length > 42 && tempStr.Length > 84)
                    {
                        line2 = tempStr.Substring(42, 42);
                    }
                    else
                    {
                        if (countLine2 > 0)
                        {
                            line2 = tempStr.Substring(42, countLine2);
                        }
                    }

                    if (tempStr.Length > 84 && tempStr.Length > 168)
                    {
                        line3 = tempStr.Substring(84, 42);
                    }
                    else
                    {
                        if (countLine3 > 0)
                        {
                            line3 = tempStr.Substring(84, countLine3);
                        }
                    }

                    if (tempStr.Length > 168 && tempStr.Length > 210)
                    {
                        line4 = tempStr.Substring(168, 42);
                    }
                    else
                    {
                        if (countLine4 > 0)
                        {
                            line4 = tempStr.Substring(168, countLine4);
                        }
                    }

                    if (line1.Length > 0)
                    {
                        sb.Append("^FT10," + 330 + "^ACN,18,10^FH\\^FD" + line1 + "^FS\r\n");
                    }

                    if (line2.Length > 0)
                    {
                        sb.Append("^FT10," + 350 + "^ACN,18,10^FH\\^FD" + line2 + "^FS\r\n");
                    }

                    if (line3.Length > 0)
                    {
                        sb.Append("^FT10," + 370 + "^ACN,18,10^FH\\^FD" + line3 + "^FS\r\n");
                    }

                    if (line4.Length > 0)
                    {
                        sb.Append("^FT10," + 390 + "^ACN,18,10^FH\\^FD" + line4 + "^FS\r\n");
                    }

                    String ed = Convert.ToDateTime(entity.ExpiredDate).ToString("dd-MM-yyyy");
                    string bud = Convert.ToDateTime(entity.BUD).ToString("dd-MM-yyyy");
                    if (!String.IsNullOrEmpty(racikan))
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED :     -    -^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                    }
                    else
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (bud != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.BUD) : "    -    -") + "^FS\r\n");
                    }
                    sb.Append("^PQ1,0,1,Y^XZ");

                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    string printerUrl = printerUrl1;
                    if (isExternalMedication)
                        printerUrl = printerUrl2;

                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                    #endregion
                }
            }
        }

        public static void printODDThermalEM(vRegistrationEtiketRSMD regis, PrescriptionOrderHd oHeader, string lstPrescriptionOrderDetailID, string printerUrl1, string printerUrl2, string prescriptionType)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            string[] detailIDLst = lstPrescriptionOrderDetailID.Split(',');
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = regis.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            for (int ix = 0; ix < detailIDLst.Count(); ix++)
            {
                StringBuilder sb = new StringBuilder();
                vPrescriptionOrderDt7 entity = BusinessLayer.GetvPrescriptionOrderDt7List(string.Format("PrescriptionOrderDetailID = {0} AND ParentID IS NULL", detailIDLst[ix])).FirstOrDefault();

                if (entity != null)
                {
                    int nlebar = 42;

                    int initBrs = 369;
                    string sisiracik = string.Empty;
                    string tempStr = null;
                    string[] words = null;

                    string sracikan = string.Empty;

                    sb.Append("^XA\r\n");
                    sb.Append("^MMT\r\n");
                    sb.Append("^PW519\r\n");
                    sb.Append("^LL0440\r\n");
                    sb.Append("^LS0\r\n");
                    sb.Append("^FT83,50^A0N,31,31^FH\\^FD" + healthcare.HealthcareName.ToString().Trim() + "^FS\r\n");
                    sb.Append("^A0N,21,18");
                    sb.Append("^FT10,87^FD" + entity.TransactionNo.ToString().Trim() + "^FS\r\n");
                    sb.Append("^FT195,87^A0N,21,18^FH\\^FD" + (regis.RegistrationDate != null ? String.Format("{0:dd-MM-yyyy}", regis.RegistrationDate) : "") + "^FS\r\n");
                    sb.Append("^FT322,87^A0N,21,18^FH\\^FDMR." + (regis.MedicalNo != null ? regis.MedicalNo.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,128^A0N,28,28^FH\\^FD" + (regis.PatientName != null ? regis.PatientName.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,164^A0N,23,24^FH\\^FDDOB/Age/Sex: " + (regis.DateOfBirth != null ? String.Format("{0:dd-MM-yyyy}", regis.DateOfBirth) : "") + " / " +
                             (regis.AgeInYear != null ? regis.AgeInYear.ToString() : "") + " thn " +
                             (regis.AgeInMonth != null ? regis.AgeInMonth.ToString() : "") + " bln / " +
                             (gender != null ? gender.ToString() : "") + "^FS\r\n");

                    //sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");

                    if (prescriptionType == Constant.PrescriptionType.ODD)
                    {
                        sb.Append(string.Format("^FT10,215^A0N,23,24^FH\\^FD07-08 / 13-14 / 19-20 / 22-23^FS\r\n"));
                    }
                    else
                    {
                        // ini jika pagi/siang/sore tampil sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");
                        if (!String.IsNullOrEmpty(entity.SignaName1))
                        {
                            if (entity.SignaLabel == "s imm")
                            {
                                sb.Append("^FT10,195^A0N,23,24^FH\\^FD" + "Pemakaian sudah diketahui" + "^FS\r\n");
                            }

                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.SignaName1 != null ? entity.SignaName1.Trim() : " " + entity.cfPRN) + "^FS\r\n");
                            sb.Append("^FT10,240^A0N,23,24^FH\\^FD" + (entity.cfPRN) + "^FS\r\n");
                        }
                        else
                        {
                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel : "") + "^FS\r\n");
                        }
                    }

                    sb.Append("^FT10,270^A0N,23,24^FH\\^FD" + (entity.Route != null ? entity.Route.ToString().Trim() : "") + "^FS\r\n");

                    string racikan = null;
                    bool isExternalMedication = entity.IsExternalMedication;

                    if (entity.ParentID == 0 && entity.IsRFlag == true && entity.IsCompound == true)
                    {
                        string nama = "Racikan";
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ")" + (nama != null ? nama.Trim() : "") + "^FS\r\n");

                        List<vPrescriptionOrderDt> lstRacik = BusinessLayer.GetvPrescriptionOrderDtList(string.Format("ParentID = {0} AND GCChargesTransactionStatus != '{1}' AND GCPrescriptionOrderStatus != '{2}' AND IsDeleted = 0", entity.PrescriptionOrderDetailID, Constant.TransactionStatus.VOID, Constant.TestOrderStatus.CANCELLED));
                        vPrescriptionOrderDt e = BusinessLayer.GetvPrescriptionOrderDtList(String.Format("PrescriptionOrderDetailID = {0}", entity.PrescriptionOrderDetailID)).FirstOrDefault();
                        lstRacik.Add(e);

                        int ExternalMedicationCount = lstRacik.Where(t => t.IsExternalMedication == true).ToList().Count;
                        if (ExternalMedicationCount > 0)
                        {
                            isExternalMedication = true;
                        }

                        foreach (vPrescriptionOrderDt ra in lstRacik)
                        {
                            //                            isExternalMedication = ra.IsExternalMedication;
                            if (racikan == null)
                            {
                                racikan = ra.ItemName1;
                            }
                            else
                            {
                                racikan = racikan + '|' + ra.ItemName1;
                            }
                        }
                    }
                    else
                    {
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ") " + (entity.cfItemName != null ? entity.cfItemName.ToString().Trim() : "") + "^FS\r\n");
                    }

                    sisiracik = (racikan != null ? racikan.ToString().Trim() : "");
                    words = sisiracik.Split('|');
                    tempStr = "";
                    //hasilStr = LibStr.repchr(' ', 0);

                    //for (int i = 0; i < words.Count(); i++)
                    //{
                    //    // Eliminate punctuation
                    //    if ((tempStr.Length + words[i].Length) > nlebar)
                    //    {
                    //        sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //        tempStr = "";
                    //        initBrs += 23;
                    //    }
                    //    tempStr = tempStr + words[i] + " ";
                    //}
                    //if (tempStr.Length > 0)
                    //{
                    //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //}

                    for (int i = 0; i < words.Count(); i++)
                    {
                        // Eliminate punctuation
                        //if ((tempStr.Length + words[i].Length) > nlebar)
                        //{
                        //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                        //    tempStr = "";
                        //    initBrs += 23;
                        //}
                        if (i != (words.Count() - 1))
                        {
                            tempStr = tempStr + words[i] + ", ";
                        }
                        else
                        {
                            tempStr = tempStr + words[i];
                        }
                    }

                    string line1 = "";
                    string line2 = "";
                    string line3 = "";
                    string line4 = "";
                    Int32 countLine2 = tempStr.Length - 42;
                    Int32 countLine3 = tempStr.Length - 84;
                    Int32 countLine4 = tempStr.Length - 168;

                    if (tempStr.Length > 42)
                    {
                        line1 = tempStr.Substring(0, 42);
                    }
                    else
                    {
                        line1 = tempStr;
                    }

                    if (tempStr.Length > 42 && tempStr.Length > 84)
                    {
                        line2 = tempStr.Substring(42, 42);
                    }
                    else
                    {
                        if (countLine2 > 0)
                        {
                            line2 = tempStr.Substring(42, countLine2);
                        }
                    }

                    if (tempStr.Length > 84 && tempStr.Length > 168)
                    {
                        line3 = tempStr.Substring(84, 42);
                    }
                    else
                    {
                        if (countLine3 > 0)
                        {
                            line3 = tempStr.Substring(84, countLine3);
                        }
                    }

                    if (tempStr.Length > 168 && tempStr.Length > 210)
                    {
                        line4 = tempStr.Substring(168, 42);
                    }
                    else
                    {
                        if (countLine4 > 0)
                        {
                            line4 = tempStr.Substring(168, countLine4);
                        }
                    }

                    if (line1.Length > 0)
                    {
                        sb.Append("^FT10," + 330 + "^ACN,18,10^FH\\^FD" + line1 + "^FS\r\n");
                    }

                    if (line2.Length > 0)
                    {
                        sb.Append("^FT10," + 350 + "^ACN,18,10^FH\\^FD" + line2 + "^FS\r\n");
                    }

                    if (line3.Length > 0)
                    {
                        sb.Append("^FT10," + 370 + "^ACN,18,10^FH\\^FD" + line3 + "^FS\r\n");
                    }

                    if (line4.Length > 0)
                    {
                        sb.Append("^FT10," + 390 + "^ACN,18,10^FH\\^FD" + line4 + "^FS\r\n");
                    }

                    String ed = Convert.ToDateTime(entity.ExpiredDate).ToString("dd-MM-yyyy");
                    string bud = Convert.ToDateTime(entity.BUD).ToString("dd-MM-yyyy");
                    if (!String.IsNullOrEmpty(racikan))
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED :     -    -^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                    }
                    else
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (bud != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.BUD) : "    -    -") + "^FS\r\n");
                    }

                    sb.Append("^PQ1,0,1,Y^XZ");

                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    string printerUrl = printerUrl1;
                    if (isExternalMedication)
                        printerUrl = printerUrl2;

                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                    #endregion
                }
            }
        }

        public static void printODDThermalOP(vRegistrationEtiketRSMD regis, PrescriptionOrderHd oHeader, string lstPrescriptionOrderDetailID, string printerUrl1, string printerUrl2, string prescriptionType)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            string[] detailIDLst = lstPrescriptionOrderDetailID.Split(',');
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = regis.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            for (int ix = 0; ix < detailIDLst.Count(); ix++)
            {
                StringBuilder sb = new StringBuilder();
                vPrescriptionOrderDt7 entity = BusinessLayer.GetvPrescriptionOrderDt7List(string.Format("PrescriptionOrderDetailID = {0} AND ParentID IS NULL", detailIDLst[ix])).FirstOrDefault();

                if (entity != null)
                {
                    int nlebar = 42;

                    int initBrs = 369;
                    string sisiracik = string.Empty;
                    string tempStr = null;
                    string[] words = null;

                    string sracikan = string.Empty;

                    sb.Append("^XA\r\n");
                    sb.Append("^MMT\r\n");
                    sb.Append("^PW519\r\n");
                    sb.Append("^LL0440\r\n");
                    sb.Append("^LS0\r\n");
                    sb.Append("^FT83,50^A0N,31,31^FH\\^FD" + healthcare.HealthcareName.ToString().Trim() + "^FS\r\n");
                    sb.Append("^A0N,21,18");
                    sb.Append("^FT10,87^FD" + entity.TransactionNo.ToString().Trim() + "^FS\r\n");
                    sb.Append("^FT195,87^A0N,21,18^FH\\^FD" + (regis.RegistrationDate != null ? String.Format("{0:dd-MM-yyyy}", regis.RegistrationDate) : "") + "^FS\r\n");
                    sb.Append("^FT322,87^A0N,21,18^FH\\^FDMR." + (regis.MedicalNo != null ? regis.MedicalNo.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,128^A0N,28,28^FH\\^FD" + (regis.PatientName != null ? regis.PatientName.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,164^A0N,23,24^FH\\^FDDOB/Age/Sex: " + (regis.DateOfBirth != null ? String.Format("{0:dd-MM-yyyy}", regis.DateOfBirth) : "") + " / " +
                             (regis.AgeInYear != null ? regis.AgeInYear.ToString() : "") + " thn " +
                             (regis.AgeInMonth != null ? regis.AgeInMonth.ToString() : "") + " bln / " +
                             (gender != null ? gender.ToString() : "") + "^FS\r\n");

                    //sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");

                    if (prescriptionType == Constant.PrescriptionType.ODD)
                    {
                        sb.Append(string.Format("^FT10,215^A0N,23,24^FH\\^FD07-08 / 13-14 / 19-20 / 22-23^FS\r\n"));
                    }
                    else
                    {
                        // ini jika pagi/siang/sore tampil sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");
                        if (!String.IsNullOrEmpty(entity.SignaName1))
                        {
                            if (entity.SignaLabel == "s imm")
                            {
                                sb.Append("^FT10,195^A0N,23,24^FH\\^FD" + "Pemakaian sudah diketahui" + "^FS\r\n");
                            }

                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.SignaName1 != null ? entity.SignaName1.Trim() : " " + entity.cfPRN) + "^FS\r\n");
                            sb.Append("^FT10,240^A0N,23,24^FH\\^FD" + (entity.cfPRN) + "^FS\r\n");
                        }
                        else
                        {
                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel : "") + "^FS\r\n");
                        }
                    }

                    sb.Append("^FT10,270^A0N,23,24^FH\\^FD" + (entity.Route != null ? entity.Route.ToString().Trim() : "") + "^FS\r\n");

                    string racikan = null;
                    bool isExternalMedication = entity.IsExternalMedication;

                    if (entity.ParentID == 0 && entity.IsRFlag == true && entity.IsCompound == true)
                    {
                        string nama = "Racikan";
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ")" + (nama != null ? nama.Trim() : "") + "^FS\r\n");

                        List<vPrescriptionOrderDt> lstRacik = BusinessLayer.GetvPrescriptionOrderDtList(string.Format("ParentID = {0} AND GCChargesTransactionStatus != '{1}' AND GCPrescriptionOrderStatus != '{2}' AND IsDeleted = 0", entity.PrescriptionOrderDetailID, Constant.TransactionStatus.VOID, Constant.TestOrderStatus.CANCELLED));
                        vPrescriptionOrderDt e = BusinessLayer.GetvPrescriptionOrderDtList(String.Format("PrescriptionOrderDetailID = {0}", entity.PrescriptionOrderDetailID)).FirstOrDefault();
                        lstRacik.Add(e);

                        int ExternalMedicationCount = lstRacik.Where(t => t.IsExternalMedication == true).ToList().Count;
                        if (ExternalMedicationCount > 0)
                        {
                            isExternalMedication = true;
                        }

                        foreach (vPrescriptionOrderDt ra in lstRacik)
                        {
                            //                            isExternalMedication = ra.IsExternalMedication;
                            if (racikan == null)
                            {
                                racikan = ra.ItemName1;
                            }
                            else
                            {
                                racikan = racikan + '|' + ra.ItemName1;
                            }
                        }
                    }
                    else
                    {
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ") " + (entity.cfItemName != null ? entity.cfItemName.ToString().Trim() : "") + "^FS\r\n");
                    }

                    sisiracik = (racikan != null ? racikan.ToString().Trim() : "");
                    words = sisiracik.Split('|');
                    tempStr = "";
                    //hasilStr = LibStr.repchr(' ', 0);

                    //for (int i = 0; i < words.Count(); i++)
                    //{
                    //    // Eliminate punctuation
                    //    if ((tempStr.Length + words[i].Length) > nlebar)
                    //    {
                    //        sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //        tempStr = "";
                    //        initBrs += 23;
                    //    }
                    //    tempStr = tempStr + words[i] + " ";
                    //}
                    //if (tempStr.Length > 0)
                    //{
                    //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //}

                    for (int i = 0; i < words.Count(); i++)
                    {
                        // Eliminate punctuation
                        //if ((tempStr.Length + words[i].Length) > nlebar)
                        //{
                        //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                        //    tempStr = "";
                        //    initBrs += 23;
                        //}
                        if (i != (words.Count() - 1))
                        {
                            tempStr = tempStr + words[i] + ", ";
                        }
                        else
                        {
                            tempStr = tempStr + words[i];
                        }
                    }

                    string line1 = "";
                    string line2 = "";
                    string line3 = "";
                    string line4 = "";
                    Int32 countLine2 = tempStr.Length - 42;
                    Int32 countLine3 = tempStr.Length - 84;
                    Int32 countLine4 = tempStr.Length - 168;

                    if (tempStr.Length > 42)
                    {
                        line1 = tempStr.Substring(0, 42);
                    }
                    else
                    {
                        line1 = tempStr;
                    }

                    if (tempStr.Length > 42 && tempStr.Length > 84)
                    {
                        line2 = tempStr.Substring(42, 42);
                    }
                    else
                    {
                        if (countLine2 > 0)
                        {
                            line2 = tempStr.Substring(42, countLine2);
                        }
                    }

                    if (tempStr.Length > 84 && tempStr.Length > 168)
                    {
                        line3 = tempStr.Substring(84, 42);
                    }
                    else
                    {
                        if (countLine3 > 0)
                        {
                            line3 = tempStr.Substring(84, countLine3);
                        }
                    }

                    if (tempStr.Length > 168 && tempStr.Length > 210)
                    {
                        line4 = tempStr.Substring(168, 42);
                    }
                    else
                    {
                        if (countLine4 > 0)
                        {
                            line4 = tempStr.Substring(168, countLine4);
                        }
                    }

                    if (line1.Length > 0)
                    {
                        sb.Append("^FT10," + 330 + "^ACN,18,10^FH\\^FD" + line1 + "^FS\r\n");
                    }

                    if (line2.Length > 0)
                    {
                        sb.Append("^FT10," + 350 + "^ACN,18,10^FH\\^FD" + line2 + "^FS\r\n");
                    }

                    if (line3.Length > 0)
                    {
                        sb.Append("^FT10," + 370 + "^ACN,18,10^FH\\^FD" + line3 + "^FS\r\n");
                    }

                    if (line4.Length > 0)
                    {
                        sb.Append("^FT10," + 390 + "^ACN,18,10^FH\\^FD" + line4 + "^FS\r\n");
                    }

                    String ed = Convert.ToDateTime(entity.ExpiredDate).ToString("dd-MM-yyyy");
                    string bud = Convert.ToDateTime(entity.BUD).ToString("dd-MM-yyyy");
                    if (!String.IsNullOrEmpty(racikan))
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED :     -    -^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                    }
                    else
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (bud != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.BUD) : "    -    -") + "^FS\r\n");
                    }

                    sb.Append("^PQ1,0,1,Y^XZ");

                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    string printerUrl = printerUrl1;
                    if (isExternalMedication)
                        printerUrl = printerUrl2;

                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                    #endregion
                }
            }
        }

        public static void printODDThermalBebas(vRegistrationEtiketRSMD regis, PrescriptionOrderHd oHeader, string lstPrescriptionOrderDetailID, string printerUrl1, string printerUrl2, string prescriptionType)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            string[] detailIDLst = lstPrescriptionOrderDetailID.Split(',');
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = regis.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            for (int ix = 0; ix < detailIDLst.Count(); ix++)
            {
                StringBuilder sb = new StringBuilder();
                vPrescriptionOrderDt7 entity = BusinessLayer.GetvPrescriptionOrderDt7List(string.Format("PrescriptionOrderDetailID = {0} AND ParentID IS NULL", detailIDLst[ix])).FirstOrDefault();

                if (entity != null)
                {
                    int nlebar = 42;

                    int initBrs = 369;
                    string sisiracik = string.Empty;
                    string tempStr = null;
                    string[] words = null;

                    string sracikan = string.Empty;

                    sb.Append("^XA\r\n");
                    sb.Append("^MMT\r\n");
                    sb.Append("^PW519\r\n");
                    sb.Append("^LL0440\r\n");
                    sb.Append("^LS0\r\n");
                    sb.Append("^FT83,50^A0N,31,31^FH\\^FD" + healthcare.HealthcareName.ToString().Trim() + "^FS\r\n");
                    //sb.Append("^FT10,87^ACN,18,10^FH\\^FD" + entity.TransactionNo.ToString().Trim() + "^FS\r\n");
                    sb.Append("^A0N,21,18");
                    sb.Append("^FT10,87^FD" + entity.TransactionNo.ToString().Trim() + "^FS\r\n");
                    sb.Append("^FT195,87^A0N,21,18^FH\\^FD" + (regis.RegistrationDate != null ? String.Format("{0:dd-MM-yyyy}", regis.RegistrationDate) : "") + "^FS\r\n");
                    sb.Append("^FT322,87^A0N,21,18^FH\\^FDMR." + (regis.MedicalNo != null ? regis.MedicalNo.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,128^A0N,28,28^FH\\^FD" + (regis.PatientName != null ? regis.PatientName.ToString().Trim() : "") + "^FS\r\n");
                    sb.Append("^FT10,164^A0N,23,24^FH\\^FDDOB/Age/Sex: " + (regis.DateOfBirth != null ? String.Format("{0:dd-MM-yyyy}", regis.DateOfBirth) : "") + " / " +
                             (regis.AgeInYear != null ? regis.AgeInYear.ToString() : "") + " thn " +
                             (regis.AgeInMonth != null ? regis.AgeInMonth.ToString() : "") + " bln / " +
                             (gender != null ? gender.ToString() : "") + "^FS\r\n");

                    //sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");

                    if (prescriptionType == Constant.PrescriptionType.ODD)
                    {
                        sb.Append(string.Format("^FT10,215^A0N,23,24^FH\\^FD07-08 / 13-14 / 19-20 / 22-23^FS\r\n"));
                    }
                    else
                    {
                        // ini jika pagi/siang/sore tampil sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel + " " + entity.cfDailyInformation : "") + "^FS\r\n");
                        if (!String.IsNullOrEmpty(entity.SignaName1))
                        {
                            if (entity.SignaLabel == "s imm")
                            {
                                sb.Append("^FT10,195^A0N,23,24^FH\\^FD" + "Pemakaian sudah diketahui" + "^FS\r\n");
                            }

                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.SignaName1 != null ? entity.SignaName1.Trim() : " " + entity.cfPRN) + "^FS\r\n");
                            sb.Append("^FT10,240^A0N,23,24^FH\\^FD" + (entity.cfPRN) + "^FS\r\n");
                        }
                        else
                        {
                            sb.Append("^FT10,215^A0N,23,24^FH\\^FD" + (entity.cfConsumeMethod != null ? entity.cfConsumeMethod.ToString().Trim() + " " + entity.CoenamRuleLabel : "") + "^FS\r\n");
                        }
                    }

                    sb.Append("^FT10,270^A0N,23,24^FH\\^FD" + (entity.Route != null ? entity.Route.ToString().Trim() : "") + "^FS\r\n");

                    string racikan = null;
                    bool isExternalMedication = entity.IsExternalMedication;

                    if (entity.ParentID == 0 && entity.IsRFlag == true && entity.IsCompound == true)
                    {
                        string nama = "Racikan";
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ") " + (nama != null ? nama.Trim() : "") + "^FS\r\n");

                        List<vPrescriptionOrderDt> lstRacik = BusinessLayer.GetvPrescriptionOrderDtList(string.Format("ParentID = {0} AND GCChargesTransactionStatus != '{1}' AND GCPrescriptionOrderStatus != '{2}' AND IsDeleted = 0", entity.PrescriptionOrderDetailID, Constant.TransactionStatus.VOID, Constant.TestOrderStatus.CANCELLED));
                        vPrescriptionOrderDt e = BusinessLayer.GetvPrescriptionOrderDtList(String.Format("PrescriptionOrderDetailID = {0}", entity.PrescriptionOrderDetailID)).FirstOrDefault();
                        lstRacik.Add(e);

                        int ExternalMedicationCount = lstRacik.Where(t => t.IsExternalMedication == true).ToList().Count;
                        if (ExternalMedicationCount > 0)
                        {
                            isExternalMedication = true;
                        }

                        foreach (vPrescriptionOrderDt ra in lstRacik)
                        {
                            //                            isExternalMedication = ra.IsExternalMedication;
                            if (racikan == null)
                            {
                                racikan = ra.ItemName1;
                            }
                            else
                            {
                                racikan = racikan + '|' + ra.ItemName1;
                            }
                        }
                    }
                    else
                    {
                        sb.Append("^FT10,302^A0N,23,24^FH\\^FD(" + entity.TakenQty.ToString() + ")" + (entity.cfItemName != null ? entity.cfItemName.ToString().Trim() : "") + "^FS\r\n");
                    }

                    sisiracik = (racikan != null ? racikan.ToString().Trim() : "");
                    words = sisiracik.Split('|');
                    tempStr = "";
                    //hasilStr = LibStr.repchr(' ', 0);

                    //for (int i = 0; i < words.Count(); i++)
                    //{
                    //    // Eliminate punctuation
                    //    if ((tempStr.Length + words[i].Length) > nlebar)
                    //    {
                    //        sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //        tempStr = "";
                    //        initBrs += 23;
                    //    }
                    //    tempStr = tempStr + words[i] + " ";
                    //}
                    //if (tempStr.Length > 0)
                    //{
                    //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                    //}

                    for (int i = 0; i < words.Count(); i++)
                    {
                        // Eliminate punctuation
                        //if ((tempStr.Length + words[i].Length) > nlebar)
                        //{
                        //    sb.Append("^FT10," + Convert.ToString(initBrs) + "^ACN,18,10^FH\\^FD" + tempStr.Trim() + repchr(' ', 0) + "^FS\r\n");
                        //    tempStr = "";
                        //    initBrs += 23;
                        //}
                        if (i != (words.Count() - 1))
                        {
                            tempStr = tempStr + words[i] + ", ";
                        }
                        else
                        {
                            tempStr = tempStr + words[i];
                        }
                    }

                    string line1 = "";
                    string line2 = "";
                    string line3 = "";
                    string line4 = "";
                    Int32 countLine2 = tempStr.Length - 42;
                    Int32 countLine3 = tempStr.Length - 84;
                    Int32 countLine4 = tempStr.Length - 168;

                    if (tempStr.Length > 42)
                    {
                        line1 = tempStr.Substring(0, 42);
                    }
                    else
                    {
                        line1 = tempStr;
                    }

                    if (tempStr.Length > 42 && tempStr.Length > 84)
                    {
                        line2 = tempStr.Substring(42, 42);
                    }
                    else
                    {
                        if (countLine2 > 0)
                        {
                            line2 = tempStr.Substring(42, countLine2);
                        }
                    }

                    if (tempStr.Length > 84 && tempStr.Length > 168)
                    {
                        line3 = tempStr.Substring(84, 42);
                    }
                    else
                    {
                        if (countLine3 > 0)
                        {
                            line3 = tempStr.Substring(84, countLine3);
                        }
                    }

                    if (tempStr.Length > 168 && tempStr.Length > 210)
                    {
                        line4 = tempStr.Substring(168, 42);
                    }
                    else
                    {
                        if (countLine4 > 0)
                        {
                            line4 = tempStr.Substring(168, countLine4);
                        }
                    }

                    if (line1.Length > 0)
                    {
                        sb.Append("^FT10," + 330 + "^ACN,18,10^FH\\^FD" + line1 + "^FS\r\n");
                    }

                    if (line2.Length > 0)
                    {
                        sb.Append("^FT10," + 350 + "^ACN,18,10^FH\\^FD" + line2 + "^FS\r\n");
                    }

                    if (line3.Length > 0)
                    {
                        sb.Append("^FT10," + 370 + "^ACN,18,10^FH\\^FD" + line3 + "^FS\r\n");
                    }

                    if (line4.Length > 0)
                    {
                        sb.Append("^FT10," + 390 + "^ACN,18,10^FH\\^FD" + line4 + "^FS\r\n");
                    }

                    String ed = Convert.ToDateTime(entity.ExpiredDate).ToString("dd-MM-yyyy");
                    string bud = Convert.ToDateTime(entity.BUD).ToString("dd-MM-yyyy");
                    if (!String.IsNullOrEmpty(racikan))
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED :     -    -^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                    }
                    else
                    {
                        sb.Append("^FT10,425^A0N,23,24^FH\\^FDED : " + (ed != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.ExpiredDate) : "    -    -") + "^FS\r\n");
                        sb.Append("^FT315,425^A0N,23,24^FH\\^FDBUD : " + (bud != Constant.ConstantDate.DEFAULT_NULL ? String.Format("{0:dd-MM-yyyy}", entity.BUD) : "    -    -") + "^FS\r\n");
                    }
                    sb.Append("^PQ1,0,1,Y^XZ");

                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    string printerUrl = printerUrl1;
                    if (isExternalMedication)
                        printerUrl = printerUrl2;

                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                    #endregion
                }
            }
        }

        public static String PrintNoteResep(Int32 prescriptionOrderID)
        {
            vPrescriptionOrderHd hd = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", prescriptionOrderID)).FirstOrDefault();
            List<vPrescriptionOrderDt1> dt = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0}", prescriptionOrderID));
            vRegistration regis = BusinessLayer.GetvRegistrationList(string.Format("VisitID = {0} AND IsMainVisit = 1", hd.VisitID)).FirstOrDefault();

            if (regis.DepartmentID == Constant.Facility.INPATIENT)
            {
                //                printFMNotaResepIP(hd, dt, regis);
            }
            else if (regis.DepartmentID == Constant.Facility.EMERGENCY)
            {
                printFMNotaResepRD(hd, dt, regis);
            }
            else if (regis.DepartmentID == Constant.Facility.PHARMACY)
            {
                //               printFMNotaResepBebas(hd, dt, regis);
            }
            else
            {
                //                printFMNotaResepOP(hd, dt, regis);
            }
            return "";
        }

        public static void printFMNotaResepRD(vPrescriptionOrderHd hd, List<vPrescriptionOrderDt1> dt, vRegistration regis)
        {
            //string stipeResep = BusinessLayer.GetStandardCodeList(string.Format("StandardCodeID = '{0}'", hd.GCPrescriptionType)).FirstOrDefault().Notes;
            //string gender = regis.GCGender;

            //if (gender == Constant.Gender.FEMALE)
            //{
            //    gender = "P";
            //}
            //else
            //{
            //    gender = "L";
            //}

            //int nlebar = 62;
            ////string sresep = (oHeader.PrescriptionNo != null ? oHeader.PrescriptionNo.ToString() : "");
            ////string[] lresep = sresep.Split(new string[] { "\r\n", "\n" }, StringSplitOptions.RemoveEmptyEntries); // Regex.Split(sresep, "\n\r");
            ////sresep = string.Empty;
            ////foreach (string line in lresep)
            ////{
            ////    sresep += line.PadRight(80); // (line + LibStr.repchr(' ', 80)); //.Substring(80);
            ////}
            //DotMatrixPrinter ep = new DotMatrixPrinter();
            //ep.InitPrinter();
            //ep.SetPageLengthInLines(33); // pake 33 baris
            //ep.SelectCondensedMode();
            //ep.SelectDoubleWidthMode();
            //ep.SelectDraftMode();
            //ep.SelectDoubleWidthMode();
            ////  ep.Append(((char)15).ToString());
            //ep.Append(PADC("FARMASI RUMAH SAKIT MEDISTRA", (int)nlebar / 2));
            //ep.Append("\n\r" + repchr('-', nlebar / 2));
            //ep.Append("\n\r" + PADC("PERINCIAN RESEP", (int)nlebar / 2));
            //ep.CancelDoubleWidthMode();
            //ep.SelectCondensedMode();
            //ep.Append("\n\rDari Dokter     : " + BagiStr(hd.ParamedicName != null ? hd.ParamedicName.ToString().Trim() : "", 45, 18));
            //ep.Append("\n\rTanggal Resep   : " + (hd.PrescriptionDate != null ? String.Format("{0:dd-MM-yyyy}", hd.PrescriptionDate) : "") + " " +
            //    (hd.PrescriptionTime != null ? hd.PrescriptionTime.ToString() : ""));
            //ep.Append("\n\rNo.Resep/No.Reg : " + (hd.PrescriptionOrderNo != null ? hd.PrescriptionOrderNo.ToString().Trim() : "") + " / " +
            //    (regis.RegistrationNo != null ? regis.RegistrationNo.ToString().Trim() : ""));
            //ep.Append("\n\rUntuk           : " + (regis.PatientName != null ? regis.PatientName.ToString().Trim() : ""));
            //ep.Append("\n\rTgl.Lhr/Umur/Sex: " + (regis.DateOfBirth != null ? String.Format("{0:dd-MM-yyyy}", regis.DateOfBirth) : "") + " / " +
            //    (regis.AgeInYear != null ? regis.AgeInYear.ToString() : "") + " tahun " +
            //    (regis.AgeInMonth != null ? regis.AgeInMonth.ToString() : "") + " bulan / " +
            //    (gender != null ? gender.ToString() : ""));
            ////ep.Append("\n\rResep           : " + BagiStr(sresep, 80, 18));
            //ep.Append("\n\rTipe Resep      : " + (stipeResep != null ? stipeResep.ToString() : ""));
            //ep.Append("\n\rJumlah Item     : " + dt.Count.ToString().Trim());

            ////Cetak Untuk Barcode
            //string BarcodeString = string.Empty;
            //string strBarcode = string.Empty;


            ////strBarcode = (dtHeader.Rows[0]["noantrian"] != DBNull.Value ? dtHeader.Rows[0]["noantrian"].ToString() : "");

            ////strBarcode = string.Format("{0}{1}", Convert.ToChar(65).ToString(), strBarcode);

            ////BarcodeString = string.Format("{0}{1}{2}{3}{4}{5}{6}{7}{8}{9}{10}{11}", Convert.ToChar(27).ToString(),
            ////Convert.ToChar(40).ToString(),
            ////Convert.ToChar(66).ToString(),
            ////Convert.ToChar(6 + strBarcode.Length).ToString(),
            ////Convert.ToChar(0).ToString(),
            ////Convert.ToChar(6).ToString(),
            ////Convert.ToChar(2).ToString(),
            ////Convert.ToChar(0).ToString(),
            ////Convert.ToChar(18).ToString(),
            ////Convert.ToChar(0).ToString(),
            ////Convert.ToChar(1).ToString(),
            ////strBarcode);

            ////ep.Append("\n\r" + repchr(' ', 20) + BarcodeString);
            ////ep.Append(string.Format("{0}{1}", Convert.ToChar(10).ToString(), Convert.ToChar(13).ToString()));
            ////ep.Append(string.Format("{0}{1}", Convert.ToChar(27).ToString(), Convert.ToChar(64).ToString())); // Reset Printer

            //ep.Append("\n\r\n\r" + repchr('-', nlebar));
            //int nNo = 0;
            //Single fTotal = (float)0.00;
            //string sNama = string.Empty;
            //foreach (vPrescriptionOrderDt1 e in dt)
            //{ //   exec spfmrpt_BuktiResepRI '201401310024'
            //    //group berdasarkan ikut obat
            //    // if totalracikan = 1 then
            //    // cetak no,nmdesc1,hasil,satuankc,jumlah
            //    // else
            //    //if jenis = 1 then
            //    // cetak no,nmkemas,'','',total
            //    //else
            //    // cetak '',nmdesc1,hasil,satuankc
            //    //endif
            //    // endif
            //    if (Convert.ToInt16(dtHeader.Rows[i]["totalracikan"]) == 0)
            //    {
            //        sNama = (e.cfItemName != null ? e.cfItemName.ToString() : "");
            //        sNama = (sNama.Length > 32 ? sNama.Substring(0, 32) : sNama);
            //        ep.Append("\n\r");
            //        ep.Append((++nNo).ToString().PadLeft(2, '0') + " ");
            //        ep.Append(sNama.PadRight(32) + " ");
            //        ep.Append((e.TakenQty != null ? e.TakenQty.ToString() : "0").PadLeft(3) + " ");
            //        ep.Append((e.ItemUnit != null ? e.ItemUnit.ToString().Trim() : "").PadRight(8) + " ");
            //        ep.Append((e.Pr != DBNull.Value ? String.Format(CultureInfo.GetCultureInfo("id-ID"), "{0:#,##0.00}", dtHeader.Rows[i]["jumlah"]) : "").PadLeft(13));
            //        fTotal += Convert.ToSingle(dtHeader.Rows[i]["jumlah"] != DBNull.Value ? dtHeader.Rows[i]["jumlah"] : 0.00);
            //    }
            //    else
            //    {
            //        if (Convert.ToInt16(dtHeader.Rows[i]["jenis"]) == 1)
            //        {
            //            sNama = (dtHeader.Rows[i]["nmkemas"] != DBNull.Value ? dtHeader.Rows[i]["nmkemas"].ToString() : "");
            //            sNama = (sNama.Length > 32 ? sNama.Substring(0, 32) : sNama);
            //            // cetak no,nmkemas,'','',total
            //            ep.Append("\n\r");
            //            ep.Append((++nNo).ToString().PadLeft(2, '0') + " ");
            //            ep.Append(sNama.PadRight(32) + " ");
            //            ep.Append(repchr(' ', 3) + " ");
            //            ep.Append(repchr(' ', 8) + " ");
            //            ep.Append((dtHeader.Rows[i]["total"] != DBNull.Value ? String.Format(CultureInfo.GetCultureInfo("id-ID"), "{0:#,##0.00}", dtHeader.Rows[i]["total"]) : "").PadLeft(13));
            //            fTotal += Convert.ToSingle(dtHeader.Rows[i]["total"] != DBNull.Value ? dtHeader.Rows[i]["total"] : 0.00);
            //        }
            //        //else
            //        {
            //            // cetak '',nmdesc1,hasil,satuankc
            //            sNama = (dtHeader.Rows[i]["nmdesc1"] != DBNull.Value ? dtHeader.Rows[i]["nmdesc1"].ToString() : "");
            //            sNama = (sNama.Length > 32 ? sNama.Substring(0, 32) : sNama);
            //            ep.Append("\n\r");
            //            ep.Append(repchr(' ', 2) + " ");
            //            ep.Append(sNama.PadRight(32) + " ");
            //            ep.Append((dtHeader.Rows[i]["hasil"] != DBNull.Value ? dtHeader.Rows[i]["hasil"].ToString() : "0").PadLeft(3) + " ");
            //            ep.Append((dtHeader.Rows[i]["satuankc"] != DBNull.Value ? dtHeader.Rows[i]["satuankc"].ToString().Trim() : "").PadRight(8) + " ");
            //        }
            //    }
            //}
            //ep.Append("\n\r" + repchr('-', nlebar));
            //ep.Append("\n\r" + repchr(' ', 40) + "Total : " + String.Format(CultureInfo.GetCultureInfo("id-ID"), "{0:#,##0.00}", fTotal).PadLeft(14));
            //ep.Append("\n\r" + repchr('-', nlebar));
            //ep.Append("\n\r" + repchr(' ', 22) + "Jakarta," + String.Format("{0:dd-MM-yyyy}", DateTime.Now));
            //ep.Append("\n\r" + repchr(' ', 22) + "pcc");
            //ep.Append("\n\r\n\r" + repchr(' ', 22) + "( " + (dtHeader.Rows[0]["updater"] != DBNull.Value ? dtHeader.Rows[0]["updater"].ToString().Trim() : "") + " )");
            //ep.CancelCondensedMode();
            //ep.SelectDraftMode();
            //ep.FormFeed();
        }

        public static String PrintLabelAssetRSMD(String printFormat, Int32 id)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];
            List<vFAItem> lstEntity = BusinessLayer.GetvFAItemList(String.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString()));

            if (lstEntity.Count > 0)
            {
                #region RSMD
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.AssetLabel, printFormat);

                List<string> lstField = GetMetadata(PrintingGroup.AssetLabel);
                if (!string.IsNullOrEmpty(command))
                {
                    string filterExpression = string.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString());
                    List<vFAItem> lstDetail = BusinessLayer.GetvFAItemList(filterExpression);
                    foreach (vFAItem item in lstDetail)
                    {
                        #region Get Header Information
                        string fixedAssetCode = item.FixedAssetCode;
                        string fixedAssetName = item.FixedAssetName;
                        string faLocationCode = item.FALocationCode;
                        string faLocationName = item.FALocationName;
                        string serialNumber = item.cfSerialNumber;
                        string itemName = item.ItemName1;
                        string itemCode = item.ItemCode;
                        string QRCodeInformation = "";

                        //if (fixedAssetName.Length > 40)
                        //{
                        //    fixedAssetName = fixedAssetName.Substring(0, 39);
                        //}

                        //if (faLocationName.Length > 14)
                        //{
                        //    faLocationName = faLocationName.Substring(0, 13);
                        //}

                        //if (serialNumber.Length > 10)
                        //{
                        //    serialNumber = serialNumber.Substring(0, 9);
                        //}

                        QRCodeInformation = string.Format("{0}/{1}/{2}/{3}", fixedAssetName, faLocationName, item.cfProcurementYear, serialNumber);
                        //QRCodeInformation = string.Format("{0}", fixedAssetName);
                        #endregion

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                        labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                        labelInfo.Add("FixedAssetName", fixedAssetName);
                        labelInfo.Add("FixedAssetCode", fixedAssetCode);
                        labelInfo.Add("FALocationName", faLocationName);
                        labelInfo.Add("SerialNumber", serialNumber);
                        labelInfo.Add("ItemName1", itemName);
                        labelInfo.Add("ItemCode", itemCode);
                        labelInfo.Add("cfProcurementYear", item.cfProcurementYear);
                        labelInfo.Add("QRCodeInformation", QRCodeInformation);

                        #region Replace Label Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion

                        if (!string.IsNullOrEmpty(labelCommand))
                        {
                            #region Create Temporary Text File to be printed by Printer Client Service
                            fileName = CreateTemporayFile(labelCommand, "ACC");
                            #endregion
                        }
                    }
                }
                #endregion
            }
            return fileName;
        }

        public static String PrintStikerRJZebra(String printFormat, Int32 MRN)
        {
            string fileName = "";
            DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

            Patient p = BusinessLayer.GetPatient(MRN);

            if (p != null)
            {
                #region RSMD
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.PatientLabel, printFormat);

                List<string> lstField = GetMetadata(PrintingGroup.PatientLabel);
                int iMaxCharLen = 35;
                if (!string.IsNullOrEmpty(command))
                {
                    #region Get Header Information
                    string PatientName = GetLinesBasedOnSpace(p.FullName, iMaxCharLen)[0];
                    string PatientName2 = GetLinesBasedOnSpace(p.FullName, iMaxCharLen)[1];
                    string MedicalNo = p.MedicalNo;
                    string DateOfBirth = String.Format("{0:dd/MM/yyyy}", p.DateOfBirth);
                    string Gender = p.GCGender == Constant.Gender.FEMALE ? "P" : "L";

                    #endregion

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", "");
                    labelInfo.Add("RegistrationNo", "");
                    labelInfo.Add("ActualVisitDateInString", "");
                    labelInfo.Add("ActualVisitTime", "");
                    labelInfo.Add("ServiceUnitCode", "");
                    labelInfo.Add("ServiceUnitName", "");
                    labelInfo.Add("BusinessPartnerName", "");
                    labelInfo.Add("MedicalNo", MedicalNo);
                    labelInfo.Add("PatientName", PatientName);
                    labelInfo.Add("PatientName2", PatientName2);
                    labelInfo.Add("Gender", Gender);
                    labelInfo.Add("DateOfBirth", DateOfBirth);
                    labelInfo.Add("PatientAge", "");
                    labelInfo.Add("PatientAgeInEnglish", "");
                    labelInfo.Add("ParamedicCode", "");
                    labelInfo.Add("ParamedicName", "");
                    labelInfo.Add("cfPatientLocation", "");
                    labelInfo.Add("cfAlternateRegistrationNo", "");
                    labelInfo.Add("DateOfBirthInString", "");
                    labelInfo.Add("HomeAddress", "");
                    labelInfo.Add("cfPatientNameSalutation", "");
                    labelInfo.Add("cfGenderInitial", "");
                    labelInfo.Add("cfPatientNameInLabel", "");
                    labelInfo.Add("cfPatientAgeInYear", "");

                    #region Replace Label Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion

                    if (!string.IsNullOrEmpty(labelCommand))
                    {
                        #region Create Temporary Text File to be printed by Printer Client Service
                        fileName = CreateTemporayFile(labelCommand, "ZRJ");
                        #endregion
                    }
                }
                #endregion
            }
            return fileName;
        }

        public static string AddChar(string a, int count)
        {
            for (int i = 1; i <= count; i++)
            {
                a = a + " ";
            }
            return a;
        }

        public static string AddCharBefore(string a, int count)
        {
            string space = "";
            for (int i = 1; i <= count; i++)
            {
                space += " ";
            }

            string final = space + a;
            return final;
        }

        public static string ConvertStr(string s)
        {
            string s1 = string.Empty;
            string s2 = string.Empty;
            for (int i = 0; i < s.Length; i++)
            {
                string c = s[i].ToString();
                s2 = string.Empty;
                switch (c)
                {
                    case "\"":
                        s2 = "\\\"";
                        break;
                    case "\'":
                        s2 = "\\\'";
                        break;
                    case "\\":
                        s2 = "\\\\";
                        break;
                    default:
                        s2 = c;
                        break;
                }
                s1 += s2;
            }
            return s1;
        }

        public static string repchr(char c, int l)
        {
            string s = "";
            int i = 0;
            for (i = 1; i <= l; i++)
            {
                s += c;
            }
            return s;
        }

        public static string PADC(string s, int panjang)
        {
            int L = 0;
            int R = 0;
            L = (panjang - s.Length) / 2;
            R = (panjang - s.Length) - L;
            return repchr(' ', L) + s + repchr(' ', R);
        }

        public static string BagiStr(string s, int lebar, int indent)
        {
            string[] words = null;
            string tempStr = null;
            string hasilStr = null;

            // Split the string at the space characters.
            words = s.Split(' ');
            tempStr = "";
            hasilStr = repchr(' ', indent);
            for (int i = 0; i < words.Length; i++)
            {
                // Eliminate punctuation
                if ((tempStr.Length + words[i].Length) > lebar)
                {
                    hasilStr += tempStr.Trim() + "\n\r" + repchr(' ', indent);
                    tempStr = "";
                }
                tempStr = tempStr + words[i] + " ";
            }
            if (tempStr.Length > 0)
            {
                hasilStr += tempStr.Trim();
            }
            return hasilStr.TrimStart();
        }

        private static string[] GetLinesBasedOnSpace(string str, int iMaxChar)
        {
            string str1 = "";
            string str2 = "";

            int nPanjang = str.Length / iMaxChar;
            if (nPanjang > 0)
            {
                // more than one line
                int i = 0;
                // print line 1
                for (i = (iMaxChar - 1); i > 0; i--)
                {
                    if (str[i] == ' ')
                    {
                        str1 = str.Substring(0, i + 1);
                        break;
                    }
                }

                // jika namanya panjang dan tidak ada spasi bijimane gan??\
                if (i == 0)
                {
                    str1 = str;
                    i = str.Length - 1;
                }

                // line 2
                i++;
                str = str.Substring(i);
                if (str.Length > iMaxChar)
                {
                    // jika line ke 2 masih saja panjang, lebih dari 22 karakter maka potong saja bro :D
                    for (i = (iMaxChar - 1); i > 0; i--)
                    {
                        if (str[i] == ' ')
                        {
                            str2 = str.Substring(0, i + 1);
                            break;
                        }
                    }
                    if (i == 0)
                    {
                        str2 = str;
                        i = str.Length - 1;
                    }
                }
                else
                {
                    str2 = str;
                }
            }
            else
            {
                // one line
                str1 = str;
            }
            string[] s = { str1, str2 };
            return s;
        }

        private static string CreateTemporayFile(string command, string fileInitial)
        {
            TimeSpan span = DateTime.Now.Subtract(new DateTime(1970, 1, 1, 0, 0, 0));
            Int32 unixTimestamp = (Int32)(DateTime.UtcNow.Subtract(new DateTime(1970, 1, 1))).TotalSeconds;

            string consID = "123456";
            string pass = "0034T2";

            string token = GenerateSignature(string.Format("{0}{1}", unixTimestamp.ToString(), consID), pass);

            var plainTextBytes = System.Text.Encoding.UTF8.GetBytes(command);
            // Simpen dulu ke file
            String NmFile = Guid.NewGuid().ToString();
            NmFile = token.Replace("-", "").Replace("/", "").Replace("+", "") + AppSession.UserLogin.UserID.ToString().Trim() + fileInitial + NmFile.Replace("-", "") + ".TXT";
            System.IO.File.WriteAllText(AppConfigManager.QISPhysicalTempDirectory + NmFile, System.Convert.ToBase64String(plainTextBytes));
            //return System.Convert.ToBase64String(plainTextBytes);
            //kembalikan ID nya
            return NmFile;
        }

        private static string GenerateSignature(string data, string secretKey)
        {
            // Initialize the keyed hash object using the secret key as the key
            HMACSHA256 hashObject = new HMACSHA256(Encoding.UTF8.GetBytes(secretKey));

            // Computes the signature by hashing the salt with the secret key as the key
            var signature = hashObject.ComputeHash(Encoding.UTF8.GetBytes(data));

            // Base 64 Encode
            var encodedSignature = Convert.ToBase64String(signature);

            // URLEncode
            // encodedSignature = System.Web.HttpUtility.UrlEncode(encodedSignature);
            return encodedSignature;
        }

        #endregion
        #region PrintBuktiPendaftaranRSSES
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSSES
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSSES(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "P" : "L";


                string QueueNo = "";
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        QueueNo = oVisit9.QueueNo.ToString();
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {

                            QueueNo = oVisit9.QueueNo.ToString();
                        }
                        else
                        {
                            ///sb.AppendLine(string.Format("No. Antrian    : *** {0} ***", oVisit9.QueueNo));
                            QueueNo = oVisit9.QueueNo.ToString();
                        }
                    }
                }
                #region Print Detail
                sb.Append(ESC + "a1");
                if (!string.IsNullOrEmpty(QueueNo))
                {

                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("ANTRIAN"));
                    sb.Append(DoubleOn);
                    sb.AppendLine(string.Format("{0}|Sesi 0{1}", QueueNo.PadLeft(3, '0'), oVisit9.Session));
                    sb.Append(DoubleOff);
                    if (!string.IsNullOrEmpty(reg.AppointmentNo))
                    {
                        sb.AppendLine(string.Format(""));
                        vAppointmentWithOperationalTime oApm = BusinessLayer.GetvAppointmentWithOperationalTimeList(string.Format("AppointmentNo='{0}'", reg.AppointmentNo)).FirstOrDefault();
                        if (oApm != null)
                        {
                            sb.AppendLine(string.Format("Jam Sesi {0} - {1}", oApm.MasterScheduleStartTime, oApm.MasterScheduleEndTime));
                        }

                    }
                    sb.AppendLine(string.Format(""));
                    sb.AppendLine(string.Format("RUANG  {0}", oVisit9.RoomName));
                    sb.Append(fontBoldEnd);

                }

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                ///sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. RM         : {0} ({1})", oVisit9.MedicalNo, gender));
                sb.AppendLine(string.Format("Nama Pasien    : {0}", oVisit9.PatientName));
                sb.AppendLine(string.Format("Tgl.Lahir/Umur : {0} / {1}Th", oVisit9.DateOfBirthInString, oVisit9.AgeInYear));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("Unit Pelayanan : {1}", serviceUnit, oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Dokter         : {0}", oVisit9.ParamedicName));
                /////sb.AppendLine(string.Format("Ruang          : {0}", oVisit9.RoomName));
                ///sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Cara Bayar     : {0}", oVisit9.BusinessPartner));
                //if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                //{
                //    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                //    {
                //        sb.AppendLine(string.Format("No. Antrian    : {0}", oVisit9.QueueNo));
                //    }
                //    else
                //    {
                //        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                //        if (app.Notes.Contains("Registrasi Langsung"))
                //        {
                //            sb.AppendLine(string.Format("No. Antrian    : {0}", oVisit9.QueueNo));
                //        }
                //        else
                //        {
                //            sb.AppendLine(string.Format("No. Antrian    : *** {0} ***", oVisit9.QueueNo));
                //        }
                //    }
                //}
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Lab PK  [ ]Lab PA  [ ]Lab Mikro"));
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format("[ ] MRS       ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Registrasi     : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("Petugas        : {0}", reg.CtreatedByName));

                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Mohon Bukti Pendaftaran Ini Jangan Hilang"));
                sb.AppendLine("");
                #region Ticket No
                //if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                //{

                //    sb.AppendLine(string.Format("", string.Empty));
                //}
                //else
                //{
                //    sb.Append(ESC + "a1");
                //    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                //    sb.Append(barcodeWidth1); //x01 = 1 x base width
                //    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                //    sb.Append(ticketNo);
                //    sb.Append(barcodeValues);
                //    sb.AppendLine("");
                //}
                #endregion

                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRSRT
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSRT
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSRT(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "P" : "L";


                string QueueNo = "";
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        QueueNo = oVisit9.QueueNo.ToString();
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {

                            QueueNo = oVisit9.QueueNo.ToString();
                        }
                        else
                        {
                            ///sb.AppendLine(string.Format("No. Antrian    : *** {0} ***", oVisit9.QueueNo));
                            QueueNo = oVisit9.QueueNo.ToString();
                        }
                    }
                }
                #region Print Detail
                sb.Append(ESC + "a1");
                if (!string.IsNullOrEmpty(QueueNo))
                {

                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("ANTRIAN"));
                    sb.Append(DoubleOn);
                    sb.AppendLine(string.Format("{0}|Sesi 0{1}", QueueNo.PadLeft(3, '0'), oVisit9.Session));
                    sb.Append(DoubleOff);
                    if (!string.IsNullOrEmpty(reg.AppointmentNo))
                    {
                        sb.AppendLine(string.Format(""));
                        vAppointmentWithOperationalTime oApm = BusinessLayer.GetvAppointmentWithOperationalTimeList(string.Format("AppointmentNo='{0}'", reg.AppointmentNo)).FirstOrDefault();
                        if (oApm != null)
                        {
                            sb.AppendLine(string.Format("Jam Sesi {0} - {1}", oApm.MasterScheduleStartTime, oApm.MasterScheduleEndTime));
                        }

                    }
                    sb.AppendLine(string.Format(""));
                    sb.AppendLine(string.Format("RUANG  {0}", oVisit9.RoomName));
                    sb.Append(fontBoldEnd);

                }

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                ///sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. RM         : {0} ({1})", oVisit9.MedicalNo, gender));
                sb.AppendLine(string.Format("Nama Pasien    : {0}", oVisit9.PatientName));
                sb.AppendLine(string.Format("Tgl.Lahir/Umur : {0} / {1}Th", oVisit9.DateOfBirthInString, oVisit9.AgeInYear));
                if (oVisit9.DepartmentID == Constant.Facility.INPATIENT)
                {
                    sb.AppendLine(string.Format("Unit Pelayanan/Kamar : {0} / {1}", oVisit9.ServiceUnitName, oVisit9.RoomName));
                }
                else if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                {
                    sb.AppendLine(string.Format("Unit Pelayanan : {1}", serviceUnit, oVisit9.ServiceUnitName));
                }
                sb.AppendLine(string.Format("Dokter         : {0}", oVisit9.ParamedicName));
                /////sb.AppendLine(string.Format("Ruang          : {0}", oVisit9.RoomName));
                ///sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Cara Bayar     : {0}", oVisit9.BusinessPartner));
                //if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                //{
                //    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                //    {
                //        sb.AppendLine(string.Format("No. Antrian    : {0}", oVisit9.QueueNo));
                //    }
                //    else
                //    {
                //        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                //        if (app.Notes.Contains("Registrasi Langsung"))
                //        {
                //            sb.AppendLine(string.Format("No. Antrian    : {0}", oVisit9.QueueNo));
                //        }
                //        else
                //        {
                //            sb.AppendLine(string.Format("No. Antrian    : *** {0} ***", oVisit9.QueueNo));
                //        }
                //    }
                //}
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format("[ ] MRS       ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Registrasi     : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("Petugas        : {0}", reg.CtreatedByName));

                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Mohon Bukti Pendaftaran Ini Jangan Hilang"));
                sb.AppendLine("");
                #region Ticket No
                //if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                //{

                //    sb.AppendLine(string.Format("", string.Empty));
                //}
                //else
                //{
                //    sb.Append(ESC + "a1");
                //    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                //    sb.Append(barcodeWidth1); //x01 = 1 x base width
                //    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                //    sb.Append(ticketNo);
                //    sb.Append(barcodeValues);
                //    sb.AppendLine("");
                //}
                #endregion

                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRSSM
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSSM
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSSM(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";

                StringBuilder sb = new StringBuilder();
                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";
                string InitialPoli = string.Empty;
                ServiceUnitMaster osm = BusinessLayer.GetServiceUnitMasterList(string.Format("ServiceUnitCode='{0}'", oVisit9.ServiceUnitCode)).FirstOrDefault();
                if (osm != null)
                {
                    InitialPoli = osm.ShortName;
                }
                string Queueno = string.Format("{0}{1}{2}", oVisit9.ParamedicInitial, InitialPoli, oVisit9.QueueNo);
                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", Queueno));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", Queueno));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", Queueno));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("*Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaran5
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaran5(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine(string.Format("Kategori Pasien    : {0}", oVisit9.PatientCategory));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("*Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRSSY
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSSY
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSSY(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine(string.Format("Kategori Pasien    : {0}", oVisit9.PatientCategory));
                if (oVisit9.DepartmentID != Constant.Facility.INPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini JANGAN HILANG *"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRSUKRIDA
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSUKRIDA
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSUKRIDA(vConsultVisit oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine(string.Format("Kategori Pasien    : {0}", oVisit9.PatientCategory));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0} | Sesi 0{1}", oVisit9.QueueNo, oVisit9.Session));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0} | Sesi 0{1}", oVisit9.QueueNo, oVisit9.Session));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} | Sesi 0{1} ***", oVisit9.QueueNo, oVisit9.Session));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("*Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranBros
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : BROS
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranBros(vConsultVisit9 oVisit9, string printerUrl, int labelCount = 0)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();
                List<vConsultVisit9> lstoVisitPrint = BusinessLayer.GetvConsultVisit9List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID.ToString()));
                RegistrationBPJS regBPJS = BusinessLayer.GetRegistrationBPJSList(string.Format("RegistrationID = {0}", oVisit9.RegistrationID.ToString())).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine(string.Format("No. Telp           : {0}", oVisit9.PhoneNo1));
                sb.AppendLine(string.Format("Alamat             : {0}", oVisit9.StreetName));
                if (regBPJS != null)
                {
                    sb.AppendLine(string.Format("No. SEP            : {0}", regBPJS.NoSEP));
                }
                sb.AppendLine("");
                for (int i = 0; i < lstoVisitPrint.Count; i++)
                {
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), lstoVisitPrint[i].ServiceUnitName));

                    #region ParamedicName
                    string textParamedic = lstoVisitPrint[i].ParamedicName;
                    string[] textLst = textParamedic.Split(' ');
                    string name = "", nameText1 = "", nameText2 = "";

                    for (int n = 0; n < textLst.Length; n++)
                    {
                        name = textLst[n];
                        if (nameText1.Length <= 17)
                        {
                            if (nameText1 != "")
                            {
                                nameText1 += " ";
                            }
                            nameText1 += name;
                        }

                        if (nameText1.Length > 17)
                        {
                            if (nameText2.Length <= 17)
                            {
                                if (!nameText1.Contains(name))
                                {
                                    if (nameText2 != "")
                                    {
                                        nameText2 += " ";
                                    }

                                    nameText2 += name;
                                }
                            }
                        }
                    }

                    if (nameText1 != "" && nameText2 != "")
                    {
                        sb.AppendLine(string.Format("Nama Dokter        : {0}", nameText1));
                        sb.AppendLine(string.Format("                     {0}", nameText2));
                    }
                    else
                    {
                        sb.AppendLine(string.Format("Nama Dokter        : {0}", nameText1));
                    }
                    sb.AppendLine("");
                    #endregion
                }


                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");

                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer
                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                for (int a = 0; a < labelCount; a++)
                {
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                }

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRspbt
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSPBT
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRspbt(vConsultVisit9 oVisit9, string printerUrl, int labelCount = 0)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                string images = "\x1b\xfa\x02\x00\x00\x03\x5e";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();
                List<vConsultVisit9> lstoVisitPrint = BusinessLayer.GetvConsultVisit9List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID.ToString()));

                //string serviceUnit = "Unit";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.MedicalNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Urut   : {0}{1}{2}{3}{4}", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Urut   : {0}{1}{2}{3}{4}", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Urut   : *** {0}{1}{2}{3}{4} ***", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                        }
                    }
                }
                sb.AppendLine(string.Format("No. Reg    : {0}", oVisit9.RegistrationNo));
                sb.AppendLine(string.Format("Tanggal    : {0}", oVisit9.ActualVisitDateInString));
                sb.AppendLine(string.Format("No. RM     : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama       : {0} {1}", oVisit9.Salutation, oVisit9.PatientName));
                sb.AppendLine(string.Format("PKS        : {0}", oVisit9.BusinessPartner));
                for (int i = 0; i < lstoVisitPrint.Count; i++)
                {
                    #region ParamedicName
                    string textParamedic = lstoVisitPrint[i].ParamedicName;
                    string[] textLst = textParamedic.Split(' ');
                    string name = "", nameText1 = "", nameText2 = "";

                    for (int n = 0; n < textLst.Length; n++)
                    {
                        name = textLst[n];
                        if (nameText1.Length <= 17)
                        {
                            if (nameText1 != "")
                            {
                                nameText1 += " ";
                            }
                            nameText1 += name;
                        }

                        if (nameText1.Length > 17)
                        {
                            if (nameText2.Length <= 17)
                            {
                                if (!nameText1.Contains(name))
                                {
                                    if (nameText2 != "")
                                    {
                                        nameText2 += " ";
                                    }

                                    nameText2 += name;
                                }
                            }
                        }
                    }

                    if (nameText1 != "" && nameText2 != "")
                    {
                        sb.AppendLine(string.Format("Dokter     : {0}", nameText1));
                        sb.AppendLine(string.Format("             {0}", nameText2));
                    }
                    else
                    {
                        sb.AppendLine(string.Format("Dokter     : {0}", nameText1));
                    }
                    sb.AppendLine("");
                    #endregion
                }
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini dibawa"));
                sb.AppendLine(string.Format("  sampai pelayanan berakhir."));
                sb.Append(ESC + "a1");
                sb.AppendLine("");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine(string.Format("-Terima Kasih-"));
                sb.AppendLine("");

                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer
                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                for (int a = 0; a < labelCount; a++)
                {
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                }

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRsdosoba
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSDOSOBA
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRsdosoba(vConsultVisit9 oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x21\x10";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.AppendLine("ANTRIAN DOKTER");
                sb.AppendLine("");

                //#region Registration No Barcode
                //string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                //sb.Append(barcodeWidth); //x01 = 1 x base width
                //sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                //sb.Append(barcodeValues);
                //sb.Append(barcode);
                //sb.AppendLine("");
                //#endregion

                sb.Append(ESC + "a1");
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("{0}{1}{2}{3}{4}", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("{0}{1}{2}{3}{4}", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("{0}{1}{2}{3}{4}", fontDoubleHeight, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightEnd));
                        }
                    }
                }
                sb.AppendLine("");
                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #region PrintBuktiPendaftaranRSCK
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : RSCK
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranRSCK(vConsultVisit9 oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";

                string fontDoubleHeightBold = "\x1b\x21\x30";

                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";


                #region Print Detail
                sb.Append(ESC + "a1"); //center
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);

                #region Registration No Barcode
                sb.Append(ESC + "a1");
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0"); //left
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT || oVisit9.DepartmentID == Constant.Facility.DIAGNOSTIC)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("{0}{1}No. Antrian{2}{3}        : {4}{5}    Sesi   : {6}{7}",
                            fontDoubleHeight, fontBold, fontBoldEnd, fontDoubleHeightEnd, fontDoubleHeightBold, oVisit9.QueueNo, oVisit9.Session, fontDoubleHeightEnd));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("{0}{1}No. Antrian{2}{3}        : {4}{5}    Sesi   : {6}{7}",
                                fontDoubleHeight, fontBold, fontBoldEnd, fontDoubleHeightEnd, fontDoubleHeightBold, oVisit9.QueueNo, oVisit9.Session, fontDoubleHeightEnd));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("{0}{1}No. Antrian{2}{3}        : {4}{5}    Sesi   : {6}{7}",
                                fontDoubleHeight, fontBold, fontBoldEnd, fontDoubleHeightEnd, fontDoubleHeightBold, oVisit9.QueueNo, oVisit9.Session, fontDoubleHeightEnd));
                        }
                    }
                }
                sb.Append(ESC + "a0"); //left
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi   [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Pemakaian [ ] Lain-Lain .........."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #region PrintBuktiPendaftaranKunjunganBros
        /// <summary>
        /// Cetak Bukti Pendaftaran dengan Printer Struk Epson (Thermal) : BROS
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPendaftaranKunjunganBros(vConsultVisit9 oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();
                List<vConsultVisit9> lstoVisitPrint = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", oVisit9.VisitID.ToString()));

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #region PrintOrderFarmasi
        public static void PrintOrderFarmasi(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id));
            //vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id)).FirstOrDefault();
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();
            ParamedicMaster entityParamedic = BusinessLayer.GetParamedicMaster(entityVisit.ParamedicID);

            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("ORDER FARMASI"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionDateInString));
            sb.AppendLine("");
            sb.AppendLine("");

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" No. Registrasi     : {0}", entityVisit.RegistrationNo));
            sb.AppendLine(string.Format(" No. Rekam Medis    : {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" Nama Pasien        : {0}", entityVisit.PatientName));
            sb.AppendLine(string.Format(" Tgl. Lahir         : {0}", entityVisit.DateOfBirthInString));
            sb.AppendLine(string.Format(" Layanan            : {0} {1}", entityVisit.DepartmentID, entityVisit.RoomName));
            sb.AppendLine(string.Format(" Jaminan            : {0}", entityVisit.BusinessPartnerName));
            sb.AppendLine(string.Format(" Dokter             : {0}", entityVisit.ParamedicName));
            sb.AppendLine(string.Format(" SIP Dokter         : {0}", entityParamedic.LicenseNo));
            sb.AppendLine("");
            #endregion

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].CompoundDrugname.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.AppendLine(string.Format(" {0}", item.Trim()));
                        }
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].DrugName.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(35, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.AppendLine(string.Format(" {0}", consumeMethod.PadRight(30, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                }
                sb.AppendLine("____________________________________________");
            }

            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine(string.Format(" Petugas : {0}", lstPrescription.FirstOrDefault().CreatedByFullName));

            #endregion

            for (int i = 0; i <= 3; i++)
            {
                sb.AppendLine("");
            }
            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasi JWCC
        public static void PrintOrderFarmasiJWCC(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id));
            //vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id)).FirstOrDefault();
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();

            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("ORDER FARMASI"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionDateInString));
            sb.AppendLine("");
            sb.AppendLine("");

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" No. Registrasi     : {0}", entityVisit.RegistrationNo));
            sb.AppendLine(string.Format(" No. Rekam Medis    : {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" Nama Pasien        : {0}", entityVisit.PatientName));
            sb.AppendLine(string.Format(" Tgl. Lahir         : {0}", entityVisit.DateOfBirthInString));
            sb.AppendLine(string.Format(" Layanan            : {0} {1}", entityVisit.DepartmentID, entityVisit.RoomName));
            sb.AppendLine(string.Format(" Jaminan            : {0}", entityVisit.BusinessPartnerName));
            sb.AppendLine(string.Format(" Dokter             : {0}", entityVisit.ParamedicName));
            sb.AppendLine("");
            #endregion

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].CompoundDrugname.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.AppendLine(string.Format(" {0}", item.Trim()));
                        }
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].DrugName.PadRight(25, ' '), lstPrescription[i].cfDispenseQty));
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(25, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.AppendLine(string.Format(" {0}", consumeMethod.PadRight(30, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                }
                sb.AppendLine("________________________________________");
            }

            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            #endregion

            for (int i = 0; i <= 3; i++)
            {
                sb.AppendLine("");
            }
            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasiRSPR
        public static void PrintOrderFarmasiRSPR(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND ChargesIsDeleted = 0", id));
            //vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id)).FirstOrDefault();
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();
            vVitalSignDt entityVitalH = BusinessLayer.GetvVitalSignDtList(string.Format("VisitID = {0} AND VitalSignLabel = 'HEIGHT' AND IsDeleted = 0 ORDER BY ID DESC", entityVisit.VisitID)).FirstOrDefault();
            vVitalSignDt entityVitalW = BusinessLayer.GetvVitalSignDtList(string.Format("VisitID = {0} AND VitalSignLabel = 'WEIGHT' AND IsDeleted = 0 ORDER BY ID DESC", entityVisit.VisitID)).FirstOrDefault();
            List<vPatientAllergy> lstAllergy = BusinessLayer.GetvPatientAllergyList(string.Format("MRN = {0} AND GCAllergenType ='0127^DA' AND IsDeleted = 0 ", entityVisit.MRN));
            RegistrationInfo entityRI = BusinessLayer.GetRegistrationInfoList(string.Format("RegistrationID = {0}", entityVisit.RegistrationID)).FirstOrDefault();
            ParamedicMaster entityPM = BusinessLayer.GetParamedicMasterList(string.Format("ParamedicID = {0}", entityVisit.ParamedicID)).FirstOrDefault();
            Healthcare entityH = BusinessLayer.GetHealthcareList(string.Format("HealthcareID = 001")).FirstOrDefault();
            Address entityA = BusinessLayer.GetAddressList(string.Format("AddressID = {0}", entityH.AddressID)).FirstOrDefault();
            int count = lstAllergy.Count;
            string listID = "";
            List<vPatientAllergy> lstPatientAlergy = null;
            if (count > 0)
            {
                foreach (vPatientAllergy entityPA in lstAllergy)
                {
                    listID += entityPA.Allergen + " (" + entityPA.Reaction + ")" + ", ";
                }
                listID = listID.Substring(0, listID.Count() - 1);
                lstPatientAlergy = BusinessLayer.GetvPatientAllergyList(string.Format("MRN = {0} AND GCAllergenType ='0127^DA' AND IsDeleted = 0", entityVisit.MRN));
            }
            else lstPatientAlergy = new List<vPatientAllergy>();

            string height = "";
            string weight = "";

            if (entityVitalH == null)
            {
                height = "-";
            }
            else
            {
                height = entityVitalH.VitalSignValue;
            }

            if (entityVitalW == null)
            {
                weight = "-";
            }
            else
            {
                weight = entityVitalW.VitalSignValue;
            }

            string noregV1 = "";
            string noregV2 = "";

            if (entityRI == null)
            {
                noregV1 = "";
            }
            else
            {
                noregV1 = entityRI.ExternalRegistrationNo + " / ";
            }

            if (entityVisit == null)
            {
                noregV2 = "";
            }
            else
            {
                noregV2 = entityVisit.RegistrationNo;
            }

            sb.Append(ESC + "a1");
            #region Healthcare
            sb.AppendLine(string.Format("{0}", entityH.ShortName));
            sb.AppendLine(string.Format("{0}", entityA.StreetName.Trim()));
            sb.AppendLine(string.Format("{0} {1}", entityA.City, entityA.ZipCode));
            sb.AppendLine(string.Format("Telp 0{0}", entityA.PhoneNo1));
            sb.AppendLine("________________________________________");
            sb.AppendLine("");
            #endregion

            sb.AppendLine(string.Format("CETAK RESEP DOKTER"));
            sb.AppendLine("");

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" Tgl/Jam Resep    : {0}", DateTime.Now.ToString(Constant.FormatString.DATE_TIME_FORMAT_4)));
            sb.AppendLine(string.Format(" No. Order        : {0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format(" Asal Unit        : {0} - {1}", entityVisit.ServiceUnitName, entityVisit.BedCode));
            sb.AppendLine(string.Format(" Nama Pasien      : {0} ({1})", entityVisit.PatientName.Trim(), entityVisit.GCSex == "0003^M" ? "L" : "P"));
            sb.AppendLine(string.Format(" Tgl.Lahir/Umur   : {0} / {1} Thn", entityVisit.DateOfBirthInString, entityVisit.AgeInYear));
            sb.AppendLine(string.Format(" No. RM           : {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" TB / BB          : {0} Cm / {1} Kg", height, weight));
            sb.AppendLine(string.Format(" Alergi           : {0}", listID.ToString()));
            sb.AppendLine(string.Format(" Penjamin         : {0}", entityVisit.BusinessPartnerName));
            sb.AppendLine(string.Format(" Nama Dokter      : {0}", entityVisit.ParamedicName.Trim()));
            sb.AppendLine(string.Format(" SIP Dokter       : {0}", entityPM.LicenseNo.Trim()));
            sb.AppendLine("________________________________________");
            sb.AppendLine("");
            #endregion
            sb.AppendLine("Resep : ");

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].CompoundDrugname.PadRight(35, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.AppendLine(string.Format(" {0}", item.Trim()));
                        }
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].DrugName.PadRight(35, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].cfDispenseQty));
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(35, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.AppendLine(string.Format(" {0}", consumeMethod.PadRight(30, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                }
            }

            sb.AppendLine(" __________________________________");
            sb.AppendLine("| Skrining |  H  |  T  |  K  |  P  |");
            sb.AppendLine("|__________________________________|");
            sb.AppendLine("|NM FRMS   |     |     |     |     |");
            sb.AppendLine("|__________________________________|");
            sb.AppendLine("|Jam       |     |     |     |     |");
            sb.AppendLine("|__________________________________|");
            sb.AppendLine("");

            sb.AppendLine(" __________________________________");
            sb.AppendLine("|NAMA OBAT   |PETUGAS 1 |PETUGAS 2 |");
            sb.AppendLine("|HIGH ALERT  |          |          |");
            sb.AppendLine("|____________|__________|__________|");
            sb.AppendLine("|            |          |          |");
            sb.AppendLine("|            |          |          |");
            sb.AppendLine("|            |          |          |");
            sb.AppendLine("|____________|__________|__________|");
            sb.AppendLine("");

            sb.AppendLine(" ___________________________________");
            sb.AppendLine("|      PENGKAJIAN OLEH APOTEKER     |");
            sb.AppendLine("|___________________________________|");
            sb.AppendLine("| Nama Apoteker :                   |");
            sb.AppendLine("|___________________________________|");
            sb.AppendLine("| #Administrasi                |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("| Benar Pasien                 |    |");
            sb.AppendLine("| Identitas Dokter             |    |");
            sb.AppendLine("| Unit Asal Resep              |    |");
            sb.AppendLine("| Tanggal Resep                |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("| #Farmasetik                  |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("| Benar Obat                   |    |");
            sb.AppendLine("| Benar Dosis                  |    |");
            sb.AppendLine("| Benar Rute                   |    |");
            sb.AppendLine("| Benar Aturan Pakai           |    |");
            sb.AppendLine("| Benar Waktu Frekuensi        |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("| #Klinis                      |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("| Duplikasi                    |    |");
            sb.AppendLine("| Interaksi Obat               |    |");
            sb.AppendLine("|______________________________|____|");
            sb.AppendLine("");

            sb.AppendLine(" __________________________________");
            sb.AppendLine("|    PENGKAJIAN PENYERAHAAN OBAT   |");
            sb.AppendLine("|__________________________________|");
            sb.AppendLine("|Nama Obat       :                 |");
            sb.AppendLine("|Dosis           :                 |");
            sb.AppendLine("|Rute            :                 |");
            sb.AppendLine("|Aturan Pakai    :                 |");
            sb.AppendLine("|Waktu Pemberian :                 |");
            sb.AppendLine("|__________________________________|");
            #endregion

            for (int i = 0; i <= 9; i++)
            {
                sb.AppendLine("");
            }
            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasi RSRT
        public static void PrintOrderFarmasiRSRT(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id));
            //vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id)).FirstOrDefault();
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();

            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("ORDER FARMASI"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionDateInString));
            sb.AppendLine("");
            sb.AppendLine("");

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" No. Registrasi     : {0}", entityVisit.RegistrationNo));
            sb.AppendLine(string.Format(" No. Rekam Medis    : {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" Nama Pasien        : {0}", entityVisit.PatientName));
            sb.AppendLine(string.Format(" Tgl. Lahir         : {0}", entityVisit.DateOfBirthInString));
            sb.AppendLine(string.Format(" Layanan            : {0} {1}", entityVisit.DepartmentID, entityVisit.RoomName));
            sb.AppendLine(string.Format(" Jaminan            : {0}", entityVisit.BusinessPartnerName));
            sb.AppendLine(string.Format(" Dokter             : {0}", entityVisit.ParamedicName));
            sb.AppendLine("");
            #endregion

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].CompoundDrugname.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.AppendLine(string.Format(" {0}", item.Trim()));
                        }
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].DrugName.PadRight(25, ' '), lstPrescription[i].cfDispenseQty));
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(25, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.AppendLine(string.Format(" {0}", consumeMethod.PadRight(30, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                }
                sb.AppendLine("________________________________________");
            }

            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            #endregion

            for (int i = 0; i <= 3; i++)
            {
                sb.AppendLine("");
            }
            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasiRSUKI
        public static void PrintOrderFarmasiRSUKI(int id, string printerUrl1)
        {
            string printerName1 = printerUrl1;

            DotMatrixPrinter sb = new DotMatrixPrinter();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id));
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();


            sb.Append(string.Format("                        RESEP ASLI"));
            sb.Append("\n");
            sb.Append(string.Format("                   {0}", entityPrescription.PrescriptionOrderNo));
            sb.Append("\n");
            sb.Append(string.Format("                       {0}", entityPrescription.PrescriptionDateInString));
            sb.Append("\n");
            sb.Append("\n");

            #region Header
            sb.Append(string.Format(" No. Registrasi     : {0}", entityVisit.RegistrationNo));
            sb.Append("\n");
            sb.Append(string.Format(" No. Rekam Medis    : {0}", entityVisit.MedicalNo));
            sb.Append("\n");
            sb.Append(string.Format(" Nama Pasien        : {0}", entityVisit.PatientName));
            sb.Append("\n");
            sb.Append(string.Format(" Tgl. Lahir         : {0}", entityVisit.DateOfBirthInString));
            sb.Append("\n");
            sb.Append(string.Format(" Layanan            : {0} {1}", entityVisit.DepartmentID, entityVisit.RoomName));
            sb.Append("\n");
            sb.Append(string.Format(" Jaminan            : {0}", entityVisit.BusinessPartnerName));
            sb.Append("\n");
            sb.Append(string.Format(" Dokter             : {0}", entityVisit.ParamedicName));
            sb.Append("\n");
            sb.Append("\n");
            #endregion

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.Append(string.Format(" {0} {1}", lstPrescription[i].CompoundDrugname.PadRight(40, ' '), lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.Append(string.Format(" {0}", item.Trim()));
                            sb.Append("\n");
                        }
                    }
                    else
                    {
                        sb.Append(string.Format(" {0} {1}", lstPrescription[i].DrugName.PadRight(40, ' '), lstPrescription[i].cfDispenseQty));
                        sb.Append("\n");
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.Append(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(40, ' ')));
                        sb.Append("\n");
                        sb.Append(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                        sb.Append("\n");
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.Append(string.Format(" {0}", consumeMethod.PadRight(35, ' ')));
                        sb.Append("\n");
                        sb.Append(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                        sb.Append("\n");
                    }
                }
                sb.Append("________________________________________________");
                sb.Append("\n");
            }
            sb.Append("_________________ ______________________________");
            sb.Append("\n");
            sb.Append("| H | T | K | P | |         TELAAH RESEP       |");
            sb.Append("\n");
            sb.Append("|   |   |   |   | |PX|OB|KE|FRE|DO|RP|IO|DUP|WP|");
            sb.Append("\n");
            sb.Append("|___|___|___|___| |  |  |  |   |  |  |  |   |  |");
            sb.Append("\n");
            sb.Append("                  |__|__|__|___|__|__|__|___|__|");
            sb.Append("\n");
            sb.Append("_______________________");
            sb.Append("\n");
            sb.Append("|        7 BENAR      |");
            sb.Append("\n");
            sb.Append("|PX|OB|DO|CR|W|DOK|INF|");
            sb.Append("\n");
            sb.Append("|__|__|__|__|_|___|___|");
            sb.Append("\n");
            sb.Append("___________________________________________________________");
            sb.Append("\n");
            sb.Append("|Taken By|Etiket By|Compound By|Verification By|Receive By|");
            sb.Append("\n");
            sb.Append("|        |         |           |               |          |");
            sb.Append("\n");
            sb.Append("|        |         |           |               |          |");
            sb.Append("\n");
            sb.Append("|________|_________|___________|_______________|__________|");
            sb.Append("\n");
            sb.Append("\n");
            sb.Append("\n");
            sb.Append("\n");
            sb.Append("\n");

            #endregion

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();
            string printerName = printerName1;
            //Initialize Printer
            print.OpenPrint(printerName);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasiRSPM
        public static void PrintOrderFarmasiRSPM(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id));
            //vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1", id)).FirstOrDefault();
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();

            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("ORDER FARMASI"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionDateInString));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionType));
            //sb.AppendLine("");
            sb.AppendLine("");

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" No. Registrasi     : {0}", entityVisit.RegistrationNo));
            sb.AppendLine(string.Format(" No. Rekam Medis    : {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" Nama Pasien        : {0}", entityVisit.PatientName));
            sb.AppendLine(string.Format(" Tgl. Lahir         : {0}", entityVisit.DateOfBirthInString));
            sb.AppendLine(string.Format(" Layanan            : {0} {1}", entityVisit.DepartmentID, entityVisit.RoomName));
            sb.AppendLine(string.Format(" Jaminan            : {0}", entityVisit.BusinessPartnerName));
            sb.AppendLine(string.Format(" Dokter             : {0}", entityVisit.ParamedicName));
            sb.AppendLine("");
            #endregion

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription[i].IsRFlag)
                {
                    if (lstPrescription[i].IsCompound)
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].CompoundDrugname.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                        string[] compoundItem = lstPrescription[i].MedicationLine.Split('+');
                        foreach (string item in compoundItem)
                        {
                            sb.AppendLine(string.Format(" {0}", item.Trim()));
                        }
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" {0} {1}", lstPrescription[i].DrugName.PadRight(35, ' '), lstPrescription[i].cfDispenseQty));
                    }

                    if (!String.IsNullOrEmpty(lstPrescription[i].SignaName1))
                    {
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].SignaName1.PadRight(35, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                    else
                    {
                        string consumeMethod = "";
                        if (lstPrescription[i].Frequency > 0)
                        {
                            switch (lstPrescription[i].GCDosingFrequency)
                            {
                                case Constant.DosingFrequency.DAY:
                                    consumeMethod = string.Format("{0} x sehari {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.WEEK:
                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                case Constant.DosingFrequency.HOUR:
                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", lstPrescription[i].Frequency.ToString("G29"), lstPrescription[i].NumberOfDosage.ToString("G29"), lstPrescription[i].DosingUnit);
                                    break;
                                default:
                                    break;
                            }
                        }
                        sb.AppendLine(string.Format(" {0}", consumeMethod.PadRight(30, ' ')));
                        sb.AppendLine(string.Format(" {0}", lstPrescription[i].MedicationAdministration));
                    }
                }
                sb.AppendLine("____________________________________________");
            }

            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine(string.Format(" Petugas : {0}", lstPrescription.FirstOrDefault().CreatedByFullName));

            #endregion

            for (int i = 0; i <= 3; i++)
            {
                sb.AppendLine("");
            }
            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion
        #region PrintOrderFarmasi RSDI
        public static void PrintOrderFarmasiRSDI(int id, string printerUrl1)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            const string DoubleOff = GSs + "!" + "\0";

            StringBuilder sb = new StringBuilder();

            #region Information
            List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND OrderIsDeleted = 0 ORDER BY PrescriptionOrderDetailID, ParentID", id));
            //List<vPrescriptionOrderDt1> lstPrescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND ChargesIsDeleted = 0", id));
            vPrescriptionOrderHd entityPrescription = BusinessLayer.GetvPrescriptionOrderHdList(string.Format("PrescriptionOrderID = {0}", id)).FirstOrDefault();
            vConsultVisit9 entityVisit = BusinessLayer.GetvConsultVisit9List(string.Format("VisitID = {0}", lstPrescription.FirstOrDefault().VisitID)).FirstOrDefault();
            List<PatientAllergy> entityAllergyLst = BusinessLayer.GetPatientAllergyList(string.Format("MRN = {0} AND IsDeleted = 0 AND GCAllergenType = '{1}'", entityVisit.MRN, Constant.AllergenType.DRUG));
            vVitalSignDt VitalSignW = BusinessLayer.GetvVitalSignDtList(string.Format("RegistrationID = {0} AND VitalSignLabel = 'WEIGHT' AND IsDeleted = 0", entityVisit.RegistrationID)).FirstOrDefault();
            vVitalSignDt VitalSignH = BusinessLayer.GetvVitalSignDtList(string.Format("RegistrationID = {0} AND VitalSignLabel = 'HEIGHT' AND IsDeleted = 0", entityVisit.RegistrationID)).FirstOrDefault();
            ParamedicMaster entityPM = BusinessLayer.GetParamedicMasterList(string.Format("ParamedicID = {0}", entityPrescription.ParamedicID)).FirstOrDefault();
            RegistrationInfo entityRI = BusinessLayer.GetRegistrationInfoList(string.Format("RegistrationID = {0}", entityVisit.RegistrationID)).FirstOrDefault();

            string departmentName = "";

            if (entityVisit.DepartmentID == Constant.Facility.INPATIENT)
            {
                departmentName = string.Format("Rawat Inap {0}", entityVisit.ServiceUnitName);
            }
            else if (entityVisit.DepartmentID == Constant.Facility.EMERGENCY)
            {
                departmentName = "Rawat Darurat";
            }
            else if (entityVisit.DepartmentID == Constant.Facility.OUTPATIENT)
            {
                departmentName = "Rawat Jalan";
            }
            else
            {
                departmentName = "";
            }

            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("ORDER FARMASI"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionOrderNo));
            sb.AppendLine(string.Format("{0}", entityPrescription.PrescriptionDateInString));
            sb.AppendLine("");

            #endregion

            #region Header
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format(" No. Registrasi : {0}", entityRI.ExternalRegistrationNo));
            sb.AppendLine(string.Format(" No. Rekam Medis: {0}", entityVisit.MedicalNo));
            sb.AppendLine(string.Format(" Nama Pasien    : {0}", entityVisit.PatientName));
            sb.AppendLine(string.Format(" {0}", entityVisit.StreetName));
            sb.AppendLine(string.Format(" Tgl. Lahir     : {0}", entityVisit.DateOfBirthInString));
            sb.AppendLine(string.Format(" No. Telp       : {0}", entityVisit.PhoneNo1));
            if (entityAllergyLst.Count() > 0)
            {
                sb.AppendLine(string.Format(" Alergi         : {0}", entityAllergyLst.FirstOrDefault().Allergen));
            }
            else
            {
                sb.AppendLine(string.Format(" Alergi         : "));
            }

            if (VitalSignH == null)
            {
                sb.AppendLine(string.Format(" TB             : 0.00 cm"));
            }
            else
            {
                sb.AppendLine(string.Format(" TB             : {0} cm", VitalSignH.VitalSignValue));
            }
            if (VitalSignW == null)
            {
                sb.AppendLine(string.Format(" BB             : 0.00 cm"));
            }
            else
            {
                sb.AppendLine(string.Format(" BB             : {0} kg", VitalSignW.VitalSignValue));
            }
            sb.AppendLine(string.Format(" Layanan : {0}", departmentName));
            sb.AppendLine(string.Format(" Dokter  : {0}", entityVisit.ParamedicName));
            sb.AppendLine(string.Format(" No. SIP : {0}", entityPM.LicenseNo));
            sb.AppendLine("________________________________________");
            #endregion

            #region Detail
            string orderDtInString = string.Empty;
            string headerPrescription = string.Empty;
            string prescriptionComp = string.Empty;
            string mfla = string.Empty;
            int drugLength = 100;
            int emptyLength = 0;
            string numero = string.Empty;
            string taken = string.Empty;
            decimal takenQty = 0;
            List<vPrescriptionOrderDt1> lstParentCompound = lstPrescription.Where(w => w.ParentID != null && w.ParentID != 0).ToList();
            int totalDetailCompound = 0;
            int countDetailCompound = 0;
            int parentID = 0;

            for (int i = 0; i < lstPrescription.Count; i++)
            {
                if (lstPrescription.Count > 0)
                {
                    if (!lstPrescription[i].IsCompound)
                    {
                        string formattedPrescription = string.Empty;
                        if (lstPrescription[i].IsRFlag)
                        {
                            formattedPrescription += string.Format(" R/ ");
                        }
                        numero = lstPrescription[i].DispenseQtyInRoman;
                        taken = lstPrescription[i].cfTakenQty;
                        emptyLength = drugLength - lstPrescription[i].DrugName.Length - numero.Length;
                        string drugName = lstPrescription[i].DrugName;
                        drugName += " No. " + numero;

                        if (lstPrescription[i].GCItemType == Constant.ItemType.OBAT_OBATAN)
                        {
                            formattedPrescription += string.Format(@"{0}{1}    {2}", drugName, Environment.NewLine, lstPrescription[i].cfConsumeMethod2);
                            if (!string.IsNullOrEmpty(lstPrescription[i].MedicationAdministration))
                            {
                                formattedPrescription += string.Format(@"{0}    {1} {0}", Environment.NewLine, lstPrescription[i].MedicationAdministration);
                            }
                            else
                            {
                                formattedPrescription += string.Format(@"{0}", Environment.NewLine);
                            }
                            if (string.IsNullOrEmpty(orderDtInString))
                            {
                                orderDtInString += formattedPrescription;
                            }
                            else
                            {
                                orderDtInString += string.Format(@"{1}", Environment.NewLine, formattedPrescription);
                            }
                        }
                        else
                        {
                            formattedPrescription += string.Format(@"{0}{1}", drugName, Environment.NewLine);
                            orderDtInString += string.Format(@"{1}{0}", Environment.NewLine, formattedPrescription);
                        }
                    }
                    else
                    {
                        if ((lstPrescription[i].IsCompound))
                        {
                            string drugName = string.Empty;
                            if (lstPrescription[i].ParentID == 0)
                            {
                                countDetailCompound = 0;
                                headerPrescription = string.Empty;
                                parentID = lstPrescription[i].PrescriptionOrderDetailID;
                                totalDetailCompound = lstPrescription.Where(w => w.PrescriptionOrderDetailID == parentID || w.ParentID == parentID).ToList().Count;
                            }
                            takenQty = lstPrescription[i].TakenQty;
                            numero = lstPrescription[i].DispenseQtyInRoman;
                            taken = lstPrescription[i].cfTakenQty;
                            if (lstPrescription[i].IsRFlag && string.IsNullOrEmpty(headerPrescription))
                            {
                                headerPrescription += string.Format(" R/ ", Environment.NewLine);
                                drugName = string.Format(@"{0} {1} {2}{3}", lstPrescription[i].DrugName.Trim(), lstPrescription[i].CompoundQtyInString, lstPrescription[i].CompoundUnit, Environment.NewLine);

                                headerPrescription += string.Format(@"{0}", drugName);
                                mfla = string.Format(@"mfla pulv dtd No. {1} da in {0}", lstPrescription[i].DosingUnit, lstPrescription[i].DispenseQtyInRoman);
                                orderDtInString += string.Format(@"{0}", headerPrescription, Environment.NewLine);
                                prescriptionComp = string.Format(@"{0}    {1} {2}", Environment.NewLine, lstPrescription[i].cfConsumeMethod2, lstPrescription[i].CoenamRule);
                                if (!string.IsNullOrEmpty(lstPrescription[i].MedicationAdministration))
                                {
                                    prescriptionComp += string.Format(@"{0}    {1}", Environment.NewLine, lstPrescription[i].MedicationAdministration);
                                }
                            }
                        }

                        if (!lstPrescription[i].IsRFlag)
                            orderDtInString += string.Format(@"    {0} {1} {2}{3}", lstPrescription[i].DrugName.Trim(), lstPrescription[i].CompoundQtyInString, lstPrescription[i].CompoundUnit, Environment.NewLine);

                        countDetailCompound += 1;

                        if (totalDetailCompound == countDetailCompound)
                        {
                            orderDtInString += string.Format(@"    {0}", mfla, Environment.NewLine);
                            orderDtInString += string.Format(@"    {0}", prescriptionComp);
                        }
                    }
                }
            }
            sb.AppendLine(string.Format("{0}", orderDtInString));
            sb.AppendLine("________________________________________");
            #endregion

            #region Footer
            sb.AppendLine(string.Format(" Diisi oleh farmasi :"));
            sb.AppendLine(string.Format(" ____________________"));
            sb.AppendLine(string.Format(" H : ___________"));
            sb.AppendLine(string.Format(" T : ___________"));
            sb.AppendLine(string.Format(" K : ___________"));
            sb.AppendLine(string.Format(" P : ___________"));
            sb.AppendLine(string.Format(" Kejelasan Tulisan         : ____"));
            sb.AppendLine(string.Format(" Benar Pasien              : ____"));
            sb.AppendLine(string.Format(" Benar Obat                : ____"));
            sb.AppendLine(string.Format(" Benar Dosis               : ____"));
            sb.AppendLine(string.Format(" Benar Waktu               : ____"));
            sb.AppendLine(string.Format(" Benar Cara Pemberian      : ____"));
            sb.AppendLine(string.Format(" Benar Informasi           : ____"));
            sb.AppendLine(string.Format(" Benar Perdokumentasian    : ____"));
            sb.AppendLine("________________________________________");
            sb.Append(ESC + "a1");
            sb.AppendLine(string.Format("Resep sudah diterima oleh :"));
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine("");
            sb.AppendLine(string.Format("(_________________________)"));
            sb.Append(ESC + "a0");
            sb.AppendLine(string.Format("*Obat sudah diterima dan dijelaskan"));
            sb.AppendLine(string.Format("*Resep ini hanya berlaku di "));
            sb.AppendLine(string.Format("{0}", AppSession.UserLogin.HealthcareName));
            sb.AppendLine("");

            #endregion

            //Send Auto-Cut Command
            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl1);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            sb.Clear();
            #endregion
        }
        #endregion

        #region PrintBuktiPerjanjian
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPerjanjian(vAppointment oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC1 = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS1 = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                string serviceUnit = "Unit Pelayanan";
                string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC1 + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI BOOKING");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                sb.Append(ESC1 + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0}", oAppointment.cfCreatedDate));
                sb.AppendLine(string.Format("Tgl/Jam Perjanjian : {0}", oAppointment.cfStartDate));
                sb.AppendLine(string.Format("No. Perjanjian     : {0}", oAppointment.AppointmentNo));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oAppointment.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oAppointment.cfDateOfBirthInString));
                if (oAppointment.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oAppointment.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oAppointment.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oAppointment.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName));
                if (oAppointment.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oAppointment.AppointmentNo))
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                    else
                        sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oAppointment.QueueNo));
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", oAppointment.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Wajib dibawa dan dikonfirmasi ke Bagian"));
                sb.AppendLine(string.Format("  Pendaftaran"));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion
        #region PrintBuktiPerjanjian1
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSDOSKA
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPerjanjian1(List<vAppointment> oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                foreach (vAppointment oData in oAppointment)
                {
                    if (oData.MRN != 0)
                    {
                        string serviceUnit = "Unit Pelayanan";
                        string gender = oData.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                        #region Print Detail
                        sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0}", oData.cfCreatedDate));
                        sb.AppendLine(string.Format("Tgl/Jam Perjanjian : {0}", oData.cfStartDate));
                        sb.AppendLine(string.Format("No. Perjanjian     : {0}", oData.AppointmentNo));
                        sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oData.MedicalNo));
                        sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oData.Salutation, oData.PatientName, gender));
                        sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oData.cfDateOfBirthInString));
                        if (oData.DepartmentID != Constant.Facility.EMERGENCY)
                            sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oData.ServiceUnitName));
                        sb.AppendLine(string.Format("Nama Dokter        : {0}", oData.ParamedicName));
                        sb.AppendLine(string.Format("Nama Ruang         : {0}", oData.RoomName));
                        sb.AppendLine(string.Format("Kiriman Dari       : -"));
                        sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oData.BusinessPartnerName));
                        if (oData.DepartmentID == Constant.Facility.OUTPATIENT)
                        {
                            if (string.IsNullOrEmpty(oData.AppointmentNo))
                                sb.AppendLine(string.Format("No. Antrian        : {0}", oData.QueueNo));
                            else
                                sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oData.QueueNo));
                        }
                        sb.AppendLine("");
                        sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                        sb.AppendLine("");
                        sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                        sb.AppendLine(string.Format(""));
                        sb.AppendLine(string.Format("Petugas            : {0}", oData.CreatedBy));
                        sb.AppendLine(string.Format(""));
                        sb.AppendLine(string.Format("* Mohon Bukti Pendaftaran ini jangan hilang"));
                        //Append beberapa baris supaya bisa pas dengan cutter
                        for (int i = 0; i <= 8; i++)
                        {
                            sb.AppendLine("");
                        }

                        //Send Auto-Cut Command
                        string GS = Convert.ToString((char)29);
                        string ESC = Convert.ToString((char)29);

                        string command = "";
                        command = ESC + "@";
                        command += GS + "V" + (char)1;

                        sb.AppendLine(command);
                        #endregion
                    }
                }

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion
        #region PrintBuktiPerjanjian2
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson / Minipos (Thermal) : RSDO-SOBA dengan QRCode
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPerjanjian2(vAppointment oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";
                StringBuilder sb = new StringBuilder();


                sb.Append(ESC + "a1");
                sb.AppendLine("BUKTI PERJANJIAN");
                sb.AppendLine("");


                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oAppointment.AppointmentNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");

                string serviceUnit = "Unit Pelayanan";
                string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0}", oAppointment.cfCreatedDate));
                sb.AppendLine(string.Format("Tgl/Jam Perjanjian : {0}", oAppointment.cfStartDate));
                sb.AppendLine(string.Format("No. Perjanjian     : {0}", oAppointment.AppointmentNo));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oAppointment.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oAppointment.cfDateOfBirthInString));
                if (oAppointment.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oAppointment.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oAppointment.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oAppointment.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName));
                if (oAppointment.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oAppointment.AppointmentNo))
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                    else
                        sb.AppendLine(string.Format("No. Antrian        : * {0} *", oAppointment.QueueNo));
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", oAppointment.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Mohon Bukti Perjanjian ini jangan hilang"));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion
        #region PrintBuktiPerjanjianRSSY
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal) : RSSY
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPerjanjianRSSY(vAppointment oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC1 = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS1 = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                string serviceUnit = "Unit Pelayanan";
                string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC1 + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI BOOKING");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                sb.Append(ESC1 + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0}", oAppointment.cfCreatedDate));
                sb.AppendLine(string.Format("Tgl/Jam Perjanjian : {0}", oAppointment.cfStartDate));
                sb.AppendLine(string.Format("No. Perjanjian     : {0}", oAppointment.AppointmentNo));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oAppointment.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oAppointment.cfDateOfBirthInString));
                if (oAppointment.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oAppointment.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oAppointment.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oAppointment.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName));
                if (oAppointment.DepartmentID != Constant.Facility.INPATIENT)
                {
                    if (string.IsNullOrEmpty(oAppointment.AppointmentNo))
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                    else
                        sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oAppointment.QueueNo));
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ] Farmasi  [ ] Laboratorium  [ ] Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", oAppointment.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Mohon Bukti Booking ini JANGAN HILANG *"));
                sb.AppendLine(string.Format("  Wajib dibawa dan dikonfirmasi ke"));
                sb.AppendLine(string.Format("  Bagian Pendaftaran"));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region PrintBuktiPerjanjianMultiKunjungan
        /// <summary>
        /// Cetak Bukti Perdaftaran Perjanjian dengan Printer Struk Epson (Thermal)
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintBuktiPerjanjianMultiKunjungan(vDiagnosticVisitSchedule oSchedule, vAppointment oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                List<vDraftTestOrderDt> lstDt = BusinessLayer.GetvDraftTestOrderDtList(string.Format("AppointmentID = {0} AND IsDeleted = 0", oAppointment.AppointmentID));
                string itemName = string.Empty;


                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC1 = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS1 = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                string serviceUnit = "Unit Pelayanan";
                string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC1 + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI BOOKING");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                sb.Append(ESC1 + "a0");
                sb.AppendLine(string.Format("No. Perjanjian     : {0}", oAppointment.AppointmentNo));
                sb.AppendLine(string.Format("Tgl/Jam Perjanjian : {0} {1}", oAppointment.cfStartDate, oAppointment.StartTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oAppointment.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oAppointment.cfDateOfBirthInString));
                if (oAppointment.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oAppointment.ServiceUnitName));
                sb.AppendLine(string.Format("Dokter/Tenaga Medis: {0}", oAppointment.ParamedicName));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName));
                //sb.AppendLine(string.Format("Tindakan ke        : {0}", oSchedule.SequenceNo));
                sb.AppendLine(string.Format("Nama Tindakan      :"));
                //if (!string.IsNullOrEmpty(itemName))
                //{
                //    sb.AppendLine(string.Format("Nama Tindakan      : {0}", itemName));
                //}
                //else
                //{
                //    sb.AppendLine(string.Format("Nama Tindakan      : {0}", oSchedule.ItemName1));
                //}
                if (lstDt.Count > 0)
                {
                    foreach (vDraftTestOrderDt dt in lstDt)
                    {
                        string formattedItem = string.Format(" * {0} ({1})", dt.ItemName1, !string.IsNullOrEmpty(dt.Remarks) ? dt.Remarks.Contains('|') ? dt.Remarks.Split('|')[1] : dt.Remarks : string.Empty);
                        sb.AppendLine(formattedItem);
                    }
                }
                if (string.IsNullOrEmpty(oAppointment.AppointmentNo))
                    sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                else
                    sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oAppointment.QueueNo));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Petugas            : {0}", oAppointment.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("* Wajib dibawa dan dikonfirmasi ke Bagian"));
                sb.AppendLine(string.Format("  Pendaftaran"));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region Bukti Order Penunjang
        public static void PrintBuktiOrderPenunjang(vConsultVisit oVisit, List<vTestOrderDt> lstOrder, string printerUrl)
        {
            DirectPrinting print = new DirectPrinting();
            StringBuilder command = new StringBuilder();

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL960"));
            command.Append(string.Format("^PW630"));
            command.Append(string.Format("^LH2,1"));
            command.Append(string.Format("^CF036,36"));
            command.Append(String.Format("^FO155,20^FDBUKTI ORDER PENUNJANG^FS"));
            command.Append(string.Format("^FO155,30^FD_____________________^FS"));
            command.Append(String.Format("^CF026,26"));
            command.Append(String.Format("^FO115,80^FDNo. Registrasi : {0}^FS", oVisit.RegistrationNo));
            command.Append(String.Format("^CF028,28"));
            command.Append(String.Format("^FO10,140^FD{0} ({1})^FS", oVisit.PatientName, oVisit.Sex));
            command.Append(String.Format("^CF026,26"));
            command.Append(String.Format("^FO10,200^FDNo. RM^FS"));
            command.Append(String.Format("^FO201,200^FD{0}^FS", oVisit.MedicalNo));
            command.Append(String.Format("^FO10,240^FDUnit Pelayanan^FS"));
            command.Append(String.Format("^FO181,240^FD:^FS"));
            command.Append(String.Format("^FO201,240^FD{0}^FS", oVisit.ServiceUnitName));
            command.Append(String.Format("^FO10,280^FDDokter^FS"));
            command.Append(String.Format("^FO181,280^FD:^FS"));
            command.Append(String.Format("^FO201,280^FD{0}^FS", oVisit.ParamedicName));
            command.Append(String.Format("^FO10,320^FDItem Pelayanan  :^FS"));

            int coordinatY = 360;
            int counter = 1;
            foreach (vTestOrderDt item in lstOrder)
            {
                command.Append(String.Format("^FO10,{0}^FD{1}. {2} _____^FS", coordinatY.ToString(), counter, item.ItemName1.TrimEnd()));
                counter += 1;
                coordinatY += 40;
            }
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            if (!string.IsNullOrEmpty(printerUrl) && !string.IsNullOrEmpty(command.ToString()))
            {
                #region Send Command to Printer
                //Initialize Printer
                print.OpenPrinter(printerUrl);
                print.StartDocPrinter();
                print.Send("\n");
                print.Send("n\n"); // clear the image buffer
                print.Send(command.ToString());
                print.Send("p1\n"); //print one label
                print.EndDocPrinter();
                #endregion
            }
        }

        public static void PrintBuktiOrderPenunjang(vConsultVisit oVisit, List<vTestOrderDt> lstOrder, string printerUrl, string printFormat)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Order, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Order);

                if (!string.IsNullOrEmpty(command))
                {

                    #region Store Header Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Order Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    print.OpenPrinter(printerUrl);
                    print.StartDocPrinter();
                    print.Send("\n");
                    print.Send("n\n"); // clear the image buffer
                    print.Send(labelCommand);
                    print.Send("p1\n"); //print one label
                    print.EndDocPrinter();
                    #endregion
                }
            }
        }
        #endregion

        public static bool PrintMCUAppointmentRequestLabel(List<PrinterLocation> lstPrinter, List<vAppointmentRequest> lstApmReq, ref string errMessage)
        {
            bool result = true;
            try
            {
                foreach (vAppointmentRequest entity in lstApmReq)
                {
                    StringBuilder sb = new StringBuilder();
                    sb.Append("^XA\r\n");
                    sb.Append("^FX\r\n");
                    sb.Append("^CF0,40\r\n");
                    sb.Append("^FO250,100^FD" + entity.CorporateAccountNo + "^FS\r\n");
                    sb.Append("^FO250,150^FD" + entity.CorporateAccountName + "^FS\r\n");
                    sb.Append("^XZ\r\n");
                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    string printerUrl = lstPrinter[0].PrinterName;
                    string zebraString = sb.ToString();
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                    #endregion
                }
            }
            catch (Exception ex)
            {
                errMessage = ex.Message;
                result = false;
            }

            return result;
        }

        #region Tracer RM
        public static void PrintTracerApmRMRSSES(vAppointment oAppt, string printerUrl)
        {
            for (int a = 0; a <= 1; a++) // utk RSSES print 2x
            {
                #region Print Detail
                StringBuilder sb = new StringBuilder();
                string ESC = Convert.ToString((char)27);
                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string t = Convert.ToString((char)116);
                string E = Convert.ToString((char)69);

                string BoldOn = ESC + GS + t;
                string BoldOff = ESC + GS + t;

                string fontBold = "\x1b\x45\x01";
                string fontBoldEnd = "\x1b\x45\x00";

                string fontDoubleHeight = "\x1b\x21\x10";
                string fontDoubleHeightEnd = "\x1b\x21\x00";

                const string GSs = "\u001D";
                string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                string DoubleOff = GSs + "!" + "\0";

                string fontItalic = "\x1b\x34\x01";
                string fontItalicEnd = "\x1b\x34\x00";


                // sb.Append(ESC + "a0");

                sb.AppendLine(string.Format("{0}          {1}", Helper.GetDateIndonesiaFormat(oAppt.StartDate), oAppt.StartTime));
                sb.Append(fontBold);
                if (oAppt.OldMedicalNo != null && oAppt.OldMedicalNo != "")
                {
                    sb.AppendLine(string.Format("{0} | {1}* ({2})", oAppt.MedicalNo, oAppt.OldMedicalNo, oAppt.cfIsNewPatientCustom1));
                }
                else
                {
                    sb.AppendLine(string.Format("{0} ({1})", oAppt.MedicalNo, oAppt.Gender));
                }
                sb.Append(fontBoldEnd);

                sb.AppendLine(string.Format("{0}", oAppt.PatientName));


                sb.AppendLine("");
                sb.AppendLine(string.Format("{0}", oAppt.BusinessPartnerName));
                sb.AppendLine("");
                if (!string.IsNullOrEmpty(oAppt.RoomName))
                {
                    sb.AppendLine(string.Format("Ruang  : {0}", oAppt.RoomName));
                }
                sb.Append(fontBold);
                sb.AppendLine(string.Format("{0}", oAppt.ParamedicName));
                sb.AppendLine(string.Format("No Antri {0}", oAppt.QueueNo));
                sb.Append(fontBoldEnd);
                sb.AppendLine("");

                sb.AppendLine(string.Format("{0}", AppSession.UserLogin.UserFullName));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 6; i++)
                {
                    sb.AppendLine("");
                }

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;
                sb.AppendLine(command);
                #endregion
                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        public static void PrintTracerRM(vConsultVisit oVisit, string printerUrl, string printFormat)
        {

            if (!string.IsNullOrEmpty(printerUrl))
            {
                if (printFormat == Constant.PrintFormat.TRACER_RSSMP)
                {
                    #region Format Tracer RSSMP

                    #region Printer Command

                    DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                    StringBuilder sb = new StringBuilder();

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(20);
                    dotMatrix.SetLeftMargin(1);
                    dotMatrix.SetRightMargin(28);
                    dotMatrix.SelectCourierFont();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.Append("\n");
                    dotMatrix.Append("\n");
                    dotMatrix.SetTittleFont(string.Format("{0}", oVisit.MedicalNo));
                    dotMatrix.SetTabHorizontally();
                    dotMatrix.SetTabHorizontally();
                    dotMatrix.SetTittleFont(string.Format("{0}", oVisit.QueueNo));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("...................................."));
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oVisit.PatientName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0} {1}", oVisit.RegistrationNo, oVisit.Gender));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.RoomName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oVisit.ParamedicName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0} {1}", oVisit.ActualVisitDateInString, oVisit.ActualVisitTime));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oVisit.BusinessPartnerName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append("\n");

                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(dotMatrix.ToString());
                    print.ClosePrint();

                    #endregion

                    #endregion
                }
                else if (printFormat == Constant.PrintFormat.TRACER_RSDOSKA)
                {
                    StringBuilder sb = new StringBuilder();

                    List<vConsultVisit> lstEntity = BusinessLayer.GetvConsultVisitList(string.Format("MRN = {0} AND ActualVisitDate = '{1}' AND GCRegistrationStatus != '{2}' AND GCVisitStatus != '{3}'", oVisit.MRN, oVisit.ActualVisitDate, Constant.VisitStatus.CANCELLED, Constant.VisitStatus.CANCELLED));
                    vRegistration2 oLastRegistration = BusinessLayer.GetvRegistration2List(string.Format("RegistrationDate < '{0}' AND MRN = {1} AND GCRegistrationStatus != '{2}'", oVisit.ActualVisitDate, oVisit.MRN, Constant.VisitStatus.CANCELLED)).FirstOrDefault();

                    #region Print Tracer

                    #region Print Detail

                    sb.AppendLine(string.Format(" TRACER BERKAS REKAM MEDIS"));
                    sb.AppendLine("");

                    string[] textNama = oVisit.Name2.Split(' ');
                    string tempNama = "", tempNama1 = "", tempNama2 = "";
                    for (int n = 0; n < textNama.Length; n++)
                    {
                        tempNama = textNama[n];
                        if (tempNama1 == "")
                        {
                            tempNama1 = tempNama;
                        }
                        else
                        {
                            if (tempNama1.Length < 30 && (tempNama1.Length + tempNama.Length) <= 30)
                            {
                                tempNama1 += " " + tempNama;
                            }
                            else
                            {
                                if (tempNama2 == "")
                                {
                                    tempNama2 = tempNama;
                                }
                                else
                                {
                                    if (tempNama2.Length < 30 && (tempNama2.Length + tempNama.Length) <= 30)
                                    {
                                        tempNama2 += " " + tempNama;
                                    }
                                }
                            }
                        }
                    }
                    if (tempNama2 == "")
                    {
                        sb.AppendLine(string.Format(" Tanggal       : {0}", oVisit.ActualVisitDateInString));
                        sb.AppendLine(string.Format(" No. MR        : {0}", oVisit.MedicalNo));
                        sb.AppendLine(string.Format(" Nama          : {0}", oVisit.Name2));
                        sb.AppendLine(string.Format(" Tanggal Lahir : {0}", oVisit.DateOfBirthInString));
                    }
                    else
                    {
                        sb.AppendLine(string.Format(" Tanggal       : {0}", oVisit.ActualVisitDateInString));
                        sb.AppendLine(string.Format(" No. MR        : {0}", oVisit.MedicalNo));
                        sb.AppendLine(string.Format(" Nama          : {0}", tempNama1));
                        sb.AppendLine(string.Format("                 {0}", tempNama2));
                        sb.AppendLine(string.Format(" Tanggal Lahir : {0}", oVisit.DateOfBirthInString));
                    }
                    sb.AppendLine("");

                    sb.AppendLine(string.Format(" Kunjungan Hari Ini"));
                    for (int i = 0; i < lstEntity.Count; i++)
                    {
                        sb.AppendLine(string.Format(" {0} No. Reg     : {1}", i + 1, lstEntity[i].RegistrationNo));
                        sb.AppendLine(string.Format("   Poli        : {0} ", lstEntity[i].ServiceUnitName));

                        string[] textLst = lstEntity[i].ParamedicName.Split(' ');
                        string temp = "", tempText1 = "", tempText2 = "";

                        for (int a = 0; a < textLst.Length; a++)
                        {
                            temp = textLst[a];
                            if (tempText1 == "")
                            {
                                tempText1 = temp;
                            }
                            else
                            {
                                if (tempText1.Length < 30 && (tempText1.Length + temp.Length) <= 30)
                                {
                                    tempText1 += " " + temp;
                                }
                                else
                                {
                                    if (tempText2 == "")
                                    {
                                        tempText2 = temp;
                                    }
                                    else
                                    {
                                        if (tempText2.Length < 30 && (tempText2.Length + temp.Length) <= 30)
                                        {
                                            tempText2 += " " + temp;
                                        }
                                    }
                                }
                            }
                        }

                        if (tempText2 == "")
                        {
                            sb.AppendLine(string.Format("   Dokter      : {0}", tempText1));
                            sb.AppendLine(string.Format("   No. Antrian : {0}", lstEntity[i].QueueNo));

                            string[] textPenanggung = lstEntity[i].BusinessPartnerName.Split(' ');
                            string tempPenanggung = "", tempPenanggung1 = "", tempPenanggung2 = "";

                            for (int p = 0; p < textPenanggung.Length; p++)
                            {
                                tempPenanggung = textPenanggung[p];
                                if (tempPenanggung1 == "")
                                {
                                    tempPenanggung1 = tempPenanggung;
                                }
                                else
                                {
                                    if (tempPenanggung1.Length < 30 && (tempPenanggung1.Length + tempPenanggung.Length) <= 30)
                                    {
                                        tempPenanggung1 += " " + tempPenanggung;
                                    }
                                    else
                                    {
                                        if (tempPenanggung2 == "")
                                        {
                                            tempPenanggung2 = tempPenanggung;
                                        }
                                        else
                                        {
                                            if (tempPenanggung2.Length < 30 && (tempPenanggung2.Length + tempPenanggung.Length) <= 30)
                                            {
                                                tempPenanggung2 += " " + tempPenanggung;
                                            }
                                        }
                                    }
                                }
                            }
                            if (tempPenanggung2 == "")
                            {
                                sb.AppendLine(string.Format("   Penanggung  : {0}", lstEntity[i].BusinessPartnerName));
                                sb.AppendLine("");
                            }
                            else
                            {
                                sb.AppendLine(string.Format("   Penanggung  : {0}", tempPenanggung1));
                                sb.AppendLine(string.Format("                 {0}", tempPenanggung2));
                                sb.AppendLine("");
                            }
                        }
                        else
                        {
                            sb.AppendLine(string.Format("   Dokter      : {0}", tempText1));
                            sb.AppendLine(string.Format("                 {0}", tempText2));
                            sb.AppendLine(string.Format("   No. Antrian : {0}", lstEntity[i].QueueNo));

                            string[] textPenanggung = lstEntity[i].BusinessPartnerName.Split(' ');
                            string tempPenanggung = "", tempPenanggung1 = "", tempPenanggung2 = "";

                            for (int p = 0; p < textPenanggung.Length; p++)
                            {
                                tempPenanggung = textPenanggung[p];
                                if (tempPenanggung1 == "")
                                {
                                    tempPenanggung1 = tempPenanggung;
                                }
                                else
                                {
                                    if (tempPenanggung1.Length < 30 && (tempPenanggung1.Length + tempPenanggung.Length) <= 30)
                                    {
                                        tempPenanggung1 += " " + tempPenanggung;
                                    }
                                    else
                                    {
                                        if (tempPenanggung2 == "")
                                        {
                                            tempPenanggung2 = tempPenanggung;
                                        }
                                        else
                                        {
                                            if (tempPenanggung2.Length < 30 && (tempPenanggung2.Length + tempPenanggung.Length) <= 30)
                                            {
                                                tempPenanggung2 += " " + tempPenanggung;
                                            }
                                        }
                                    }
                                }
                            }
                            if (tempPenanggung2 == "")
                            {
                                sb.AppendLine(string.Format("   Penanggung  : {0}", lstEntity[i].BusinessPartnerName));
                                sb.AppendLine("");
                            }
                            else
                            {
                                sb.AppendLine(string.Format("   Penanggung  : {0}", tempPenanggung1));
                                sb.AppendLine(string.Format("                 {0}", tempPenanggung2));
                                sb.AppendLine("");
                            }
                        }
                    }

                    sb.AppendLine("");
                    if (oLastRegistration != null)
                    {
                        sb.AppendLine(string.Format(" Kunjungan Terakhir"));
                        sb.AppendLine(string.Format(" {0}, {1}", oLastRegistration.RegistrationDateInString, oLastRegistration.ServiceUnitName));
                    }

                    sb.AppendLine("");
                    DateTime dateNow = DateTime.Now;
                    sb.AppendLine(string.Format(" Dicetak pada {0} {1}, oleh {2}", dateNow.ToString(Constant.FormatString.DATE_FORMAT), dateNow.ToString(Constant.FormatString.TIME_FORMAT), AppSession.UserLogin.UserName));


                    //Append beberapa baris supaya bisa pas dengan cutter
                    for (int i = 0; i <= 3; i++)
                    {
                        sb.AppendLine("");
                    }

                    //Send Auto-Cut Command
                    string GS = Convert.ToString((char)29);
                    string ESC = Convert.ToString((char)29);

                    string command = "";
                    command = ESC + "@";
                    command += GS + "V" + (char)1;

                    sb.Append(command);
                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();

                    #endregion

                    #endregion

                    #region Print Ekspedisi Berkas Rekam Medis

                    #endregion
                }
                else if (printFormat == Constant.PrintFormat.TRACER_RSSES)
                {
                    for (int a = 0; a <= 1; a++) // utk RSSES print 2x
                    {
                        #region Print Detail
                        StringBuilder sb = new StringBuilder();
                        string ESC = Convert.ToString((char)27);
                        //Send Auto-Cut Command
                        string GS = Convert.ToString((char)29);
                        string t = Convert.ToString((char)116);
                        string E = Convert.ToString((char)69);

                        string BoldOn = ESC + GS + t;
                        string BoldOff = ESC + GS + t;

                        string fontBold = "\x1b\x45\x01";
                        string fontBoldEnd = "\x1b\x45\x00";

                        string fontDoubleHeight = "\x1b\x21\x10";
                        string fontDoubleHeightEnd = "\x1b\x21\x00";

                        const string GSs = "\u001D";
                        string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                        string DoubleOff = GSs + "!" + "\0";

                        string fontItalic = "\x1b\x34\x01";
                        string fontItalicEnd = "\x1b\x34\x00";


                        // sb.Append(ESC + "a0");

                        sb.AppendLine(string.Format("{0}          {1}", Helper.GetDateIndonesiaFormat(oVisit.ActualVisitDate), oVisit.ActualVisitTime));
                        sb.Append(fontBold);
                        if (oVisit.OldMedicalNo != null && oVisit.OldMedicalNo != "")
                        {
                            sb.AppendLine(string.Format("{0} | {1}* ({2})", oVisit.MedicalNo, oVisit.OldMedicalNo, oVisit.cfIsNewPatientCustom1));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("{0} ({1})", oVisit.MedicalNo, oVisit.Gender));
                        }
                        sb.Append(fontBoldEnd);

                        sb.AppendLine(string.Format("{0}", oVisit.PatientName));


                        sb.AppendLine("");
                        sb.AppendLine(string.Format("{0}", oVisit.BusinessPartnerName));
                        sb.AppendLine("");
                        if (!string.IsNullOrEmpty(oVisit.RoomName))
                        {
                            sb.AppendLine(string.Format("Ruang  : {0}", oVisit.RoomName));
                        }
                        sb.Append(fontBold);
                        sb.AppendLine(string.Format("{0}", oVisit.ParamedicName));
                        sb.AppendLine(string.Format("No Antri {0}", oVisit.QueueNo));
                        sb.Append(fontBoldEnd);
                        sb.AppendLine("");

                        sb.AppendLine(string.Format("{0}", AppSession.UserLogin.UserFullName));

                        //Append beberapa baris supaya bisa pas dengan cutter
                        for (int i = 0; i <= 6; i++)
                        {
                            sb.AppendLine("");
                        }

                        string command = "";
                        command = ESC + "@";
                        command += GS + "V" + (char)1;
                        sb.AppendLine(command);
                        #endregion

                        #region Send Command to Printer

                        RawPrinterHelper print = new RawPrinterHelper();

                        //Initialize Printer
                        print.OpenPrint(printerUrl);
                        print.SendStringToPrinter(sb.ToString());
                        print.ClosePrint();

                        #endregion
                    }
                }
                else if (printFormat == Constant.PrintFormat.TRACER_RSASIH)
                {
                    #region Print Detail
                    StringBuilder sb = new StringBuilder();
                    string ESC = Convert.ToString((char)27);
                    //Send Auto-Cut Command
                    string GS = Convert.ToString((char)29);
                    string t = Convert.ToString((char)116);
                    string E = Convert.ToString((char)69);

                    string BoldOn = ESC + GS + t;
                    string BoldOff = ESC + GS + t;

                    string fontBold = "\x1b\x45\x01";
                    string fontBoldEnd = "\x1b\x45\x00";

                    string fontDoubleHeight = "\x1b\x21\x10";
                    string fontDoubleHeightEnd = "\x1b\x21\x00";

                    const string GSs = "\u001D";
                    string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                    string DoubleOff = GSs + "!" + "\0";

                    string fontItalic = "\x1b\x34\x01";
                    string fontItalicEnd = "\x1b\x34\x00";


                    // sb.Append(ESC + "a0");

                    sb.AppendLine(string.Format("{0}          {1}", Helper.GetDateIndonesiaFormat(oVisit.ActualVisitDate), oVisit.ActualVisitTime));
                    sb.Append(fontBold);
                    if (oVisit.OldMedicalNo != null && oVisit.OldMedicalNo != "")
                    {
                        sb.AppendLine(string.Format("{0} | {1} ", oVisit.MedicalNo, oVisit.OldMedicalNo));
                    }
                    else
                    {
                        sb.AppendLine(string.Format("{0} ({1})", oVisit.MedicalNo, oVisit.Gender));
                    }
                    sb.Append(fontBoldEnd);

                    sb.AppendLine(string.Format("{0}", oVisit.PatientName));


                    sb.AppendLine("");
                    sb.AppendLine(string.Format("{0}", oVisit.BusinessPartnerName));
                    sb.AppendLine("");
                    if (!string.IsNullOrEmpty(oVisit.RoomName))
                    {
                        sb.AppendLine(string.Format("Ruang  : {0}", oVisit.RoomName));
                    }
                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("{0}", oVisit.ParamedicName));
                    sb.AppendLine(string.Format("No Antri {0}", oVisit.QueueNo));
                    sb.Append(fontBoldEnd);
                    sb.AppendLine("");

                    sb.AppendLine(string.Format("{0}", AppSession.UserLogin.UserFullName));

                    //Append beberapa baris supaya bisa pas dengan cutter
                    for (int i = 0; i <= 6; i++)
                    {
                        sb.AppendLine("");
                    }

                    string command = "";
                    command = ESC + "@";
                    command += GS + "V" + (char)1;
                    sb.AppendLine(command);
                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();

                    #endregion
                }
                else if (printFormat == Constant.PrintFormat.TRACER_RSUKI)
                {

                    #region Printer Command

                    const char NUL = '\x00';    // NUL 
                    const char LF = '\x0A';     //LINE FEED
                    const char ESC = '\x1B';    // ESCAPE
                    const char FS = '\x1c';
                    const char GS = '\x1D';     //GROUP SPARATOR
                    const string GSs = "\u001D";

                    const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                    const string DoubleOff = GSs + "!" + "\0";

                    string barcodeWidth = "\x1d\x77\x01";
                    string barcodeHeight = "\x1d\x68\x32";
                    string barcodeWidth1 = "\x1d\x77\x02";
                    string barcodeHeight1 = "\x1d\x68\x50";
                    string barcodeValues = "\x1d\x48\x32";

                    string fontBold = "\x1b\x45\x01";
                    string fontDoubleHeight = "\x1b\x21\x10";
                    string fontBoldEnd = "\x1b\x45\x00";
                    string fontDoubleHeightEnd = "\x1b\x21\x00";

                    DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                    StringBuilder sb = new StringBuilder();

                    sb.Append(ESC + "a1");
                    sb.Append(fontDoubleHeight);
                    sb.Append(DoubleOn);
                    sb.Append(fontBold);
                    sb.AppendLine("* BON  MR *");
                    sb.AppendLine(string.Format("{0}", oVisit.MedicalNo));
                    sb.Append(fontBoldEnd);
                    sb.Append(DoubleOff);
                    sb.Append(fontDoubleHeightEnd);
                    sb.AppendLine(string.Format("--------------------------------"));

                    sb.Append(ESC + "a0");
                    sb.Append(fontDoubleHeight);
                    sb.Append(DoubleOn);
                    sb.Append(fontBold);
                    sb.AppendLine(string.Format("  {0} / {1}", oVisit.ActualVisitDateInString, oVisit.ActualVisitTime));
                    sb.AppendLine(string.Format("  {0}", oVisit.ServiceUnitName));
                    sb.AppendLine(string.Format("  {0}", oVisit.PatientName));
                    sb.Append(fontBoldEnd);
                    sb.Append(DoubleOff);
                    sb.Append(fontDoubleHeightEnd);
                    sb.Append(ESC + "a1");
                    sb.AppendLine(string.Format("--------------------------------"));

                    sb.Append(ESC + "a0");
                    sb.AppendLine(string.Format("  {0}", AppSession.UserLogin.UserFullName));
                    sb.AppendLine(string.Format(" ({0})", DateTime.Now.ToString(Constant.FormatString.DATE_TIME_FORMAT_4)));
                    sb.AppendLine("");

                    //Append beberapa baris supaya bisa pas dengan cutter
                    for (int i = 0; i <= 6; i++)
                    {
                        sb.AppendLine("");
                    }

                    string command = "";
                    command = ESC + "@";
                    command += GS + "V" + (char)1;
                    sb.AppendLine(command);
                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();

                    #endregion
                }
                else if (printFormat == Constant.PrintFormat.TRACER_RSPW)
                {
                    #region Format Tracer RSPW

                    DirectPrinting print = new DirectPrinting();

                    //Get and Load Printer Command
                    string command = string.Empty;
                    command = GetTracerFormat(printFormat);

                    //Get Printing Metadata
                    List<string> lstField = GetMetadata(PrintingGroup.Tracer);

                    if (!string.IsNullOrEmpty(command))
                    {

                        #region Store Tracer Information to Dictionary

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        foreach (string fieldName in lstField)
                        {
                            if (fieldName != "HealthcareName")
                                labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                        }
                        #endregion

                        #region Replace Command's Visit Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion

                        #region Send Command to Printer

                        //Initialize Printer
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send(labelCommand);
                        print.Send("\x1B");
                        print.Send("@");
                        print.Send("\x1D");
                        print.Send((Convert.ToChar(0)).ToString());
                        print.EndDocPrinter();

                        #endregion
                    }

                    #endregion
                }
                else
                {
                    #region Format Tracer Default

                    DirectPrinting print = new DirectPrinting();

                    //Get and Load Printer Command
                    string command = string.Empty;
                    command = GetTracerFormat(printFormat);

                    //Get Printing Metadata
                    List<string> lstField = GetMetadata(PrintingGroup.Tracer);

                    if (!string.IsNullOrEmpty(command))
                    {

                        #region Store Tracer Information to Dictionary

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        foreach (string fieldName in lstField)
                        {
                            if (fieldName != "HealthcareName")
                                labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                        }
                        #endregion

                        #region Replace Command's Visit Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion

                        #region Send Command to Printer

                        //Initialize Printer
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send(labelCommand);
                        //print.Send("\x1B\x40\x1D\x561");
                        //print.Send("\x1B@\x1DV1");
                        print.Send("\x1B");
                        print.Send("@");
                        print.Send("\x1D");
                        print.Send("V");
                        print.Send((Convert.ToChar(65)).ToString());
                        print.Send((Convert.ToChar(0)).ToString());
                        print.EndDocPrinter();

                        #endregion
                    }

                    #endregion
                }
            }
        }

        public static void PrintTracerRMDotMatrix(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            DotMatrixPrinter DotMatrix = new DotMatrixPrinter();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetTracerFormat(printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Tracer);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion

                    #region Send Command to Printer
                    RawPrinterHelper print = new RawPrinterHelper();

                    Healthcare entityHSU = BusinessLayer.GetHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                    if (entityHSU.Initial == "PHS")
                    {
                        string[] lstPrinterUrl = printerUrl.Split('|');
                        for (int i = 0; i < lstPrinterUrl.Length; i++)
                        {
                            //Initialize Printer
                            print.OpenPrint(lstPrinterUrl[i]);
                            print.SendStringToPrinter(labelCommand);
                            print.ClosePrint();
                        }
                    }
                    else
                    {
                        //Initialize Printer
                        print.OpenPrint(printerUrl);
                        print.SendStringToPrinter(labelCommand);
                        print.ClosePrint();
                    }
                    #endregion
                }
            }
        }

        private static string GetTracerFormat(string printFormat = "X208^01")
        {
            #region Get Label Format
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\print_format\tracer\{1}.rdl", filePath, printFormat.Replace('^', '_'));
            IEnumerable<string> lstCommand = File.ReadAllLines(fileName);
            StringBuilder commandText = new StringBuilder();
            foreach (string command in lstCommand)
            {
                commandText.AppendLine(command);
            }
            string result = commandText.ToString();
            #endregion
            return result;
        }
        #endregion

        #region Tracer Appointment RM

        public static void PrintTracerAppointmentRM(vAppointment oAppointment, string printerUrl, string printFormat)
        {

            if (!string.IsNullOrEmpty(printerUrl))
            {
                if (printFormat == Constant.PrintFormat.TRACER_APPOINTMENT_RSSMP)
                {
                    #region Format Tracer RSSMP

                    #region Printer Command

                    DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                    StringBuilder sb = new StringBuilder();

                    dotMatrix.InitPrinter();
                    dotMatrix.SetPageLengthInLines(20);
                    dotMatrix.SetLeftMargin(1);
                    dotMatrix.SetRightMargin(28);
                    dotMatrix.SelectCourierFont();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.Append("\n");
                    dotMatrix.Append("\n");
                    dotMatrix.SetTittleFont(string.Format("{0} (R)", oAppointment.MedicalNo));
                    dotMatrix.SetTabHorizontally();
                    dotMatrix.SetTittleFont(string.Format("{0}", oAppointment.QueueNo));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("...................................."));
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.SetFont15cpi();
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oAppointment.PatientName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0} {1}", oAppointment.AppointmentNo, oAppointment.Gender));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0} {1}", oAppointment.ServiceUnitName, oAppointment.RoomName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oAppointment.ParamedicName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oAppointment.StartDateTimeInString));
                    dotMatrix.Append("\n");
                    dotMatrix.Append(string.Format("{0}", oAppointment.BusinessPartnerName));
                    dotMatrix.Append("\n");
                    dotMatrix.Append("\n");

                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(dotMatrix.ToString());
                    print.ClosePrint();

                    #endregion

                    #endregion
                }
                else
                {
                    #region Format Tracer Default

                    DirectPrinting print = new DirectPrinting();

                    //Get and Load Printer Command
                    string command = string.Empty;
                    command = GetTracerFormat(printFormat);

                    //Get Printing Metadata
                    List<string> lstField = GetMetadata(PrintingGroup.Tracer);

                    if (!string.IsNullOrEmpty(command))
                    {

                        #region Store Tracer Information to Dictionary

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        foreach (string fieldName in lstField)
                        {
                            if (fieldName != "HealthcareName")
                                labelInfo.Add(fieldName, GetPropertyValue(oAppointment, fieldName).ToString());
                        }
                        #endregion

                        #region Replace Command's Visit Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion

                        #region Send Command to Printer

                        //Initialize Printer
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send(labelCommand);
                        //print.Send("\x1B\x40\x1D\x561");
                        //print.Send("\x1B@\x1DV1");
                        print.Send("\x1B");
                        print.Send("@");
                        print.Send("\x1D");
                        print.Send("V");
                        print.Send((Convert.ToChar(65)).ToString());
                        print.Send((Convert.ToChar(0)).ToString());
                        print.EndDocPrinter();

                        #endregion
                    }

                    #endregion
                }
            }
        }

        #endregion

        #region Tracer RM 1
        /// <summary>
        /// Cetak Tracer dengan Printer Struk Epson (Thermal) : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintTracerRM1(vConsultVisit oVisit, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.AppendLine(string.Format("{0}", oVisit.MedicalNo));
                sb.AppendLine("");
                sb.AppendLine(string.Format("{0} {1} / {2}", oVisit.Salutation, oVisit.PatientName, gender));
                sb.AppendLine(string.Format("   Penjamin Bayar     : {0}", oVisit.BusinessPartner));
                if (oVisit.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("   {0}: {1}", serviceUnit.PadRight(19, ' '), oVisit.ServiceUnitName));
                sb.AppendLine(string.Format("   Nama Dokter        : {0}", oVisit.ParamedicName));
                sb.AppendLine(string.Format("   Tgl/Jam Registrasi : {0} / {1}", oVisit.ActualVisitDateInString, oVisit.ActualVisitTime));
                if (oVisit.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit.AppointmentNo))
                        sb.AppendLine(string.Format("   No. Antrian        : {0}", oVisit.QueueNo));
                    else
                        sb.AppendLine(string.Format("   No. Antrian        : *** {0} ***", oVisit.QueueNo));
                }
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region RSSC
        #region Tracer RM 2
        /// <summary>
        /// Cetak Tracer dengan Printer Struk Epson (Thermal) : RSSC
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintTracerRM2(vConsultVisit oVisit, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();
                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                string line1 = string.Format("{0} {1} / {2}", oVisit.Salutation, oVisit.PatientName, gender).ToUpper();
                string line2 = string.Format("Penjamin Bayar     : {0}", oVisit.BusinessPartner);
                string line3 = string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit.ServiceUnitName);
                string line4 = string.Format("Nama Dokter        : {0}", oVisit.ParamedicName);

                if (line1.Length > 40)
                {
                    line1 = line1.Substring(0, 40);
                }

                if (line2.Length > 40)
                {
                    line2 = line2.Substring(0, 40);
                }

                if (line3.Length > 40)
                {
                    line3 = line3.Substring(0, 40);
                }

                if (line4.Length > 40)
                {
                    line4 = line4.Substring(0, 40);
                }

                #region Print Detail
                sb.AppendLine(string.Format("TRACER REGISTRASI"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("{0}", oVisit.MedicalNo));
                sb.AppendLine("");
                sb.AppendLine(line1);
                sb.AppendLine(line2);
                if (oVisit.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(line3);
                sb.AppendLine(line4);
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit.ActualVisitDateInString, oVisit.ActualVisitTime));
                if (oVisit.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit.AppointmentNo))
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit.QueueNo));
                    else
                        sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit.QueueNo));
                }
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();
                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region Tracer RM 3
        /// <summary>
        /// Cetak Tracer dengan Printer Struk Epson (Thermal) : RSSC (Untuk Appointment)
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintTracerRM3(vAppointment oAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();
                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                string line1 = string.Format("{0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender).ToUpper();
                string line2 = string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName);
                string line3 = string.Format("Nama Dokter        : {0}", oAppointment.ParamedicName);
                string line4 = string.Format("Poliklinik         : {0}", oAppointment.ServiceUnitName);

                if (line1.Length > 40)
                {
                    line1 = line1.Substring(0, 40);
                }

                if (line2.Length > 40)
                {
                    line2 = line2.Substring(0, 40);
                }

                if (line3.Length > 40)
                {
                    line3 = line3.Substring(0, 40);
                }

                if (line4.Length > 40)
                {
                    line4 = line4.Substring(0, 40);
                }


                #region Print Detail
                sb.AppendLine(string.Format("TRACER RESERVASI"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("{0}", oAppointment.MedicalNo));
                sb.AppendLine("");
                sb.AppendLine(line1);
                sb.AppendLine(line2);
                sb.AppendLine(line3);
                sb.AppendLine(line4);
                sb.AppendLine(string.Format("Tgl/Jam Reservasi  : {0} / {1}", oAppointment.StartDateInString, oAppointment.StartTime));
                sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #region Tracer RM 4
        /// <summary>
        /// Cetak Tracer dengan Printer Struk Epson (Thermal) : RSSC (Untuk Appointment Per Hari)
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintTracerRM4(List<vAppointment> lstAppointment, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                foreach (vAppointment oAppointment in lstAppointment)
                {
                    StringBuilder sb = new StringBuilder();
                    vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                    string gender = oAppointment.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                    string line1 = string.Format("{0} {1} / {2}", oAppointment.Salutation, oAppointment.PatientName, gender).ToUpper();
                    string line2 = string.Format("Penjamin Bayar     : {0}", oAppointment.BusinessPartnerName);
                    string line3 = string.Format("Nama Dokter        : {0}", oAppointment.ParamedicName);

                    if (line1.Length > 40)
                    {
                        line1 = line1.Substring(0, 40);
                    }

                    if (line2.Length > 40)
                    {
                        line2 = line2.Substring(0, 40);
                    }

                    if (line3.Length > 40)
                    {
                        line3 = line3.Substring(0, 40);
                    }


                    #region Print Detail
                    sb.AppendLine(string.Format("TRACER RESERVASI"));
                    sb.AppendLine("");
                    sb.AppendLine(string.Format("{0}", oAppointment.MedicalNo));
                    sb.AppendLine("");
                    sb.AppendLine(line1);
                    sb.AppendLine(line2);
                    sb.AppendLine(line3);
                    sb.AppendLine(string.Format("Tgl/Jam Reservasi  : {0} / {1}", oAppointment.StartDateInString, oAppointment.StartTime));
                    sb.AppendLine(string.Format("No. Antrian        : {0}", oAppointment.QueueNo));
                    //Append beberapa baris supaya bisa pas dengan cutter
                    for (int i = 0; i <= 8; i++)
                    {
                        sb.AppendLine("");
                    }

                    #endregion

                    #region Send Command to Printer

                    RawPrinterHelper print = new RawPrinterHelper();

                    //Initialize Printer
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();

                    #endregion
                }
            }
        }

        #endregion

        #region printCoverLabel
        public static void printCoverLabel(vPatient patient, string printerUrl1)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = Constant.Gender.MALE;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^MMT\r\n");
            sb.Append("^PW519\r\n");
            sb.Append("^LL0440\r\n");
            sb.Append("^LS0\r\n");
            sb.Append("^FT60,70^A0N,40,40^FH\\^FD" + patient.PatientName.Trim() + "^FS\r\n");
            sb.Append("^FT80,120^A0N,31,31^FH\\^FD" + string.Format("Tgl Lahir : {0}", patient.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^FT0,200^A0N,50,50^FH\\^FD" + string.Format("RM : {0}", patient.MedicalNo) + "^FS\r\n");
            sb.Append("^BY3,10,50");
            sb.Append("^FO0,220^BC^FD" + patient.MedicalNo + "^FS");
            sb.Append("^PQ1,0,1,Y^XZ");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            string printerUrl = printerUrl1;
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();
            #endregion
        }
        #endregion

        #region printLabelPasien
        public static void printLabelPasien(vRegistration registration, string prinerUrl)
        {
            DotMatrixPrinter printer = new DotMatrixPrinter();
            string gender = registration.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "(P)";
            }
            else
            {
                gender = "(L)";
            }

            string patientInfo = string.Format("No. RM : {0} {1} {2}", registration.MedicalNo, gender, registration.DateOfBirthInString);
            string patientName = registration.PatientName;
            if (patientName.Length > 26)
            {
                patientName = patientName.Substring(0, 26);
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO20,15^A0N,31,31^FD" + patientName + "^FS\r\n");
            sb.Append("^FO430,15^A0N,31,31^FD" + patientName + "^FS\r\n");
            sb.Append("^FO20,55^A0N,20,20^FD" + patientInfo + "^FS\r\n");
            sb.Append("^FO430,55^A0N,20,20^FD" + patientInfo + "^FS\r\n");
            sb.Append("^BY1,40,80\r\n");
            sb.Append("^FO40,80^BC\r\n");
            sb.Append("^FO40,80^FD" + registration.RegistrationNo + "^FS\r\n");
            sb.Append("^BY1,430,80\r\n");
            sb.Append("^FO430,80^BC\r\n");
            sb.Append("^FO430,80^FD" + registration.RegistrationNo + "^FS\r\n");
            //sb.Append("^FO180,205^A0N,10,10^FD" + "(" + registration.RegistrationDateInString + ")" + "^FS\r\n");
            sb.Append("^XZ\r\n");


            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(prinerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }
        #endregion

        #region printGelangPasien
        public static void printGelangPasien(vRegistration registration, string prinerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string patientName = registration.PatientName;
            if (patientName.Length > 23)
            {
                patientName = patientName.Substring(0, 23);
            }

            string medicalNo = string.Format("No. RM : {0}", registration.MedicalNo);
            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO20,15^A0N,31,31^FD" + patientName + "^FS\r\n");
            sb.Append("^FO430,15^A0N,31,31^FD" + patientName + "^FS\r\n");
            sb.Append("^FO20,55^A0N,20,20^FD" + registration.DateOfBirthInString + "^FS\r\n");
            sb.Append("^FO430,55^A0N,20,20^FD" + registration.DateOfBirthInString + "^FS\r\n");
            sb.Append("^FO20,80^A0N,20,20^FD" + medicalNo + "^FS\r\n");
            sb.Append("^FO430,80^A0N,20,20^FD" + medicalNo + "^FS\r\n");
            //sb.Append("^FO180,205^A0N,10,10^FD" + "(" + registration.RegistrationDateInString + ")" + "^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(prinerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }

        #endregion

        #region printGelangPasienAnak
        public static void printGelangPasienAnak(vConsultVisit consultVisit, string prinerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string patientName = consultVisit.PatientName;
            if (patientName.Length > 25)
            {
                patientName = patientName.Substring(0, 25);
            }

            string gender = string.Empty;
            if (consultVisit.GCGender == Constant.Gender.MALE)
            {
                gender = "L";
            }
            else
            {
                gender = "P";
            }

            string name = string.Format("{0} ({1})", patientName, gender);
            string dob = string.Format("DOB:{0} MR:{1} (RI)", consultVisit.DateOfBirthInString, consultVisit.MedicalNo);
            //string medicalNo = string.Format("MR:{0} (RI)", consultVisit.MedicalNo);

            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO365,245^A0B,30,30^FD" + name + "^FS\r\n");
            sb.Append("^FO405,155^GB1,700,3^FS\r\n");
            sb.Append("^FO425,255^A0B,30,30^FD" + dob + "^FS\r\n");
            //sb.Append("^FO425,100^A0B,38,38^FD" + medicalNo + "^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(prinerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }
        #endregion

        #region printGelangPasienDewasa
        public static void printGelangPasienDewasa(vConsultVisit consultVisit, string prinerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string patientName = consultVisit.PatientName;
            if (patientName.Length > 25)
            {
                patientName = patientName.Substring(0, 25);
            }

            string gender = string.Empty;
            if (consultVisit.GCGender == Constant.Gender.MALE)
            {
                gender = "L";
            }
            else
            {
                gender = "P";
            }

            string name = string.Format("{0} ({1})", patientName, gender);
            string dob = string.Format("DOB:{0}", consultVisit.DateOfBirthInString);
            string medicalNo = string.Format("MR:{0} (RI)", consultVisit.MedicalNo);

            sb.Append("^XA\r\n");
            //sb.Append("^FO330,50^GB140,750,3^FS\r\n");
            sb.Append("^FO355,1805^A0B,40,40^FD" + name + "^FS\r\n");
            sb.Append("^FO405,1565^GB1,700,3^FS\r\n");
            sb.Append("^FO425,1955^A0B,38,38^FD" + dob + "^FS\r\n");
            sb.Append("^FO425,1500^A0B,38,38^FD" + medicalNo + "^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(prinerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }
        #endregion

        #endregion

        #region PrintLabelRekamMedisRSSMC
        public static void PrintLabelRekamMedisRSSMC(vPatient patient, string printerUrl1, int labelCount = 0)
        {
            //DotMatrixPrinter printer = new DotMatrixPrinter();
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            string gender = patient.GCGender;

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            StringBuilder sb = new StringBuilder();
            sb.Append("^XA\r\n");

            //MODIFIKASI
            sb.Append("^CF0,25");
            sb.Append("^FO235,20^FD" + string.Format("Nama") + "^FS\r\n");
            sb.Append("^CF0,25");
            sb.Append("^FO235,55^FD" + string.Format("Tgl Lahir") + "^FS\r\n");
            sb.Append("^CF0,25");
            sb.Append("^FO235,90^FD" + string.Format("No.RM") + "^FS\r\n");

            sb.Append("^CF0,25");
            sb.Append("^FO350,20^FD" + string.Format(": {0}   ({1})", patient.CardName, gender) + "^FS\r\n");
            sb.Append("^CF0,25");
            sb.Append("^FO350,55^FD" + string.Format(": {0}", patient.DateOfBirthInString) + "^FS\r\n");
            sb.Append("^CF0,25");
            sb.Append("^FO350,90^FD" + string.Format(": {0}", patient.MedicalNo) + "^FS\r\n");
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            for (int i = 0; i < labelCount; i++)
            {
                string printerUrl = printerUrl1;
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
            }
            #endregion
        }
        #endregion


        #region granostic

        #region printLabelRadiologiGRANOSTIC
        public static void printLabelRadiologiGRANOSTIC(vLabelPatientRegistrationImagingRSUKRIDA charges, string printerUrl)
        {

            StringBuilder sb = new StringBuilder();

            string line2 = string.Format("Pemeriksaan");
            string line3 = string.Format("Nama");
            string line4 = string.Format("Umur");
            string line5 = string.Format("Tanggal");
            string line6 = string.Format("Pengirim");

            string filterExpression = string.Format("TransactionID = {0}", charges.TransactionID.ToString());
            List<vLabelPatientRegistrationImagingRSUKRIDA> lstDetail = BusinessLayer.GetvLabelPatientRegistrationImagingRSUKRIDAList(filterExpression);
            foreach (vLabelPatientRegistrationImagingRSUKRIDA item in lstDetail)
            {
                sb.Append("^XA");
                sb.Append("^LL640");
                sb.Append("^PW800");
                sb.Append("^LH5,10");

                sb.Append("^A0N,35,36");
                sb.Append("^FO20,30^FD" + line2 + "^FS"); //Pemeriksaan
                sb.Append("^A0N,35,36");
                sb.Append("^FO230,21^FD:^FS");
                sb.Append("^A0N,35,36");
                sb.Append("^FO250,21^FD" + item.ItemName + "^FS");

                sb.Append("^A0N,35,34");
                sb.Append("^FO20,80^FD" + line3 + "^FS"); //Nama
                sb.Append("^A0N,35,34");
                sb.Append("^FO230,80^FD:^FS");
                sb.Append("^A0N,35,34");
                sb.Append("^FO250,80^FD" + string.Format("{0}", item.PatientName) + "^FS");

                sb.Append("^A0N,35,34");
                sb.Append("^FO20,130^FD" + line4 + "^FS"); //Umur
                sb.Append("^A0N,35,34");
                sb.Append("^FO230,130^FD:^FS");
                sb.Append("^A0N,35,34");
                sb.Append("^FO250,130^FD" + string.Format("{0} Tahun / ({1})", item.AgeInYear, item.cfGenderInitial) + "^FS");

                sb.Append("^A0N,35,34");
                sb.Append("^FO20,180^FD" + line5 + "^FS"); //Tgl Pemeriksaan
                sb.Append("^A0N,35,34");
                sb.Append("^FO230,180^FD:^FS");
                sb.Append("^A0N,35,34");
                sb.Append("^FO250,180^FD" + item.cfTransactionDateInString + "^FS");

                sb.Append("^A0N,35,34");
                sb.Append("^FO20,230^FD" + line6 + "^FS"); //Dokter Pengirim
                sb.Append("^A0N,35,34");
                sb.Append("^FO230,230^FD:^FS");
                sb.Append("^A0N,35,34");
                sb.Append("^FO250,230^FD" + item.DokterRujukan + "^FS");

                sb.Append("^PR2");
                sb.Append("^XZ");
                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #endregion

        #region PrintLabelPasienRSDO
        public static void PrintLabelPasienRSDO(vPatient patient, string printerUrl1, int labelCount)
        {
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");
            //List<vRegistration> lstRegistration = BusinessLayer.GetvRegistrationList(string.Format("MRN = {0}", patient.MRN));

            string patientAge = "";
            //patientAge = string.Format("{0}thn {1}bln", lstRegistration.FirstOrDefault().AgeInYear, lstRegistration.FirstOrDefault().AgeInMonth);
            patientAge = string.Format("{0}thn {1}bln", patient.AgeInYear, patient.AgeInMonth);

            StringBuilder sb = new StringBuilder();

            int a1 = 0;
            int a2 = 0;
            int a3 = 0;
            int a4 = 3;
            int maxA = 0;

            int diff1 = 50;
            int diff2 = 10;

            sb.Append("^XA");
            for (int i = 0; i < 1; i++)
            {
                if (i == 0)
                {
                    a1 = 15;
                    a2 = 65;
                    a3 = 110;
                }
                else
                {
                    a1 = maxA;
                    a2 = maxA + diff1;
                    a3 = a2 + diff1;
                }

                //versi ORI
                sb.Append("^FO35," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                sb.Append("^FO35," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.cfCardNameSalutation) + "^FS");
                sb.Append("^FO35," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");

                sb.Append("^FO450," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                sb.Append("^FO450," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.cfCardNameSalutation) + "^FS");
                sb.Append("^FO450," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");

                //// versi RIO
                ////sb.Append("^FO170," + a1 + "^A0N,45,25^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                ////sb.Append("^FO170," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.CardName) + "^FS");
                ////sb.Append("^FO170," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");
                ////sb.Append("^FO35,"  + a4 + "^BQN,2,6 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");

                ////sb.Append("^FO585," + a1 + "^A0N,45,25^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                ////sb.Append("^FO585," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.CardName) + "^FS");
                ////sb.Append("^FO585," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");
                ////sb.Append("^FO450," + a4 + "^BQN,2,6 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");


                ////sb.Append("^FO285," + a4 + "^BQN,3,3 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO35," + a4 + "^BQN,2.5,3.5 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO120," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO120," + a2 + "^A0N,45,20^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");
                //sb.Append("^FO35," + a3 + "^A0N,45,25^FD" + string.Format("{0}", patient.CardName) + "^FS");

                ////sb.Append("^FO700," + a4 + "^BQN,3,3 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO450," + a4 + "^BQN,2.5,3.5 ^FDMM,A" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO535," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                //sb.Append("^FO535," + a2 + "^A0N,45,20^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");
                //sb.Append("^FO450," + a3 + "^A0N,45,25^FD" + string.Format("{0}", patient.CardName) + "^FS");

                maxA = a3 + diff2;
            }
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();
            for (int i = 0; i < labelCount; i++)
            {
                printer.OpenPrinter(printerUrl1);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
            }
        }
            #endregion
        #endregion

        #region printLabelRadiologiRSDO
        public static void printLabelRadiologiRSDO(vLabelPatientRegistrationImagingRSDOSKA charges, string printerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string paramedic = charges.DokterRujukan;

            string line1 = string.Format("TANGGAL");
            string line2 = string.Format("NOMOR");
            string line3 = string.Format("NAMA");
            string line4 = string.Format("ALAMAT");
            string line5 = string.Format("TGL LAHIR");
            string line6 = string.Format("RUANGAN");
            string line7 = string.Format("PENGIRIM");
            string line8 = string.Format("NO RM");
            string line9 = string.Format("PEMERIKSAAN");
            string line10 = string.Format("JUMLAH FILM");

            string filterExpression = string.Format("TransactionID = {0}", charges.TransactionID.ToString());
            List<vLabelPatientRegistrationImagingRSDOSKA> lstDetail = BusinessLayer.GetvLabelPatientRegistrationImagingRSDOSKAList(filterExpression);
            foreach (vLabelPatientRegistrationImagingRSDOSKA item in lstDetail)
            {
                string HomeAddress = item.HomeAddress;
                if (HomeAddress.Length > 41)
                {
                    sb.Append("^XA");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,30^FD" + line1 + "^FS"); //TANGGAL
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,30^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,30^FD" + item.cfTransactionDateInString + "^FS"); //cfTransactionDateInString
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,65^FD" + line2 + "^FS"); //NOMOR
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,65^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,65^FD" + item.TransactionNo + "^FS"); //TransactionNo
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,100^FD" + line3 + "^FS"); //NAMA
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,100^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,100^FD" + item.PatientName + "^FS"); //PatientName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,135^FD" + line4 + "^FS"); //ALAMAT
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,135^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,135^FB450,7,^FD" + item.HomeAddress + "^FS"); //HomeAddress
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,210^FD" + line5 + "^FS"); //TGL LAHIR
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,210^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,210^FD" + item.DateOfBirthInString + "^FS"); //DOB
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,245^FD" + line6 + "^FS"); //RUANGAN
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,245^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,245^FD" + item.VisitServiceUnitName + ' ' + item.VisitRoomName + item.VisitBedCode + "^FS"); //VisitServiceUnitName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,280^FD" + line7 + "^FS"); //PENGIRIM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,280^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,280^FD" + item.DokterRujukan + "^FS"); //paramedic
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,315^FD" + line9 + "^FS"); //PEMERIKSAAN
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,315^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,315^FD" + item.ItemName + "^FS"); //AlternateItemName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO420,30^FD" + line8 + "^FS"); //NO RM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO490,30^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO500,30^FD" + item.MedicalNo + "^FS"); //MedicalNo
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,350^FD" + line10 + "^FS"); //JUMLAH FILM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,350^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,350^FD" + item.Qty + "^FS"); //Qty
                    sb.Append("^XZ");
                }
                else
                {
                    sb.Append("^XA");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,30^FD" + line1 + "^FS"); //TANGGAL
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,30^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,30^FD" + item.cfTransactionDateInString + "^FS"); //cfTransactionDateInString
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,70^FD" + line2 + "^FS"); //NOMOR
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,70^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,70^FD" + item.TransactionNo + "^FS"); //TransactionNo
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,110^FD" + line3 + "^FS"); //NAMA
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,110^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,110^FD" + item.PatientName + "^FS"); //PatientName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,150^FD" + line4 + "^FS"); //ALAMAT
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,150^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,150^FD" + item.HomeAddress + "^FS"); //HomeAddress
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,190^FD" + line5 + "^FS"); //TGL LAHIR
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,190^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,190^FD" + item.DateOfBirthInString + "^FS"); //DOB
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,230^FD" + line6 + "^FS"); //RUANGAN
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,230^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,230^FD" + item.VisitServiceUnitName + ' ' + item.VisitRoomName + item.VisitBedCode + "^FS"); //VisitServiceUnitName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,270^FD" + line7 + "^FS"); //PENGIRIM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,270^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,270^FD" + item.DokterRujukan + "^FS"); //paramedic
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,310^FD" + line9 + "^FS"); //PEMERIKSAAN
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,310^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,310^FD" + item.ItemName + "^FS"); //AlternateItemName
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO420,30^FD" + line8 + "^FS"); //NO RM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO490,30^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO500,30^FD" + item.MedicalNo + "^FS"); //MedicalNo
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO50,350^FD" + line10 + "^FS"); //JUMLAH FILM
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO190,350^FD:^FS");
                    sb.Append("^AQN,28,24");
                    sb.Append("^FO200,350^FD" + item.Qty + "^FS"); //Qty
                    sb.Append("^XZ");
                }

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #region PrintLabelObatRSSES
        public static void PrintLabelObatRSSES(vPrescriptionOrderDtLabelRSSES prescription, string printerUrl1)
        {
            // ambil semua detail resep, khusus utk yg racikan cm ambil bapak racikan doank
            List<vPrescriptionOrderDtLabelRSSES> lstprescription = BusinessLayer.GetvPrescriptionOrderDtLabelRSSESList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND ChargesIsDeleted = 0", prescription.PrescriptionOrderID));

            // ambil semua detail resep tp non racikan (bapak racikan gk tampil)
            List<vPrescriptionOrderDtLabelRSSES> lstprescriptionPrint = BusinessLayer.GetvPrescriptionOrderDtLabelRSSESList(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND IsCompound = 0 AND ChargesIsDeleted = 0 AND TakenQty > 0", prescription.PrescriptionOrderID));

            vConsultVisit9 oVisit = BusinessLayer.GetvConsultVisit9List(String.Format("VisitID = {0}", prescription.VisitID.ToString())).FirstOrDefault();

            List<vPrescriptionOrderDtLabelRSSES> lstCompoundDetail = new List<vPrescriptionOrderDtLabelRSSES>();

            int MaxLine = 6;
            int totalRecord = lstprescription.Count;
            var totalPages = Math.Ceiling(Convert.ToDecimal(totalRecord) / Convert.ToDecimal(MaxLine));

            for (int j = 1; j <= totalPages; j++)
            {
                int skip = (j - 1) * MaxLine;
                StringBuilder sb = new StringBuilder();
                sb.Append("^XA");
                sb.Append("^LL800");
                sb.Append("^PW640");
                sb.Append("^LH10,10");
                sb.Append("^FO70,10^CF0,25^FB500,1,0,C^FD" + string.Format("{0}", oVisit.cfPatientNameSalutation) + "^FS");
                sb.Append("^CF0,23");
                sb.Append("^FO40,45^FD" + string.Format("{0}", prescription.ParamedicName) + "^FS");
                sb.Append("^FO40,70^FD" + string.Format("{0}", prescription.cfPrescriptionDate) + "^FS");
                sb.Append("^FO400,70^FD" + string.Format("{0}", oVisit.MedicalNo) + "^FS");
                sb.Append("^FO40,95^GB520,1,2^FS");
                sb.Append("^CF0,20");

                int row = 82;
                List<vPrescriptionOrderDtLabelRSSES> lstprescriptionPrint1 = lstprescription.OrderBy(p => p.IsCompound).Skip(skip).Take(MaxLine).ToList();
                foreach (vPrescriptionOrderDtLabelRSSES rowData in lstprescriptionPrint1)
                {

                    row += 25;

                    sb.Append("^FO40," + row + "^FD" + string.Format("{0}", rowData.cfMedicationName) + "^FS");
                    sb.Append("^FO320," + row + "^FD" + string.Format("{0}", rowData.TakenQty) + "^FS");
                    sb.Append("^FO390," + row + "^FD" + string.Format("{0}", rowData.cfConsumeMethod) + "^FS");


                    if (rowData.IsCompound == true && rowData.ParentID == 0)
                    {
                        row += 25;
                        sb.Append("^FS^FB500,15,0,L^FO40," + row + "^FD" + string.Format("{0}", rowData.cfCompoundDetailLabel) + "^FS");
                    }
                }


                sb.Append("^XZ");
                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                string printerUrl = printerUrl1;
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
                #endregion



            }

        }
        #endregion

        #region PrintLabelObat
        public static void PrintLabelObat(vPrescriptionOrderDt1 prescription, string printerUrl1)
        {
            List<vPrescriptionOrderDt1> lstprescription = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND ChargesIsDeleted = 0", prescription.PrescriptionOrderID));
            List<vPrescriptionOrderDt1> lstprescriptionPrint = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsRFlag = 1 AND IsCompound = 0 AND ChargesIsDeleted = 0 AND TakenQty > 0", prescription.PrescriptionOrderID));

            vConsultVisit9 oVisit = BusinessLayer.GetvConsultVisit9List(String.Format("VisitID = {0}", prescription.VisitID.ToString())).FirstOrDefault();

            List<vPrescriptionOrderDt1> lstCompoundDetail = new List<vPrescriptionOrderDt1>();
            foreach (vPrescriptionOrderDt1 item in lstprescription)
            {
                if (item.IsCompound)
                {
                    lstCompoundDetail.Add(item);
                }
            }
            if (lstCompoundDetail.Count > 0 && lstprescriptionPrint.Count == 0)
            {
                ZebraPrinting.PrintRacikanLabelObat(prescription, oVisit, printerUrl1);
            }
            else
            {
                StringBuilder sb = new StringBuilder();
                sb.Append("^XA");
                sb.Append("^LL800");
                sb.Append("^PW640");
                sb.Append("^LH10,10");
                sb.Append("^FO70,10^CF0,25^FB500,1,0,C^FD" + string.Format("{0}", oVisit.cfPatientNameSalutation) + "^FS");
                sb.Append("^CF0,23");
                sb.Append("^FO40,45^FD" + string.Format("{0}", prescription.ParamedicName) + "^FS");
                sb.Append("^FO40,70^FD" + string.Format("{0}", prescription.cfPrescriptionDate) + "^FS");
                sb.Append("^FO400,70^FD" + string.Format("{0}", oVisit.MedicalNo) + "^FS");
                sb.Append("^FO40,95^GB520,1,2^FS");
                sb.Append("^CF0,20");

                int row = 82;
                for (int i = 0; i < lstprescriptionPrint.Count; i++)
                {
                    row += 25;
                    sb.Append("^FO40," + row + "^FD" + string.Format("{0}", lstprescriptionPrint[i].cfMedicationName) + "^FS");
                    sb.Append("^FO320," + row + "^FD" + string.Format("{0}", lstprescriptionPrint[i].TakenQty) + "^FS");
                    sb.Append("^FO390," + row + "^FD" + string.Format("{0}", lstprescriptionPrint[i].cfConsumeMethod) + "^FS");
                }
                sb.Append("^XZ");

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                string printerUrl = printerUrl1;
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
                #endregion

                if (lstCompoundDetail.Count > 0)
                {
                    ZebraPrinting.PrintRacikanLabelObat(prescription, oVisit, printerUrl1);
                }
            }
        }
        #endregion

        #region PrintRacikanLabelObat
        public static void PrintRacikanLabelObat(vPrescriptionOrderDt1 prescription, vConsultVisit9 oVisit, string printerUrl1)
        {
            List<vPrescriptionOrderDt1> lstprescriptionCompound = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsCompound = 1 AND ParentID IS NULL AND takenQty > 0", prescription.PrescriptionOrderID));
            String ItemName = "";

            if (lstprescriptionCompound.Count >= 0)
            {
                foreach (vPrescriptionOrderDt1 k in lstprescriptionCompound)
                {
                    List<vPrescriptionOrderDt1> lstprescriptionCompoundDetail = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderDetailID = {0} OR ParentID = {1} AND takenQty > 0", k.PrescriptionOrderDetailID, k.PrescriptionOrderDetailID));

                    for (int i = 0; i < lstprescriptionCompoundDetail.Count; i++)
                    {
                        ItemName += lstprescriptionCompoundDetail[i].DrugName + " " + lstprescriptionCompoundDetail[i].CompoundQtyInString + ", ";
                    }

                    StringBuilder sb = new StringBuilder();
                    sb.Append("^XA");
                    sb.Append("^LL800");
                    sb.Append("^PW640");
                    sb.Append("^LH10,10");
                    sb.Append("^FO70,10^CF0,25^FB500,1,0,C^FD" + string.Format("{0}", oVisit.PatientName) + "^FS");
                    sb.Append("^CF0,23");
                    sb.Append("^FO40,45^FD" + string.Format("{0}", prescription.ParamedicName) + "^FS");
                    sb.Append("^FO40,70^FD" + string.Format("{0}", prescription.cfPrescriptionDate) + "^FS");
                    sb.Append("^FO400,70^FD" + string.Format("{0}", oVisit.MedicalNo) + "^FS");
                    sb.Append("^FO40,95^GB520,1,2^FS");
                    sb.Append("^FO40,105^FDKomposisi Racikan :^FS");
                    sb.Append("^FO290,105^FD" + string.Format("{0}", k.TakenQty) + "^FS");
                    sb.Append("^FO380,105^FD" + string.Format("{0}", k.cfConsumeMethod) + "^FS");
                    sb.Append("^CF0,20");
                    sb.Append("^FO40,150^FB550,8,^FD" + string.Format("{0}", ItemName) + "^FS");
                    sb.Append("^XZ");

                    #region Send Command to Printer
                    DirectPrinting printer = new DirectPrinting();
                    string printerUrl = printerUrl1;
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    ItemName = "";
                    #endregion
                }
            }
        }
        #endregion

        #region RSDOSOBA

        #region printLabelRadiologiRSDOSOBA
        public static void printLabelRadiologiRSDOSOBA(vLabelPatientRegistrationImagingRSDOSOBA charges, string printerUrl)
        {

            StringBuilder sb = new StringBuilder();
            string paramedic = charges.DokterRujukan;

            string line1 = string.Format("No. Trx");
            string line2 = string.Format("No. RM : {0}", charges.MedicalNo);
            string line3 = string.Format("Tgl Lahir");
            string line4 = string.Format("Nama");
            string line5 = string.Format("Alamat");
            string line6 = string.Format("Ruang");
            string line7 = string.Format("Kelas : {0}", charges.ClassName);
            string line8 = string.Format("Tgl Pemeriksaan");
            string line9 = string.Format("Jenis Pemeriksaan :");
            string line10 = string.Format("Dokter Pengirim");

            string line11 = string.Format(": {0}", charges.TransactionNo);
            string line12 = string.Format(": {0}", charges.DOB.ToString(Constant.FormatString.DATE_FORMAT));
            string line13 = string.Format(": {0}", charges.cfPatientName);
            string line14 = string.Format(": {0}", charges.StreetName);
            string line15 = string.Format(": {0}", charges.VisitServiceUnitName, charges.VisitRoomName, charges.VisitBedCode);

            string line16 = string.Format(": {0}", charges.cfTransactionDateInString);
            string line17 = string.Format("{0}", charges.ItemName);
            string line18 = string.Format(": {0}", paramedic);

            sb.Append("^XA");
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,30^FD" + line1 + "^FS"); //No. Trx
            sb.Append("^AQN,28,24");
            sb.Append("^FO480,30^FD" + line2 + "^FS"); //No. RM
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,120^FD" + line3 + "^FS"); //Tgl Lahir
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,60^FD" + line4 + "^FS"); //Nama
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,90^FD" + line5 + "^FS"); //Alamat
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,150^FD" + line6 + "^FS"); //Ruangan
            sb.Append("^AQN,28,24");
            sb.Append("^FO550,150^FD" + line7 + "^FS"); //Kelas

            sb.Append("^AQN,28,24");
            sb.Append("^FO150,30^FD" + line11 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO150,120^FD" + line12 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO150,60^FD" + line13 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO150,90^FD" + line14 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO150,150^FD" + line15 + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO30,180^FD" + line8 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,240^FD" + line9 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO30,210^FD" + line10 + "^FS");

            sb.Append("^CF0,20");
            sb.Append("^FO233,180^FD" + line16 + "^FS");
            sb.Append("^CF0,20");
            sb.Append("^FO60,270^FB680,7,^FD" + line17 + "^FS");
            sb.Append("^CF0,20");
            sb.Append("^FO233,210^FD" + line18 + "^FS");

            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();

            printer.OpenPrinter(printerUrl);
            printer.StartDocPrinter();
            printer.Send("\n");
            printer.Send("n\n");
            printer.Send(sb.ToString());
            printer.Send("p1\n");
            printer.EndDocPrinter();
            #endregion
        }
        #endregion

        #region PrintKwitansiPasien

        #region PrintKwitansiIndRSDOSOBA
        public static void PrintKwitansiIndRSDOSOBA(String PaymentReceiptID, string printerUrl)
        {
            String streetName = "";
            String itemName = "";

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                GetPaymentReceiptCustom oLabel = BusinessLayer.GetPaymentReceiptCustomList(Convert.ToInt32(PaymentReceiptID)).FirstOrDefault();
                PatientPaymentHd oPaymentHd = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0}", oLabel.PaymentReceiptID)).FirstOrDefault();
                PatientPaymentDt oPaymentDt = BusinessLayer.GetPatientPaymentDtList(string.Format("PaymentID = {0} AND GCPaymentMethod = 'X035^008'", oPaymentHd.PaymentID)).FirstOrDefault();
                List<GetPaymentReceiptCustom2> lstPayment = BusinessLayer.GetGetPaymentReceiptCustom2List(oLabel.PaymentReceiptID);
                GetPaymentReceiptCustom2 oPayment = BusinessLayer.GetGetPaymentReceiptCustom2List(Convert.ToInt32(oLabel.PaymentReceiptID)).FirstOrDefault();
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                var result = lstPayment.GroupBy(test => test.VisitServiceUnitName).Select(grp => grp.First()).ToList().OrderBy(x => x.VisitServiceUnitName);

                string printAsName = oLabel.PrintAsName;
                string patientName = oLabel.PatientName;
                string grandTotalTransaksi = oPayment.GroupingAmount.ToString("N2");
                string signName = oLabel.cfSignName;
                string line1 = string.Format(" Total Transaksi  :");
                string line2 = string.Format(" Diskon           :");
                string line6 = string.Format(" Voucher          :");
                string line3 = string.Format(" Dijamin          :");
                string line4 = string.Format(" Lain-lain        :");
                string line5 = string.Format("TOTAL AKHIR");
                int totalLine = 53;

                decimal totalTransaksi = lstPayment.Sum(t => t.GroupingAmount);
                decimal totalDiscount = lstPayment.Sum(t => t.GroupingDiscount);
                decimal totalVoucher = 0;

                if (oPaymentDt != null)
                {
                    if (oPaymentDt.GCPaymentMethod == "X035^008")
                    {
                        List<PatientPaymentDt> lstPaymentDt = BusinessLayer.GetPatientPaymentDtList(string.Format("PaymentID = {0}", oPaymentHd.PaymentID));                        
                        totalVoucher = lstPaymentDt.Where(t => t.GCPaymentMethod == "X035^008").Sum(t => t.PaymentAmount);;
                    }
                    else
                    {
                        totalVoucher = 0;
                    }
                }
                else
                {
                    totalVoucher = 0;
                }

                if (printAsName.Length > 35)
                {
                    printAsName = printAsName.Substring(0, 34);
                }

                if (patientName.Length > 20)
                {
                    patientName = patientName.Substring(0, 20);
                }

                if (signName.Length > 22)
                {
                    signName = signName.Substring(0, 22);
                }

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(39);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SetTittleFont("          KWITANSI");
                dotMatrix.Append("\n");
                dotMatrix.SetFont8cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Telah Terima Dari  : {0}", printAsName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Pasien             : ({0}) {1}", oLabel.MedicalNo, patientName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" KETERANGAN                                       NILAI"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                foreach (GetPaymentReceiptCustom2 group in result)
                {
                    List<GetPaymentReceiptCustom2> gr = lstPayment.Where(x => x.VisitServiceUnitName == group.VisitServiceUnitName).ToList();
                    foreach (GetPaymentReceiptCustom2 entity in gr)
                    {
                        if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                        {
                            string servName = entity.VisitServiceUnitName;
                            if (entity.VisitServiceUnitName.Length > 35)
                            {
                                servName = entity.VisitServiceUnitName.Substring(0, 35);
                            }
                            else
                            {
                                int count = 35 - servName.Length;
                                servName = AddChar(servName, count);
                            }

                            int totalLength = 53;

                            dotMatrix.Append(string.Format(" {0}\n", servName));
                            if (entity.GroupingAmount.ToString("N2") != "0.00" && entity.GroupingAmount.ToString("N2") != "0")
                            {
                                dotMatrix.Append(string.Format("  {0}{1}\n", entity.cfGroupingName.PadRight(totalLength - entity.GroupingAmount.ToString("N2").Length, ' '), entity.GroupingAmount.ToString("N2")));
                            }
                            else
                            {
                                dotMatrix.Append("");
                            }
                        }
                        else
                        {
                            int totalLength = 53;

                            if (entity.GroupingAmount.ToString("N2") != "0.00" && entity.GroupingAmount.ToString("N2") != "0")
                            {
                                dotMatrix.Append(string.Format("  {0}{1}\n", entity.cfGroupingName.PadRight(totalLength - entity.GroupingAmount.ToString("N2").Length, ' '), entity.GroupingAmount.ToString("N2")));
                            }
                            else
                            {
                                dotMatrix.Append("");
                            }
                        }
                    }
                }
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line1.PadRight(totalLine - totalTransaksi.ToString("N2").Length), totalTransaksi.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line2.PadRight(totalLine - totalDiscount.ToString("N2").Length), totalDiscount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line6.PadRight(totalLine - totalVoucher.ToString("N2").Length), totalVoucher.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line3.PadRight(totalLine - oPayment.PayerAmount.ToString("N2").Length), oPayment.PayerAmount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line4.PadRight(totalLine - oPayment.RoundingAmount.ToString("N2").Length), oPayment.RoundingAmount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line5.PadRight(totalLine - oLabel.ReceiptAmount.ToString("N2").Length), (oLabel.ReceiptAmount - totalVoucher).ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                string terbilang = Function.NumberInWords(Convert.ToInt32(oLabel.ReceiptAmount - totalVoucher), true);
                dotMatrix.Append(string.Format(" Terbilang : "));
                if (terbilang.Length > 43)
                {
                    int max = terbilang.Length - 43;
                    string t1 = terbilang.Substring(0, 43);
                    string t2 = terbilang.Substring(43, max);

                    if (t2.Length > 43)
                    {
                        t2 = t2.Substring(0, 43);
                    }
                    else
                    {
                        int count = 43 - t2.Length;
                        t2 = AddChar(t2, count);
                    }

                    dotMatrix.Append(string.Format(" {0}\n", t1));
                    dotMatrix.Append(string.Format("              {0}", t2));
                }
                else
                {
                    if (terbilang.Length > 43)
                    {
                        terbilang = terbilang.Substring(0, 43);
                    }
                    else
                    {
                        int count = 43 - terbilang.Length;
                        terbilang = AddChar(terbilang, count);
                    }

                    dotMatrix.Append(string.Format("{0}", terbilang));
                }
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Cetakan Ke = {0}                 {1}, {2}", oLabel.PrintNumber, entityH.City, oLabel.cfSignDateInString));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", oLabel.cfLastPrintedDateInString, oLabel.LastPrintedTime));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" *{0}\n", oLabel.RegistrationNo));
                dotMatrix.Append(string.Format(" #{0}\n", oLabel.PaymentMethod));
                dotMatrix.Append(string.Format("                                 {0}", signName));
                dotMatrix.FormFeed();
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();
                #endregion
            }
        }
        #endregion

        #region PrintKwitansiEngRSDOSOBA
        public static void PrintKwitansiEngRSDOSOBA(String PaymentReceiptID, string printerUrl)
        {
            String streetName = "";
            String itemName = "";

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                GetPaymentReceiptCustom oLabel = BusinessLayer.GetPaymentReceiptCustomList(Convert.ToInt32(PaymentReceiptID)).FirstOrDefault();
                PatientPaymentHd oPaymentHd = BusinessLayer.GetPatientPaymentHdList(string.Format("PaymentReceiptID = {0}", oLabel.PaymentReceiptID)).FirstOrDefault();
                PatientPaymentDt oPaymentDt = BusinessLayer.GetPatientPaymentDtList(string.Format("PaymentID = {0} AND GCPaymentMethod = 'X035^008'", oPaymentHd.PaymentID)).FirstOrDefault();
                List<GetPaymentReceiptCustom2> lstPayment = BusinessLayer.GetGetPaymentReceiptCustom2List(oLabel.PaymentReceiptID);
                GetPaymentReceiptCustom2 oPayment = BusinessLayer.GetGetPaymentReceiptCustom2List(Convert.ToInt32(oLabel.PaymentReceiptID)).FirstOrDefault();
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                var result = lstPayment.GroupBy(test => test.cfVisitServiceUnitName2).Select(grp => grp.First()).ToList().OrderBy(x => x.cfVisitServiceUnitName2);

                string printAsName = oLabel.PrintAsName;
                string patientName = oLabel.PatientName;
                string grandTotalTransaksi = oPayment.GroupingAmount.ToString("N2");
                string signName = oLabel.cfSignName;
                string line1 = string.Format(" Total Transaction  :");
                string line2 = string.Format(" Discount Amount    :");
                string line6 = string.Format(" Voucher Amount     :");
                string line3 = string.Format(" Coverage Amount    :");
                string line4 = string.Format(" Rounding           :");
                string line5 = string.Format("GRAND TOTAL");
                int totalLine = 53;

                decimal totalTransaksi = lstPayment.Sum(t => t.GroupingAmount);
                decimal totalDiscount = lstPayment.Sum(t => t.GroupingDiscount);
                decimal totalVoucher = 0;

                if (oPaymentDt != null)
                {
                    if (oPaymentDt.GCPaymentMethod == "X035^008")
                    {
                        List<PatientPaymentDt> lstPaymentDt = BusinessLayer.GetPatientPaymentDtList(string.Format("PaymentID = {0}", oPaymentHd.PaymentID));
                        totalVoucher = lstPaymentDt.Where(t => t.GCPaymentMethod == "X035^008").Sum(t => t.PaymentAmount);;
                    }
                    else
                    {
                        totalVoucher = 0;
                    }
                }
                else
                {
                    totalVoucher = 0;
                }

                if (printAsName.Length > 35)
                {
                    printAsName = printAsName.Substring(0, 34);
                }

                if (patientName.Length > 20)
                {
                    patientName = patientName.Substring(0, 20);
                }

                if (signName.Length > 22)
                {
                    signName = signName.Substring(0, 22);
                }

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(39);
                dotMatrix.SelectDraftMode();

                #region Print Healthcare Information
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SetTittleFont("        PAYMENT RECEIPT");
                dotMatrix.Append("\n");
                dotMatrix.SetFont8cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Received From      : {0}", printAsName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Patient            : ({0}) {1}", oLabel.MedicalNo, patientName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" NOTES                                           AMOUNT"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                foreach (GetPaymentReceiptCustom2 group in result)
                {
                    List<GetPaymentReceiptCustom2> gr = lstPayment.Where(x => x.cfVisitServiceUnitName2 == group.cfVisitServiceUnitName2).ToList();
                    foreach (GetPaymentReceiptCustom2 entity in gr)
                    {
                        if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                        {
                            string servName = entity.cfVisitServiceUnitName2;
                            if (entity.cfVisitServiceUnitName2.Length > 35)
                            {
                                servName = entity.cfVisitServiceUnitName2.Substring(0, 35);
                            }
                            else
                            {
                                int count = 35 - servName.Length;
                                servName = AddChar(servName, count);
                            }

                            int totalLength = 53;

                            dotMatrix.Append(string.Format(" {0}\n", servName));
                            if (entity.GroupingAmount.ToString("N2") != "0.00" && entity.GroupingAmount.ToString("N2") != "0")
                            {
                                dotMatrix.Append(string.Format("  {0}{1}\n", entity.cfGroupingName2.PadRight(totalLength - entity.GroupingAmount.ToString("N2").Length, ' '), entity.GroupingAmount.ToString("N2")));
                            }
                            else
                            {
                                dotMatrix.Append("");
                            }
                        }
                        else
                        {
                            int totalLength = 53;

                            if (entity.GroupingAmount.ToString("N2") != "0.00" && entity.GroupingAmount.ToString("N2") != "0")
                            {
                                dotMatrix.Append(string.Format("  {0}{1}\n", entity.cfGroupingName2.PadRight(totalLength - entity.GroupingAmount.ToString("N2").Length, ' '), entity.GroupingAmount.ToString("N2")));
                            }
                            else
                            {
                                dotMatrix.Append("");
                            }
                        }
                    }
                }
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line1.PadRight(totalLine - totalTransaksi.ToString("N2").Length), totalTransaksi.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line2.PadRight(totalLine - totalDiscount.ToString("N2").Length), totalDiscount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line6.PadRight(totalLine - totalVoucher.ToString("N2").Length), totalVoucher.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line3.PadRight(totalLine - oPayment.PayerAmount.ToString("N2").Length), oPayment.PayerAmount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line4.PadRight(totalLine - oPayment.RoundingAmount.ToString("N2").Length), oPayment.RoundingAmount.ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", line5.PadRight(totalLine - oLabel.ReceiptAmount.ToString("N2").Length), (oLabel.ReceiptAmount - totalVoucher).ToString("N2")));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" -------------------------------------------------------"));
                dotMatrix.Append("\n");
                string terbilang = Function.NumberInWordsInEnglish(Convert.ToInt32(oLabel.ReceiptAmount - totalVoucher), true);
                dotMatrix.Append(string.Format(" Amount in word : "));
                if (terbilang.Length > 38)
                {
                    int max = terbilang.Length - 38;
                    string t1 = terbilang.Substring(0, 38);
                    string t2 = terbilang.Substring(38, max);

                    if (t2.Length > 38)
                    {
                        t2 = t2.Substring(0, 38);
                    }
                    else
                    {
                        int count = 38 - t2.Length;
                        t2 = AddChar(t2, count);
                    }

                    dotMatrix.Append(string.Format(" {0}\n", t1));
                    dotMatrix.Append(string.Format("              {0}", t2));
                }
                else
                {
                    if (terbilang.Length > 38)
                    {
                        terbilang = terbilang.Substring(0, 38);
                    }
                    else
                    {
                        int count = 38 - terbilang.Length;
                        terbilang = AddChar(terbilang, count);
                    }

                    dotMatrix.Append(string.Format("{0}", terbilang));
                }
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Print No. {0}                 {1}, {2}", oLabel.PrintNumber, entityH.City, oLabel.cfSignDateInString));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0} {1}", oLabel.cfLastPrintedDateInString, oLabel.LastPrintedTime));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" *{0}\n", oLabel.RegistrationNo));
                dotMatrix.Append(string.Format(" #{0}\n", oLabel.PaymentMethod));
                dotMatrix.Append(string.Format("                                 {0}", signName));
                dotMatrix.FormFeed();
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();
                #endregion
            }
        }
        #endregion

        #endregion

        #endregion

        #region RSUKRIDA

        #region printLabelRadiologiRSUKRIDA
        public static void printLabelRadiologiRSUKRIDA(vLabelPatientRegistrationImagingRSUKRIDA charges, string printerUrl)
        {

            StringBuilder sb = new StringBuilder();

            string line2 = string.Format("No. RM");
            string line3 = string.Format("Nama");
            string line4 = string.Format("Tgl Lahir");
            string line5 = string.Format("Jenis Pemeriksaan");
            string line6 = string.Format("No. Foto");
            string line7 = string.Format("Tgl Pemeriksaan");
            string line8 = string.Format("Dokter Pengirim");
            string line9 = string.Format("Asal Pasien");

            string filterExpression = string.Format("TransactionID = {0}", charges.TransactionID.ToString());
            List<vLabelPatientRegistrationImagingRSUKRIDA> lstDetail = BusinessLayer.GetvLabelPatientRegistrationImagingRSUKRIDAList(filterExpression);
            foreach (vLabelPatientRegistrationImagingRSUKRIDA item in lstDetail)
            {
                sb.Append("^XA");
                sb.Append("^LL210");
                sb.Append("^PW600");
                sb.Append("^LH2,1^MD10");
                sb.Append("^CF024,24");
                sb.Append("^FO2,21^FDRADIOLOGI RS UKRIDA^FS");

                sb.Append("^CF024,24");
                sb.Append("^FO330,21^FD" + line2 + "^FS"); //No. RM
                sb.Append("^FO410,21^FD:^FS");
                sb.Append("^FO420,21^FD" + item.MedicalNo + "^FS");

                sb.Append("^CF022,22");
                sb.Append("^FO3,55^FD" + line3 + "^FS"); //Nama
                sb.Append("^FO170,55^FD:^FS");
                sb.Append("^FO180,55^FD" + string.Format("{0} ({1})", item.PatientName, item.cfGenderInitial) + "^FS");

                sb.Append("^CF022,22");
                sb.Append("^FO3,80^FD" + line4 + "^FS"); //Tgl Lahir
                sb.Append("^FO170,80^FD:^FS");
                sb.Append("^FO180,80^FD" + string.Format("{0} / {1} Tahun", item.DateOfBirthInString, item.AgeInYear) + "^FS");

                string ItemName = item.ItemName;
                if (ItemName.Length > 35)
                {
                    sb.Append("^CF022,22");
                    sb.Append("^FO3,105^FD" + line5 + "^FS"); //Jenis Pemeriksaan
                    sb.Append("^FO170,105^FD:^FS");
                    sb.Append("^FO180,105^FB430,7,^FD" + item.ItemName + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,155^FD" + line6 + "^FS"); //No. Foto
                    sb.Append("^FO170,155^FD:^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,180^FD" + line7 + "^FS"); //Tgl Pemeriksaan
                    sb.Append("^FO170,180^FD:^FS");
                    sb.Append("^FO180,180^FD" + item.cfTransactionDateInString + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,205^FD" + line8 + "^FS"); //Dokter Pengirim
                    sb.Append("^FO170,205^FD:^FS");
                    sb.Append("^FO180,205^FD" + item.DokterRujukan + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,230^FD" + line9 + "^FS"); //Asal Pasien
                    sb.Append("^FO170,230^FD:^FS");
                    sb.Append("^FO180,230^FD" + item.VisitServiceUnitName + "^FS");
                    sb.Append("^BY1,1,50");
                    sb.Append("^FO420,170^BC^FD" + item.MedicalNo + "^FS");
                    sb.Append("^PR2");
                    sb.Append("^XZ");
                }
                else
                {
                    sb.Append("^CF022,22");
                    sb.Append("^FO3,105^FD" + line5 + "^FS"); //Jenis Pemeriksaan
                    sb.Append("^FO170,105^FD:^FS");
                    sb.Append("^FO180,105^FD" + item.ItemName + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,130^FD" + line6 + "^FS"); //No. Foto
                    sb.Append("^FO170,130^FD:^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,155^FD" + line7 + "^FS"); //Tgl Pemeriksaan
                    sb.Append("^FO170,155^FD:^FS");
                    sb.Append("^FO180,155^FD" + item.cfTransactionDateInString + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,180^FD" + line8 + "^FS"); //Dokter Pengirim
                    sb.Append("^FO170,180^FD:^FS");
                    sb.Append("^FO180,180^FD" + item.DokterRujukan + "^FS");

                    sb.Append("^CF022,22");
                    sb.Append("^FO3,205^FD" + line9 + "^FS"); //Asal Pasien
                    sb.Append("^FO170,205^FD:^FS");
                    sb.Append("^FO180,205^FD" + item.VisitServiceUnitName + "^FS");
                    sb.Append("^BY1,1,50");
                    sb.Append("^FO420,170^BC^FD" + item.MedicalNo + "^FS");
                    sb.Append("^PR2");
                    sb.Append("^XZ");
                }
                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #endregion

        #region RSRA

        #region printLabelRadiologiRSRA
        public static void printLabelRadiologiRSRA(vLabelPatientRegistrationImagingRSRA charges, string printerUrl)
        {

            StringBuilder sb = new StringBuilder();

            string line1 = string.Format("No. RM");
            string line2 = string.Format("Nama");
            string line3 = string.Format("Umur");
            string line4 = string.Format("Ruang");
            string line5 = string.Format("No. Reg");
            string line6 = string.Format("Dr. Pengirim");
            string line7 = string.Format("Tgl Pemeriksaan");
            string line8 = string.Format("Jenis Pemeriksaan");

            string medicalNo = string.Format(": {0}", charges.MedicalNo);
            string patientName = string.Format(": {0}", charges.cfPatientNameInLabel);
            string patientAge = string.Format(": {0}", charges.cfPatientAgeInYear);
            string visitServiceUnit = string.Format(": {0}", charges.cfVisitServiceUnit);
            string registrationNo = string.Format(": {0}", charges.RegistrationNo);
            string dokterRujukan = string.Format(": {0}", charges.DokterRujukan);
            string transactionDate = string.Format(": {0}", charges.cfTransactionDateInString);
            string itemName = string.Empty;
            itemName = charges.ItemName.Replace(" | ", @"\&");

            sb.Append("^XA");
            sb.Append("^LL400");
            sb.Append("^PW640");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,30^FD" + line1 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO175,30^FD" + medicalNo + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,60^FD" + line2 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO175,60^FD" + patientName + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,90^FD" + line3 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO175,90^FD" + patientAge + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,120^FD" + line4 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO175,120^FD" + visitServiceUnit + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,150^FD" + line5 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO175,150^FD" + registrationNo + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,180^FD" + line6 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO215,180^FD" + dokterRujukan + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,210^FD" + line7 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO265,210^FD" + transactionDate + "^FS");

            sb.Append("^AQN,28,24");
            sb.Append("^FO90,240^FD" + line8 + "^FS");
            sb.Append("^AQN,28,24");
            sb.Append("^FO265,240^FD" + ":" + "^FS");

            sb.Append("^CF0,20");
            sb.Append("^FO105,270^FB430,7,^FD" + itemName + "^FS");

            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();

            printer.OpenPrinter(printerUrl);
            printer.StartDocPrinter();
            printer.Send("\n");
            printer.Send("n\n");
            printer.Send(sb.ToString());
            printer.Send("p1\n");
            printer.EndDocPrinter();
            #endregion
        }
        #endregion

        #region Tracer RM
        /// <summary>
        /// Cetak Tracer dengan Printer Struk Epson (Dot Matriks) : RSRA
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintTracerRMRSRA(vConsultVisit oVisit, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit.RegistrationID)).FirstOrDefault();

                string line1 = string.Format(" No Kunjungan   : {0}       {1}", reg.RegistrationNo, reg.cfRegistrationDateInString);
                string line2 = string.Format(" No MR          : {0}", oVisit.MedicalNo);
                string line3 = string.Format(" Nama Pasien    : {0}", oVisit.PatientName);
                string line4 = string.Format(" Penjamin       : {0}", oVisit.BusinessPartnerName);
                string line5 = string.Format(" Status Pasien  : {0}", oVisit.IsNewPasien);
                string line6 = string.Format(" Unit Pelayanan : {0}", oVisit.ServiceUnitName);
                string line7 = string.Format(" {0}", oVisit.ParamedicName);
                string line8 = string.Format(" No Antrian     : {0}", oVisit.cfQueueNo2);

                if (line1.Length > 60)
                {
                    line1 = line1.Substring(0, 60);
                }

                if (line2.Length > 60)
                {
                    line2 = line2.Substring(0, 60);
                }

                if (line3.Length > 60)
                {
                    line3 = line3.Substring(0, 60);
                }

                if (line4.Length > 60)
                {
                    line4 = line4.Substring(0, 60);
                }


                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(39);
                dotMatrix.SelectDraftMode();
                #region Print Detail
                dotMatrix.SelectSansSerifFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.SetTittleFont(string.Format("{0}", oHealthcare.HealthcareName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}", oHealthcare.StreetName));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("{0}", oHealthcare.City));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(line1);
                dotMatrix.Append("\n");
                dotMatrix.Append(line2);
                dotMatrix.Append("\n");
                dotMatrix.Append(line3);
                dotMatrix.Append("\n");
                dotMatrix.Append(line4);
                dotMatrix.Append("\n");
                dotMatrix.Append(line5);
                dotMatrix.Append("\n");
                dotMatrix.Append(line8);
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" Jasa Pelayanan                            Harga"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" _______________________________________________________"));
                dotMatrix.Append("\n");
                dotMatrix.Append(line6);
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" 1. Administrasi                   ....................."));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" 2. Konsul Dokter                  ....................."));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" 3. ..................             ....................."));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("    [] Laboratorium"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("    [] Radiologi"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("    [] Farmasi"));
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format("    Dokter"));
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(line7);
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append(string.Format(" {0}", DateTime.Now.ToString("dd-MMM-yyyy/HH:mm:ss")));
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 6; i++)
                {
                    dotMatrix.Append("\n");
                }

                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();
                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        #endregion

        #endregion

        #region RSSM

        #region printLabelRadiologiRSSM
        public static void printLabelRadiologiRSSM(vLabelPatientRegistrationImagingRSSM charges, string printerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string paramedic = charges.DokterRujukan;

            string line1 = string.Format("TANGGAL");
            string line3 = string.Format("NAMA");
            string line5 = string.Format("TGL LAHIR");
            string line7 = string.Format("PENGIRIM");
            string line8 = string.Format("NO RM");
            string line9 = string.Format("PEMERIKSAAN");

            string filterExpression = string.Format("TransactionID = {0}", charges.TransactionID.ToString());
            List<vLabelPatientRegistrationImagingRSSM> lstDetail = BusinessLayer.GetvLabelPatientRegistrationImagingRSSMList(filterExpression);
            foreach (vLabelPatientRegistrationImagingRSSM item in lstDetail)
            {
                sb.Append("^XA");
                sb.Append("^CF028,28");
                sb.Append("^FO150,30^FD" + line1 + "^FS"); //TANGGAL
                sb.Append("^FO280,30^FD:^FS");
                sb.Append("^FO295,30^FD" + item.cfTransactionDateInString + "^FS"); //cfTransactionDateInString

                sb.Append("^FO150,70^FD" + line8 + "^FS"); //NO RM
                sb.Append("^FO280,70^FD:^FS");
                sb.Append("^FO295,70^FD" + item.MedicalNo + "^FS"); //MedicalNo

                sb.Append("^FO150,110^FD" + line3 + "^FS"); //NAMA
                sb.Append("^FO280,110^FD:^FS");
                sb.Append("^FO295,110^FD" + item.PatientName + "^FS"); //PatientName

                sb.Append("^FO150,150^FD" + line5 + "^FS"); //TGL LAHIR
                sb.Append("^FO280,150^FD:^FS");
                sb.Append("^FO295,150^FD" + item.DateOfBirthInString + "^FS"); //DOB

                sb.Append("^FO150,190^FD" + line7 + "^FS"); //PENGIRIM
                sb.Append("^FO280,190^FD:^FS");
                sb.Append("^FO295,190^FD" + item.DokterRujukan + "^FS"); //paramedic

                sb.Append("^FO150,230^FD" + line9 + "^FS"); //PEMERIKSAAN
                sb.Append("^FO330,230^FD:^FS");
                sb.Append("^FO150,270^FB600,50,0,L^FD" + item.ItemName + "^FS"); //AlternateItemName
                sb.Append("^XZ");

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #endregion

        #region RSSES
        #region Print Bukti Transaksi
        public static void PrintBuktiTransaksi(int TransactionID, string printerUrl)
        {

            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";
            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                vPatientChargesHd oHeader = BusinessLayer.GetvPatientChargesHdList(string.Format("TransactionID = {0} ", TransactionID)).FirstOrDefault();
                List<vPatientChargesDt> lstTransaction = BusinessLayer.GetvPatientChargesDtList(string.Format("TransactionID = {0} AND IsDeleted = 0", TransactionID));
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();

                string specimenDeliveryBy = string.Empty;
                string specimenDeliveryDate = string.Empty;
                string specimenDeliveryTime = string.Empty;

                string TransactionNo = oHeader.TransactionNo;
                string TransactionDate = oHeader.TransactionDateInString;
                string createdby = oHeader.CreatedByName;

                #region Print Healthcare Information
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("{0}", "BUKTI TRANSAKSI"));
                sb.AppendLine(string.Format("{0}", "Rumah Sakit St. Elisabeth"));
                sb.AppendLine(string.Format("{0}", entityH.City));
                sb.AppendLine(string.Format("{0}", entityH.PhoneNo1));
                #region Registration No Barcode
                sb.AppendLine("");
                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeValues = "\x1d\x48\x32";
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oHeader.TransactionNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                sb.Append(ESC + "a0");
                #endregion

                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Reg          : {0}", oHeader.RegistrationNo));
                sb.AppendLine(string.Format("No. RM           : {0}", oHeader.MedicalNo));
                sb.AppendLine(string.Format("Pasien           : {0}", oHeader.PatientName));
                sb.AppendLine(string.Format("Jaminan          : {0}", oHeader.BusinessPartnerName));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Transaksi     : {0}", TransactionNo));
                sb.AppendLine(string.Format("Tgl Transaksi     : {0}", TransactionDate));
                sb.AppendLine(string.Format("------------------------------------------"));

                #region Test Order Detail
                foreach (vPatientChargesDt item in lstTransaction)
                {
                    string itemName = string.Format("{0}", item.ItemName1);
                    sb.AppendLine(string.Format("- {0} @{1}", itemName, item.ChargedQuantity));
                }
                sb.AppendLine(string.Format(""));
                #endregion
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format(""));

                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("Order Dientry Oleh :"));
                sb.AppendLine(string.Format("{0}", createdby));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                #endregion

                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }
                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;
                sb.AppendLine(command);

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion
        #region Print Bukti Order

        public static void PrintBuktiOrderRSSES(int TransactionID, string printerUrl)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";
            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                vTestOrderHdVisit oHeader = BusinessLayer.GetvTestOrderHdVisitList(string.Format("TestOrderID = {0}", TransactionID)).FirstOrDefault();
                List<vTestOrderDt> lstOrderDt = BusinessLayer.GetvTestOrderDtList(string.Format("TestOrderID = {0} AND IsDeleted = 0", oHeader.TestOrderID, Constant.TransactionStatus.VOID));
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();

                string specimenDeliveryBy = string.Empty;
                string specimenDeliveryDate = string.Empty;
                string specimenDeliveryTime = string.Empty;

                if (oHeader.SpecimenDeliveryDate.Year != 1900)
                {
                    specimenDeliveryDate = oHeader.SpecimenDeliveryDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT);
                    specimenDeliveryTime = oHeader.SpecimenDeliveryTime;
                    specimenDeliveryBy = oHeader.SpecimenDeliveryByName;
                }


                #region Print Healthcare Information
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("{0}", "Rumah Sakit St. Elisabeth"));
                sb.AppendLine(string.Format("{0}", entityH.City));
                sb.AppendLine(string.Format("{0}", entityH.PhoneNo1));
                #region Registration No Barcode
                sb.AppendLine("");
                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeValues = "\x1d\x48\x32";
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oHeader.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                sb.Append(ESC + "a0");
                #endregion

                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Reg          : {0}", oHeader.RegistrationNo));
                sb.AppendLine(string.Format("No. RM, Tgl Lahir: {0},{1}", oHeader.MedicalNo, oHeader.DateOfBirthInString));
                sb.AppendLine(string.Format("Pasien           : {0}", oHeader.PatientName));
                sb.AppendLine(string.Format("Lokasi Pasien    : {0} {1}", oHeader.ServiceUnitName, oHeader.BedCode));
                sb.AppendLine(string.Format("Jaminan          : {0}", oHeader.BusinessPartnerName));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Order     : {0}", oHeader.TestOrderNo));
                sb.AppendLine(string.Format("Tgl/Jam Order : {0}", oHeader.TestOrderDateTimeInString));
                sb.AppendLine(string.Format("Layanan       : {0}", oHeader.ToServiceUnitName));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("Catatan Klinis   : {0}", oHeader.Remarks));
                sb.AppendLine(string.Format("Pemeriksaan      : "));

                #region Test Order Detail
                foreach (vTestOrderDt item in lstOrderDt)
                {
                    string itemName = string.Format("{0}", item.ItemName1);
                    sb.AppendLine(string.Format("- {0}", itemName));
                }
                sb.AppendLine(string.Format(""));
                #endregion
                sb.AppendLine(string.Format("------------------------------------------"));

                if (oHeader.HealthcareServiceUnitID == Convert.ToInt32(AppSession.LaboratoryServiceUnitID))
                {
                    //Order Pemeriksaan Laboratorium : Lengkapi dengan informasi sample
                    sb.AppendLine(string.Format("Tanggal Pengambilan Sampel : {0}", oHeader.SpecimenTakenDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    sb.AppendLine(string.Format("Jam Pengambilan Sampel     : {0}", oHeader.SpecimenTakenTime, oHeader.SpecimenTakenByName));
                    sb.AppendLine(string.Format("Diambil oleh               : {0}", oHeader.SpecimenTakenByName));
                    sb.AppendLine(string.Format(""));
                    List<vTestOrderSpecimen> lstOrderSpecimen = BusinessLayer.GetvTestOrderSpecimenList(string.Format("TestOrderID = {0} AND IsDeleted = 0", oHeader.TestOrderID));
                    foreach (vTestOrderSpecimen specimen in lstOrderSpecimen)
                    {
                        sb.AppendLine(string.Format("- {0}, Jumlah : {1} ({2})", specimen.SpecimenName, specimen.cfQuantity, specimen.SpecimenContainerType));
                    }
                }
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Tanggal Pengiriman Sampel     : {0}", specimenDeliveryDate));
                sb.AppendLine(string.Format("Jam Pengiriman Sampel         : {0}", specimenDeliveryTime));
                sb.AppendLine(string.Format("Dikirim oleh                  : {0}", specimenDeliveryBy));
                sb.AppendLine(string.Format("Tanggal Penerimaan Sampel     : "));
                sb.AppendLine(string.Format("Jam Penerimaan Sampel         : "));
                sb.AppendLine(string.Format("Diterima oleh                 : "));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Kondisi Sampel : "));
                sb.AppendLine(string.Format("--------------   "));
                sb.AppendLine(string.Format("[ ] Baik / Tidak Bocor   "));
                sb.AppendLine(string.Format("[ ] Tidak,       karena [ ] Lisis"));
                sb.AppendLine(string.Format("                        [ ] Bekuan"));
                sb.AppendLine(string.Format("                        [ ] Listerik"));
                sb.AppendLine(string.Format("                        [ ] Lipemik"));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("Order Dientry Oleh :"));
                sb.AppendLine(string.Format("{0}", oHeader.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                #endregion

                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }
                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;
                sb.AppendLine(command);

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion
        #region Print Bukti Order Lab

        public static void PrintBuktiOrderLabRSSES(int TransactionID, string printerUrl)
        {
            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";
            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                vTestOrderHdVisit oHeader = BusinessLayer.GetvTestOrderHdVisitList(string.Format("TestOrderID = {0}", TransactionID)).FirstOrDefault();
                List<vTestOrderDt> lstOrderDt = BusinessLayer.GetvTestOrderDtList(string.Format("TestOrderID = {0} AND IsDeleted = 0 AND GCTestOrderStatus = 'X126^003'", oHeader.TestOrderID, Constant.TransactionStatus.VOID));
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();

                string specimenDeliveryBy = string.Empty;
                string specimenDeliveryDate = string.Empty;
                string specimenDeliveryTime = string.Empty;

                if (oHeader.SpecimenDeliveryDate.Year != 1900)
                {
                    specimenDeliveryDate = oHeader.SpecimenDeliveryDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT);
                    specimenDeliveryTime = oHeader.SpecimenDeliveryTime;
                    specimenDeliveryBy = oHeader.SpecimenDeliveryByName;
                }


                #region Print Healthcare Information
                sb.Append(ESC + "a1");
                sb.AppendLine(string.Format("{0}", "Rumah Sakit St. Elisabeth"));
                sb.AppendLine(string.Format("{0}", entityH.City));
                sb.AppendLine(string.Format("{0}", entityH.PhoneNo1));
                #region Registration No Barcode
                sb.AppendLine("");
                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeValues = "\x1d\x48\x32";
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oHeader.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                sb.Append(ESC + "a0");
                #endregion

                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Reg          : {0}", oHeader.RegistrationNo));
                sb.AppendLine(string.Format("No. RM, Tgl Lahir: {0},{1}", oHeader.MedicalNo, oHeader.DateOfBirthInString));
                sb.AppendLine(string.Format("Pasien           : {0}", oHeader.PatientName));
                sb.AppendLine(string.Format("Lokasi Pasien    : {0} {1}", oHeader.ServiceUnitName, oHeader.BedCode));
                sb.AppendLine(string.Format("Jaminan          : {0}", oHeader.BusinessPartnerName));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("No. Order     : {0}", oHeader.TestOrderNo));
                sb.AppendLine(string.Format("Tgl/Jam Order : {0}", oHeader.TestOrderDateTimeInString));
                sb.AppendLine(string.Format("Layanan       : {0}", oHeader.ToServiceUnitName));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("Catatan Klinis   : {0}", oHeader.Remarks));
                sb.AppendLine(string.Format("Pemeriksaan      : "));

                #region Test Order Detail
                foreach (vTestOrderDt item in lstOrderDt)
                {
                    string itemName = string.Format("{0}", item.ItemName1);
                    sb.AppendLine(string.Format("- {0}", itemName));
                }
                sb.AppendLine(string.Format(""));
                #endregion
                sb.AppendLine(string.Format("------------------------------------------"));

                if (oHeader.HealthcareServiceUnitID == Convert.ToInt32(AppSession.LaboratoryServiceUnitID))
                {
                    //Order Pemeriksaan Laboratorium : Lengkapi dengan informasi sample
                    sb.AppendLine(string.Format("Tanggal Pengambilan Sampel : {0}", oHeader.SpecimenTakenDate.ToString(Constant.FormatString.DATE_PICKER_FORMAT)));
                    sb.AppendLine(string.Format("Jam Pengambilan Sampel     : {0}", oHeader.SpecimenTakenTime, oHeader.SpecimenTakenByName));
                    sb.AppendLine(string.Format("Diambil oleh               : {0}", oHeader.SpecimenTakenByName));
                    sb.AppendLine(string.Format(""));
                    List<vTestOrderSpecimen> lstOrderSpecimen = BusinessLayer.GetvTestOrderSpecimenList(string.Format("TestOrderID = {0} AND IsDeleted = 0", oHeader.TestOrderID));
                    foreach (vTestOrderSpecimen specimen in lstOrderSpecimen)
                    {
                        sb.AppendLine(string.Format("- {0}, Jumlah : {1} ({2})", specimen.SpecimenName, specimen.cfQuantity, specimen.SpecimenContainerType));
                    }
                }
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Tanggal Pengiriman Sampel     : {0}", specimenDeliveryDate));
                sb.AppendLine(string.Format("Jam Pengiriman Sampel         : {0}", specimenDeliveryTime));
                sb.AppendLine(string.Format("Dikirim oleh                  : {0}", specimenDeliveryBy));
                sb.AppendLine(string.Format("Tanggal Penerimaan Sampel     : "));
                sb.AppendLine(string.Format("Jam Penerimaan Sampel         : "));
                sb.AppendLine(string.Format("Diterima oleh                 : "));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Kondisi Sampel : "));
                sb.AppendLine(string.Format("--------------   "));
                sb.AppendLine(string.Format("[ ] Baik / Tidak Bocor   "));
                sb.AppendLine(string.Format("[ ] Tidak,       karena [ ] Lisis"));
                sb.AppendLine(string.Format("                        [ ] Bekuan"));
                sb.AppendLine(string.Format("                        [ ] Listerik"));
                sb.AppendLine(string.Format("                        [ ] Lipemik"));
                sb.AppendLine(string.Format("------------------------------------------"));
                sb.AppendLine(string.Format("Order Dientry Oleh :"));
                sb.AppendLine(string.Format("{0}", oHeader.CreatedBy));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                #endregion

                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }
                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;
                sb.AppendLine(command);

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion

        #endregion

        #region RSUKI

        #region PrintBuktiTransaksiFarmasi
        public static void PrintBuktiTransaksiFarmasi(int TransactionID, string printerUrl)
        {
            String streetName = "";

            const char NUL = '\x00';    // NUL 
            const char LF = '\x0A';     //LINE FEED
            const char ESC = '\x1B';    // ESCAPE
            const char FS = '\x1c';
            const char GS = '\x1D';     //GROUP SPARATOR
            const string GSs = "\u001D";

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();
                List<string> lstHeader = new List<string>();
                List<string> lstDetail = new List<string>();
                List<string> lstFooter = new List<string>();

                StringBuilder sb = new StringBuilder();
                vPatientChargesDt oLabel = BusinessLayer.GetvPatientChargesDtList(string.Format("TransactionID = {0} AND IsDeleted = 0", TransactionID)).FirstOrDefault();
                List<vPatientChargesDt> lstCharges = BusinessLayer.GetvPatientChargesDtList(string.Format("TransactionID = {0} AND IsDeleted = 0 AND GCTransactionDetailStatus != '{1}'", oLabel.TransactionID, Constant.TransactionStatus.VOID));
                vConsultVisit entityVisit = BusinessLayer.GetvConsultVisitList(string.Format("VisitID = {0}", oLabel.VisitID)).FirstOrDefault();
                vHealthcare entityH = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();

                var result = lstCharges.GroupBy(test => test.GCItemType).Select(grp => grp.First()).ToList().OrderBy(x => x.VisitServiceUnitName);

                string patientName = oLabel.PatientName;
                string itemName = oLabel.ItemName1;
                string grandTotalTransaksi = oLabel.LineAmount.ToString("N2");
                string signName = oLabel.CreatedByUserName;
                int totalLine = 40;

                decimal totalTransaksi = lstCharges.Sum(t => t.LineAmount);

                if (patientName.Length > 20)
                {
                    patientName = patientName.Substring(0, 20);
                }

                if (itemName.Length > 20)
                {
                    itemName = itemName.Substring(0, 20);
                }

                if (signName.Length > 22)
                {
                    signName = signName.Substring(0, 22);
                }

                #region Print Healthcare Information
                sb.AppendLine(string.Format("{0}", entityH.HealthcareName));
                sb.AppendLine(string.Format("{0}", entityH.City));
                sb.AppendLine(string.Format("{0}", entityH.PhoneNo1));
                sb.AppendLine(string.Format("----------------------------------------"));
                sb.AppendLine(string.Format("No. Trx : {0}", oLabel.TransactionNo));
                sb.AppendLine(string.Format("No. Reg : {0}", oLabel.RegistrationNo));
                sb.AppendLine(string.Format("No. RM  : {0}", oLabel.MedicalNo));
                sb.AppendLine(string.Format("Pasien  : {0}", oLabel.PatientName));
                sb.AppendLine(string.Format("Tgl/Jam : {0} {1}", oLabel.TransactionDateInString, oLabel.TransactionTime));
                sb.AppendLine(string.Format("Layanan : {0}", oLabel.VisitServiceUnitName));
                sb.AppendLine(string.Format("Jaminan : {0}", entityVisit.BusinessPartnerName));
                sb.AppendLine(string.Format("----------------------------------------"));
                foreach (vPatientChargesDt group in result)
                {
                    List<vPatientChargesDt> gr = lstCharges.Where(x => x.GCItemType == group.GCItemType).ToList();
                    foreach (vPatientChargesDt entity in gr)
                    {
                        if (entity == gr.FirstOrDefault() && gr.Count() > 1)
                        {
                            string itemType = entity.ItemType;
                            if (entity.ItemType.Length > 35)
                            {
                                itemType = entity.ItemType.Substring(0, 35);
                            }
                            else
                            {
                                int count = 35 - itemType.Length;
                                itemType = AddChar(itemType, count);
                            }

                            sb.AppendLine(string.Format("{0}", itemType));
                        }

                        string itemName1 = entity.ItemName1;
                        if (entity.ItemName1.Length > 20)
                        {
                            itemName1 = entity.ItemName1.Substring(0, 20);
                        }
                        else
                        {
                            int count = 20 - itemName1.Length;
                            itemName1 = AddChar(itemName1, count);
                        }

                        string itemUnit = entity.ItemUnit;
                        if (entity.ItemUnit.Length > 3)
                        {
                            itemUnit = entity.ItemUnit.Substring(0, 3);
                        }
                        else
                        {
                            int count = 3 - itemUnit.Length;
                            itemUnit = AddChar(itemUnit, count);
                        }
                        string tes = string.Format("{0}   {1} {2}", itemName1, entity.ChargedQuantity.ToString("").Replace(".00", string.Empty), itemUnit);
                        sb.AppendLine(string.Format("{0} {1}", tes.PadRight(totalLine - entity.LineAmount.ToString("N2").Length), entity.LineAmount));
                    }
                }
                sb.AppendLine(string.Format("----------------------------------------"));
                string tes1 = string.Format("           GRAND TOTAL    : ");
                sb.AppendLine(string.Format("{0} {1}", tes1.PadRight(totalLine - totalTransaksi.ToString("N2").Length), totalTransaksi));
                sb.AppendLine(string.Format("----------------------------------------"));
                sb.AppendLine(string.Format("PETUGAS FARMASI APOTEK."));
                sb.AppendLine(string.Format("{0}", oLabel.CreatedByFullName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                #endregion

                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }
                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;
                sb.AppendLine(command);

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }
        #endregion

        #endregion

        #region RSBL

        #region PrintSlipAntrianRawatJalan
        public static void PrintSlipAntrianRawatJalan(vConsultVisit9 oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";

                string fontDoubleHeightBold = "\x1b\x21\x30";

                string ESC1 = Convert.ToString((char)27);
                string GS1 = Convert.ToString((char)29);
                string center = ESC1 + "a" + (char)1; //align center
                string initp = ESC1 + (char)64; //initialize printer

                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";


                #region Print Detail
                sb.Append(ESC + "a0"); //left
                sb.AppendLine(string.Format("{0}", oHealthcare.HealthcareName));
                sb.AppendLine(string.Format("{0}", oHealthcare.StreetName));
                sb.AppendLine("-----------------------------------------------");
                sb.Append(ESC + "a1"); //center
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("SLIP ANTRIAN RAWAT JALAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.Append(ESC + "a0"); //left
                sb.AppendLine("-----------------------------------------------");

                #region GenerateQRCode

                sb.Append(center); //center
                string QrData = oVisit9.RegistrationNo;
                string qrCodes = "";
                Encoding m_encoding = Encoding.GetEncoding("iso-8859-1");
                int store_len = (QrData).Length + 3;
                byte store_pL = (byte)(store_len % 256);
                byte store_pH = (byte)(store_len / 256);
                qrCodes += m_encoding.GetString(new byte[] { 29, 40, 107, 4, 0, 49, 65, 50, 0 });
                qrCodes += m_encoding.GetString(new byte[] { 29, 40, 107, 3, 0, 49, 67, 8 });
                qrCodes += m_encoding.GetString(new byte[] { 29, 40, 107, 3, 0, 49, 69, 48 });
                qrCodes += m_encoding.GetString(new byte[] { 29, 40, 107, store_pL, store_pH, 49, 80, 48 });
                qrCodes += QrData;
                qrCodes += m_encoding.GetString(new byte[] { 29, 40, 107, 3, 0, 49, 81, 48 });

                sb.Append(center); //center
                sb.AppendLine(qrCodes);
                sb.Append(center); //center
                sb.AppendLine(oVisit9.RegistrationNo);
                sb.AppendLine("");

                #endregion
                sb.Append(ESC + "a1"); //center
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    sb.AppendLine(string.Format("{0}{1}{2}",
                         fontDoubleHeightBold, oVisit9.QueueNo, fontDoubleHeightEnd));
                }
                sb.Append(ESC + "a0"); //left
                sb.AppendLine("");
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Nama Pasien        : {0} {1}", oVisit9.Salutation, oVisit9.PatientName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Tgl. Lahir         : {0}", oVisit9.DateOfBirthInString));
                sb.AppendLine("");
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Unit               : {0}", oVisit9.ServiceUnitName));
                sb.AppendLine("");
                sb.AppendLine("-----------------------------------------------");
                sb.AppendLine(string.Format("Tgl Cetak : {0} Petugas : {1}", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT_1), AppSession.UserLogin.UserName));
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #endregion

        #region RSSA

        #region PrintSlipAntrianRawatJalanRSSA
        public static void PrintSlipAntrianRawatJalanRSSA(vConsultVisit9 oVisit9, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";

                string fontDoubleHeightBold = "\x1b\x21\x30";
                string fontDoubleHeightBoldEnd = "\x1b\x21\x00";

                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a0"); //left
                sb.AppendLine(string.Format("{0}", oHealthcare.HealthcareName));
                sb.AppendLine(string.Format("{0}", oHealthcare.StreetName));
                sb.AppendLine("----------------------------------------");
                sb.Append(ESC + "a1"); //center
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("SLIP ANTRIAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.Append(ESC + "a0"); //left
                sb.AppendLine("----------------------------------------");
                sb.Append(ESC + "a1"); //center
                sb.AppendLine(string.Format("{0}{1}{2}{3}{4}",
                         fontDoubleHeightBold, fontBold, oVisit9.QueueNo, fontBoldEnd, fontDoubleHeightBoldEnd));
                sb.Append(ESC + "a0"); //left
                sb.AppendLine("");
                sb.AppendLine(string.Format("No. RM         : {0}", oVisit9.MedicalNo));
                sb.AppendLine("");
                sb.AppendLine(string.Format("No. Reg        : {0}", oVisit9.RegistrationNo));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Tgl/Jam Reg    : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Nama Pasien    : {0} {1}", oVisit9.Salutation, oVisit9.PatientName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Tgl. Lahir     : {0}", oVisit9.DateOfBirthInString));
                sb.AppendLine("");
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("Unit Pelayanan : {0}", oVisit9.ServiceUnitName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Nama Dokter    : {0}", oVisit9.ParamedicName));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Penjamin Bayar : {0}", oVisit9.BusinessPartner));
                sb.AppendLine("");
                sb.AppendLine(string.Format("Unit           : {0}", oVisit9.ServiceUnitName));
                sb.AppendLine("");
                sb.Append(ESC + "a1"); //center
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("* JANGAN DIBUANG SAMPAI SELESAI BEROBAT");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");
                sb.AppendLine("----------------------------------------");
                sb.AppendLine(string.Format("Tgl Cetak : {0} Petugas : {1}", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT_1), AppSession.UserLogin.UserName));
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #endregion

        #region KKDI

        public static void PrintLabelPasienRadiologiKKDI(vLabelPatientRegistrationImagingKKDI oChargesHd, string printFormat, int id = 0, string printerUrl = "")
        {
            string printerName1 = printerUrl;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            if (!string.IsNullOrEmpty(printerName1))
            {
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Imaging, printFormat);
                List<string> lstField = GetMetadata(PrintingGroup.Imaging);
                if (!string.IsNullOrEmpty(command))
                {
                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", string.Empty);
                    labelInfo.Add("TransactionNo", oChargesHd.TransactionNo);
                    labelInfo.Add("MedicalNo", oChargesHd.MedicalNo);
                    labelInfo.Add("Salutation", oChargesHd.Salutation);
                    labelInfo.Add("PatientName", oChargesHd.PatientName);
                    labelInfo.Add("StreetName", oChargesHd.StreetName);
                    labelInfo.Add("cfDateOfBirth", oChargesHd.DateOfBirthInString);
                    labelInfo.Add("RegistrationDate", oChargesHd.RegistrationDateInString);
                    labelInfo.Add("PhoneNo", oChargesHd.MobilePhoneNo1);
                    labelInfo.Add("PhotoNumber", oChargesHd.PhotoNumber);
                    labelInfo.Add("ItemName", oChargesHd.ItemName);
                    labelInfo.Add("RegistrationPhysicianName", oChargesHd.DokterRujukan);
                    labelInfo.Add("PhysicianOrder", oChargesHd.DokterPemeriksa);
                    labelInfo.Add("cfGenderInitial1", string.Empty);
                    labelInfo.Add("cfTransactionDate", string.Empty);
                    labelInfo.Add("cfItemDetailListForLabel", string.Empty);

                    #region Replace Label Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion

                    #region Send Command to Printer
                    int a = 0;
                    int noOfPrint = 1;
                    a = noOfPrint;

                    DirectPrinting printer = new DirectPrinting();
                    string printerName = printerName1;
                    for (int i = 1; i <= a; i++)
                    {
                        printer.OpenPrinter(printerName);
                        printer.StartDocPrinter();
                        printer.Send("\n");
                        printer.Send("n\n");
                        printer.Send(labelCommand);
                        printer.Send("p1\n");
                        printer.EndDocPrinter();
                    }
                    #endregion
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #region RSRT
        #region printLabelRadiologiRSRT
        public static void printLabelRadiologiRSRT2(vPatientChargesDt item, string printerUrl)
        {
            StringBuilder sb = new StringBuilder();

            string line1 = string.Format("Nama Pasien");
            string line3 = string.Format("No Foto/MRN");
            string line5 = string.Format("TGL Pemeriksaan");
            string line7 = string.Format("Ruangan");
            string line8 = string.Format("Dokter Pengirim");
            string line9 = string.Format("Jenis Pemeriksaan");
            string age = "";
            string PhotoNumber = "";
            vPatientChargesHd9 charges = BusinessLayer.GetvPatientChargesHd9List(string.Format("TransactionID='{0}'", item.TransactionID)).FirstOrDefault();
            vRegistration3 registration = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", item.RegistrationID)).FirstOrDefault();
            //vImagingResultDt1 oResult = BusinessLayer.GetvImagingResultDt1List(string.Format("ItemID='{0}' AND TransactionID='{1}' and IsDeleted=0", item.ItemID, item.TransactionID)).FirstOrDefault();
            ImagingResultHd imagingHD = BusinessLayer.GetImagingResultHdList(string.Format("ChargeTransactionID='{0}'", item.TransactionID)).FirstOrDefault();
            if (imagingHD != null)
            {
                ImagingResultDt imgDT = BusinessLayer.GetImagingResultDtList(string.Format("ID='{0}' AND ItemID='{1}'  AND IsDeleted=0", imagingHD.ID, item.ItemID)).FirstOrDefault();
                if (imgDT != null)
                {
                    PhotoNumber = imgDT.PhotoNumber;
                }
            }

            string ParamedicName = "";

            ParamedicName = charges.ParamedicSender;
            if (charges.IsOrderCreatedBySystem)
            {
                ParamedicName = string.Empty;
            }
            if (string.IsNullOrEmpty(ParamedicName))
            {

                if (registration.ReferrerParamedicID > 0)
                {
                    string strFilterExpression = string.Format("ParamedicID = '{0}'", registration.ReferrerParamedicID);
                    ParamedicMaster pm = BusinessLayer.GetParamedicMasterList(strFilterExpression).FirstOrDefault();
                    if (pm != null)
                    {
                        ParamedicName = pm.FullName;
                    }
                }
                else
                {
                    ParamedicName = registration.ReferrerName;
                }
            }

            sb.Append("^XA");
            sb.Append("^CF028,28");
            sb.Append("^FO120,30^FD" + line1 + "^FS"); //Nama Pasien
            sb.Append("^FO330,30^FD:^FS");
            sb.Append("^FO340,30^FD" + string.Format("{0} / {1} Thn", item.PatientName, registration.AgeInYear) + "^FS"); //Nama Pasien

            sb.Append("^FO120,70^FD" + line3 + "^FS"); //NO RM
            sb.Append("^FO330,70^FD:^FS");
            sb.Append("^FO340,70^FD" + PhotoNumber + "^FS"); //no Foto
            sb.Append("^FO500,70^FD" + string.Format(" / {0}", item.MedicalNo) + "^FS"); //MedicalNo

            sb.Append("^FO120,110^FD" + line5 + "^FS"); //NAMA
            sb.Append("^FO330,110^FD:^FS");
            sb.Append("^FO340,110^FD" + item.TransactionDateInString + "^FS"); //TGL Pemeriksaan

            sb.Append("^FO120,150^FD" + line7 + "^FS"); //Ruangan
            sb.Append("^FO330,150^FD:^FS");
            sb.Append("^FO340,150^FD" + registration.RoomName + "^FS"); //DOB

            sb.Append("^FO120,190^FD" + line8 + "^FS"); //PENGIRIM
            sb.Append("^FO330,190^FD:^FS");
            sb.Append("^FO340,190^FD" + ParamedicName + "^FS"); //paramedic

            sb.Append("^FO120,230^FD" + line9 + "^FS"); //PEMERIKSAAN
            sb.Append("^FO330,230^FD:^FS");
            sb.Append("^FO340,230^FB400,50,0,L^FD" + item.ItemName1 + "^FS"); //AlternateItemName
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();
            for (int i = 0; i < 1; i++)
            {
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
                sb.Clear();
            }
            #endregion
        }

        public static void printLabelRadiologiRSRT(vLabelPatientRegistrationImagingRSRT charges, string printerUrl)
        {
            StringBuilder sb = new StringBuilder();
            string paramedic = charges.DokterRujukan;

            string line1 = string.Format("Nama Pasien");
            string line3 = string.Format("No Foto/MRN");
            string line5 = string.Format("TGL Pemeriksaan");
            string line7 = string.Format("Ruangan");
            string line8 = string.Format("Dokter Pengirim");
            string line9 = string.Format("Jenis Pemeriksaan");
            string age = "";

            string filterExpression = string.Format("TransactionID = {0}", charges.TransactionID.ToString());
            List<vLabelPatientRegistrationImagingRSRT> lstDetail = BusinessLayer.GetvLabelPatientRegistrationImagingRSRTList(filterExpression);

            vLabelPatientRegistrationImagingRSRT oRow = lstDetail.FirstOrDefault();
            if (oRow != null)
            {
                string agePatient = Helper.CalculateAge(oRow.DOB);
                if (!string.IsNullOrEmpty(agePatient))
                {
                    age = agePatient.Split('|')[0];
                }
            }
            foreach (vLabelPatientRegistrationImagingRSRT item in lstDetail)
            {
                string RefNo = "";
                ImagingResultHd oImaging = BusinessLayer.GetImagingResultHdList(string.Format(" ChargeTransactionID={0} and IsDeleted=0", item.TransactionID)).FirstOrDefault();
                if (oImaging != null)
                {
                    RefNo = oImaging.ReferenceNo;
                }
                sb.Append("^XA");
                sb.Append("^CF028,28");
                sb.Append("^FO100,50^FD" + line1 + "^FS"); //Nama Pasien
                sb.Append("^FO300,50^FD:^FS");
                sb.Append("^FO310,50^FD" + string.Format("{0} / {1} Thn", item.PatientName, age) + "^FS"); //Nama Pasien

                sb.Append("^FO100,90^FD" + line3 + "^FS"); //NO RM
                sb.Append("^FO300,90^FD:^FS");
                sb.Append("^FO310,90^FD" + RefNo + "^FS"); //no Foto
                sb.Append("^FO410,90^FD" + string.Format(" / {0}", item.MedicalNo) + "^FS"); //MedicalNo

                sb.Append("^FO100,130^FD" + line5 + "^FS"); //NAMA
                sb.Append("^FO300,130^FD:^FS");
                sb.Append("^FO310,130^FD" + item.cfTransactionDateInString + "^FS"); //TGL Pemeriksaan

                sb.Append("^FO100,170^FD" + line7 + "^FS"); //Ruangan
                sb.Append("^FO300,170^FD:^FS");
                sb.Append("^FO310,170^FD" + item.VisitRoomName + "^FS"); //DOB

                sb.Append("^FO100,210^FD" + line8 + "^FS"); //PENGIRIM
                sb.Append("^FO300,210^FD:^FS");
                sb.Append("^FO310,210^FD" + item.DokterRujukan + "^FS"); //paramedic

                sb.Append("^FO100,250^FD" + line9 + "^FS"); //PEMERIKSAAN
                sb.Append("^FO310,250^FD:^FS");
                sb.Append("^FO100,290^FB600,50,0,L^FD" + item.ItemName + "^FS"); //AlternateItemName
                sb.Append("^XZ");

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion
        #region PrintNutritionDistributionLabel RSRT
        /// <summary>
        /// Cetak Label Distribusi Makan Pasien
        /// </summary>
        /// <param name="vNutritionOrderDtMealPlan"></param>
        /// <param name="printerUrl"></param>
        public static void PrintNutritionDistributionLabelRSRT(int orderID, int detailID, string printerUrl, string expiredTime)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                string filterExpression = string.Format("NutritionOrderHdID = {0} AND NutritionOrderDtID = {1} ORDER BY BedCode", orderID, detailID);
                List<vNutritionOrderDtCustom> lstEntity = BusinessLayer.GetvNutritionOrderDtCustomList(filterExpression);

                sb.AppendLine(string.Format("Tanggal      : {0}", lstEntity[0].ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)));
                sb.AppendLine(string.Format("Jadwal Makan : {0}", lstEntity[0].MealTime));
                sb.AppendLine(string.Format("No.Reg / MR  : {0} / {1}", lstEntity[0].RegistrationNo, lstEntity[0].MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien  : {0}", lstEntity[0].cfPatientNameSalutation));
                sb.AppendLine(string.Format("Jenis Kelamin: {0}", lstEntity[0].Gender));
                sb.AppendLine(String.Format("Tgl. Lahir   : {0}", lstEntity[0].DateOfBirthInString));
                sb.AppendLine(string.Format("Ruangan / TT : {0} / {1}", lstEntity[0].RoomName, lstEntity[0].BedCode));
                sb.AppendLine(string.Format("Panel Menu   : {0}", lstEntity[0].MealPlanName));
                sb.AppendLine(string.Format("Catatan      : {0} {1}", lstEntity[0].RemarksHd, lstEntity[0].Remarks));
                sb.AppendLine(String.Format(""));
                //sb.AppendLine(String.Format("Jam Expired  : {0}", expiredTime));
                //sb.AppendLine(String.Format(""));
                //sb.AppendLine(String.Format("Tgl Cetak    : {0}", DateTime.Now.ToString("dd-MM-yyyy HH:mm")));
                //sb.AppendLine("-".PadRight(48, '-'));
                //sb.AppendLine(String.Format("  HA     LH     LN     SY     BH   Cairan"));
                //sb.AppendLine(String.Format("[    ] [    ] [    ] [    ] [    ] [    ]"));
                //sb.AppendLine(String.Format(""));
                //sb.AppendLine(String.Format("HABIS    1      2      3      4    UTUH"));
                //sb.AppendLine(String.Format("      <- - - - - - - - - - - - -> "));
                //sb.AppendLine(String.Format("0      10-25  25-50  50-75  75-100  100"));
                //sb.AppendLine(String.Format("      <- - - - - - - - - - - - -> "));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                sb.AppendLine(CreateAutoCutCommand());

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #endregion

        #region Cover RM
        public static void PrintCoverRM(vPatient oPatient, string printerUrl, string printFormat)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetCoverRMFormat(printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Cover);

                if (!string.IsNullOrEmpty(command))
                {

                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oPatient, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Patient Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    print.OpenPrinter(printerUrl);
                    print.StartDocPrinter();
                    print.Send("\n");
                    print.Send("n\n"); // clear the image buffer
                    print.Send(labelCommand);
                    print.Send("p1\n"); //print one label
                    print.EndDocPrinter();
                    #endregion
                }
            }
        }

        private static string GetCoverRMFormat(string printFormat = "X214^01")
        {
            #region Get Label Format
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\print_format\cover\{1}.rdl", filePath, printFormat.Replace('^', '_'));
            IEnumerable<string> lstCommand = File.ReadAllLines(fileName);
            StringBuilder commandText = new StringBuilder();
            foreach (string command in lstCommand)
            {
                commandText.AppendLine(command);
            }
            string result = commandText.ToString();
            #endregion
            return result;
        }
        #endregion

        #region printLabelRadiologi
        public static void printLabelRadiologi2RSSES(vPatientChargesDt chargesDt, string printerUrl)
        {
            String MedicalNo = "";
            String ParamedicName = "";
            String PatientName = "";
            String DOB = "";
            String Age = "";
            String gender = "";
            String Address = "";
            String TransaksiDetail = "";
            String RoomName = "";
            String City = "";
            vPatientChargesHd9 charges = BusinessLayer.GetvPatientChargesHd9List(string.Format("TransactionID='{0}'", chargesDt.TransactionID)).FirstOrDefault();
            vRegistration3 registration = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", charges.RegistrationID)).FirstOrDefault();
            Int32 PatientAgeInYear = Function.GetPatientAgeInYear(registration.DateOfBirth, DateTime.Now);
            Int32 PatientAgeInMonth = Function.GetPatientAgeInMonth(registration.DateOfBirth, DateTime.Now);
            DOB = registration.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT_1);
            if (registration.GCGender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }
            MedicalNo = registration.MedicalNo;
            ParamedicName = charges.ParamedicSender;
            if (charges.IsOrderCreatedBySystem)
            {
                ParamedicName = string.Empty;
                if (registration.DepartmentID == Constant.Facility.MEDICAL_CHECKUP)
                {
                    ParamedicName = registration.ParamedicName;
                }
            }
            if (string.IsNullOrEmpty(ParamedicName))
            {

                if (registration.ReferrerParamedicID > 0)
                {
                    string strFilterExpression = string.Format("ParamedicID = '{0}'", registration.ReferrerParamedicID);
                    ParamedicMaster pm = BusinessLayer.GetParamedicMasterList(strFilterExpression).FirstOrDefault();
                    if (pm != null)
                    {
                        ParamedicName = pm.FullName;
                    }
                }
                else
                {
                    ParamedicName = registration.ReferrerName;
                }
            }
            RoomName = charges.RoomName;
            PatientName = registration.cfPatientNameSalutation2;
            Age = string.Format("{0} Th, {1} Bln / {2}", PatientAgeInYear, PatientAgeInMonth, gender);
            Address = registration.StreetName + " " + registration.County + " " + registration.District;
            City = registration.City;
            TransaksiDetail = string.Format("{0} ~ ", charges.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT_1));

            if (Address.Length > 48)
            {
                Address = Address.Substring(0, 48) + "...";

            }




            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);

                #region Print Healthcare Information
                dotMatrix.SelectRomanFont();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", RoomName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", MedicalNo));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", ParamedicName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", PatientName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}         {1}", DOB, Age));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", Address));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                if (!string.IsNullOrEmpty(City))
                {

                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.Append(string.Format("{0}", City));
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0} ", TransaksiDetail));
                dotMatrix.Append("\n");
                string item = chargesDt.ItemName1;
                dotMatrix.Append(string.Format("{0} ", item));
                dotMatrix.Append("\n");

                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }


        }



        public static void printLabelRadiologiRSSES(vPatientChargesHd9 charges, string printerUrl)
        {
            String MedicalNo = "";
            String ParamedicName = "";
            String PatientName = "";
            String DOB = "";
            String Age = "";
            String gender = "";
            String Address = "";
            String TransaksiDetail = "";
            String RoomName = "";
            String City = "";
            vRegistration3 registration = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", charges.RegistrationID)).FirstOrDefault();
            Int32 PatientAgeInYear = Function.GetPatientAgeInYear(registration.DateOfBirth, DateTime.Now);
            Int32 PatientAgeInMonth = Function.GetPatientAgeInMonth(registration.DateOfBirth, DateTime.Now);
            DOB = registration.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT_1);
            if (registration.GCGender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }
            MedicalNo = registration.MedicalNo;
            ParamedicName = charges.ParamedicSender;
            if (charges.IsOrderCreatedBySystem)
            {
                ParamedicName = string.Empty;
            }
            if (string.IsNullOrEmpty(ParamedicName))
            {

                if (registration.ReferrerParamedicID > 0)
                {
                    string strFilterExpression = string.Format("ParamedicID = '{0}'", registration.ReferrerParamedicID);
                    ParamedicMaster pm = BusinessLayer.GetParamedicMasterList(strFilterExpression).FirstOrDefault();
                    if (pm != null)
                    {
                        ParamedicName = pm.FullName;
                    }
                }
                else
                {
                    ParamedicName = registration.ReferrerName;
                }
            }
            RoomName = charges.RoomName;
            PatientName = registration.cfPatientNameSalutation2;
            Age = string.Format("{0} Th, {1} Bln / {2}", PatientAgeInYear, PatientAgeInMonth, gender);
            Address = registration.StreetName + " " + registration.County + " " + registration.District;
            City = registration.City;
            List<vItemMaster> lstItem = new List<vItemMaster>();

            if (registration.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
            {
                string filter = string.Format("TransactionID = {0} AND IsDeleted = 0 AND ISNULL(GCTransactionDetailStatus,'') != '{1}' AND GCITemType IN ('{2}','{3}')", charges.TransactionID, Constant.TransactionStatus.VOID, Constant.ItemType.RADIOLOGI, Constant.ItemType.PENUNJANG_MEDIS);
                List<vPatientChargesDt1> lstChargesDt = BusinessLayer.GetvPatientChargesDt1List(filter);
                foreach (vPatientChargesDt1 k in lstChargesDt)
                {
                    vItemMaster master = BusinessLayer.GetvItemMasterList(string.Format("ItemID = {0}", k.ItemID)).FirstOrDefault();
                    lstItem.Add(master);
                }
            }
            else
            {
                List<vItemMCUPackageLabel> lstMCU = BusinessLayer.GetvItemMCUPackageLabelList(string.Format("TransactionID = {0}", charges.TransactionID));
                foreach (vItemMCUPackageLabel z in lstMCU)
                {
                    vItemMaster master = BusinessLayer.GetvItemMasterList(string.Format("ItemID = {0}", z.paket)).FirstOrDefault();
                    lstItem.Add(master);
                }
            }



            TransaksiDetail = string.Format("{0} ~ ", charges.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT_1));

            if (Address.Length > 48)
            {
                Address = Address.Substring(0, 48) + "...";

            }

            if (TransaksiDetail.Length > 48)
            {
                TransaksiDetail = TransaksiDetail.Substring(0, 48) + "...";
            }



            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);

                #region Print Healthcare Information
                dotMatrix.SelectRomanFont();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", RoomName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", MedicalNo));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", ParamedicName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetDoubleSizeFont();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", PatientName));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}         {1}", DOB, Age));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0}", Address));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                if (!string.IsNullOrEmpty(City))
                {

                    dotMatrix.SelectEmphasizedMode();
                    dotMatrix.Append(string.Format("{0}", City));
                    dotMatrix.CancelEmphasizedMode();
                    dotMatrix.Append("\n");
                }

                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("{0} ", TransaksiDetail));

                var result = lstItem.GroupBy(test => test.ItemID).Select(grp => grp.First()).ToList().OrderBy(x => x.ItemID);

                string item = "";
                foreach (vItemMaster e in result)
                {
                    if (e == result.FirstOrDefault())
                    {
                        item = e.ItemName1;
                        if (e.ItemName1.Length > 48)
                        {
                            item = e.ItemName1.Substring(0, 48) + "...";
                        }


                        dotMatrix.Append(string.Format("{0} ", item));
                        dotMatrix.Append("\n");
                    }
                    else
                    {
                        item = e.ItemName1;
                        if (e.ItemName1.Length > 48)
                        {
                            item = e.ItemName1.Substring(0, 48) + "...";
                        }

                        dotMatrix.Append(string.Format("{0} ", item));
                        dotMatrix.Append("\n");

                    }
                }

                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }


        }


        public static void printLabelRadiologi(vPatientChargesHd1 charges, string printerUrl)
        {
            StringBuilder sb = new StringBuilder();
            vRegistration3 registration = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", charges.RegistrationID)).FirstOrDefault();
            String HealthcareImaging = BusinessLayer.GetSettingParameterDtList(string.Format("ParameterCode = '{0}'", Constant.SettingParameter.IS_KODE_PENUNJANG_RADIOLOGI)).FirstOrDefault().ParameterValue;
            string gender = registration.GCGender;
            Int32 PatientAge = Function.GetPatientAgeInYear(registration.DateOfBirth, DateTime.Now);

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            string paramedic = "";
            if (registration.HealthcareServiceUnitID == Convert.ToInt32(HealthcareImaging))
            {
                if (registration.ReferrerParamedicID != 0 && registration.ReferrerID == 0)
                {
                    ParamedicMaster pm = BusinessLayer.GetParamedicMaster(registration.ReferrerParamedicID);
                    paramedic = pm.FullName;
                }
                else if (registration.ReferrerID != 0 && registration.ReferrerParamedicID == 0)
                {
                    vReferrer vr = BusinessLayer.GetvReferrerList(string.Format("BusinessPartnerID = {0}", registration.ReferrerID)).FirstOrDefault();
                    paramedic = vr.BusinessPartnerName;
                }
            }
            else
            {
                paramedic = registration.ParamedicName;
            }

            string line1 = string.Format("{0} / {1} Tahun / {2}", registration.PatientName, PatientAge, gender);
            string line2 = string.Format("RM : {0} / / {1} {2}", registration.MedicalNo, charges.TransactionDateInString, charges.TransactionTime);
            string line3 = string.Format("");

            List<vItemMaster> lstItem = new List<vItemMaster>();

            if (registration.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
            {
                string filter = string.Format("TransactionID = {0} AND IsDeleted = 0 AND ISNULL(GCTransactionDetailStatus,'') != '{1}' AND GCITemType = '{2}'", charges.TransactionID, Constant.TransactionStatus.VOID, Constant.ItemType.RADIOLOGI);
                List<vPatientChargesDt1> lstChargesDt = BusinessLayer.GetvPatientChargesDt1List(filter);
                foreach (vPatientChargesDt1 k in lstChargesDt)
                {
                    vItemMaster master = BusinessLayer.GetvItemMasterList(string.Format("ItemID = {0}", k.ItemID)).FirstOrDefault();
                    lstItem.Add(master);
                }
            }
            else
            {
                List<vItemMCUPackageLabel> lstMCU = BusinessLayer.GetvItemMCUPackageLabelList(string.Format("TransactionID = {0}", charges.TransactionID));
                foreach (vItemMCUPackageLabel z in lstMCU)
                {
                    vItemMaster master = BusinessLayer.GetvItemMasterList(string.Format("ItemID = {0}", z.paket)).FirstOrDefault();
                    lstItem.Add(master);
                }
            }

            var result = lstItem.GroupBy(test => test.ItemID).Select(grp => grp.First()).ToList().OrderBy(x => x.ItemID);

            string item = "";
            foreach (vItemMaster e in result)
            {
                if (e == result.FirstOrDefault())
                {
                    item = e.ItemName1;
                }
                else
                {
                    item = item + ", " + e.ItemName1;
                }
            }

            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append("^FO20,15^A0N,31,31^FD" + line1 + "^FS\r\n");
            sb.Append("^FO20,55^A0N,31,31^FD" + line2 + "^FS\r\n");
            sb.Append("^FO20,90^A0N,31,31^FD" + paramedic + "^FS\r\n");
            sb.Append("^FO20,130^A0N,31,31^FD" + string.Format("{0} - {1}", registration.DepartmentID, registration.ServiceUnitName) + "^FS\r\n");


            if (item.Length <= 50)
            {
                sb.Append("^FO20,180^A0N,31,31^FD" + item + "^FS\r\n");
            }
            else if (item.Length > 50 && item.Length <= 100)
            {
                int max = item.Length - 50;
                string l1 = item.Substring(0, 50);
                string l2 = item.Substring(50, max);

                sb.Append("^FO20,180^A0N,31,31^FD" + l1 + "^FS\r\n");
                sb.Append("^FO20,220^A0N,31,31^FD" + l2 + "^FS\r\n");
            }
            else
            {
                int max = item.Length - 100;
                string l1 = item.Substring(0, 50);
                string l2 = item.Substring(50, 50);
                string l3 = item.Substring(100, max);

                sb.Append("^FO20,180^A0N,31,31^FD" + l1 + "^FS\r\n");
                sb.Append("^FO20,220^A0N,31,31^FD" + l2 + "^FS\r\n");
                sb.Append("^FO20,260^A0N,31,31^FD" + l3 + "^FS\r\n");
            }
            sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }

       public static void printLabelRadiologiRSPM(vPatientChargesDt charges, string printerUrl)
       {
            #region Lama
            StringBuilder sb = new StringBuilder();
            vRegistration3 registration = BusinessLayer.GetvRegistration3List(string.Format("RegistrationID = {0}", charges.RegistrationID)).FirstOrDefault();
            String HealthcareImaging = BusinessLayer.GetSettingParameterDtList(string.Format("ParameterCode = '{0}'", Constant.SettingParameter.IS_KODE_PENUNJANG_RADIOLOGI)).FirstOrDefault().ParameterValue;
            string gender = registration.GCGender;

            string dokterPengirim = "";
            PatientChargesHd chargesHD = BusinessLayer.GetPatientChargesHd(charges.TransactionID);
            TestOrderHd orderHd = BusinessLayer.GetTestOrderHd(Convert.ToInt32(chargesHD.TestOrderID));
            if (orderHd != null)
            {
                ParamedicMaster pmPengirim = BusinessLayer.GetParamedicMaster(orderHd.ParamedicID);
                dokterPengirim = pmPengirim.FullName;
            }

            Int32 PatientAge = Function.GetPatientAgeInYear(registration.DateOfBirth, DateTime.Now);

            if (gender == Constant.Gender.FEMALE)
            {
                gender = "P";
            }
            else
            {
                gender = "L";
            }

            string paramedicReferrer = "";
            if (registration.HealthcareServiceUnitID == Convert.ToInt32(HealthcareImaging))
            {
                if (registration.ReferrerParamedicID != 0 && registration.ReferrerID == 0)
                {
                    ParamedicMaster pm = BusinessLayer.GetParamedicMaster(registration.ReferrerParamedicID);
                    paramedicReferrer = pm.FullName;
                }
                else if (registration.ReferrerID != 0 && registration.ReferrerParamedicID == 0)
                {
                    vReferrer vr = BusinessLayer.GetvReferrerList(string.Format("BusinessPartnerID = {0}", registration.ReferrerID)).FirstOrDefault();
                    paramedicReferrer = vr.BusinessPartnerName;
                }
            }
            //else
            //{
            //    paramedic = registration.ParamedicName;
            //}

            string line1 = string.Format("{0} / {1} Tahun / {2}", registration.PatientName, PatientAge, gender);
            string line2 = string.Format("RM : {0} / / {1} {2}", registration.MedicalNo, charges.TransactionDateInString, charges.TransactionTime);
            string line3 = string.Format("");

            List<ItemMaster> lstItem = new List<ItemMaster>();

            //if (registration.DepartmentID != Constant.Facility.MEDICAL_CHECKUP)
            //{
            //    ItemMaster master = BusinessLayer.GetItemMaster(charges.ItemID);
            //    lstItem.Add(master);
            //}
            //else
            //{
            //    List<vItemMCUPackageLabel> lstMCU = BusinessLayer.GetvItemMCUPackageLabelList(string.Format("TransactionID = {0}", charges.TransactionID));
            //    foreach (vItemMCUPackageLabel z in lstMCU)
            //    {
            //        ItemMaster master = BusinessLayer.GetItemMasterList(string.Format("ItemID = {0}", z.paket)).FirstOrDefault();
            //        lstItem.Add(master);
            //    }
            //}

            ItemMaster master = BusinessLayer.GetItemMaster(charges.ItemID);
            lstItem.Add(master);

            ItemMaster itemFinal = lstItem.GroupBy(test => test.ItemID).Select(grp => grp.First()).ToList().OrderBy(x => x.ItemID).ToList().FirstOrDefault();

            sb.Append("^XA\r\n");
            sb.Append("^FX\r\n");
            sb.Append(string.Format("^FO10,20^A0N,30,28^FD{0}^FS\r\n", itemFinal.ItemName1));
            sb.Append("^FO10,15^A0N,30,40^FD______________________________^FS\r\n");

            sb.Append("^FO10,60^A0N,28,28^FDID/RUJUKAN^FS\r\n");
            sb.Append("^FO155,60^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,60^A0N,28,28^FD{0} / {1}^FS\r\n", registration.MedicalNo, paramedicReferrer));

            sb.Append("^FO10,90^A0N,28,28^FDTGL. REG^FS\r\n");
            sb.Append("^FO155,90^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,90^A0N,28,28^FD{0}^FS\r\n", registration.cfRegistrationDateInString));

            sb.Append("^FO10,120^A0N,28,28^FDORDER^FS\r\n");
            sb.Append("^FO155,120^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,120^A0N,28,28^FD{0}^FS\r\n", chargesHD.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT)));
 
            sb.Append("^FO10,150^A0N,28,28^FDNAMA^FS\r\n");
            sb.Append("^FO155,150^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,155^A0N,28,28^FD{0}^FS\r\n", registration.PatientName));

            sb.Append("^FO10,180^A0N,28,28^FDDOKTER^FS\r\n");
            sb.Append("^FO155,180^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,180^A0N,28,28^FD{0}^FS\r\n", charges.ParamedicName));

            sb.Append("^FO10,210^A0N,28,28^FDPENGIRIM^FS\r\n");
            sb.Append("^FO155,210^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,210^A0N,28,28^FD{0}^FS\r\n", dokterPengirim));

            sb.Append("^FO10,240^A0N,28,28^FDTGL LAHIR^FS\r\n");
            sb.Append("^FO155,240^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,240^A0N,28,28^FD{0}^FS\r\n", registration.cfDateOfBirthInString));

            //sb.Append("^FO20,210^A0N,28,28^FDUMUR^FS\r\n");
            //sb.Append("^FO175,210^A0N,28,28^FD : ^FS\r\n");
            //sb.Append(string.Format("^FO195,210^A0N,28,28^FD{0} years {1} month {2} days^FS\r\n", registration.AgeInYear, registration.AgeInMonth, registration.AgeInDay));

            sb.Append("^FO10,270^A0N,28,28^FDALAMAT^FS\r\n");
            sb.Append("^FO155,270^A0N,28,28^FD : ^FS\r\n");
            sb.Append(string.Format("^FO175,270^A0N,28,28^FB400,50,0,L^FD{0}^FS", registration.StreetName));
            //if (registration.StreetName.Length <= 33)
            //{
            //    sb.Append(string.Format("^FO175,245^A0N,28,28^FD{0}^FS\r\n", registration.StreetName));
            //}
            //else if (registration.StreetName.Length > 33 && registration.StreetName.Length <= 69)
            //{
            //    int max = registration.StreetName.Length - 33;
            //    string l1 = registration.StreetName.Substring(0, 33);
            //    string l2 = registration.StreetName.Substring(33, max);

            //    sb.Append(string.Format("^FO175,245^A0N,28,28^FD{0}^FS\r\n", l1));
            //    sb.Append(string.Format("^FO170,275^A0N,28,28^FD{0}^FS\r\n", l2));
            //}
            //else
            //{
            //    int max = registration.StreetName.Length - 69;
            //    string l1 = registration.StreetName.Substring(0, 33);
            //    string l2 = registration.StreetName.Substring(33, 33);
            //    string l3 = registration.StreetName.Substring(69, max);

            //    sb.Append(string.Format("^FO175,245^A0N,28,28^FD{0}^FS\r\n", l1));
            //    sb.Append(string.Format("^FO170,275^A0N,28,28^FD{0}^FS\r\n", l2));
            //    sb.Append(string.Format("^FO170,305^A0N,28,28^FD{0}^FS\r\n", l3));
            //}


            sb.Append("^XZ\r\n");

            //sb.Append("^XA\r\n");
            //sb.Append("^FX\r\n");
            //sb.Append("^FO20,15^A0N,31,31^FD" + line1 + "^FS\r\n");
            //sb.Append("^FO20,55^A0N,31,31^FD" + line2 + "^FS\r\n");
            //sb.Append("^FO20,90^A0N,31,31^FD" + paramedic + "^FS\r\n");
            //sb.Append("^FO20,130^A0N,31,31^FD" + string.Format("{0} - {1}", registration.DepartmentID, registration.ServiceUnitName) + "^FS\r\n");


            //if (item.Length <= 50)
            //{
            //    sb.Append("^FO20,180^A0N,31,31^FD" + item + "^FS\r\n");
            //}
            //else if (item.Length > 50 && item.Length <= 100)
            //{
            //    int max = item.Length - 50;
            //    string l1 = item.Substring(0, 50);
            //    string l2 = item.Substring(50, max);

            //    sb.Append("^FO20,180^A0N,31,31^FD" + l1 + "^FS\r\n");
            //    sb.Append("^FO20,220^A0N,31,31^FD" + l2 + "^FS\r\n");
            //}
            //else
            //{
            //    int max = item.Length - 100;
            //    string l1 = item.Substring(0, 50);
            //    string l2 = item.Substring(50, 50);
            //    string l3 = item.Substring(100, max);

            //    sb.Append("^FO20,180^A0N,31,31^FD" + l1 + "^FS\r\n");
            //    sb.Append("^FO20,220^A0N,31,31^FD" + l2 + "^FS\r\n");
            //    sb.Append("^FO20,260^A0N,31,31^FD" + l3 + "^FS\r\n");
            //}
            //sb.Append("^XZ\r\n");

            #region Send Command to Printer
            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
            #endregion

            #region Baru

            #endregion
        }
        #endregion

        #region MR Label
        public static void PrintZPLForMRCoverLabel(vPatient oPatient)
        {
            DirectPrinting print = new DirectPrinting();
            SettingParameter param = BusinessLayer.GetSettingParameter(Constant.SettingParameter.LABEL_PRINTER_NAME);

            if (param != null && !string.IsNullOrEmpty(param.ParameterValue))
            {
                //Initialize Printer
                print.OpenPrinter(param.ParameterValue);
                string command = GenerateZPLForMRCoverLabel(oPatient);

                print.StartDocPrinter();
                print.Send("\n");
                print.Send("n\n"); // clear the image buffer
                print.Send(command.ToString());
                print.Send("p1\n"); //print one label
                print.EndDocPrinter();
            }
        }

        private static string GenerateZPLForMRCoverLabel(vPatient oPatient)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF032,32"));
            command.Append(String.Format("^FO2,60^FD{0} ({1})^FS", oPatient.PatientName, oPatient.GCGender == "0003^M" ? "L" : "P"));
            command.Append(String.Format("^FO2,170^FD{0}^FS", oPatient.HomeAddress));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateMRLabelZPLCommand(ConsultVisit oVisit, string labelSizeType = MR_Label_Size_4x2)
        {
            string result = string.Empty;
            Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);

            if (oRegistration != null)
            {
                if (oRegistration.MRN != null)
                {
                    Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                    GetPatientLabelInformation(oPatient, oVisit, oRegistration);

                    switch (labelSizeType)
                    {
                        case MR_Label_Size_4x2:
                            result = GenerateZPLForLabel4_1(oPatient, oVisit, oRegistration);
                            break;
                        case MR_Label_Size_8x3:
                            result = GenerateZPLForLabel8_NoBarcode_NoParamedic(oPatient, oVisit, oRegistration);
                            break;
                        default:
                            break;
                    }
                }
            }
            return result;
        }

        private static void GetPatientLabelInformation(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            string firstName = string.IsNullOrEmpty(oPatient.FirstName) ? "Nama Depan" : oPatient.FirstName;
            string lastName = string.IsNullOrEmpty(oPatient.LastName) ? "Nama Belakang" : oPatient.LastName;
            string gender = oPatient.GCGender == "0003^M" ? "Laki-Laki" : "Perempuan";
            string age = string.Format("{0} thn {1} bln {2} hari", oRegistration.AgeInYear.ToString(), oRegistration.AgeInMonth.ToString(), oRegistration.AgeInDay.ToString());
            line1 = string.Format("{0} {1} {2} ({3})", oPatient.FirstName, oPatient.MiddleName, oPatient.LastName, gender);

            string mrn = string.IsNullOrWhiteSpace(oPatient.MedicalNo) ? "No.RM" : oPatient.MedicalNo;
            line2 = string.Format("{0}", oPatient.MedicalNo);
            line3 = string.Format("{0}", oRegistration.RegistrationNo);
            line4 = string.Format("{0} ({1})", oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT), age);

            string physicianName = oVisit.ParamedicID == null ? "Nama Dokter" : BusinessLayer.GetParamedicMaster((int)oVisit.ParamedicID).FullName;
            line5 = physicianName;

            string wardName = oVisit.HealthcareServiceUnitID == null ? "Ruang Rawat" : BusinessLayer.GetServiceUnitMaster(oVisit.HealthcareServiceUnitID).ShortName.ToString();
            string patientLocation = string.Format("{0} - {1}", wardName, BusinessLayer.GetBed((int)oVisit.BedID).BedCode.ToString());
            line6 = string.Format("{0}", patientLocation);

            if (oPatient.IsHasAllergy)
            {
                allergyInfo = "ALERGI";
            }
            else
            {
                allergyInfo = string.Empty;
            }
        }

        private static string GenerateZPLForLabel8(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF022,22"));
            command.Append(String.Format("^FO2,20^FD{0}^FS", line1));
            command.Append(string.Format("^CF018,20"));
            command.Append(String.Format("^FO2,50^FDNOREG / NORM^FS"));
            command.Append(String.Format("^FO161,50^FD:^FS"));
            command.Append(String.Format("^FO181,50^FD{0}^FS", line2));
            command.Append(String.Format("^FO2,70^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO161,70^FD:^FS"));
            command.Append(String.Format("^FO181,70^FD{0}^FS", line3));
            command.Append(String.Format("^FO2,90^FDDOKTER^FS"));
            command.Append(String.Format("^FO161,90^FD:^FS"));
            command.Append(String.Format("^FO181,90^FD{0}^FS", line4));
            command.Append(String.Format("^FO2,110^FDRUANG RAWAT^FS"));
            command.Append(String.Format("^FO161,110^FD:^FS"));
            command.Append(String.Format("^FO181,110^FD{0}^FS", line5));
            command.Append(String.Format("^FO120,130^BCN,90,Y,N,N^FD{0}^FS", oPatient.MedicalNo));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForLabel8_NoBarcode(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF028,28"));
            command.Append(String.Format("^FO2,20^FD{0}^FS", line1));
            command.Append(string.Format("^CF024,24"));
            command.Append(String.Format("^FO2,80^FDNO.RM^FS"));
            command.Append(String.Format("^FO171,80^FD:^FS"));
            command.Append(String.Format("^FO191,80^FD{0}^FS", line2));
            command.Append(String.Format("^FO2,110^FDNO.REGISTRASI^FS"));
            command.Append(String.Format("^FO171,110^FD:^FS"));
            command.Append(String.Format("^FO191,110^FD{0}^FS", line3));
            command.Append(String.Format("^FO2,140^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO171,140^FD:^FS"));
            command.Append(String.Format("^FO191,140^FD{0}^FS", line4));
            command.Append(String.Format("^FO2,170^FDDOKTER^FS"));
            command.Append(String.Format("^FO171,170^FD:^FS"));
            command.Append(String.Format("^FO191,170^FD{0}^FS", line5));
            command.Append(String.Format("^FO2,200^FDRUANG RAWAT^FS"));
            command.Append(String.Format("^FO171,200^FD:^FS"));
            command.Append(String.Format("^FO191,200^FD{0}^FS", line6));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForLabel8_NoBarcode_NoParamedic(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF028,28"));
            command.Append(String.Format("^FO2,20^FD{0}^FS", line1));
            command.Append(string.Format("^CF024,24"));
            command.Append(String.Format("^FO2,80^FDNO.RM^FS"));
            command.Append(String.Format("^FO171,80^FD:^FS"));
            command.Append(String.Format("^FO191,80^FD{0}^FS", line2));
            command.Append(String.Format("^FO2,110^FDNO.REGISTRASI^FS"));
            command.Append(String.Format("^FO171,110^FD:^FS"));
            command.Append(String.Format("^FO191,110^FD{0}^FS", line3));
            command.Append(String.Format("^FO2,140^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO171,140^FD:^FS"));
            command.Append(String.Format("^FO191,140^FD{0}^FS", line4));
            command.Append(String.Format("^FO2,170^FDRUANG RAWAT^FS"));
            command.Append(String.Format("^FO171,170^FD:^FS"));
            command.Append(String.Format("^FO191,170^FD{0}^FS", line6));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForLabel4_1(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF022,22"));
            command.Append(String.Format("^FO2,10^FD{0} ({1})^FS", oPatient.Name, oPatient.GCGender == "0003^M" ? "Laki-Laki," : "Perempuan"));
            command.Append(string.Format("^CF018,20"));
            command.Append(String.Format("^FO2,30^FDNOREG / NORM^FS"));
            command.Append(String.Format("^FO161,30^FD:^FS"));
            command.Append(String.Format("^FO181,30^FD{0} / {1}^FS", oRegistration.RegistrationNo, oPatient.MedicalNo));
            command.Append(String.Format("^FO2,50^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO161,50^FD:^FS"));
            command.Append(String.Format("^FO181,50^FD{0}^FS", oPatient.DateOfBirth.ToString("dd-MMM-yyyy")));
            command.Append(String.Format("^FO351,50^FD({0} Thn {1} Bln {2} hr)^FS", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay));
            command.Append(String.Format("^FO120,80^BCN,90,Y,N,N^FD{0}^FS", oPatient.MedicalNo));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForLabel5(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL260"));
            command.Append(string.Format("^PW550"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF022,22"));
            command.Append(String.Format("^FO2,21^FD{0} ({1})^FS", oPatient.Name, oPatient.GCGender == "0003^M" ? "Laki-Laki," : "Perempuan"));
            command.Append(string.Format("^CF018,20"));
            command.Append(String.Format("^FO2,51^FDNOREG / NORM^FS"));
            command.Append(String.Format("^FO161,51^FD:^FS"));
            command.Append(String.Format("^FO181,51^FD{0} / {1}^FS", oRegistration.RegistrationNo, oPatient.MedicalNo));
            command.Append(String.Format("^FO2,71^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO161,71^FD:^FS"));
            command.Append(String.Format("^FO181,71^FD{0}^FS", oPatient.DateOfBirth.ToString("dd-MMM-yyyy")));
            command.Append(String.Format("^FO351,71^FD({0} Thn {1} Bln {2} hr)^FS", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay));
            command.Append(String.Format("^FO120,100^BCA,90,Y,N,N^FD{0}^FS", oPatient.MedicalNo));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }

        //public static void PrintMRLabel(vConsultVisit oVisit, string printerUrl, string printFormat, int labelCount = 1)
        public static void PrintMRLabel(vLabelPatientRegistrationInfo oVisit, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.PatientLabel, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.PatientLabel);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }

        public static void PrintMRLabel(vPatient oPatient, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.PatientLabel, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.PatientLabel);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oPatient, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }

        #region PrintLabelAmplopHasilLaboratorium
        public static void PrintLabelAmplopHasilLaboratorium(vLabelPatientRegistrationLaboratory oChargesHd, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();


            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Laboratory, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Laboratory);


                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oChargesHd, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }
        #endregion
        #region PrintLaboratorySampleLabel
        public static void PrintLaboratorySampleLabel(vPatientChargesHdVisit oChargesHd, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Laboratory, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Laboratory);

                if (!string.IsNullOrEmpty(command))
                {
                    if (printFormat == "X255^07")
                    {
                        #region format RSDOSKA
                        vPatient patient = BusinessLayer.GetvPatientList(string.Format("MRN = {0}", oChargesHd.MRN)).FirstOrDefault();
                        string patientAge = "";
                        patientAge = string.Format("{0}thn {1}bln", patient.AgeInYear, patient.AgeInMonth);

                        StringBuilder sb = new StringBuilder();

                        int a1 = 0;
                        int a2 = 0;
                        int a3 = 0;
                        int a4 = 3;
                        int maxA = 0;

                        int diff1 = 50;
                        int diff2 = 10;

                        sb.Append("^XA");
                        for (int i = 0; i < 1; i++)
                        {
                            if (i == 0)
                            {
                                a1 = 15;
                                a2 = 65;
                                a3 = 110;
                            }
                            else
                            {
                                a1 = maxA;
                                a2 = maxA + diff1;
                                a3 = a2 + diff1;
                            }

                            sb.Append("^FO35," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                            sb.Append("^FO35," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.cfCardNameSalutation) + "^FS");
                            sb.Append("^FO35," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");

                            sb.Append("^FO450," + a1 + "^A0N,45,35^FD" + string.Format("{0}", patient.MedicalNo) + "^FS");
                            sb.Append("^FO450," + a2 + "^A0N,45,25^FD" + string.Format("{0}", patient.cfCardNameSalutation) + "^FS");
                            sb.Append("^FO450," + a3 + "^A0N,45,25^FD" + string.Format("{0} / {1}", patient.DateOfBirthInString, patientAge) + "^FS");

                            maxA = a3 + diff2;
                        }
                        sb.Append("^XZ");

                        #region Send Command to Printer
                        DirectPrinting printer = new DirectPrinting();
                        for (int i = 0; i < labelCount; i++)
                        {
                            printer.OpenPrinter(printerUrl);
                            printer.StartDocPrinter();
                            printer.Send("\n");
                            printer.Send("n\n");
                            printer.Send(sb.ToString());
                            printer.Send("p1\n");
                            printer.EndDocPrinter();
                        }
                        #endregion
                    }
                        #endregion
                    else
                    {
                        #region Store Tracer Information to Dictionary

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        foreach (string fieldName in lstField)
                        {
                            if (fieldName != "HealthcareName")
                                labelInfo.Add(fieldName, GetPropertyValue(oChargesHd, fieldName).ToString());
                        }
                        #endregion
                        #region Replace Command's Visit Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion
                        #region Send Command to Printer
                        //Initialize Printer
                        for (int i = 0; i < labelCount; i++)
                        {
                            print.OpenPrinter(printerUrl);
                            print.StartDocPrinter();
                            print.Send("\n");
                            print.Send("n\n"); // clear the image buffer
                            print.Send(labelCommand);
                            print.Send("p1\n"); //print one label
                            print.EndDocPrinter();
                        }
                        #endregion
                    }
                }
            }
        }
        #endregion

        #region PrintLaboratorySampleLabelDt
        public static void PrintLaboratorySampleLabelDt(vLabelPatientRegistrationLaboratory oChargesHd, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();


            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Laboratory, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Laboratory);


                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oChargesHd, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }
        #endregion

        public static void PrintProductionLabel(vItemProductionHd oHeader, string printerUrl1, string printerUrl2, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();
            DrugInfo info = BusinessLayer.GetDrugInfo(oHeader.ItemID);

            string printerUrl = printerUrl1;
            if (info.IsExternalMedication)
            {
                printerUrl = printerUrl2;
            }

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.ProductionLabel, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.ProductionLabel);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oHeader, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Item Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }

        public static void PrintCoverHasilRadiologi(vPatientChargesHd5 oHeader, string printerUrl, string printFormat, int labelCount = 1)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                string command = GenerateLabelCoverRadiologiCommand(oHeader, printFormat);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(command);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    #endregion
                }
            }
        }

        public static string PrintCoverHasilRadiologiUsingClientService(vPatientChargesHd5 oHeader, string printFormat)
        {
            vRegistration reg = BusinessLayer.GetvRegistrationList(String.Format("RegistrationID = {0}", oHeader.RegistrationID)).FirstOrDefault();
            List<vPatientChargesDt> lstDt = BusinessLayer.GetvPatientChargesDtList(String.Format("TransactionID = {0} AND GCTransactionStatus != '{1}' AND IsDeleted = 0", oHeader.TransactionID, Constant.TransactionStatus.VOID));
            string asal = oHeader.DepartmentID;
            string paramedic = oHeader.RegistrationPhysicianName;

            if (asal == Constant.Facility.OUTPATIENT)
            {
                asal = "OP";
            }
            else if (asal == Constant.Facility.EMERGENCY)
            {
                asal = "EM";
            }
            else if (asal == Constant.Facility.INPATIENT)
            {
                asal = "IP" + reg.BedCode;
            }
            else if (asal == Constant.Facility.MEDICAL_CHECKUP)
            {
                asal = "MCU";
            }
            else if (asal == Constant.Facility.LABORATORY)
            {
                asal = "LB";
            }
            else if (asal == Constant.Facility.PHARMACY)
            {
                asal = "PH";
            }
            else if (asal == Constant.Facility.DIAGNOSTIC)
            {
                paramedic = oHeader.ReferrerParamedicName;
                asal = "MD";
            }
            else
            {
                asal = "";
            }

            string fileName = string.Empty;
            string command = string.Empty;
            foreach (vPatientChargesDt e in lstDt)
            {
                StikerHasil stk = new StikerHasil();

                stk.nama = oHeader.PatientName;
                stk.tgllahir = oHeader.DateOfBirth;
                stk.sex = oHeader.cfGenderInitial1;
                stk.pengirim = paramedic;
                stk.tglpemeriksaan = oHeader.TransactionDate;
                stk.norm = oHeader.MedicalNo;
                stk.asalpasien = asal;
                stk.Pemeriksaan.Add(e.ItemName1);

                command = command + (new AmplopRad()).GetAmplopCode(stk);
            }

            // Kembalikan hasilnya jadi String


            if (!string.IsNullOrEmpty(command))
            {
                #region Create Temporary Text File to be printed by Printer Client Service
                fileName = CreateTemporayFile(command, "IMC");
                #endregion
            }
            return fileName;
        }

        private static string GenerateLabelCoverRadiologiCommand(vPatientChargesHd5 oHeader, string printFormat)
        {
            //Get and Load Printer Command
            string command = string.Empty;
            command = GetPrintFormat(PrintingGroup.Imaging, printFormat);

            //Get Printing Metadata
            List<string> lstField = GetMetadata(PrintingGroup.Imaging);

            #region Store Tracer Information to Dictionary

            var labelInfo = new Dictionary<string, string>();
            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
            foreach (string fieldName in lstField)
            {
                if (fieldName != "HealthcareName")
                    labelInfo.Add(fieldName, GetPropertyValue(oHeader, fieldName).ToString());
            }
            #endregion
            #region Replace Command's Item Information
            string labelCommand = command;
            foreach (string fieldName in lstField)
            {
                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
            }
            #endregion

            return labelCommand;
        }

        //public static void PrintWristband(vConsultVisit oVisit, string printerUrl, string printFormat)
        public static void PrintWristband(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            DirectPrinting print = new DirectPrinting();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Wristband, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Wristband);

                if (!string.IsNullOrEmpty(command))
                {

                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    if (!printerUrl.Contains(':'))
                    {
                        //Initialize Printer
                        print.OpenPrinter(printerUrl);
                        print.StartDocPrinter();
                        print.Send("\n");
                        print.Send("n\n"); // clear the image buffer
                        print.Send(labelCommand);
                        print.Send("p1\n"); //print one label
                        print.EndDocPrinter();
                    }
                    else
                    {
                        Helper.MedinfrasDirectPrintingTools(printerUrl, labelCommand);
                    }
                    #endregion
                }
            }
        }
        #endregion

        #region PrintLabelPasienRekamMedis2
        public static void printLabelPasienRekamMedis2(vPatient patient, string printerUrl, int labelCount = 1)
        {
            StringBuilder sb = new StringBuilder();

            string NoRM = string.Format("No. RM");
            string Simbol = string.Format(":");
            string MedicalNo = string.Format("{0}", patient.MedicalNo);
            string Nama = string.Format("Nama");
            string PatientSalutation = string.Format("{0} ({1})", patient.cfPatientNameSalutation, patient.cfGenderInitial);
            string TglLahir = string.Format("Tgl Lahir");
            string DateBirthInString = string.Format("{0}", patient.DateOfBirthInString);
            string Umur = string.Format("UMUR");
            string Age = string.Format("{0}", patient.PatientAge);

            sb.Append("^XA");
            sb.Append("^LL270");
            sb.Append("^PW500");
            sb.Append("^LH1,1^MD5");
            sb.Append("^CFA20,20");
            sb.Append("^FO2,18^FD" + NoRM + "^FS");
            sb.Append("^FO115,18^FD" + Simbol + "^FS");
            sb.Append("^FO130,18^FD" + MedicalNo + "^FS");
            sb.Append("^FO2,48^FD" + Nama + "^FS");
            sb.Append("^FO115,48^FD" + Simbol + "^FS");
            sb.Append("^FO130,48^FD" + PatientSalutation + "^FS");
            sb.Append("^FO2,78^FD" + TglLahir + "^FS");
            sb.Append("^FO115,78^FD" + Simbol + "^FS");
            sb.Append("^FO130,78^FD" + DateBirthInString + "^FS");
            sb.Append("^FO2,108^FD" + Umur + "^FS");
            sb.Append("^FO115,108^FD" + Simbol + "^FS");
            sb.Append("^FO130,108^FD" + Age + "^FS");
            sb.Append("^FO02,148^BCN,60,N,N,N^FD" + MedicalNo + "^FS");
            sb.Append("^PR2");
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();

            for (int i = 0; i < labelCount; i++)
            {
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
            }
            #endregion
        }
        #endregion

        #region PrintMRLabelRSRTH
        public static void PrintMRLabelRSRTH(vLabelPatientRegistrationInfo oPatient, string printerUrl, int labelCount = 1)
        {
            StringBuilder sb = new StringBuilder();

            string line2 = string.Format("NO. RM");
            string line3 = string.Format("TANGGAL LAHIR");
            string line4 = string.Format("RUANGAN");
            string line5 = string.Format("BED : ");

            sb.Append("^XA");
            sb.Append("^LL200");
            sb.Append("^PW640");
            sb.Append("^LH10,10^MD10");
            sb.Append("^CF030,30");

            sb.Append("^FO10,30^FD" + oPatient.cfPatientNameSalutation + "^FS");
            sb.Append("^CF024,24");
            sb.Append("^FO10,70^FD" + line2 + "^FS");
            sb.Append("^FO181,70^FD:^FS");
            sb.Append("^FO201,70^FD" + oPatient.MedicalNo + "^FS");

            sb.Append("^FO10,100^FD" + line3 + "^FS");
            sb.Append("^FO181,100^FD:^FS");
            sb.Append("^FO201,100^FD" + string.Format("{0} ({1})", oPatient.DateOfBirthInString, oPatient.Gender) + "^FS");

            sb.Append("^FO10,130^FD" + line4 + "^FS");
            sb.Append("^FO181,130^FD:^FS");
            sb.Append("^FO201,130^FD" + oPatient.RoomName + "^FS");
            sb.Append("^FO350,130^FD" + string.Format("{0} {1}", line5, oPatient.BedCode) + "^FS");

            sb.Append("^FO160,160^BCN,40,Y,N,N^FD" + oPatient.MedicalNo + "^FS");
            sb.Append("^PR2");
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();

            for (int i = 0; i < labelCount; i++)
            {
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
            }
            #endregion
        }
        #endregion

        #region Wristband Label
        private static string GenerateWristbandZPLCommand(ConsultVisit oVisit, string cartridgeType = CARTRIDGE_TYPE_Adult_Clip)
        {
            string result = string.Empty;
            Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);

            if (oRegistration != null)
            {
                if (oRegistration.MRN != null)
                {
                    Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                    GetWristbandInformation(oPatient, oVisit, oRegistration);

                    switch (cartridgeType)
                    {
                        case CARTRIDGE_TYPE_Adult_Clip:
                            result = GenerateZPLForAdultClip(oPatient, oVisit, oRegistration);
                            break;
                        case CARTRIDGE_Type_Adult_Economy:
                            result = GenerateZPLForAdultEconomy(oPatient, oVisit, oRegistration);
                            break;
                        case CARTRIDGE_TYPE_Infant_Clip:
                            result = GenerateZPLForInfantClip(oPatient, oVisit, oRegistration);
                            break;
                        case CARTRIDGE_Type_Soft_Infant:
                            result = GenerateZPLForSoftInfant(oPatient, oVisit, oRegistration);
                            break;
                        default:
                            break;
                    }
                }
            }
            return result;
        }

        private static void GetWristbandInformation(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            string firstName = string.IsNullOrEmpty(oPatient.FirstName) ? "Nama Depan" : oPatient.FirstName;
            string lastName = string.IsNullOrEmpty(oPatient.LastName) ? "Nama Belakang" : oPatient.LastName;
            string gender = oPatient.GCGender == "0003^M" ? "Laki-Laki," : "Perempuan,";
            string age = string.Format("{0} thn {1} bln {2} hari", oRegistration.AgeInYear.ToString(), oRegistration.AgeInMonth.ToString(), oRegistration.AgeInDay.ToString());
            line1 = string.Format("{0} {1} {2} ({3}{4})", oPatient.FirstName, oPatient.MiddleName, oPatient.LastName, gender, age).Trim();
            line4 = string.Format("Tgl Lahir : {0}", oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT)).Trim();

            PatientFamily oFamily = BusinessLayer.GetPatientFamilyList(string.Format("GCFDmilyRelation = '{0}' AND MRN = {1}", "0063^MTH", oPatient.MRN)).FirstOrDefault();
            if (oFamily != null)
                line5 = string.Format("Ibu Kandung : '{0}'", oFamily.FullName).Trim();
            else
                line5 = string.Format(string.Empty);

            //line5 = string.Format("Ibu Kandung : {0}", oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT));

            string mrn = string.IsNullOrWhiteSpace(oPatient.MedicalNo) ? "No.RM" : oPatient.MedicalNo;
            line3 = string.Format("( {0} )     {1}", mrn, oRegistration.RegistrationNo).Trim();

            //string physicianName = oVisit.ParamedicID == null ? "Nama Dokter" : BusinessLayer.GetParamedicMaster((int)oVisit.ParamedicID).FullName;
            string physicianName = "";
            string wardName = oVisit.HealthcareServiceUnitID == null ? "Ruang Rawat" : BusinessLayer.GetServiceUnitMaster(oVisit.HealthcareServiceUnitID).ShortName.ToString();
            string patientLocation = string.Format("{0} - {1}", wardName, BusinessLayer.GetBed((int)oVisit.BedID).BedCode.ToString());
            line2 = string.Format("{0}   {1}", patientLocation, physicianName).Trim();

            if (oPatient.IsHasAllergy)
            {
                allergyInfo = "ALERGI";
            }
            else
            {
                allergyInfo = string.Empty;
            }
        }

        private static string GenerateZPLForAdultClip(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format(@"^XA"));
            command.Append(string.Format(@"^POI"));
            command.Append(string.Format(@"^FWR"));     // Set the default orientation for all command fields (FD)
            command.Append(string.Format(@"^LH0,236")); // Set the Label Home
            command.Append(string.Format(@"^FO45,80 ^BY2,2.9,200^BCN,200,Y,N,N^FD{0}^FS", barcodeValue));
            command.Append(string.Format(@"^FO300,370 ^A0,38,38^FD{0}^FS", line1));
            command.Append(string.Format(@"^FO240,370 ^A0,33,33^FD{0}^FS", line2));
            command.Append(string.Format(@"^FO200,370 ^A0,33,33^FD{0}^FS", line3));
            command.Append(string.Format(@"^FO160,370 ^A0,33,33^FD{0}^FS", line4));
            if (oPatient.IsHasAllergy)
            {
                command.Append(string.Format(@"^FO160,830 ^A0,33,33^FD{0}^FS", allergyInfo));
            }
            command.Append(string.Format(@"^FO120,370 ^A0,33,33^FD{0}^FS", line5));

            command.AppendLine(string.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForAdultEconomy(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format(@"^XA"));
            command.Append(string.Format(@"^POI"));
            command.Append(string.Format(@"^FWR"));     // Set the default orientation for all command fields (FD)
            command.Append(string.Format(@"^LH0,236")); // Set the Label Home
            command.Append(string.Format(@"^FO80,160 ^BY1,2.0,200^BCN,200,Y,N,N^FD{0}^FS", barcodeValue));
            command.Append(string.Format(@"^FO250,400 ^A0,38,38^FD{0}^FS", line1));
            command.Append(string.Format(@"^FO200,400 ^A0,33,33^FD{0}^FS", line2));
            command.Append(string.Format(@"^FO160,400 ^A0,33,33^FD{0}^FS", line3));
            command.Append(string.Format(@"^FO120,400 ^A0,33,33^FD{0}^FS", line4));
            if (oPatient.IsHasAllergy)
            {
                command.Append(string.Format(@"^FO160,830 ^A0,33,33^FD{0}^FS", allergyInfo));
            }
            command.Append(string.Format(@"^FO80,400 ^A0,33,33^FD{0}^FS", line5));

            command.AppendLine(string.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForInfantClip(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format(@"^XA"));
            command.Append(string.Format(@"^POI"));
            command.Append(string.Format(@"^FWR"));     // Set the default orientation for all command fields (FD)
            command.Append(string.Format(@"^LH0,260")); // Set the Label Home
            command.Append(string.Format(@"^FO80,110 ^BY1,2.0,180^BCN,180,Y,N,N^FD{0}^FS", barcodeValue));
            command.Append(string.Format(@"^FO250,340 ^A0,38,38^FD{0}^FS", line1));
            command.Append(string.Format(@"^FO190,340 ^A0,33,33^FD{0}^FS", line2));
            command.Append(string.Format(@"^FO150,340 ^A0,33,33^FD{0}^FS", line3));
            command.Append(string.Format(@"^FO110,340 ^A0,33,33^FD{0}^FS", line4));
            if (oPatient.IsHasAllergy)
            {
                command.Append(string.Format(@"^FO110,800 ^A0,33,33^FD{0}^FS", allergyInfo));
            }
            command.Append(string.Format(@"^FO70,340 ^A0,33,33^FD{0}^FS", line5));
            command.AppendLine(string.Format("^XZ"));

            return command.ToString();
        }

        private static string GenerateZPLForSoftInfant(Patient oPatient, ConsultVisit oVisit, Registration oRegistration)
        {
            StringBuilder command = new StringBuilder();
            string barcodeValue = oPatient.MedicalNo;

            command.Append(string.Format(@"^XA"));
            command.Append(string.Format(@"^POI"));
            command.Append(string.Format(@"^FWR"));     // Set the default orientation for all command fields (FD)
            command.Append(string.Format(@"^LH0,135")); // Set the Label Home            
            //command.Append(string.Format(@"^F190,800 ^BY1,2.0,80^BCR,80,N,N,N^FD{0}^FS", barcodeValue));
            command.Append(string.Format(@"^FO230,10 ^A0,30,30^FD{0}^FS", line1));
            command.Append(string.Format(@"^FO190,10 ^A0,25,25^FD{0}^FS", line2));
            command.Append(string.Format(@"^FO160,10 ^A0,25,25^FD{0}^FS", line3));
            command.Append(string.Format(@"^FO130,10 ^A0,25,25^FD{0}^FS", line4));
            if (oPatient.IsHasAllergy)
            {
                command.Append(string.Format(@"^FO130,330 ^A0,25,25^FD{0}^FS", allergyInfo));
            }
            command.Append(string.Format(@"^FO100,10 ^A0,25,25^FD{0}^FS", line5));
            command.AppendLine(string.Format("^XZ"));

            return command.ToString();
        }
        #endregion

        #region Meal Label

        private static void GetPatientMealLabelInformation(vNutritionOrderDtCustom oVisit)
        {
            //string PatientName = string.IsNullOrEmpty(oVisit.PatientName) ? "Nama Pasien" : oVisit.PatientName;
            //string gender = oVisit.GCGender == "0003^M" ? "Laki-Laki" : "Perempuan";
            //string age = string.Format("{0} thn {1} bln {2} hari", oVisit.AgeInYear.ToString(), oVisit.AgeInMonth.ToString(), oVisit.AgeInDay.ToString());
            //line1 = string.Format("{0} ({1})", PatientName,gender);

            //string mrn = string.IsNullOrWhiteSpace(oVisit.MedicalNo) ? "No.RM" : oVisit.MedicalNo;
            //line2 = string.Format("{0}/{1}", oVisit.RegistrationNo, oVisit.MedicalNo);
            //line3 = string.Format("{0} ({1})", oVisit.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT), age);
            //string physicianName = oVisit.ParamedicID == null ? "Nama Dokter" : BusinessLayer.GetParamedicMaster((int)oVisit.ParamedicID).FullName;
            //line4 = physicianName;
            //string wardName = oVisit.HealthcareServiceUnitID == null ? "Ruang Rawat" : BusinessLayer.GetServiceUnitMaster(oVisit.HealthcareServiceUnitID).ShortName.ToString();
            //string patientLocation = string.Format("{0} - {1}", wardName, BusinessLayer.GetBed((int)oVisit.BedID).BedCode.ToString());
            //line5 = string.Format("{0}", patientLocation);
            //line6 = string.Format("{0}, {1}",oVisit.MealTime, oVisit.MealPlanName);


        }

        private static string GenerateMealLabelZPLCommand(vNutritionOrderDtCustom oVisit, string labelSizeType = Meal_Label_Size_8x3)
        {
            string result = string.Empty;
            String filterExpersion = String.Format("");

            if (oVisit != null)
            {
                if (oVisit.NutritionOrderNo != null)
                {

                    GetPatientMealLabelInformation(oVisit);

                    switch (labelSizeType)
                    {
                        //case MR_Label_Size_4x2:
                        //    result = GenerateZPLForLabel4_1(oPatient, oVisit, oRegistration);
                        //    break;
                        case MR_Label_Size_8x3:
                            result = GenerateZPLForMealLabel8x3(oVisit);
                            break;
                        //    case ZebraPrinterLib.WRISTBAND_TYPE_Adult_Adhesive:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Comfort_Blue:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Comfort_Pink:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Splash_Blue:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Splash_Pink:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Splash_Red:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Splash_Yellow:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        //    case ZebraPrinterLib.WRISTBAND_Type_Adult_Splash_Purple:
                        //        result = GenerateZPLForAdultAdhesive(oPatient,oVisit,oRegistration);
                        //        break;
                        default:
                            break;
                    }
                }
            }
            return result;
        }

        private static string GenerateZPLForMealLabel8x3(vNutritionOrderDtCustom oVisit)
        {
            StringBuilder command = new StringBuilder();

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^LL210"));
            command.Append(string.Format("^PW600"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF025,25"));
            command.Append(String.Format("^FO2,20^FD{0}^FS", line1));
            command.Append(string.Format("^CF018,20"));
            command.Append(String.Format("^FO2,50^FDNOREG / NORM^FS"));
            command.Append(String.Format("^FO161,50^FD:^FS"));
            command.Append(String.Format("^FO181,50^FD{0}^FS", line2));
            command.Append(String.Format("^FO2,70^FDTANGGAL LAHIR^FS"));
            command.Append(String.Format("^FO161,70^FD:^FS"));
            command.Append(String.Format("^FO181,70^FD{0}^FS", line3));
            command.Append(String.Format("^FO2,90^FDDOKTER^FS"));
            command.Append(String.Format("^FO161,90^FD:^FS"));
            command.Append(String.Format("^FO181,90^FD{0}^FS", line4));
            command.Append(String.Format("^FO2,110^FDRUANG RAWAT^FS"));
            command.Append(String.Format("^FO161,110^FD:^FS"));
            command.Append(String.Format("^FO181,110^FD{0}^FS", line5));
            command.Append(String.Format("^FO2,130^FDMEAL PLAN^FS"));
            command.Append(String.Format("^FO161,130^FD:^FS"));
            command.Append(String.Format("^FO181,130^FD{0}^FS", line6));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));

            return command.ToString();
        }
        #endregion

        #region Drug Label
        /// <summary>
        /// Not by IP Address : RSPB
        /// </summary>
        /// <param name="oHeader"></param>
        /// <param name="printFormat"></param>
        /// <param name="lstPrescriptionOrderDtID"></param>
        #region PrintDrugLabel
        public static void PrintDrugLabel(PrescriptionOrderHd oHeader, string printFormat, String lstPrescriptionOrderDtID = "")
        {
            #region Printer Configuration
            string paramCodeList = string.Format("('{0}','{1}')", Constant.SettingParameter.FM_ALAMAT_PRINTER_ETIKET_OBAT_DALAM,
                Constant.SettingParameter.FM_ALAMAT_PRINTER_ETIKET_OBAT_LUAR);
            string paramFilterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN {1}", AppSession.UserLogin.HealthcareID, paramCodeList);

            List<SettingParameterDt> lstParam = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
            string printerName1 = string.Empty;
            string printerName2 = string.Empty;
            if (lstParam != null)
            {
                printerName1 = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_ALAMAT_PRINTER_ETIKET_OBAT_DALAM).FirstOrDefault().ParameterValue.ToString();
                printerName2 = lstParam.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_ALAMAT_PRINTER_ETIKET_OBAT_LUAR).FirstOrDefault().ParameterValue.ToString();
            }
            #endregion

            #region Baru
            if (!string.IsNullOrEmpty(printerName1))
            {
                //dibuat oleh Agustin 2020/04/07
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).FirstOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string patientAgeInYear = ""; //Tambahan
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string cfDispensaryInitial = "";
                        string genericName = "";
                        string storageRemarks = "";

                        patientName = entity.PatientName;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        patientAgeInYear = string.Format("{0}thn", entity.AgeInYear); //Tambahan
                        sex = entity.GCSex == "0003^M" ? "Laki-laki" : "Perempuan";
                        genericName = entity.cfGenericName;

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        string prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        string prescriptionTime = entity.PrescriptionTime;
                        if (entity.TransactionNo != null)
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;
                        string defaultSignaName = string.Empty;
                        string additionalConsumeMethod = string.Empty;

                        paramCodeList = string.Format("('{0}','{1}','{2}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI);
                        paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        string filterExpression = string.Format("PrescriptionOrderID = {0}", entity.PrescriptionOrderID.ToString());
                        if (lstPrescriptionOrderDtID != string.Empty)
                        {
                            filterExpression += string.Format(" AND PrescriptionOrderDetailID IN ({0})", lstPrescriptionOrderDtID);
                        }

                        List<vPrintPrescriptionEtiket> lstDetail = BusinessLayer.GetvPrintPrescriptionEtiketList(filterExpression);
                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        foreach (vPrintPrescriptionEtiket item in lstDetail)
                        {
                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";

                                string expiredDate = "ED: ";
                                if (item.ExpiredDate != null)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                        expiredDate = string.Format("ED : {0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", entityHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", entity.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", entity.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationno);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", entity.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("PatientAgeInYear", patientAgeInYear); //Tambahan
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", genericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }

                                if (item.IsInjection)
                                {
                                    if (!String.IsNullOrEmpty(defaultSigna))
                                    {
                                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
                                        if (signa != null)
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
                                        }
                                        else
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", "");
                                        }
                                    }
                                }
                                else
                                {
                                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                }


                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                //string isUsedQty = "";
                                //if (isUsedDispenseQty == "True")
                                //{
                                //    isUsedQty = item.cfTakenQtyWithUnit;
                                //}
                                //else
                                //{
                                //    isUsedQty = item.cfIsUsedDispenseQty;
                                //}
                                labelInfo.Add("cfCompound1", "");
                                labelInfo.Add("cfCompound2", "");
                                labelInfo.Add("cfCompound3", "");
                                labelInfo.Add("cfCompound4", "");
                                labelInfo.Add("cfCompound5", "");
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfTakenQty);
                                labelInfo.Add("cfIsUsedDispenseQty", item.cfTakenQty);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", item.cfIsLASA);
                                labelInfo.Add("cfIsHAM", item.cfIsHAM);
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                if (item.IsExternalMedication)
                                    printerName = printerName2;

                                printer.OpenPrinter(printerName);
                                printer.StartDocPrinter();
                                printer.Send("\n");
                                printer.Send("n\n");
                                printer.Send(labelCommand);
                                printer.Send("p1\n");
                                printer.EndDocPrinter();
                                #endregion
                            }
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

            #region Lama
            //////#region Lama
            ////////ditutup oleh Agustin 2020/04/07
            //////if (!string.IsNullOrEmpty(printerName1))
            //////{
            //////    vConsultVisit1 oVisit = BusinessLayer.GetvConsultVisit1List(String.Format("VisitID = {0}", oHeader.VisitID.ToString())).FirstOrDefault();
            //////    if (oVisit != null)
            //////    {
            //////        Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
            //////        string command = string.Empty;
            //////        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
            //////        List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
            //////        if (!string.IsNullOrEmpty(command))
            //////        {
            //////            #region Get Header Information
            //////            string registrationno = oRegistration.RegistrationNo;
            //////            string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
            //////            string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

            //////            string patientName = "";
            //////            string medicalNo = "";
            //////            string dateOfBirth = "";
            //////            string patientAge = "";
            //////            string sex = "";
            //////            string cfPatientNameInLabel = "";
            //////            string cfDispensaryInitial = "";

            //////            if (oRegistration.MRN != null && oRegistration.MRN != 0)
            //////            {
            //////                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
            //////                patientName = oPatient.FullName;
            //////                medicalNo = oPatient.MedicalNo;
            //////                dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
            //////                patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
            //////                sex = oPatient.GCSex == "0003^M" ? "Laki-laki" : "Perempuan";
            //////            }
            //////            else
            //////            {
            //////                if (oRegistration.GuestID != null && oRegistration.GuestID != 0)
            //////                {
            //////                    Guest oPatient = BusinessLayer.GetGuest((int)oRegistration.GuestID);
            //////                    patientName = oPatient.FullName;
            //////                    dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
            //////                    patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
            //////                    sex = oPatient.GCGender == "0003^M" ? "Laki-laki" : "Perempuan";
            //////                }
            //////            }

            //////            List<PatientChargesHd> chargesHd = BusinessLayer.GetPatientChargesHdList(string.Format("PrescriptionOrderID = {0}", oHeader.PrescriptionOrderID.ToString()));
            //////            string prescriptionNo = oHeader.PrescriptionOrderNo;
            //////            string prescriptionDate = oHeader.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
            //////            if (chargesHd != null)
            //////            {
            //////                prescriptionNo = chargesHd.FirstOrDefault().TransactionNo;
            //////                prescriptionDate = chargesHd.FirstOrDefault().TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
            //////            }

            //////            #endregion
            //////            #region Get Pharmacist Information
            //////            string pharmacistName = string.Empty;
            //////            string pharmacyLicenseNo = string.Empty;
            //////            string defaultSigna = string.Empty;
            //////            string defaultSignaName = string.Empty;
            //////            string additionalConsumeMethod = string.Empty;

            //////            paramCodeList = string.Format("('{0}','{1}','{2}')", Constant.SettingParameter.PHARMACIST,
            //////                Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI);
            //////            paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

            //////            List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
            //////            if (param != null)
            //////            {
            //////                pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
            //////                pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
            //////                defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
            //////            }
            //////            #endregion
            //////            #region Get Detail Item Information
            //////            string filterExpression = string.Format("PrescriptionOrderID = {0}", oHeader.PrescriptionOrderID.ToString());
            //////            if (lstPrescriptionOrderDtID != string.Empty)
            //////            {
            //////                filterExpression += string.Format(" AND PrescriptionOrderDetailID IN ({0})", lstPrescriptionOrderDtID);
            //////            }
            //////            List<vPrescriptionOrderDt1> lstDetail = BusinessLayer.GetvPrescriptionOrderDt1List(filterExpression);
            //////            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
            //////            foreach (vPrescriptionOrderDt1 item in lstDetail)
            //////            {
            //////                if (item.IsRFlag)
            //////                {
            //////                    #region Store Drug Information to Dictionary
            //////                    string drugName = item.DrugName;
            //////                    if (item.IsCompound)
            //////                        drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";

            //////                    string expiredDate = "ED: ";
            //////                    if (item.ExpiredDate.HasValue)
            //////                    {
            //////                        DateTime expDate = (DateTime)item.ExpiredDate;
            //////                        if (expDate.Date > DateTime.Now.Date)
            //////                            expiredDate = string.Format("ED : {0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
            //////                    }

            //////                    var labelInfo = new Dictionary<string, string>();
            //////                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
            //////                    labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
            //////                    labelInfo.Add("Fax", entityHealthcare.FaxNo1);
            //////                    labelInfo.Add("ShortName", entityHealthcare.ShortName);
            //////                    labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
            //////                    labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
            //////                    labelInfo.Add("Pharmacist", pharmacistName);
            //////                    labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
            //////                    labelInfo.Add("PrescriptionNo", prescriptionNo);
            //////                    labelInfo.Add("PrescriptionDate", prescriptionDate);
            //////                    labelInfo.Add("PhysicianName", physicianName);
            //////                    labelInfo.Add("RegistrationNo", registrationno);
            //////                    labelInfo.Add("MedicalNo", medicalNo);
            //////                    labelInfo.Add("Salutation", oVisit.Salutation);
            //////                    labelInfo.Add("PatientFullName", patientName);
            //////                    labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
            //////                    labelInfo.Add("Sex", sex);
            //////                    labelInfo.Add("PatientAge", patientAge);
            //////                    labelInfo.Add("DateOfBirth", dateOfBirth);
            //////                    labelInfo.Add("ItemName", drugName);

            //////                    SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
            //////                    if (paramdt.ParameterValue == "1")
            //////                    {
            //////                        if (item.IsAsRequired)
            //////                        {
            //////                            if (!String.IsNullOrEmpty(item.SignaName1))
            //////                            {
            //////                                string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
            //////                                labelInfo.Add("ConsumeMethod", signa);
            //////                            }
            //////                            else
            //////                            {
            //////                                string consumeMethod = "";
            //////                                if (item.Frequency > 0)
            //////                                {
            //////                                    switch (item.GCDosingFrequency)
            //////                                    {
            //////                                        case Constant.DosingFrequency.DAY:
            //////                                            consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        case Constant.DosingFrequency.WEEK:
            //////                                            consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        case Constant.DosingFrequency.HOUR:
            //////                                            consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        default:
            //////                                            break;
            //////                                    }
            //////                                }
            //////                                string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
            //////                                labelInfo.Add("ConsumeMethod", signa);
            //////                            }
            //////                        }
            //////                        else
            //////                        {
            //////                            if (!String.IsNullOrEmpty(item.SignaName1))
            //////                            {
            //////                                labelInfo.Add("ConsumeMethod", item.SignaName1);
            //////                            }
            //////                            else
            //////                            {
            //////                                string consumeMethod = "";
            //////                                if (item.Frequency > 0)
            //////                                {
            //////                                    switch (item.GCDosingFrequency)
            //////                                    {
            //////                                        case Constant.DosingFrequency.DAY:
            //////                                            consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        case Constant.DosingFrequency.WEEK:
            //////                                            consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        case Constant.DosingFrequency.HOUR:
            //////                                            consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //////                                            break;
            //////                                        default:
            //////                                            break;
            //////                                    }
            //////                                }
            //////                                labelInfo.Add("ConsumeMethod", consumeMethod);
            //////                            }
            //////                        }
            //////                    }
            //////                    else
            //////                    {
            //////                        if (item.IsAsRequired)
            //////                        {
            //////                            labelInfo.Add("ConsumeMethod", "Jika diperlukan");
            //////                        }
            //////                        else
            //////                        {
            //////                            labelInfo.Add("ConsumeMethod", "");
            //////                        }
            //////                    }

            //////                    if (item.IsInjection)
            //////                    {
            //////                        if (!String.IsNullOrEmpty(defaultSigna))
            //////                        {
            //////                            Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
            //////                            if (signa != null)
            //////                            {
            //////                                labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
            //////                            }
            //////                            else
            //////                            {
            //////                                labelInfo.Add("AdditionalConsumeMethod", "");
            //////                            }
            //////                        }
            //////                    }
            //////                    else
            //////                    {
            //////                        labelInfo.Add("AdditionalConsumeMethod", string.Empty);
            //////                    }


            //////                    labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
            //////                    labelInfo.Add("Route", item.Route);
            //////                    labelInfo.Add("ExpiredDate", expiredDate);
            //////                    labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
            //////                    labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
            //////                    labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
            //////                    if (item.IsInjection)
            //////                    {
            //////                        labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
            //////                    }
            //////                    else if (item.IsExternalMedication)
            //////                    {
            //////                        labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
            //////                    }
            //////                    else
            //////                    {
            //////                        labelInfo.Add("cfMedication", string.Empty);
            //////                    }
            //////                    labelInfo.Add("PatientLocation", patientLocation);
            //////                    labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
            //////                    //string isUsedQty = "";
            //////                    //if (isUsedDispenseQty == "True")
            //////                    //{
            //////                    //    isUsedQty = item.cfTakenQtyWithUnit;
            //////                    //}
            //////                    //else
            //////                    //{
            //////                    //    isUsedQty = item.cfIsUsedDispenseQty;
            //////                    //}
            //////                    labelInfo.Add("cfCompound1", "");
            //////                    labelInfo.Add("cfCompound2", "");
            //////                    labelInfo.Add("cfCompound3", "");
            //////                    labelInfo.Add("cfCompound4", "");
            //////                    labelInfo.Add("cfCompound5", "");
            //////                    labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
            //////                    labelInfo.Add("cfTakenQty", item.cfTakenQty);
            //////                    labelInfo.Add("cfIsUsedDispenseQty", "");
            //////                    labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
            //////                    labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
            //////                    labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
            //////                    labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
            //////                    labelInfo.Add("MedicationLine", item.MedicationLine);
            //////                    labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
            //////                    labelInfo.Add("cfIsLASA", item.cfIsLASA);
            //////                    labelInfo.Add("cfIsHAM", item.cfIsHAM);
            //////                    #endregion

            //////                    #region Replace Prescription Drug Information
            //////                    string labelCommand = command;
            //////                    foreach (string fieldName in lstField)
            //////                    {
            //////                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
            //////                    }
            //////                    #endregion

            //////                    #region Send Command to Printer
            //////                    DirectPrinting printer = new DirectPrinting();
            //////                    string printerName = printerName1;
            //////                    if (item.IsExternalMedication)
            //////                        printerName = printerName2;

            //////                    printer.OpenPrinter(printerName);
            //////                    printer.StartDocPrinter();
            //////                    printer.Send("\n");
            //////                    printer.Send("n\n");
            //////                    printer.Send(labelCommand);
            //////                    printer.Send("p1\n");
            //////                    printer.EndDocPrinter();
            //////                    #endregion
            //////                }
            //////            }
            //////            #endregion
            //////        }
            //////        else
            //////        {
            //////            throw new Exception("Please setup the printer address in System Parameter!");
            //////        }
            //////    }
            //////    else
            //////    {
            //////        throw new Exception("Cannot find Patient Visit Information!");
            //////    }
            //////}
            //////else
            //////{
            //////    throw new Exception("Please setup the printer address in System Parameter!");
            //////}
            //////#endregion
            #endregion
        }
        #endregion

        #region PrintUDDDrugLabel
        /// <summary>
        /// Print Label Etiket UDD : Default
        /// </summary>
        /// <param name="visitID"></param>
        /// <param name="transactionNo"></param>
        /// <param name="transactionDate"></param>
        /// <param name="printFormat"></param>
        /// <param name="lstScheduleID"></param>
        /// <param name="printerUrl1"></param>
        /// <param name="printerUrl2"></param>
        public static void PrintUDDDrugLabel(int visitID, string transactionNo, string transactionDate, string printFormat, String lstScheduleID = "", string printerUrl1 = "", string printerUrl2 = "", string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            if (!string.IsNullOrEmpty(printerName1))
            {
                vConsultVisit1 oVisit = BusinessLayer.GetvConsultVisit1List(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
                vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                if (oVisit != null)
                {
                    Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.UDD, printFormat);
                    List<string> lstField = GetMetadata(PrintingGroup.UDD);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = oRegistration.RegistrationNo;
                        Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                        string patientName = oPatient.FullName;
                        string medicalNo = oPatient.MedicalNo;
                        string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                        string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                        string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

                        //ditutup oleh agustin 20210120, dipindah ke bawah
                        //string prescriptionDate = !string.IsNullOrEmpty(transactionDate) ? transactionDate : DateTime.Now.Date.ToString(Constant.FormatString.DATE_FORMAT);

                        #endregion
                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        string filterExpression = string.Format("VisitID = {0} AND ID IN ({1})", visitID, lstScheduleID);
                        bool isUsingExpiredDate = lstExpiredDate != "";
                        bool isUsingPrintNo = lstPrintNo != "";
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');

                        int index = 0;
                        List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                        Healthcare oHealthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
                        string ConsumeMethodEng = "";
                        SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                        foreach (vMedicationSchedule item in lstDetail)
                        {
                            String filterPrescriptionEtiket = "";
                            if (item.PastMedicationID == 0)
                            {
                                filterPrescriptionEtiket = String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", visitID.ToString(), item.PrescriptionOrderId);
                            }
                            else
                            {
                                filterPrescriptionEtiket = String.Format("VisitID = {0}", visitID.ToString());
                            }

                            string prescriptionDate = item.MedicationDate.ToString(Constant.FormatString.DATE_FORMAT);
                            string prescriptionTime = item.MedicationTime;

                            vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(filterPrescriptionEtiket).LastOrDefault();

                            string cfPatientNameInLabel = "";
                            string cfTransactionNo = "";
                            string cfServiceUnitCode = "";
                            string storageRemarks = "";

                            if (entity != null)
                            {
                                cfPatientNameInLabel = entity.PatientName;
                                cfTransactionNo = entity.TransactionNo;
                                cfServiceUnitCode = entity.ServiceUnitCode;
                            }
                            else
                            {
                                cfPatientNameInLabel = oVisit.PatientName;
                            }

                            string[] names = cfPatientNameInLabel.Split(' ');

                            if (names.Length >= 3)
                            {
                                cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                            }

                            if (cfPatientNameInLabel.Length > 25)
                            {
                                cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                            }

                            if (storageRemarks.Length > 55)
                            {
                                storageRemarks = storageRemarks.Substring(0, 55);
                            }

                            string physicianName = item.PhysicianName;

                            #region Store Drug Information to Dictionary
                            string homeMedication = item.IsInternalMedication ? "" : "*";
                            string drugName = string.Format("{0}{1}", homeMedication, item.DrugName);
                            string expiredDate = string.Format("ED: {0}", (isUsingExpiredDate ? expiredDateInfo[index] : string.Empty));
                            string beyondUseDate = string.Format("BUD: {0}", (isUsingExpiredDate ? expiredDateInfo[index] : string.Empty));
                            string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                            string prescriptionNo = cfTransactionNo;

                            if (prescriptionNo == null)
                            {
                                prescriptionNo = transactionNo;
                            }

                            var labelInfo = new Dictionary<string, string>();
                            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                            labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                            labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                            labelInfo.Add("ShortName", oHealthcare.ShortName);
                            labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
                            labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
                            labelInfo.Add("Pharmacist", pharmacistName);
                            labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                            labelInfo.Add("PrescriptionNo", prescriptionNo);
                            labelInfo.Add("PrescriptionDate", prescriptionDate);
                            labelInfo.Add("PrescriptionTime", prescriptionTime);
                            labelInfo.Add("PhysicianName", physicianName);
                            labelInfo.Add("RegistrationNo", registrationno);
                            labelInfo.Add("Salutation", oVisit.Salutation);
                            labelInfo.Add("MedicalNo", medicalNo);
                            labelInfo.Add("PatientFullName", patientName);
                            labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                            labelInfo.Add("Sex", sex);
                            labelInfo.Add("PatientAge", patientAge);
                            labelInfo.Add("DateOfBirth", dateOfBirth);
                            labelInfo.Add("ItemName", drugName);
                            labelInfo.Add("cfGenericName", item.cfGenericName);
                            labelInfo.Add("DoseUnit", doseUnit);

                            if (!String.IsNullOrEmpty(item.SignaName1))
                            {
                                labelInfo.Add("ConsumeMethod", item.SignaName1);
                            }
                            else
                            {
                                if (!item.IsAsRequired)
                                {
                                    string consumeMethod = "";
                                    switch (item.GCDosingFrequency)
                                    {
                                        case Constant.DosingFrequency.DAY:
                                            consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.WEEK:
                                            consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.HOUR:
                                            consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        default:
                                            break;
                                    }
                                    labelInfo.Add("ConsumeMethod", consumeMethod);
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                }
                            }
                            #region ConsumeMethodEng
                            if (paramdt.ParameterValue == "1")
                            {
                                if (item.IsAsRequired)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0} (If needed)", consumeMethod);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                    }
                                }
                            }
                            else
                            {
                                if (item.IsAsRequired)
                                {
                                    labelInfo.Add("ConsumeMethodEng", "If needed");
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethodEng", "");
                                }
                            }
                            #endregion

                            labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                            labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                            labelInfo.Add("Route", item.Route);
                            labelInfo.Add("MedicationRoute", item.MedicationRoute);
                            labelInfo.Add("ExpiredDate", expiredDate);
                            labelInfo.Add("BeyondUseDate", beyondUseDate);
                            labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                            labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            if (item.IsInjection)
                            {
                                labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            }
                            else if (item.IsExternalMedication)
                            {
                                labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            }
                            else
                            {
                                labelInfo.Add("cfMedication", string.Empty);
                            }
                            labelInfo.Add("SequenceNo", item.SequenceNo);
                            labelInfo.Add("MedicationTime", item.MedicationTime);
                            labelInfo.Add("ChargeQuantity", Convert.ToString(item.ChargeQuantity));
                            labelInfo.Add("PatientLocation", patientLocation);
                            labelInfo.Add("cfDispensaryInitial", cfServiceUnitCode);
                            labelInfo.Add("cfDispenseQty", item.NumberOfDosage.ToString());
                            labelInfo.Add("cfTakenQty", item.NumberOfDosage.ToString());
                            labelInfo.Add("cfIsUsedDispenseQty", "");
                            labelInfo.Add("cfTakenQtyWithItemUnit", item.cfDosingQuantity);
                            labelInfo.Add("cfConsumeMethodRoute", "");
                            labelInfo.Add("cfCoenamRuleLabel", "");
                            labelInfo.Add("cfDailyInformation", "");
                            labelInfo.Add("MedicationLine", "");
                            labelInfo.Add("cfMedicalAdministrationNonDaily", "");
                            labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                            labelInfo.Add("StorageRemarks", storageRemarks);
                            labelInfo.Add("cfIsLASA", "");
                            labelInfo.Add("cfIsHAM", item.cfIsHAM);
                            labelInfo.Add("cfIsPRNIMM", "");
                            if (entity != null)
                            {
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                            }
                            labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                            labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                            #endregion

                            #region Replace Prescription Drug Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            int noOfPrint = 1;
                            if (isUsingPrintNo)
                                noOfPrint = Convert.ToInt16(printNoInfo[index]);
                            for (int i = 1; i <= noOfPrint; i++)
                            {
                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                if (item.IsExternalMedication)
                                    printerName = printerName2;

                                if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                else
                                {
                                    if (item.IsExternalMedication)
                                    {
                                        Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                    }
                                    else
                                    {
                                        Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                    }
                                }
                            }
                            #endregion

                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #region PrintDrugLabel
        //Default
        public static void PrintDrugLabel(PrescriptionOrderHd oHeader, string printFormat, String lstPrescriptionOrderDtID = "", string printerUrl1 = "", string printerUrl2 = "", Boolean isPrintByType = false, string printFormat2 = "", string isUsedDispenseQty = "", bool isPrintCompoundDetailLabel = false, int labelCount = 0, string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            #region Baru
            ////dibuat oleh Agustin 2020/04/07
            if (!string.IsNullOrEmpty(printerName1))
            {
                //vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).FirstOrDefault();
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).LastOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    if (isPrintByType)
                    {
                        if (oHeader.GCPrescriptionType != Constant.PrescriptionType.MEDICATION_ORDER)
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat2);
                        else
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }
                    else
                    {
                        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }

                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string prescriptionDate = "";
                        string prescriptionTime = "";
                        string storageRemarks = "";
                        string PharmacyPhoneNo = "";
                        string cfPrescriptionDateInString1 = "";
                        string compoundRSSES = "";

                        string ConsumeMethodEng = "";
                        if (patientLocation.Length > 30)
                        {
                            patientLocation = patientLocation.Substring(0, 30);
                        }

                        patientName = entity.PatientName; ;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        sex = entity.GCSex == "0003^M" ? "L" : "P";

                        cfPatientNameInLabel = entity.PatientName;
                        string[] names = cfPatientNameInLabel.Split(' ');

                        if (names.Length >= 3)
                        {
                            cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                        }

                        if (cfPatientNameInLabel.Length > 25)
                        {
                            cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                        }

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        cfPrescriptionDateInString1 = entity.cfPrescriptionDateInString1;
                        prescriptionTime = entity.PrescriptionTime;
                        string cfDispensaryInitial = "";
                        if (entity.TransactionNo != null)
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                            cfDispensaryInitial = string.Format("({0})", entity.ServiceUnitCode);
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}','{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();

                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        //string filterExpression = string.Format("PrescriptionOrderID = {0}", entity.PrescriptionOrderID.ToString());
                        //string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0", entity.PrescriptionOrderID.ToString());
                        string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0 AND ParentID IS NULL", entity.PrescriptionOrderID.ToString());
                        if (lstPrescriptionOrderDtID != string.Empty)
                        {
                            filterExpression += string.Format(" AND PrescriptionOrderDetailID IN ({0})", lstPrescriptionOrderDtID);
                        }

                        List<vPrintPrescriptionEtiket> lstDetail = BusinessLayer.GetvPrintPrescriptionEtiketList(filterExpression);
                        List<vPrintPrescriptionEtiket> lstCompoundDetail = new List<vPrintPrescriptionEtiket>();

                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        bool isUsingExpiredDate = !string.IsNullOrEmpty(lstExpiredDate);
                        bool isUsingPrintNo = !string.IsNullOrEmpty(lstExpiredDate);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;

                        foreach (vPrintPrescriptionEtiket item in lstDetail)
                        {
                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";
                                    if (isPrintCompoundDetailLabel == true)
                                    {
                                        lstCompoundDetail.Add(item);
                                    }

                                    //if (!string.IsNullOrEmpty(entity.MedicationLine)) {

                                    //    if (item.ParentID == 0)
                                    //    {
                                    //        compoundRSSES = item.MedicationLine.Replace(@"+",",");

                                    //    }
                                    //    else {

                                    //        compoundRSSES = lstDetail.Where(r => r.ParentID == 0 && r.PrescriptionOrderDetailID == item.ParentID).FirstOrDefault().MedicationLine.Replace(@"+", ",");

                                    //    }

                                    //}
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }


                                }

                                string expiredDate = "";
                                if (item.ExpiredDate != null)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                    {
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                    }
                                    else
                                    {
                                        if (isUsingExpiredDate)
                                        {
                                            expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                        }
                                    }
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);


                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", entityHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", entity.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", entity.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationno);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", entity.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                if (item.IsInjection)
                                {
                                    if (!String.IsNullOrEmpty(defaultSigna))
                                    {
                                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
                                        if (signa != null)
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
                                        }
                                        else
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", "");
                                        }
                                    }
                                }
                                else
                                {
                                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                }


                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty = "";
                                if (isUsedDispenseQty == "True")
                                {
                                    isUsedQty = item.cfTakenQtyWithUnit;
                                }
                                else
                                {
                                    isUsedQty = item.cfDispenseQty;
                                }
                                string isUsedQty1 = "";
                                if (item.IsCompound == true)
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithUnit;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQty;
                                    }
                                }
                                else
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithForm;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQtyWithForm;
                                    }
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                labelInfo.Add("cfCompound1", "");
                                labelInfo.Add("cfCompound2", "");
                                labelInfo.Add("cfCompound3", "");
                                labelInfo.Add("cfCompound4", "");
                                labelInfo.Add("cfCompound5", "");
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfTakenQty);
                                labelInfo.Add("cfIsUsedDispenseQty", isUsedQty);
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", item.cfIsLASA);
                                labelInfo.Add("cfIsHAM", item.cfIsHAM);
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", cfPrescriptionDateInString1);
                                labelInfo.Add("cfDateOfBirthInString1", entity.cfDateOfBirthInString1);
                                labelInfo.Add("RoomName", entity.RoomName);
                                labelInfo.Add("cfTakenQtyWithUnit", entity.cfTakenQtyWithUnit);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);
                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);

                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = labelCount;
                                if (isUsingPrintNo)
                                {
                                    noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                }
                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                if (item.IsExternalMedication)
                                    printerName = printerName2;

                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        printer.OpenPrinter(printerName);
                                        printer.StartDocPrinter();
                                        printer.Send("\n");
                                        printer.Send("n\n");
                                        printer.Send(labelCommand);
                                        printer.Send("p1\n");
                                        printer.EndDocPrinter();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }
                                
                                #endregion

                                compoundRSSES = "";

                                #region Compound Detail Printing
                                if (lstCompoundDetail.Count > 0)
                                {
                                    #region detail racikan
                                    //ditutup oleh Agustin 2019/08/09 : ubah konsep untuk cetakn detail Obat Racikan RSDO
                                    string filterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN ('{1}','{2}')",
                                    AppSession.UserLogin.HealthcareID, Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN, Constant.SettingParameter.FM_PRINT_ETIKET_DETAIL_OBAT_RACIKAN);
                                    List<vSettingParameterDt> lstParam = BusinessLayer.GetvSettingParameterDtList(filterExp);
                                    string printFormatRacikan = lstParam.Where(lst => lst.ParameterCode.Equals(Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN)).FirstOrDefault().ParameterValue;

                                    string labelFormat = string.Empty; //Read from Setting Parameter
                                    string ipAddress = HttpContext.Current.Request.UserHostAddress;

                                    filterExp = string.Format("IPAddress = '{0}' AND GCPrinterType IN ('{1}','{2}') AND IsDeleted=0",
                                        ipAddress, Constant.DirectPrintType.ETIKET_OBAT_DALAM, Constant.DirectPrintType.ETIKET_OBAT_LUAR);

                                    List<PrinterLocation> lstPrinter = BusinessLayer.GetPrinterLocationList(filterExp);
                                    string printerUrlRacikan1 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_DALAM).FirstOrDefault().PrinterName;
                                    string printerUrlRacikan2 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_LUAR).FirstOrDefault().PrinterName;

                                    PrescriptionOrderHd oHeaderRacikan = BusinessLayer.GetPrescriptionOrderHd(oHeader.PrescriptionOrderID);

                                    PrintCompoundDetailLabel(oHeaderRacikan, printFormatRacikan, lstCompoundDetail, printerUrlRacikan1, printerUrlRacikan2);
                                    lstCompoundDetail.Clear();
                                    #endregion
                                }
                                #endregion
                            }
                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

        }
        #endregion

        #region PrintDrugLabel1
        //Default
        public static void PrintDrugLabel1(PrescriptionOrderHd oHeader, string printFormat, String lstRecordID, string printerUrl1 = "", string printerUrl2 = "", Boolean isPrintByType = false, string printFormat2 = "", string isUsedDispenseQty = "", bool isPrintCompoundDetailLabel = false, int labelCount = 0, string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            #region Baru
            ////dibuat oleh Agustin 2020/04/07
            if (!string.IsNullOrEmpty(printerName1))
            {
                //vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).FirstOrDefault();
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).LastOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    if (isPrintByType)
                    {
                        if (oHeader.GCPrescriptionType != Constant.PrescriptionType.MEDICATION_ORDER)
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat2);
                        else
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }
                    else
                    {
                        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }

                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string prescriptionDate = "";
                        string prescriptionTime = "";
                        string compoundRSSES = "";
                        if (patientLocation.Length > 30)
                        {
                            patientLocation = patientLocation.Substring(0, 30);
                        }

                        patientName = entity.PatientName; ;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        sex = entity.GCSex == "0003^M" ? "L" : "P";

                        cfPatientNameInLabel = entity.PatientName; ;
                        string[] names = cfPatientNameInLabel.Split(' ');

                        if (names.Length >= 3)
                        {
                            cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                        }

                        if (cfPatientNameInLabel.Length > 25)
                        {
                            cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                        }

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        prescriptionTime = entity.PrescriptionTime;
                        string cfDispensaryInitial = "";
                        if (entity.TransactionNo != null)
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                            cfDispensaryInitial = string.Format("({0})", entity.ServiceUnitCode);
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}', '{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);
                        string PharmacyPhoneNo = "";
                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        //string filterExpression = string.Format("PrescriptionOrderID = {0}", entity.PrescriptionOrderID.ToString());
                        //string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0", entity.PrescriptionOrderID.ToString());
                        string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0 AND ParentID IS NULL", entity.PrescriptionOrderID.ToString());
                        if (lstRecordID != string.Empty)
                        {
                            filterExpression += string.Format(" AND ID IN ({0}) ORDER BY ID", lstRecordID);
                        }

                        List<vPrintPrescriptionEtiket> lstDetail = BusinessLayer.GetvPrintPrescriptionEtiketList(filterExpression);
                        List<vPrintPrescriptionEtiket> lstCompoundDetail = new List<vPrintPrescriptionEtiket>();

                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        bool isUsingExpiredDate = !string.IsNullOrEmpty(lstExpiredDate);
                        bool isUsingPrintNo = !string.IsNullOrEmpty(lstExpiredDate);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;

                        foreach (vPrintPrescriptionEtiket item in lstDetail)
                        {
                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";
                                    if (isPrintCompoundDetailLabel == true)
                                    {
                                        lstCompoundDetail.Add(item);
                                    }

                                    //if (!string.IsNullOrEmpty(item.MedicationLine))
                                    //{
                                    //    if (item.ParentID == 0)
                                    //    {
                                    //        compoundRSSES = item.MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //    else
                                    //    {
                                    //        compoundRSSES = lstDetail.Where(r => r.ParentID == 0 && r.PrescriptionOrderDetailID == item.ParentID).FirstOrDefault().MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //}
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }

                                }

                                string expiredDate = "";
                                if (item.ExpiredDate != null)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                    {
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                    }
                                    else
                                    {
                                        if (isUsingExpiredDate)
                                        {
                                            expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                        }
                                    }
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);


                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", entityHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", entity.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", entity.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationno);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", entity.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                if (item.IsInjection)
                                {
                                    if (!String.IsNullOrEmpty(defaultSigna))
                                    {
                                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
                                        if (signa != null)
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
                                        }
                                        else
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", "");
                                        }
                                    }
                                }
                                else
                                {
                                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                }


                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty1 = "";
                                if (isUsedDispenseQty == "True")
                                {
                                    isUsedQty1 = item.cfTakenQtyWithForm;
                                }
                                else
                                {
                                    isUsedQty1 = item.cfDispenseQtyWithForm;
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                labelInfo.Add("cfCompound1", "");
                                labelInfo.Add("cfCompound2", "");
                                labelInfo.Add("cfCompound3", "");
                                labelInfo.Add("cfCompound4", "");
                                labelInfo.Add("cfCompound5", "");
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfTakenQtyWithDrugForm", item.cfTakenQtyWithDrugForm);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfTakenQty);
                                labelInfo.Add("cfIsUsedDispenseQty", "");
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", item.cfIsLASA);
                                labelInfo.Add("cfIsHAM", item.cfIsHAM);
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", entity.cfPrescriptionDateInString1);
                                labelInfo.Add("cfDateOfBirthInString1", entity.cfDateOfBirthInString1);
                                labelInfo.Add("cfTakenQtyWithUnit", entity.cfTakenQtyWithUnit);
                                labelInfo.Add("RoomName", entity.RoomName);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);

                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = labelCount;
                                if (isUsingPrintNo)
                                {
                                    noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                }
                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                if (item.IsExternalMedication)
                                    printerName = printerName2;
                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        printer.OpenPrinter(printerName);
                                        printer.StartDocPrinter();
                                        printer.Send("\n");
                                        printer.Send("n\n");
                                        printer.Send(labelCommand);
                                        printer.Send("p1\n");
                                        printer.EndDocPrinter();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }
                                #endregion

                                #region Compound Detail Printing
                                if (lstCompoundDetail.Count > 0)
                                {
                                    #region detail racikan
                                    //ditutup oleh Agustin 2019/08/09 : ubah konsep untuk cetakn detail Obat Racikan RSDO
                                    string filterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN ('{1}','{2}')",
                                    AppSession.UserLogin.HealthcareID, Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN, Constant.SettingParameter.FM_PRINT_ETIKET_DETAIL_OBAT_RACIKAN);
                                    List<vSettingParameterDt> lstParam = BusinessLayer.GetvSettingParameterDtList(filterExp);
                                    string printFormatRacikan = lstParam.Where(lst => lst.ParameterCode.Equals(Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN)).FirstOrDefault().ParameterValue;

                                    string labelFormat = string.Empty; //Read from Setting Parameter
                                    string ipAddress = HttpContext.Current.Request.UserHostAddress;

                                    filterExp = string.Format("IPAddress = '{0}' AND GCPrinterType IN ('{1}','{2}') AND IsDeleted=0",
                                        ipAddress, Constant.DirectPrintType.ETIKET_OBAT_DALAM, Constant.DirectPrintType.ETIKET_OBAT_LUAR);

                                    List<PrinterLocation> lstPrinter = BusinessLayer.GetPrinterLocationList(filterExp);
                                    string printerUrlRacikan1 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_DALAM).FirstOrDefault().PrinterName;
                                    string printerUrlRacikan2 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_LUAR).FirstOrDefault().PrinterName;

                                    PrescriptionOrderHd oHeaderRacikan = BusinessLayer.GetPrescriptionOrderHd(oHeader.PrescriptionOrderID);

                                    PrintCompoundDetailLabel(oHeaderRacikan, printFormatRacikan, lstCompoundDetail, printerUrlRacikan1, printerUrlRacikan2);
                                    lstCompoundDetail.Clear();
                                    #endregion
                                }
                                #endregion
                            }
                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

        }
        #endregion

        #region Etiket Racikan
        /// <summary>
        /// untuk detail racikan
        /// </summary>
        /// <param name="oHeader"></param>
        /// <param name="labelFormat"></param>
        /// <param name="lstCompoundDetail"></param>
        private static void PrintCompoundDetailLabel(PrescriptionOrderHd oHeaderRacikan, string printFormatRacikan, List<vPrintPrescriptionEtiket> lstCompoundDetail, string printerUrlRacikan1, string printerUrlRacikan2)
        //private static void PrintCompoundDetailLabel(PrescriptionOrderHd oHeaderRacikan, string printFormatRacikan, List<vPrescriptionOrderDt1> lstCompoundDetail, string printerUrlRacikan1, string printerUrlRacikan2)
        {
            string printerName1 = printerUrlRacikan1;
            string printerName2 = printerUrlRacikan2;

            #region Baru
            if (!string.IsNullOrEmpty(printerName1))
            {
                //vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0}", oHeaderRacikan.VisitID.ToString())).FirstOrDefault();
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeaderRacikan.VisitID.ToString(), oHeaderRacikan.PrescriptionOrderID)).LastOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.DrugLabel, printFormatRacikan);

                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeaderRacikan.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string cfDispensaryInitial = "";
                        string prescriptionDate = "";
                        string prescriptionTime = "";
                        string PharmacyPhoneNo = "";
                        patientName = entity.PatientName;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        sex = entity.GCSex == "0003^M" ? "Laki-laki" : "Perempuan";

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        prescriptionTime = entity.PrescriptionTime;
                        if (entity.TransactionNo != null && entity.TransactionNo != "")
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}', '{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();

                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        foreach (vPrintPrescriptionEtiket item in lstCompoundDetail)
                        {
                            string expiredDate = "";
                            if (item.ExpiredDate != null)
                            {
                                DateTime expDate = (DateTime)item.ExpiredDate;
                                if (expDate.Date > DateTime.Now.Date)
                                {
                                    expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                }
                            }

                            string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);

                            var labelInfo = new Dictionary<string, string>();

                            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                            labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                            labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                            labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                            labelInfo.Add("ShortName", entityHealthcare.ShortName);
                            labelInfo.Add("ServiceUnitName", item.ServiceUnitName);
                            labelInfo.Add("cfServiceUnitName", item.cfServiceUnitName);
                            labelInfo.Add("Pharmacist", pharmacistName);
                            labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                            labelInfo.Add("PrescriptionNo", prescriptionNo);
                            labelInfo.Add("PrescriptionDate", prescriptionDate);
                            labelInfo.Add("PrescriptionTime", prescriptionTime);
                            labelInfo.Add("PhysicianName", physicianName);
                            labelInfo.Add("RegistrationNo", registrationno);
                            labelInfo.Add("MedicalNo", medicalNo);
                            labelInfo.Add("Salutation", item.Salutation);
                            labelInfo.Add("PatientFullName", patientName);
                            labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                            labelInfo.Add("Sex", sex);
                            labelInfo.Add("PatientAge", patientAge);
                            labelInfo.Add("DateOfBirth", dateOfBirth);
                            labelInfo.Add("ItemName", "");
                            labelInfo.Add("cfGenericName", "");
                            labelInfo.Add("DoseUnit", doseUnit);

                            #region ConsumeMethod1
                            if (!String.IsNullOrEmpty(item.SignaName1))
                            {
                                labelInfo.Add("ConsumeMethod1", item.SignaName1);
                            }
                            else
                            {
                                if (!item.IsAsRequired)
                                {
                                    string consumeMethod1 = "";
                                    switch (item.GCDosingFrequency)
                                    {
                                        case Constant.DosingFrequency.DAY:
                                            consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.WEEK:
                                            consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.HOUR:
                                            consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        default:
                                            break;
                                    }
                                    labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                }
                            }
                            #endregion

                            #region ConsumeMethod2
                            SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                            if (paramdt.ParameterValue == "1")
                            {
                                if (item.IsAsRequired)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                        labelInfo.Add("ConsumeMethod", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                        labelInfo.Add("ConsumeMethod", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        labelInfo.Add("ConsumeMethod", item.SignaName1);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        labelInfo.Add("ConsumeMethod", consumeMethod);
                                    }
                                }
                            }
                            else
                            {
                                if (item.IsAsRequired)
                                {
                                    labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethod", "");
                                }
                            }
                            #endregion

                            #region ConsumeMethod3
                            if (paramdt.ParameterValue == "1")
                            {
                                if (item.IsAsRequired)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0}", item.SignaName1);
                                        labelInfo.Add("ConsumeMethod2", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod2", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        labelInfo.Add("ConsumeMethod2", consumeMethod);
                                    }
                                }
                            }
                            else
                            {
                                if (item.IsAsRequired)
                                {
                                    labelInfo.Add("ConsumeMethod2", "");
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethod2", "");
                                }
                            }
                            #endregion

                            #region ConsumeMethod4
                            if (item.IsAsRequired && item.IsIMM)
                            {
                                string route = string.Format("({0})", item.Route);
                                labelInfo.Add("ConsumeMethod3", route);
                            }
                            else if (item.IsAsRequired && !item.IsIMM)
                            {
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                                else
                                {
                                    string consumeMethod = "";
                                    if (item.Frequency > 0)
                                    {
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            default:
                                                break;
                                        }
                                    }
                                    string signa = string.Format("{0}", consumeMethod);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                            }
                            else if (!item.IsAsRequired && item.IsIMM)
                            {
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                                else
                                {
                                    string consumeMethod = "";
                                    if (item.Frequency > 0)
                                    {
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            default:
                                                break;
                                        }
                                    }
                                    string signa = string.Format("{0}", consumeMethod);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                            }
                            else
                            {
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                                else
                                {
                                    string consumeMethod = "";
                                    if (item.Frequency > 0)
                                    {
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                break;
                                            default:
                                                break;
                                        }
                                    }
                                    string signa = string.Format("{0}", consumeMethod);
                                    labelInfo.Add("ConsumeMethod3", signa);
                                }
                            }
                            #endregion

                            #region ConsumeMethodEng
                            if (paramdt.ParameterValue == "1")
                            {
                                if (item.IsAsRequired)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0} (If needed)", consumeMethod);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                    }
                                }
                            }
                            else
                            {
                                if (item.IsAsRequired)
                                {
                                    labelInfo.Add("ConsumeMethodEng", "If needed");
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethodEng", "");
                                }
                            }
                            #endregion

                            labelInfo.Add("AdditionalConsumeMethod", string.Empty);

                            string tempCompound1 = "";
                            tempCompound1 = item.MedicationLine.Replace(@"+", ",");
                            labelInfo.Add("cfCompound1", tempCompound1);
                            labelInfo.Add("cfCompound2", "");
                            labelInfo.Add("cfCompound3", "");
                            labelInfo.Add("cfCompound4", "");
                            labelInfo.Add("cfCompound5", "");
                            labelInfo.Add("cfCompoundRSSES", "");
                            labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                            labelInfo.Add("Route", item.Route);
                            labelInfo.Add("MedicationRoute", item.MedicationRoute);
                            labelInfo.Add("ExpiredDate", expiredDate);
                            labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                            labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            if (item.IsInjection)
                            {
                                labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            }
                            else if (item.IsExternalMedication)
                            {
                                labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            }
                            else
                            {
                                labelInfo.Add("cfMedication", string.Empty);
                            }
                            labelInfo.Add("PatientLocation", patientLocation);
                            labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                            labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                            labelInfo.Add("cfTakenQty", item.cfTakenQty);
                            labelInfo.Add("cfIsUsedDispenseQty", "");
                            labelInfo.Add("cfIsUsedDispenseQty1", "");
                            labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                            labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                            labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                            labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                            labelInfo.Add("MedicationLine", item.MedicationLine);
                            labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                            labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                            labelInfo.Add("cfIsLASA", item.cfIsLASA);
                            labelInfo.Add("cfIsHAM", item.cfIsHAM);
                            labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                            labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                            labelInfo.Add("cfPrescriptionDateInString1", entity.cfPrescriptionDateInString1);
                            labelInfo.Add("cfDateOfBirthInString1", "");
                            labelInfo.Add("RoomName", item.RoomName);
                            labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                            labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                            labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                            labelInfo.Add("cfTakenQtyWithUnit", entity.cfTakenQtyWithUnit);
                            #region Replace Prescription Drug Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            DirectPrinting printer = new DirectPrinting();
                            string printerName = printerName1;
                            if (item.IsExternalMedication)
                                printerName = printerName2;
                            printer.OpenPrinter(printerName);
                            printer.StartDocPrinter();
                            printer.Send("\n");
                            printer.Send("n\n");
                            printer.Send(labelCommand);
                            printer.Send("p1\n");
                            printer.EndDocPrinter();
                            #endregion
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Please setup the printer address in System Parameter!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

            #region Lama
            ////ditutup oleh Agustin 2020/04/07
            //if (!string.IsNullOrEmpty(printerName1))
            //{
            //    vConsultVisit1 oVisit = BusinessLayer.GetvConsultVisit1List(String.Format("VisitID = {0}", oHeaderRacikan.VisitID.ToString())).FirstOrDefault();
            //    vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
            //    if (oVisit != null)
            //    {
            //        Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
            //        string command = string.Empty;
            //        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormatRacikan);

            //        List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
            //        if (!string.IsNullOrEmpty(command))
            //        {
            //            #region Get Header Information
            //            string registrationno = oRegistration.RegistrationNo;
            //            string physicianName = BusinessLayer.GetParamedicMaster(oHeaderRacikan.ParamedicID).FullName;
            //            string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

            //            string patientName = "";
            //            string medicalNo = "";
            //            string dateOfBirth = "";
            //            string patientAge = "";
            //            string sex = "";
            //            string cfPatientNameInLabel = "";

            //            if (patientLocation.Length > 30)
            //                patientLocation = patientLocation.Substring(0, 30);

            //            if (oRegistration.MRN != null && oRegistration.GuestID != 0)
            //            {
            //                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
            //                patientName = oPatient.FullName;
            //                medicalNo = oPatient.MedicalNo;
            //                dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
            //                patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
            //                sex = oPatient.GCSex == "0003^M" ? "L" : "P";

            //                cfPatientNameInLabel = oPatient.FullName;
            //                string[] names = cfPatientNameInLabel.Split(' ');

            //                if (names.Length >= 3)
            //                    cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);

            //                if (cfPatientNameInLabel.Length > 25)
            //                    cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
            //            }
            //            else
            //            {
            //                if (oRegistration.GuestID != null && oRegistration.GuestID != 0)
            //                {
            //                    Guest oPatient = BusinessLayer.GetGuest((int)oRegistration.GuestID);
            //                    patientName = oPatient.FullName;
            //                    dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
            //                    patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
            //                    sex = oPatient.GCGender == "0003^M" ? "L" : "P";

            //                    cfPatientNameInLabel = oPatient.FullName;
            //                    string[] names = cfPatientNameInLabel.Split(' ');

            //                    if (names.Length >= 3)
            //                        cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);

            //                    if (cfPatientNameInLabel.Length > 25)
            //                        cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
            //                }
            //            }

            //            List<PatientChargesHd> chargesHd = BusinessLayer.GetPatientChargesHdList(string.Format("PrescriptionOrderID = {0}", oHeaderRacikan.PrescriptionOrderID.ToString()));
            //            string prescriptionNo = oHeaderRacikan.PrescriptionOrderNo;
            //            string prescriptionDate = oHeaderRacikan.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
            //            string cfDispensaryInitial = "";
            //            if (chargesHd != null)
            //            {
            //                prescriptionNo = chargesHd.FirstOrDefault().TransactionNo;
            //                prescriptionDate = chargesHd.FirstOrDefault().TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
            //                string filterExp = string.Format("HealthcareServiceUnitID = {0}", chargesHd.FirstOrDefault().HealthcareServiceUnitID);
            //                vHealthcareServiceUnit oServiceunit = BusinessLayer.GetvHealthcareServiceUnitList(filterExp).FirstOrDefault();
            //                if (oServiceunit != null)
            //                    cfDispensaryInitial = string.Format("({0})", oServiceunit.ServiceUnitCode);
            //            }
            //            #endregion

            //            #region Get Pharmacist Information
            //            string pharmacistName = string.Empty;
            //            string pharmacyLicenseNo = string.Empty;
            //            string defaultSigna = string.Empty;

            //            string paramCodeList = string.Format("('{0}','{1}','{2}')", Constant.SettingParameter.PHARMACIST,
            //                Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI);
            //            string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

            //            List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
            //            if (param != null)
            //            {
            //                pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
            //                pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
            //                defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
            //            }
            //            #endregion

            //            #region Get Detail Item Information
            //            Healthcare oHealthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
            //            foreach (vPrescriptionOrderDt1 item in lstCompoundDetail)
            //            {
            //                string expiredDate = "";
            //                if (item.ExpiredDate.HasValue)
            //                {
            //                    DateTime expDate = (DateTime)item.ExpiredDate;
            //                    if (expDate.Date > DateTime.Now.Date)
            //                    {
            //                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
            //                    }
            //                }

            //                var labelInfo = new Dictionary<string, string>();
            //                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
            //                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
            //                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
            //                labelInfo.Add("ShortName", oHealthcare.ShortName);
            //                labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
            //                labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
            //                labelInfo.Add("Pharmacist", pharmacistName);
            //                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
            //                labelInfo.Add("PrescriptionNo", prescriptionNo);
            //                labelInfo.Add("PrescriptionDate", prescriptionDate);
            //                labelInfo.Add("PhysicianName", physicianName);
            //                labelInfo.Add("RegistrationNo", registrationno);
            //                labelInfo.Add("MedicalNo", medicalNo);
            //                labelInfo.Add("Salutation", oVisit.Salutation);
            //                labelInfo.Add("PatientFullName", patientName);
            //                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
            //                labelInfo.Add("Sex", sex);
            //                labelInfo.Add("PatientAge", patientAge);
            //                labelInfo.Add("DateOfBirth", dateOfBirth);
            //                labelInfo.Add("ItemName", "");

            //                string tempCompound1 = "";
            //                tempCompound1 = item.MedicationLine.Replace(@"+", ",");
            //                labelInfo.Add("cfCompound1", tempCompound1);
            //                labelInfo.Add("cfCompound2", "");
            //                labelInfo.Add("cfCompound3", "");
            //                labelInfo.Add("cfCompound4", "");
            //                labelInfo.Add("cfCompound5", "");

            //                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
            //                if (paramdt.ParameterValue == "1")
            //                {
            //                    if (item.IsAsRequired)
            //                    {
            //                        if (!String.IsNullOrEmpty(item.SignaName1))
            //                        {
            //                            Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
            //                            if (signa != null)
            //                            {
            //                                labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
            //                            }
            //                            else
            //                            {
            //                                labelInfo.Add("AdditionalConsumeMethod", "");
            //                            }
            //                        }
            //                        else
            //                        {
            //                            string consumeMethod = "";
            //                            if (item.Frequency > 0)
            //                            {
            //                                switch (item.GCDosingFrequency)
            //                                {
            //                                    case Constant.DosingFrequency.DAY:
            //                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    case Constant.DosingFrequency.WEEK:
            //                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    case Constant.DosingFrequency.HOUR:
            //                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    default:
            //                                        break;
            //                                }
            //                            }
            //                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
            //                            labelInfo.Add("ConsumeMethod", signa);
            //                        }
            //                    }
            //                    else
            //                    {
            //                        if (!String.IsNullOrEmpty(item.SignaName1))
            //                        {
            //                            labelInfo.Add("ConsumeMethod", item.SignaName1);
            //                        }
            //                        else
            //                        {
            //                            string consumeMethod = "";
            //                            if (item.Frequency > 0)
            //                            {
            //                                switch (item.GCDosingFrequency)
            //                                {
            //                                    case Constant.DosingFrequency.DAY:
            //                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    case Constant.DosingFrequency.WEEK:
            //                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    case Constant.DosingFrequency.HOUR:
            //                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
            //                                        break;
            //                                    default:
            //                                        break;
            //                                }
            //                            }
            //                            labelInfo.Add("ConsumeMethod", consumeMethod);
            //                        }
            //                    }
            //                }
            //                else
            //                {
            //                    if (item.IsAsRequired)
            //                    {
            //                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
            //                    }
            //                    else
            //                    {
            //                        labelInfo.Add("ConsumeMethod", "");
            //                    }
            //                }

            //                if (item.IsInjection)
            //                {
            //                    if (!String.IsNullOrEmpty(defaultSigna))
            //                    {
            //                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
            //                        if (signa != null)
            //                        {
            //                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
            //                        }
            //                        else
            //                        {
            //                            labelInfo.Add("AdditionalConsumeMethod", "");
            //                        }
            //                    }
            //                }
            //                else
            //                {
            //                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
            //                }


            //                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
            //                labelInfo.Add("Route", item.Route);
            //                labelInfo.Add("ExpiredDate", expiredDate);
            //                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
            //                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
            //                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
            //                if (item.IsInjection)
            //                {
            //                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
            //                }
            //                else if (item.IsExternalMedication)
            //                {
            //                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
            //                }
            //                else
            //                {
            //                    labelInfo.Add("cfMedication", string.Empty);
            //                }
            //                labelInfo.Add("PatientLocation", patientLocation);
            //                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
            //                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
            //                labelInfo.Add("cfTakenQty", item.cfTakenQty);
            //                labelInfo.Add("cfIsUsedDispenseQty", "");
            //                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
            //                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
            //                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
            //                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
            //                labelInfo.Add("MedicationLine", item.MedicationLine);
            //                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
            //                labelInfo.Add("cfIsLASA", item.cfIsLASA);
            //                labelInfo.Add("cfIsHAM", item.cfIsHAM);

            //                #region Replace Prescription Drug Information
            //                string labelCommand = command;
            //                foreach (string fieldName in lstField)
            //                {
            //                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
            //                }
            //                #endregion

            //                #region Send Command to Printer
            //                DirectPrinting printer = new DirectPrinting();
            //                string printerName = printerName1;
            //                //if (item.IsExternalMedication)
            //                //    printerName = printerName2;

            //                printer.OpenPrinter(printerName);
            //                printer.StartDocPrinter();
            //                printer.Send("\n");
            //                printer.Send("n\n");
            //                printer.Send(labelCommand);
            //                printer.Send("p1\n");
            //                printer.EndDocPrinter();
            //                #endregion
            //            }
            //            #endregion
            //        }
            //        else
            //        {
            //            throw new Exception("Please setup the printer address in System Parameter!");
            //        }
            //    }
            //    else
            //    {
            //        throw new Exception("Please setup the printer address in System Parameter!");
            //    }
            //}
            //else
            //{
            //    throw new Exception("Please setup the printer address in System Parameter!");
            //}
            #endregion
        }
        #endregion

        #region Etiket Racikan 2
        public static void PrintCompoundDetailLabel2(vPrescriptionOrderDt1 prescription, vConsultVisit9 oVisit, string printerUrl1)
        {
            List<vPrescriptionOrderDt1> prescriptionCompound = BusinessLayer.GetvPrescriptionOrderDt1List(string.Format("PrescriptionOrderID = {0} AND IsCompound = 1", prescription.PrescriptionOrderID));
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];

            if (prescriptionCompound.Count <= 7)
            {
                #region StringBuilder
                StringBuilder sb = new StringBuilder();
                sb.Append("^XA");
                sb.Append("^LL800");
                sb.Append("^PW640");
                sb.Append("^LH10,10");
                sb.Append("^FO85,15^CF0,25^FB500,1,0,C^FD" + entityHealthcare.HealthcareName + "^FS");
                sb.Append("^FO100,38^CF0,25^FB400,1,0,C^FD" + string.Format("{0} {1}", entityHealthcare.PhoneNo1, entityHealthcare.FaxNo1) + "^FS");
                sb.Append("^FO50,60^GB520,1,2^FS");
                sb.Append("^CF0,20");
                sb.Append("^FO50,70^FD" + oVisit.PatientName + "^FS");
                sb.Append("^CF0,20");
                sb.Append("^FO420,70^FD" + prescription.cfPrescriptionDate + "^FS");
                sb.Append("^FO50,110^FD" + prescription.ParamedicName + "^FS");
                sb.Append("^FO420,110^FD" + oVisit.MedicalNo + "^FS");
                sb.Append("^FO50,130^GB520,1,2^FS");
                sb.Append("^CF0,20");

                int row = 120;
                for (int i = 0; i < prescriptionCompound.Count; i++)
                {
                    row += 25;
                    sb.Append("^FO50," + row + "^FD" + string.Format("{0} {1} {2}", prescriptionCompound[i].DrugName, prescriptionCompound[i].CompoundQtyInString, prescriptionCompound[i].CompoundUnit) + "^FS");
                }
                sb.Append("^XZ");
                #endregion

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                string printerUrl = printerUrl1;
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
                #endregion
            }
            else
            {
                #region StringBuilder
                StringBuilder sb = new StringBuilder();
                sb.Append("^XA");
                sb.Append("^LL1600");
                sb.Append("^PW640");
                sb.Append("^LH10,10");
                sb.Append("^FO85,15^CF0,25^FB500,1,0,C^FD" + entityHealthcare.HealthcareName + "^FS");
                sb.Append("^FO100,38^CF0,25^FB400,1,0,C^FD" + string.Format("{0} {1}", entityHealthcare.PhoneNo1, entityHealthcare.FaxNo1) + "^FS");
                sb.Append("^FO50,60^GB520,1,2^FS");
                sb.Append("^CF0,20");
                sb.Append("^FO50,70^FD" + oVisit.PatientName + "^FS");
                sb.Append("^CF0,20");
                sb.Append("^FO420,70^FD" + prescription.cfPrescriptionDate + "^FS");
                sb.Append("^FO50,110^FD" + prescription.ParamedicName + "^FS");
                sb.Append("^FO420,110^FD" + oVisit.MedicalNo + "^FS");
                sb.Append("^FO50,130^GB520,1,2^FS");
                sb.Append("^CF0,20");

                int row = 120;
                for (int i = 0; i < prescriptionCompound.Count; i++)
                {
                    row += 25;
                    sb.Append("^FO50," + row + "^FD" + string.Format("{0} {1} {2}", prescriptionCompound[i].DrugName, prescriptionCompound[i].CompoundQtyInString, prescriptionCompound[i].CompoundUnit) + "^FS");
                }
                sb.Append("^XZ");
                #endregion

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                string printerUrl = printerUrl1;
                printer.OpenPrinter(printerUrl);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
                #endregion
            }
        }
        #endregion

        #region PrintDrugLabelFromCharges
        public static void PrintDrugLabelFromCharges(PatientChargesHd chargesHd, string printFormat, String lstRecordID, string printerUrl1 = "", string printerUrl2 = "", string lstExpiredDate = "", string lstPrintNo = "", string isUsedDispenseQty = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            if (!string.IsNullOrEmpty(printerName1))
            {
                vConsultVisit9 oVisit = BusinessLayer.GetvConsultVisit9List(String.Format("VisitID = {0}", chargesHd.VisitID.ToString())).FirstOrDefault();
                vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                if (oVisit != null)
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;
                        string compoundRSSES = "";
                        string PharmacyPhoneNo = "";
                        string ConsumeMethodEng = "";

                        string paramCodeList = string.Format("('{0}','{1}','{2}', '{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();

                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Header Information
                        Healthcare oHealthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
                        string patientName = oVisit.PatientName;
                        string medicalNo = oVisit.MedicalNo;
                        string dateOfBirth = oVisit.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        string patientAge = string.Format("{0}", oVisit.PatientAge);
                        string sex = oVisit.GCGender == "0003^M" ? "L" : "P";
                        string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

                        string prescriptionNo = string.Empty;
                        string prescriptionDate = string.Empty;
                        string prescriptionTime = string.Empty;
                        string registrationNo = oVisit.RegistrationNo;
                        string cfDispensaryInitial = "";

                        string cfPatientNameInLabel = oVisit.cfPatientNameInLabel;

                        #endregion

                        string filterExpression = string.Format("ID IN ({0}) ORDER BY ID", lstRecordID);
                        List<vChargesForDrugLabel> lstItem = BusinessLayer.GetvChargesForDrugLabelList(filterExpression);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;
                        foreach (vChargesForDrugLabel item in lstItem)
                        {
                            string physicianName = item.ParamedicName;
                            prescriptionNo = item.TransactionNo;
                            prescriptionDate = item.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            cfDispensaryInitial = item.ChargesServiceUnitCode;

                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";

                                    //if (!string.IsNullOrEmpty(item.MedicationLine))
                                    //{

                                    //    if (item.ParentID == 0)
                                    //    {
                                    //        compoundRSSES = item.MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //    else
                                    //    {
                                    //        compoundRSSES = lstItem.Where(r => r.ParentID == 0 && r.PrescriptionOrderDetailID == item.ParentID).FirstOrDefault().MedicationLine.Replace(@"+", ",");

                                    //    }

                                    //}
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }
                                }

                                string expiredDate = "";
                                if (((DateTime)item.ExpiredDate).Year != 1900)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                }
                                else
                                {
                                    expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", oHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationNo);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", oVisit.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty1 = "";
                                if (item.IsCompound == true)
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithUnit;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQty;
                                    }
                                }
                                else
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithForm;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQtyWithForm;
                                    }
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                string tempCompound1 = "", tempCompound2 = "", tempCompound3 = "", tempCompound4 = "", tempCompound5 = "";
                                labelInfo.Add("cfCompound1", tempCompound1);
                                labelInfo.Add("cfCompound2", tempCompound2);
                                labelInfo.Add("cfCompound3", tempCompound3);
                                labelInfo.Add("cfCompound4", tempCompound4);
                                labelInfo.Add("cfCompound5", tempCompound5);
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfChargeQty);
                                labelInfo.Add("cfIsUsedDispenseQty", item.cfChargeQty);
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", "");
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", "");
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", "");
                                labelInfo.Add("cfIsHAM", "");
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", oVisit.DateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", item.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT_1));
                                labelInfo.Add("cfDateOfBirthInString1", item.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT_1));
                                labelInfo.Add("RoomName", item.RoomName);
                                labelInfo.Add("cfTakenQtyWithUnit", item.cfTakenQtyWithUnit);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);
                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    DirectPrinting printer = new DirectPrinting();
                                    string printerName = printerName1;
                                    if (item.IsExternalMedication)
                                        printerName = printerName2;

                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        printer.OpenPrinter(printerName);
                                        printer.StartDocPrinter();
                                        printer.Send("\n");
                                        printer.Send("n\n");
                                        printer.Send(labelCommand);
                                        printer.Send("p1\n");
                                        printer.EndDocPrinter();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }
                                #endregion
                            }

                            index += 1;
                        }
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #region PrintUDDLabel
        public static void PrintUDDLabelWithTMPrinter(int visitID, DateTime medicationDate, string sequenceNo, String lstRecordID, string transactionNo, string printerUrl = "")
        {
            string printerName = printerUrl;

            if (!string.IsNullOrEmpty(printerName))
            {
                #region Send Command to Printer
                RawPrinterHelper print = new RawPrinterHelper();

                string command = GenerateUDDLabelReceiptPrinter1(visitID, medicationDate, sequenceNo, transactionNo, lstRecordID);

                for (int i = 1; i <= 2; i++)
                {
                    if (i == 1)
                    {
                        print.OpenPrint(printerUrl);
                        print.SendStringToPrinter(command);
                        print.ClosePrint();
                    }
                    else
                    {
                        PrintUDDLabelReceiptWithTMPrinter(printerName, command);
                    }
                }
                #endregion
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        public static void PrintUDDLabel(int visitID, DateTime medicationDate, string sequenceNo, String lstRecordID, string printerUrl = "")
        {
            string printerName = printerUrl;

            if (!string.IsNullOrEmpty(printerName))
            {
                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();

                string command = GenerateUDDLabelCommand3(visitID, medicationDate, sequenceNo, lstRecordID);

                for (int i = 1; i <= 2; i++)
                {
                    if (i == 1)
                    {
                        printer.OpenPrinter(printerName);
                        printer.StartDocPrinter();
                        printer.Send("\n");
                        printer.Send("n\n");
                        printer.Send(command);
                        printer.Send("p1\n");
                        printer.EndDocPrinter();
                    }
                    else
                    {
                        PrintUDDLabelReceipt(printerName, command);
                    }
                }
                #endregion
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }

        private static void PrintUDDLabelReceipt(string printerName, string command)
        {
            string headerText = GenerateUDDReceiptHeader();
            string footerText = GenerateUDDReceiptFooter();

            SendCommandToPrinter(printerName, headerText);
            SendCommandToPrinter(printerName, command);
            SendCommandToPrinter(printerName, footerText);
        }

        private static void PrintUDDLabelReceiptWithTMPrinter(string printerName, string command)
        {
            string headerText = GenerateUDDReceiptWithTMPrinterHeader();
            string footerText = GenerateUDDReceiptWithTMPrinterFooter();

            SendCommandToReceiptPrinter(printerName, headerText);
            SendCommandToReceiptPrinter(printerName, command.Replace("ED: _________", ""));
            SendCommandToReceiptPrinter(printerName, footerText);
        }

        private static void SendCommandToReceiptPrinter(string printerName, string command)
        {
            RawPrinterHelper printer = new RawPrinterHelper();

            printer.OpenPrint(printerName);
            printer.SendStringToPrinter(command);
            printer.ClosePrint();
        }

        private static void SendCommandToPrinter(string printerName, string command)
        {
            DirectPrinting printer = new DirectPrinting();

            printer.OpenPrinter(printerName);
            printer.StartDocPrinter();
            printer.Send("\n");
            printer.Send("n\n");
            printer.Send(command);
            printer.Send("p1\n");
            printer.EndDocPrinter();
        }

        private static string GenerateUDDReceiptFooter()
        {
            StringBuilder command = new StringBuilder();

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^POI"));
            command.Append(string.Format("^LL200"));
            command.Append(string.Format("^PW800"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CFD"));
            command.Append(String.Format("^FO20 ,20^FDDelivered By :^FS"));
            command.Append(String.Format("^FO540,20^FDReceived  By :^FS"));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));
            return command.ToString();
        }

        private static string GenerateUDDReceiptHeader()
        {
            StringBuilder command = new StringBuilder();

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^POI"));
            command.Append(string.Format("^LL120"));
            command.Append(string.Format("^PW800"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^CF040,40"));
            command.Append(string.Format("^FO220,20^FD{0}^FS", "MEDICATION RECEIPT"));
            command.Append(string.Format("^CF030,30"));
            command.Append(string.Format("^FO20,70^FDDate : {0}^FS", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT)));
            command.Append(string.Format("^FO540,70^FDTime : ___:___^FS"));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));
            return command.ToString();
        }

        #endregion
        #endregion

        #region PrintLabelMasterItem
        public static void PrintLabelMasterItem(vItemProduct item, string printerUrl1, int labelCount)
        {
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");

            StringBuilder sb = new StringBuilder();

            sb.Append("^XA");
            sb.Append("^LL200");
            sb.Append("^PW400");
            sb.Append("^LH5,10");

            //versi ORI
            sb.Append("^FO10,15^CF024,24^FB395,5,0,L^FD" + string.Format("{0}", item.ItemName1) + "^FS");
            sb.Append("^FO200,130^BY2,2,0^A0N,40,30^BAN,40,N,N,N^FD" + string.Format("{0}", item.ItemCode) + "^FS");
            sb.Append("^CF033,33^FO10,140^FD" + string.Format("{0}", item.ItemCode) + "^FS");

            sb.Append("^PR2");
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();
            for (int i = 0; i < labelCount; i++)
            {
                printer.OpenPrinter(printerUrl1);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
            }
        }
            #endregion
        #endregion

        #region PrintLabelPenunjangMedis
        public static void PrintLabelPenunjangMedis(string printFormat, int id = 0, string printerUrl1 = "", string lstExpiredDate = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vLabelPatientRegistrationDiagnostic> lstEntity = BusinessLayer.GetvLabelPatientRegistrationDiagnosticList(String.Format("TransactionID = {0}", id.ToString()));

            if (lstEntity.Count > 0)
            {
                if (!string.IsNullOrEmpty(printerName1))
                {
                    if (printFormat == Constant.PrintFormat.LABEL_PENUNJANG_MEDIS_RSDOSOBA)
                    {
                        #region RSDOSOBA
                        string command = string.Empty;
                        command = GetPrintFormat(PrintingGroup.Diagnostic, printFormat);

                        List<string> lstField = GetMetadata(PrintingGroup.Diagnostic);
                        if (!string.IsNullOrEmpty(command))
                        {
                            string filterExpression = string.Format("TransactionID = {0}", id.ToString());
                            List<vLabelPatientRegistrationDiagnosticRSDOSOBA> lstDetail = BusinessLayer.GetvLabelPatientRegistrationDiagnosticRSDOSOBAList(filterExpression);
                            foreach (vLabelPatientRegistrationDiagnosticRSDOSOBA item in lstDetail)
                            {
                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("MedicalNo", item.MedicalNo);
                                labelInfo.Add("ClassName", item.ClassName);
                                labelInfo.Add("TransactionNo", item.TransactionNo);
                                labelInfo.Add("DateOfBirthInString", item.DateOfBirthInString);
                                labelInfo.Add("cfPatientName", item.cfPatientName);
                                labelInfo.Add("StreetName", item.StreetName);
                                labelInfo.Add("VisitServiceUnitName", item.VisitServiceUnitName);
                                labelInfo.Add("VisitRoomName", item.VisitRoomName);
                                labelInfo.Add("VisitBedCode", item.VisitBedCode);
                                labelInfo.Add("cfTransactionDateInString", item.cfTransactionDateInString);
                                labelInfo.Add("ItemName", item.ItemName);
                                labelInfo.Add("DokterRujukan", item.DokterRujukan);
                                #region Replace Label Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int a = 0;
                                int noOfPrint = 1;
                                a = noOfPrint;

                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                for (int i = 1; i <= a; i++)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                #endregion
                            }
                        }
                        #endregion
                    }
                    else
                    {
                        #region Default
                        string command = string.Empty;
                        command = GetPrintFormat(PrintingGroup.Diagnostic, printFormat);

                        List<string> lstField = GetMetadata(PrintingGroup.Diagnostic);
                        if (!string.IsNullOrEmpty(command))
                        {
                            string filterExpression = string.Format("TransactionID = {0}", id.ToString());
                            List<vLabelPatientRegistrationDiagnostic> lstDetail = BusinessLayer.GetvLabelPatientRegistrationDiagnosticList(filterExpression);
                            foreach (vLabelPatientRegistrationDiagnostic item in lstDetail)
                            {
                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("MedicalNo", item.MedicalNo);
                                labelInfo.Add("ClassName", item.ClassName);
                                labelInfo.Add("TransactionNo", item.TransactionNo);
                                labelInfo.Add("DateOfBirthInString", item.DateOfBirthInString);
                                labelInfo.Add("cfPatientName", item.cfPatientName);
                                labelInfo.Add("StreetName", item.StreetName);
                                labelInfo.Add("VisitServiceUnitName", item.VisitServiceUnitName);
                                labelInfo.Add("VisitRoomName", item.VisitRoomName);
                                labelInfo.Add("VisitBedCode", item.VisitBedCode);
                                labelInfo.Add("cfTransactionDateInString", item.cfTransactionDateInString);
                                labelInfo.Add("ItemName", item.ItemName);
                                labelInfo.Add("DokterRujukan", item.DokterRujukan);

                                #region Replace Label Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int a = 0;
                                int noOfPrint = 1;
                                a = noOfPrint;

                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                for (int i = 1; i <= a; i++)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                #endregion
                            }
                        }
                        #endregion
                    }
                }
                else
                {
                    throw new Exception("Please setup the printer address in System Parameter!");
                }
            }
        }
        #endregion

        #region PrintLabelAsset
        public static void PrintLabelAsset(string printFormat, int id = 0, string printerUrl1 = "", string lstExpiredDate = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vFAItem> lstEntity = BusinessLayer.GetvFAItemList(String.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString()));

            if (lstEntity.Count > 0)
            {
                if (!string.IsNullOrEmpty(printerName1))
                {
                    if (printFormat == Constant.PrintFormat.LABLE_ASSET_RSRTH)
                    {
                        #region RSRTH
                        string command = string.Empty;
                        command = GetPrintFormat(PrintingGroup.AssetLabel, printFormat);

                        List<string> lstField = GetMetadata(PrintingGroup.AssetLabel);
                        if (!string.IsNullOrEmpty(command))
                        {
                            string filterExpression = string.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString());
                            List<vFAItem> lstDetail = BusinessLayer.GetvFAItemList(filterExpression);
                            foreach (vFAItem item in lstDetail)
                            {
                                #region Get Header Information
                                string fixedAssetCode = "";
                                string fixedAssetName = "";
                                string faLocationCode = "";
                                string serialNumber = "";
                                string itemName = "";
                                string itemCode = "";

                                faLocationCode = item.FALocationName;
                                serialNumber = item.cfSerialNumber;
                                itemName = item.ItemName1;
                                itemCode = item.ItemCode;

                                int count = item.FixedAssetName.Count();
                                if (count > 35)
                                {
                                    fixedAssetName = item.FixedAssetName.Substring(0, 35);
                                }
                                else
                                {
                                    fixedAssetName = item.FixedAssetName;
                                }

                                fixedAssetCode = item.FixedAssetCode;
                                #endregion

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("FixedAssetName", fixedAssetName);
                                labelInfo.Add("FixedAssetCode", fixedAssetCode);
                                labelInfo.Add("FALocationName", faLocationCode);
                                labelInfo.Add("SerialNumber", serialNumber);
                                labelInfo.Add("ItemName1", itemName);
                                labelInfo.Add("ItemCode", itemCode);
                                labelInfo.Add("cfProcurementYear", item.cfProcurementYear);
                                #region Replace Label Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int a = 0;
                                int noOfPrint = 1;
                                a = noOfPrint;

                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                for (int i = 1; i <= a; i++)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                #endregion
                            }
                        }
                        #endregion
                    }
                    else if (printFormat == Constant.PrintFormat.LABLE_ASSET_RSMD)
                    {
                        #region RSMD
                        string command = string.Empty;
                        command = GetPrintFormat(PrintingGroup.AssetLabel, printFormat);

                        List<string> lstField = GetMetadata(PrintingGroup.AssetLabel);
                        if (!string.IsNullOrEmpty(command))
                        {
                            string filterExpression = string.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString());
                            List<vFAItem> lstDetail = BusinessLayer.GetvFAItemList(filterExpression);
                            foreach (vFAItem item in lstDetail)
                            {
                                #region Get Header Information
                                string fixedAssetCode = "";
                                string fixedAssetName = "";
                                string faLocationCode = "";
                                string serialNumber = "";
                                string itemName = "";
                                string itemCode = "";
                                string QRCodeInformation = "";

                                faLocationCode = item.FALocationName;
                                serialNumber = item.cfSerialNumber;
                                itemName = item.ItemName1;
                                itemCode = item.ItemCode;
                                fixedAssetName = item.FixedAssetName;

                                if (fixedAssetName.Length > 50)
                                {
                                    fixedAssetName = fixedAssetName.Substring(0, 50);
                                }

                                fixedAssetCode = item.FixedAssetCode;
                                QRCodeInformation = string.Format("{0};{1};{2};{3}", fixedAssetName, item.FALocationName, item.cfProcurementYear, serialNumber);
                                #endregion

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("FixedAssetName", fixedAssetName);
                                labelInfo.Add("FixedAssetCode", fixedAssetCode);
                                labelInfo.Add("FALocationName", faLocationCode);
                                labelInfo.Add("SerialNumber", serialNumber);
                                labelInfo.Add("ItemName1", itemName);
                                labelInfo.Add("ItemCode", itemCode);
                                labelInfo.Add("cfProcurementYear", item.cfProcurementYear);
                                labelInfo.Add("QRCodeInformation", QRCodeInformation);
                                #region Replace Label Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int a = 0;
                                int noOfPrint = 1;
                                a = noOfPrint;

                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                for (int i = 1; i <= a; i++)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                #endregion
                            }
                        }
                        #endregion
                    }
                    else
                    {
                        #region Default
                        string command = string.Empty;
                        command = GetPrintFormat(PrintingGroup.AssetLabel, printFormat);

                        List<string> lstField = GetMetadata(PrintingGroup.AssetLabel);
                        if (!string.IsNullOrEmpty(command))
                        {
                            string filterExpression = string.Format("FixedAssetID = {0} AND IsDeleted = 0", id.ToString());
                            List<vFAItem> lstDetail = BusinessLayer.GetvFAItemList(filterExpression);
                            foreach (vFAItem item in lstDetail)
                            {
                                #region Get Header Information
                                string fixedAssetCode = "";
                                string fixedAssetName = "";
                                string faLocationCode = "";
                                string serialNumber = "";
                                string itemName = "";
                                string itemCode = "";
                                string QRCodeInformation = "";

                                faLocationCode = item.FALocationName;
                                serialNumber = item.cfSerialNumber;
                                itemName = item.ItemName1;
                                itemCode = item.ItemCode;

                                int count = item.FixedAssetName.Count();
                                if (count > 35)
                                {
                                    fixedAssetName = item.FixedAssetName.Substring(0, 35);
                                }
                                else
                                {
                                    fixedAssetName = item.FixedAssetName;
                                }

                                fixedAssetCode = item.FixedAssetCode;
                                QRCodeInformation = string.Format("{0};{1};{2};{3}", fixedAssetName, item.FALocationName, item.cfProcurementYear, serialNumber);
                                #endregion

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("FixedAssetName", fixedAssetName);
                                labelInfo.Add("FixedAssetCode", fixedAssetCode);
                                labelInfo.Add("FALocationName", faLocationCode);
                                labelInfo.Add("SerialNumber", serialNumber);
                                labelInfo.Add("ItemName1", itemName);
                                labelInfo.Add("ItemCode", itemCode);
                                labelInfo.Add("cfProcurementYear", item.cfProcurementYear);
                                labelInfo.Add("QRCodeInformation", QRCodeInformation);

                                #region Replace Label Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int a = 0;
                                int noOfPrint = 1;
                                a = noOfPrint;

                                DirectPrinting printer = new DirectPrinting();
                                string printerName = printerName1;
                                for (int i = 1; i <= a; i++)
                                {
                                    printer.OpenPrinter(printerName);
                                    printer.StartDocPrinter();
                                    printer.Send("\n");
                                    printer.Send("n\n");
                                    printer.Send(labelCommand);
                                    printer.Send("p1\n");
                                    printer.EndDocPrinter();
                                }
                                #endregion
                            }
                        }
                        #endregion
                    }
                }
                else
                {
                    throw new Exception("Please setup the printer address in System Parameter!");
                }
            }
        }
        #endregion

        #region PrintLabelAssetRSSB
        public static void PrintLabelAssetRSSB(vFAItem item, string printerUrl = "")
        {
            String fixedAssetCode = "";
            String fixedAssetName = "";
            String serialNumber = "";

            if (item.FixedAssetCode.Length > 20)
            {
                fixedAssetCode = item.FixedAssetCode.Substring(0, 20) + "...";
            }
            else
            {
                fixedAssetCode = item.FixedAssetCode;
            }

            if (item.FixedAssetName.Length > 35)
            {
                fixedAssetName = item.FixedAssetName.Substring(0, 35);
            }
            else
            {
                fixedAssetName = item.FixedAssetName;
            }

            if (item.SerialNumber.Length > 20)
            {
                serialNumber = item.SerialNumber.Substring(0, 20) + "...";
            }
            else
            {
                serialNumber = item.SerialNumber;
            }

            if (!string.IsNullOrEmpty(printerUrl))
            {
                DotMatrixPrinter dotMatrix = new DotMatrixPrinter();

                StringBuilder sb = new StringBuilder();

                dotMatrix.InitPrinter();
                dotMatrix.SetPageLengthInLines(7);

                #region Print Healthcare Information
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont10cpi();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("      {0}", fixedAssetCode));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.Append(string.Format("    {0}", fixedAssetName));
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectEmphasizedMode();
                dotMatrix.Append(string.Format("    Serial No. {0}", serialNumber));
                dotMatrix.CancelEmphasizedMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.SelectRomanFont();
                dotMatrix.SetFont15cpi();
                dotMatrix.SelectItalicMode();
                dotMatrix.SelectSubscriptMode();
                dotMatrix.Append(string.Format("    Seksi Pengelolaan Inventaris"));
                dotMatrix.CancelSuperSubScriptMode();
                dotMatrix.CancelItalicMode();
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                dotMatrix.Append("\n");
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(dotMatrix.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #region PrintLabelAssetKKDI
        public static void PrintLabelAssetKKDI(vFAItem item, string printerUrl1, int labelCount)
        {
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");

            StringBuilder sb = new StringBuilder();

            sb.Append("^XA");
            sb.Append("^LL200");
            sb.Append("^PW400");
            sb.Append("^LH5,10");

            sb.Append("^FO10,15^CF024,24^FB395,5,0,L^FD" + string.Format("{0}", item.FixedAssetCode) + "^FS");

            string fixedAssetName = item.FixedAssetName;
            if (fixedAssetName.Length > 35)
            {
                int max = fixedAssetName.Length - 35;
                string t1 = fixedAssetName.Substring(0, 35);
                string t2 = fixedAssetName.Substring(35, max);

                sb.Append("^FO10,135^BY1,2,0^BAN,40,N,N,N^FD" + string.Format("{0}", item.FixedAssetCode) + "^FS");

                if (t2.Length > 35)
                {
                    t2 = t2.Substring(0, 35);
                }
                else
                {
                    int count = 35 - t2.Length;
                    t2 = AddChar(t2, count);
                }
                if (item.SerialNumber != null && item.SerialNumber != "")
                {
                    sb.Append("^FO10,110^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", item.SerialNumber) + "^FS");
                    sb.Append("^FO10,88^CF020,20^FB450,50,0,L^FD" + item.FALocationName + "^FS");
                }
                else
                {
                    sb.Append(string.Format(""));
                }

                sb.Append("^FO10,40^CF024,24^FB380,50,0,L^FD" + string.Format("{0}", item.FixedAssetName) + "^FS");
            }
            else
            {
                sb.Append("^FO10,130^BY1,2,0^BAN,40,N,N,N^FD" + string.Format("{0}", item.FixedAssetCode) + "^FS");

                if (fixedAssetName.Length > 35)
                {
                    fixedAssetName = fixedAssetName.Substring(0, 35);
                }
                else
                {
                    int count = 35 - fixedAssetName.Length;
                    fixedAssetName = AddChar(fixedAssetName, count);
                }
                if (item.SerialNumber != null && item.SerialNumber != "")
                {
                    sb.Append("^FO10,75^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", item.SerialNumber) + "^FS");
                    sb.Append("^FO10,105^CF022,22^FB450,50,0,L^FD" + item.FALocationName + "^FS");
                }
                else
                {
                    sb.Append(string.Format(""));
                }

                sb.Append("^FO10,45^CF024,24^FB380,50,0,L^FD" + string.Format("{0}", item.FixedAssetName) + "^FS");
            }

            sb.Append("^PR2");
            sb.Append("^XZ");

            #region Send Command to Printer
            DirectPrinting printer = new DirectPrinting();
            for (int i = 0; i < labelCount; i++)
            {
                printer.OpenPrinter(printerUrl1);
                printer.StartDocPrinter();
                printer.Send("\n");
                printer.Send("n\n");
                printer.Send(sb.ToString());
                printer.Send("p1\n");
                printer.EndDocPrinter();
            }
        }
            #endregion
        #endregion

        #region PrintLabelBeritaAssetInventaris
        public static void PrintLabelBeritaAssetInventaris(vFAAcceptanceDt item, string printerUrl1, int labelCount)
        {
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");

            StringBuilder sb = new StringBuilder();

            string filterExpression = string.Format("FAAcceptanceID = {0}", item.FAAcceptanceID.ToString());
            List<vFAAcceptanceDt> lstDetail = BusinessLayer.GetvFAAcceptanceDtList(filterExpression);
            foreach (vFAAcceptanceDt a in lstDetail)
            {
                sb.Append("^XA");
                sb.Append("^LL200");
                sb.Append("^PW400");
                sb.Append("^LH5,10");

                sb.Append("^FO10,15^CF024,24^FB395,5,0,L^FD" + string.Format("{0}", a.FixedAssetCode) + "^FS");
                sb.Append("^FO10,130^BY1,2,0^BAN,40,N,N,N^FD" + string.Format("{0}", a.FixedAssetCode) + "^FS");

                string fixedAssetName = a.FixedAssetName;
                if (fixedAssetName.Length > 35)
                {
                    int max = fixedAssetName.Length - 35;
                    string t1 = fixedAssetName.Substring(0, 35);
                    string t2 = fixedAssetName.Substring(35, max);

                    if (t2.Length > 35)
                    {
                        t2 = t2.Substring(0, 35);
                    }
                    else
                    {
                        int count = 35 - t2.Length;
                        t2 = AddChar(t2, count);
                    }
                    if (a.SerialNumber != null && a.SerialNumber != "")
                    {
                        sb.Append("^FO10,105^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                    }
                    else
                    {
                        sb.Append(string.Format(""));
                    }
                }
                else
                {
                    if (fixedAssetName.Length > 35)
                    {
                        fixedAssetName = fixedAssetName.Substring(0, 35);
                    }
                    else
                    {
                        int count = 35 - fixedAssetName.Length;
                        fixedAssetName = AddChar(fixedAssetName, count);
                    }
                    if (a.SerialNumber != null && a.SerialNumber != "")
                    {
                        sb.Append("^FO10,85^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                    }
                    else
                    {
                        sb.Append(string.Format(""));
                    }
                }

                sb.Append("^FO10,50^CF024,24^FB380,50,0,L^FD" + string.Format("{0}", a.FixedAssetName) + "^FS");

                if (a.SerialNumber != null && a.SerialNumber != "")
                {
                    sb.Append("^FO10,85^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                }
                else
                {
                    sb.Append(string.Format(""));
                }

                sb.Append("^PR2");
                sb.Append("^XZ");

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl1);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #region PrintLabelBeritaAssetInventarisKKDI
        public static void PrintLabelBeritaAssetInventarisKKDI(vFAAcceptanceDt item, string printerUrl1, int labelCount)
        {
            Healthcare healthcare = BusinessLayer.GetHealthcare("001");

            StringBuilder sb = new StringBuilder();

            string filterExpression = string.Format("FAAcceptanceID = {0}", item.FAAcceptanceID.ToString());
            List<vFAAcceptanceDt> lstDetail = BusinessLayer.GetvFAAcceptanceDtList(filterExpression);
            foreach (vFAAcceptanceDt a in lstDetail)
            {
                sb.Append("^XA");
                sb.Append("^LL200");
                sb.Append("^PW400");
                sb.Append("^LH5,10");

                sb.Append("^FO10,15^CF024,24^FB395,5,0,L^FD" + string.Format("{0}", a.FixedAssetCode) + "^FS");
                sb.Append("^FO10,130^BY1,2,0^BAN,40,N,N,N^FD" + string.Format("{0}", a.FixedAssetCode) + "^FS");

                string fixedAssetName = a.FixedAssetName;
                if (fixedAssetName.Length > 35)
                {
                    int max = fixedAssetName.Length - 35;
                    string t1 = fixedAssetName.Substring(0, 35);
                    string t2 = fixedAssetName.Substring(35, max);

                    if (t2.Length > 35)
                    {
                        t2 = t2.Substring(0, 35);
                    }
                    else
                    {
                        int count = 35 - t2.Length;
                        t2 = AddChar(t2, count);
                    }
                    if (a.SerialNumber != null && a.SerialNumber != "")
                    {
                        sb.Append("^FO10,105^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                    }
                    else
                    {
                        sb.Append(string.Format(""));
                    }
                }
                else
                {
                    if (fixedAssetName.Length > 35)
                    {
                        fixedAssetName = fixedAssetName.Substring(0, 35);
                    }
                    else
                    {
                        int count = 35 - fixedAssetName.Length;
                        fixedAssetName = AddChar(fixedAssetName, count);
                    }
                    if (a.SerialNumber != null && a.SerialNumber != "")
                    {
                        sb.Append("^FO10,85^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                    }
                    else
                    {
                        sb.Append(string.Format(""));
                    }
                }

                sb.Append("^FO10,50^CF024,24^FB380,50,0,L^FD" + string.Format("{0}", a.FixedAssetName) + "^FS");

                if (a.SerialNumber != null && a.SerialNumber != "")
                {
                    sb.Append("^FO10,85^CF024,24^FB450,50,0,L^FD" + string.Format("S/N : {0}", a.SerialNumber) + "^FS");
                }
                else
                {
                    sb.Append(string.Format(""));
                }

                sb.Append("^PR2");
                sb.Append("^XZ");

                #region Send Command to Printer
                DirectPrinting printer = new DirectPrinting();
                for (int i = 0; i < 1; i++)
                {
                    printer.OpenPrinter(printerUrl1);
                    printer.StartDocPrinter();
                    printer.Send("\n");
                    printer.Send("n\n");
                    printer.Send(sb.ToString());
                    printer.Send("p1\n");
                    printer.EndDocPrinter();
                    sb.Clear();
                }
                #endregion
            }
        }
        #endregion

        #region Bukti Pembayaran
        public static void PrintBuktiPembayaran1(int paymentID, string printerName, int printCount = 1)
        {
            try
            {
                DirectPrinting printer = new DirectPrinting();
                if (paymentID != 0 && !string.IsNullOrEmpty(printerName))
                {
                    string command = GenerateBuktiPembayaran1ZPL(paymentID);

                    for (int i = 1; i <= printCount; i++)
                    {
                        printer.OpenPrinter(printerName);
                        printer.StartDocPrinter();
                        printer.Send("\n");
                        printer.Send("n\n");
                        printer.Send(command);
                        printer.Send("p1\n");
                        printer.EndDocPrinter();
                    }
                }
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        public static void PrintBuktiPembayaran2(int paymentID, string printerName, int printCount = 1)
        {
            try
            {
                DirectPrinting printer = new DirectPrinting();
                if (paymentID != 0 && !string.IsNullOrEmpty(printerName))
                {
                    string command = GenerateBuktiPembayaran2ZPL(paymentID);

                    for (int i = 1; i <= printCount; i++)
                    {
                        printer.OpenPrinter(printerName);
                        printer.StartDocPrinter();
                        printer.Send("\n");
                        printer.Send("n\n");
                        printer.Send(command);
                        printer.Send("p1\n");
                        printer.EndDocPrinter();
                    }
                }
            }
            catch (Exception ex)
            {
                throw new Exception(ex.Message);
            }
        }

        private static string GenerateUDDLabelCommand1(int visitID, DateTime medicationDate, string sequenceNo, String lstRecordID)
        {
            StringBuilder command = new StringBuilder();

            //vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
            //string healthcareName = oHealthcare.HealthcareName;
            //string addressLine1 = oHealthcare.AddressLine1;
            //string addressLine2 = oHealthcare.AddressLine2;
            //string addressLine3 = oHealthcare.PhoneNo1;
            //string addressLine4 = oHealthcare.FaxNo1;
            //string companyName = oHealthcare.CompanyName;
            //string taxRegistrantNo = oHealthcare.TaxRegistrantNo;


            vConsultVisit oVisit = BusinessLayer.GetvConsultVisitList(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
            if (oVisit != null)
            {
                Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                #region Get Header Information
                string physicianName = string.Empty;
                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                string firstName = oPatient.FirstName;
                string middleName = oPatient.MiddleName;
                string lastName = oPatient.LastName;
                string patientName = oPatient.FullName;
                string medicalNo = oPatient.MedicalNo;
                string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);
                string registrationNo = oRegistration.RegistrationNo;
                string medicationInfo = string.Format("{0}|{1}|{2}", medicationDate.ToString(Constant.FormatString.DATE_FORMAT_112), sequenceNo, lstRecordID);
                string alternateRegistrationNo = oRegistration.RegistrationNo.Replace(@"/", "");
                #endregion

                command.Append(string.Format("^XA"));
                command.Append(string.Format("^POI"));
                command.Append(string.Format("^LL400"));
                command.Append(string.Format("^PW800"));
                command.Append(string.Format("^LH2,1^MD10"));

                #region Label Header : Patient Information
                command.Append(string.Format("^CF030,30"));
                command.Append(string.Format("^FO20,20^FD{0}^FS", patientName));
                command.Append(string.Format("^CFD"));
                command.Append(string.Format("^FO20,70^FDDOB^FS"));
                command.Append(string.Format("^FO220,70^FD:^FS"));
                command.Append(string.Format("^FO240,70^FD{0}^FS", dateOfBirth));
                command.Append(string.Format("^FO20,100^FDRegistration No.^FS"));
                command.Append(string.Format("^FO220,100^FD:^FS"));
                command.Append(string.Format("^FO240,100^FD{0}^FS", registrationNo));
                command.Append(string.Format("^FO20,130^FDMedication Date^FS"));
                command.Append(string.Format("^FO220,130^FD:^FS"));
                command.Append(string.Format("^FO240,130^FD{0}^FS", medicationDate.ToString(Constant.FormatString.DATE_FORMAT)));
                command.Append(string.Format("^FO20,160^FDSequence No.^FS"));
                command.Append(string.Format("^FO220,160^FD:^FS"));
                command.Append(string.Format("^FO240,160^FD{0}^FS", sequenceNo));

                command.Append(string.Format("^FO620,10 ^BQN,2,4,Q,1^FH_^FDQA,{0}_0A_0D{1}_0A_0D{2}_0A_0D{3}_0A_0D^FS", medicalNo, registrationNo, patientName, medicationInfo));
                #endregion

                int y = 210;

                #region Get Detail Item Information
                string filterExpression = string.Format("VisitID = {0} AND ID IN ({1})", visitID, lstRecordID);
                List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                foreach (vMedicationSchedule item in lstDetail)
                {
                    if (item.DrugName.Length > 35)
                        command.Append(string.Format("^FO20,{0}^FD{1}^FS", y.ToString(), item.DrugName.Substring(0, 35).ToUpper()));
                    else
                        command.Append(string.Format("^FO20,{0}^FD{1}^FS", y.ToString(), item.DrugName.ToUpper()));

                    command.Append(String.Format("^FO600,{0}^FD{1}^FS", y.ToString(), item.cfDosingQuantity));
                    //command.Append(String.Format("^FO720,{0}^FD{1}^FS", y.ToString(), item.MedicationTime));
                    y += 30;
                }
                #endregion

                #region Report Footer
                //command.Append("^FO420,340^BY3,2.0");
                //command.Append(string.Format("^A0N,40,30^BAR,100,N,N,N^FD{0}^FS", alternateRegistrationNo));
                //command.Append(string.Format("^CFD"));
                //command.Append(String.Format("^FO20 ,360^FDPrint Date^FS"));
                //command.Append(string.Format("^FO220,360^FD:^FS"));
                //command.Append(String.Format("^FO240,360^FD{0} {1} ^FS", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
                //command.Append(String.Format("^FO220,380^FDPrinted By^FS"));
                //command.Append(string.Format("^FO220,380^FD:^FS"));
                //command.Append(String.Format("^FO220,380^FD{0}^FS", AppSession.UserLogin.UserName));

                command.Append(string.Format("^CFD"));
                command.Append(String.Format("^FO20 ,360^FDPrint Date : {0} {1} ^FS", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
                command.Append(String.Format("^FO420,380^FDPrinted By : {0} ^FS", AppSession.UserLogin.UserName));
                command.Append(String.Format("^PR2"));
                command.Append(String.Format("^XZ"));
                #endregion
            }
            else
            {
                throw new Exception("Cannot find Patient Visit Information!");
            }

            //#region Report Footer
            //y += 30;
            //command.Append(string.Format("^CFD"));
            //command.Append(String.Format("^FO30 ,{0}^FDPrint Date : {1} {2} ^FS", y.ToString(), DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
            //command.Append(String.Format("^FO420,{0}^FDPrinted By : {1} ^FS", y.ToString(), AppSession.UserLogin.UserFullName));
            //command.Append(String.Format("^PR2"));
            //command.Append(String.Format("^XZ"));
            //#endregion

            return command.ToString();
        }

        private static string GenerateUDDLabelCommand2(int visitID, DateTime medicationDate, string sequenceNo, String lstRecordID)
        {
            StringBuilder command = new StringBuilder();

            //vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
            //string healthcareName = oHealthcare.HealthcareName;
            //string addressLine1 = oHealthcare.AddressLine1;
            //string addressLine2 = oHealthcare.AddressLine2;
            //string addressLine3 = oHealthcare.PhoneNo1;
            //string addressLine4 = oHealthcare.FaxNo1;
            //string companyName = oHealthcare.CompanyName;
            //string taxRegistrantNo = oHealthcare.TaxRegistrantNo;


            vConsultVisit oVisit = BusinessLayer.GetvConsultVisitList(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
            if (oVisit != null)
            {
                Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                #region Get Header Information
                string physicianName = string.Empty;
                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                string firstName = oPatient.FirstName;
                string middleName = oPatient.MiddleName;
                string lastName = oPatient.LastName;
                string patientName = oPatient.FullName;
                string medicalNo = oPatient.MedicalNo;
                string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);
                string registrationNo = oRegistration.RegistrationNo;
                string medicationInfo = string.Format("{0};{1};{2}", medicationDate.ToString(Constant.FormatString.DATE_FORMAT_112), sequenceNo, lstRecordID);
                string alternateRegistrationNo = oRegistration.RegistrationNo.Replace(@"/", "");
                #endregion

                command.Append(string.Format("^XA"));
                command.Append(string.Format("^POI"));
                command.Append(string.Format("^LL400"));
                command.Append(string.Format("^PW800"));
                command.Append(string.Format("^LH2,1^MD10"));

                #region Label Header : Patient Information
                command.Append(string.Format("^CF030,30"));
                command.Append(string.Format("^FO20,20^FD{0}^FS", patientName));
                command.Append(string.Format("^CFD"));
                command.Append(string.Format("^FO20,70^FDDOB^FS"));
                command.Append(string.Format("^FO220,70^FD:^FS"));
                command.Append(string.Format("^FO240,70^FD{0} MRN : {1}^FS", dateOfBirth, medicalNo));
                command.Append(string.Format("^FO20,100^FDRegistration No.^FS"));
                command.Append(string.Format("^FO220,100^FD:^FS"));
                command.Append(string.Format("^FO240,100^FD{0}^FS", registrationNo));
                command.Append(string.Format("^FO20,130^FDMedication Date^FS"));
                command.Append(string.Format("^FO220,130^FD:^FS"));
                command.Append(string.Format("^FO240,130^FD{0}^FS", medicationDate.ToString(Constant.FormatString.DATE_FORMAT)));
                command.Append(string.Format("^FO20,160^FDSequence No.^FS"));
                command.Append(string.Format("^FO220,160^FD:^FS"));
                command.Append(string.Format("^FO240,160^FD{0}^FS", sequenceNo));
                command.Append(string.Format("^FO620,10 ^BQN,2,4,Q,1^FH_^FDQA,{0}|{1}|{2}|{3}^FS", medicalNo, registrationNo, patientName, medicationInfo));
                #endregion

                int y = 210;

                #region Get Detail Item Information
                string filterExpression = string.Format("VisitID = {0} AND ID IN ({1}) ORDER BY IsExternalMedication DESC", visitID, lstRecordID);
                List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                foreach (vMedicationSchedule item in lstDetail)
                {
                    if (item.DrugName.Length > 35)
                        command.Append(string.Format("^FO20,{0}^FD{1}^FS", y.ToString(), item.DrugName.Substring(0, 35).ToUpper()));
                    else
                        command.Append(string.Format("^FO20,{0}^FD{1}^FS", y.ToString(), item.DrugName.ToUpper()));

                    command.Append(String.Format("^FO600,{0}^FD{1}^FS", y.ToString(), item.cfDosingQuantity));
                    //command.Append(String.Format("^FO720,{0}^FD{1}^FS", y.ToString(), item.MedicationTime));
                    y += 30;
                }
                #endregion

                #region Report Footer
                //command.Append("^FO420,340^BY3,2.0");
                //command.Append(string.Format("^A0N,40,30^BAR,100,N,N,N^FD{0}^FS", alternateRegistrationNo));
                //command.Append(string.Format("^CFD"));
                //command.Append(String.Format("^FO20 ,360^FDPrint Date^FS"));
                //command.Append(string.Format("^FO220,360^FD:^FS"));
                //command.Append(String.Format("^FO240,360^FD{0} {1} ^FS", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
                //command.Append(String.Format("^FO220,380^FDPrinted By^FS"));
                //command.Append(string.Format("^FO220,380^FD:^FS"));
                //command.Append(String.Format("^FO220,380^FD{0}^FS", AppSession.UserLogin.UserName));

                command.Append(string.Format("^CFD"));
                command.Append(String.Format("^FO20 ,380^FDPrint Date : {0} {1} ^FS", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
                command.Append(String.Format("^FO420,380^FDPrinted By : {0} ^FS", AppSession.UserLogin.UserName));
                command.Append(String.Format("^PR2"));
                command.Append(String.Format("^XZ"));
                #endregion
            }
            else
            {
                throw new Exception("Cannot find Patient Visit Information!");
            }

            //#region Report Footer
            //y += 30;
            //command.Append(string.Format("^CFD"));
            //command.Append(String.Format("^FO30 ,{0}^FDPrint Date : {1} {2} ^FS", y.ToString(), DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
            //command.Append(String.Format("^FO420,{0}^FDPrinted By : {1} ^FS", y.ToString(), AppSession.UserLogin.UserFullName));
            //command.Append(String.Format("^PR2"));
            //command.Append(String.Format("^XZ"));
            //#endregion

            return command.ToString();
        }

        /// <summary>
        /// Using Thermal Paper
        /// </summary>
        /// <param name="visitID"></param>
        /// <param name="medicationDate"></param>
        /// <param name="sequenceNo"></param>
        /// <param name="lstRecordID"></param>
        /// <returns></returns>
        private static string GenerateUDDLabelCommand3(int visitID, DateTime medicationDate, string sequenceNo, String lstRecordID)
        {
            StringBuilder command = new StringBuilder();


            vConsultVisit oVisit = BusinessLayer.GetvConsultVisitList(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
            if (oVisit != null)
            {
                Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                #region Get Header Information
                string physicianName = string.Empty;
                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                string firstName = oPatient.FirstName;
                string middleName = oPatient.MiddleName;
                string lastName = oPatient.LastName;
                string patientName = oPatient.FullName;
                string medicalNo = oPatient.MedicalNo;
                string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);
                string registrationNo = oRegistration.RegistrationNo;
                string medicationInfo = string.Format("{0};{1};{2}", medicationDate.ToString(Constant.FormatString.DATE_FORMAT_112), sequenceNo, lstRecordID);
                string[] itemInfo = lstRecordID.Split(',');
                int labelLength = Convert.ToInt32(itemInfo.Length * 80);
                if (labelLength < 640)
                    labelLength = 640;

                string alternateRegistrationNo = oRegistration.RegistrationNo.Replace(@"/", "");
                #endregion

                command.Append(string.Format("^XA"));
                command.Append(string.Format("^POI"));
                command.Append(string.Format("^LL{0}", labelLength.ToString()));
                command.Append(string.Format("^PW800"));
                command.Append(string.Format("^LH2,1^MD10"));

                #region Label Header : Patient Information
                command.Append(string.Format("^CF030,30"));
                command.Append(string.Format("^FO20,20^FD{0}^FS", patientName));
                command.Append(string.Format("^CFD"));
                command.Append(string.Format("^FO20,70^FDDOB^FS"));
                command.Append(string.Format("^FO220,70^FD:^FS"));
                command.Append(string.Format("^FO240,70^FD{0}^FS", dateOfBirth));
                command.Append(string.Format("^FO20,100^FDMRN^FS"));
                command.Append(string.Format("^FO220,100^FD:^FS"));
                command.Append(string.Format("^FO240,100^FD{0}^FS", medicalNo));
                command.Append(string.Format("^FO20,130^FDRegistration No.^FS"));
                command.Append(string.Format("^FO220,130^FD:^FS"));
                command.Append(string.Format("^FO240,130^FD{0}^FS", registrationNo));
                command.Append(string.Format("^FO20,160^FDMedication Date^FS"));
                command.Append(string.Format("^FO220,160^FD:^FS"));
                command.Append(string.Format("^FO240,160^FD{0}^FS", medicationDate.ToString(Constant.FormatString.DATE_FORMAT)));
                command.Append(string.Format("^FO20,190^FDSequence No.^FS"));
                command.Append(string.Format("^FO220,190^FD:^FS"));
                command.Append(string.Format("^FO240,190^FD{0}^FS", sequenceNo));
                command.Append(string.Format("^FO20,220^FD{0}^FS", patientLocation));
                command.Append(string.Format("^FO540,10 ^BQN,2,4,Q,1^FH_^FDQA,{0}|{1}|{2}|{3}^FS", medicalNo, registrationNo, patientName, medicationInfo));
                command.Append(string.Format("^FO20,260^FD_________________________________________________________________^FS"));
                #endregion

                int y = 300;

                #region Get Detail Item Information
                string filterExpression = string.Format("VisitID = {0} AND ID IN ({1}) ORDER BY IsExternalMedication DESC", visitID, lstRecordID);
                List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                foreach (vMedicationSchedule item in lstDetail)
                {
                    string homeMedication = item.IsInternalMedication ? "" : "*";

                    if (item.DrugName.Length > 35)
                        command.Append(string.Format("^FO20,{0}^FD{2}{1}^FS", y.ToString(), item.DrugName.Substring(0, 35).ToUpper(), homeMedication));
                    else
                        command.Append(string.Format("^FO20,{0}^FD{2}{1}^FS", y.ToString(), item.DrugName.ToUpper(), homeMedication));

                    command.Append(String.Format("^FO600,{0}^FD{1}^FS", y.ToString(), item.cfDosingQuantity));
                    y += 30;
                }
                #endregion
                command.Append(string.Format("^FO20,{0}^FD_________________________________________________________________^FS", labelLength - 80));

                #region Report Footer
                y += 30;
                command.Append(string.Format("^CFD"));
                command.Append(String.Format("^FO20 ,{0}^FDPrint Date : {1} {2} ^FS", labelLength - 50, DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
                command.Append(String.Format("^FO420,{0}^FDPrinted By : {1} ^FS", labelLength - 50, AppSession.UserLogin.UserName));
                command.Append(String.Format("^PR2"));
                command.Append(String.Format("^XZ"));
                #endregion
            }
            else
            {
                throw new Exception("Cannot find Patient Visit Information!");
            }

            return command.ToString();
        }

        /// <summary>
        /// Using Epson Receipt Printer
        /// </summary>
        /// <param name="visitID"></param>
        /// <param name="medicationDate"></param>
        /// <param name="sequenceNo"></param>
        /// <param name="lstRecordID"></param>
        /// <returns></returns>
        private static string GenerateUDDLabelReceiptPrinter1(int visitID, DateTime medicationDate, string sequenceNo, string transactionNo, String lstRecordID)
        {
            StringBuilder command = new StringBuilder();

            vConsultVisit4 oVisit = BusinessLayer.GetvConsultVisit4List(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
            if (oVisit != null)
            {
                Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                #region Get Header Information
                string physicianName = string.Empty;
                Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                string firstName = oPatient.FirstName;
                string middleName = oPatient.MiddleName;
                string lastName = oPatient.LastName;
                string patientName = oPatient.FullName;
                string medicalNo = oPatient.MedicalNo;
                string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);
                string registrationNo = oRegistration.RegistrationNo;
                string medicationInfo = string.Format("{0};{1};{2}", medicationDate.ToString(Constant.FormatString.DATE_FORMAT_112), sequenceNo, lstRecordID);
                string[] itemInfo = lstRecordID.Split(',');
                int labelLength = Convert.ToInt32(itemInfo.Length * 80);
                if (labelLength < 640)
                    labelLength = 640;

                string alternateRegistrationNo = oRegistration.RegistrationNo.Replace(@"/", "");
                #endregion

                const char ESC = '\x1B';    // ESCAPE
                const char GS = '\x1D';     //GROUP SPARATOR

                #region Label Header : Patient Information
                command.Append(ESC + "a1"); // Center Alignment
                command.AppendLine("DAFTAR OBAT PASIEN");
                command.AppendLine("");
                command.Append(ESC + "a0"); // Left Alignment
                command.AppendLine(string.Format("Nama Pasien / JK : {0} / {1}", patientName, sex));
                command.AppendLine(string.Format("Tanggal Lahir    : {0}", dateOfBirth));
                command.AppendLine(string.Format("No. Rekam Medis  : {0}", medicalNo));
                command.AppendLine(string.Format("No. Registrasi   : {0}", registrationNo));
                command.AppendLine(string.Format("Tanggal Pemberian: {0}", medicationDate.ToString(Constant.FormatString.DATE_FORMAT)));
                command.AppendLine(string.Format("No. Sequence     : {0}", sequenceNo));
                command.AppendLine(string.Format("Lokasi Pasien    : {0}", patientLocation));
                command.AppendLine(string.Format("No. Transaksi    : {0}", transactionNo));
                command.AppendLine(string.Format("______________________________________________"));
                #endregion

                #region Get Detail Item Information
                string filterExpression = string.Format("VisitID = {0} AND ID IN ({1}) ORDER BY IsExternalMedication DESC", visitID, lstRecordID);
                List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                foreach (vMedicationSchedule item in lstDetail)
                {
                    string homeMedication = item.IsInternalMedication ? "" : "*";
                    string itemName = item.DrugName.Length > 25 ? item.DrugName.Substring(0, 25).ToUpper() : item.DrugName.ToUpper();

                    command.AppendLine(string.Format("({3}) {1}{0} Qty:{2}", itemName.PadRight(25, ' '), homeMedication, item.cfDosingQuantity, item.MedicationTime));
                    command.Append(ESC + "\x34"); // Italic Font
                    command.AppendLine(string.Format("{0} ED: _________", item.cfSignaRule.PadRight(30, ' ')));
                    command.Append(ESC + "\x35"); // Cancel Italic Font
                }

                #endregion
                command.AppendLine(string.Format("______________________________________________"));

                #region Report Footer
                command.AppendLine(String.Format("Print Date : {0} {1}, {2}", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT), AppSession.UserLogin.UserName));
                command.AppendLine("");
                command.Append(ESC + "a0"); // Left Alignment
                command.AppendLine("5 BENAR:");
                command.Append(ESC + "a1"); // Center Alignment
                command.AppendLine(string.Format("[ ]Px  [ ]OB  [ ]DO  [ ]RP  [ ]WP"));

                //for (int i = 0; i <= 3; i++)
                //{
                //    command.AppendLine("");
                //}

                #endregion
            }
            else
            {
                throw new Exception("Cannot find Patient Visit Information!");
            }

            return command.ToString();
        }

        private static string GenerateUDDReceiptWithTMPrinterHeader()
        {
            const char ESC = '\x1B';    // ESCAPE
            const char GS = '\x1D';     //GROUP SPARATOR
            StringBuilder command = new StringBuilder();

            command.AppendLine("");
            command.AppendLine("");
            command.AppendLine(string.Format(".............................................."));
            command.AppendLine("");
            command.Append(ESC + "a1"); // Center Alignment
            command.AppendLine(string.Format("Tanggal : {0} Jam : ___:___", DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT)));
            return command.ToString();
        }

        private static string GenerateUDDReceiptWithTMPrinterFooter()
        {
            const char ESC = '\x1B';    // ESCAPE
            const char GS = '\x1D';     //GROUP SPARATOR
            StringBuilder command = new StringBuilder();

            command.AppendLine("");
            command.Append(ESC + "a0"); // Left Alignment
            command.AppendLine("TELAAH RESEP:");
            command.Append(ESC + "a1"); // Center Alignment
            command.AppendLine(string.Format("[ ]Px  [ ]OB  [ ]KE  [ ]FRE"));
            command.AppendLine(string.Format("[ ]DO  [ ]RP  [ ]IO  [ ]DUP"));
            //command.AppendLine("");
            //command.Append(ESC + "a0"); // Left Alignment
            //command.AppendLine("5 BENAR:");
            //command.Append(ESC + "a1"); // Center Alignment
            //command.AppendLine(string.Format("[ ]Px  [ ]OB  [ ]DO  [ ]RP  [ ]WP"));
            command.AppendLine("");
            command.Append(ESC + "a0"); // Left Alignment
            command.AppendLine(String.Format("Dispense :    Cek :     Serah :     Terima:  "));
            for (int i = 0; i <= 6; i++)
            {
                command.AppendLine("");
            }

            //Send Auto-Cut Command
            string cutCommand = "";
            cutCommand = ESC + "@";
            cutCommand += GS + "V" + (char)1;
            command.AppendLine(cutCommand);

            return command.ToString();
        }


        /// <summary>
        /// Default
        /// </summary>
        /// <param name="paymentID"></param>
        /// <returns></returns>
        private static string GenerateBuktiPembayaran1ZPL(int paymentID)
        {
            vPatientPaymentHd oPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentID = {0}", paymentID)).FirstOrDefault();
            string paymentNo = oPaymentHd.PaymentNo;

            vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
            string healthcareName = oHealthcare.HealthcareName;
            string addressLine1 = oHealthcare.AddressLine1;
            string addressLine2 = oHealthcare.AddressLine2;
            string addressLine3 = oHealthcare.PhoneNo1;
            string addressLine4 = oHealthcare.FaxNo1;
            string companyName = oHealthcare.CompanyName;
            string taxRegistrantNo = oHealthcare.TaxRegistrantNo;

            StringBuilder command = new StringBuilder();
            //string barcodeValue = oPatient.MedicalNo;

            List<vPatientChargesDtPayment> lstItem = BusinessLayer.GetvPatientChargesDtPaymentList(string.Format("PaymentID = {0} ORDER BY GCItemType,ItemCode ASC", paymentID));
            decimal length = Convert.ToDecimal(lstItem.Count * 120);

            if (length < 1200)
                length = 1200;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^POI"));
            command.Append(string.Format("^LL{0}", length));
            command.Append(string.Format("^PW900"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^FO30,30^GFA,790,790,10,O01C,O0FFC,N03FFE,N07IF,N0JF8,M01JFC,M01JFE,M03JFE,::M03KF,:::::M03JFE,::::::M03JFC,01PFC,07PFC,0QF8,1QF8,3QF,7QF,7PFE,7PFC,:QF8,QF,7OFE003FC7C,7OF803FF7FF8,7OF01FFDIFE,3NFC0IFBJF,3NF83NF81MFC07NF80MF01OFC03FFDFF803OFC007C7FI0PFCN01PFEN03PFEN07PFCN07IFELFCN0QFCM01QFCM01QF8M03QF,M03PFE,M07PFC,M07PF,M07JF8,M0KF8,::::::L01KF8,:::::M0KF8,::M0KF,M07JF,M03IFE,M01IFC,N0IF8,N07FE,O07,^FS"));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO120,18^FD{0}^FS", healthcareName));
            command.Append(string.Format("^FO120,48^FD{0}^FS", addressLine1));
            command.Append(string.Format("^FO120,78^FD{0}^FS", addressLine2));
            command.Append(string.Format("^FO120,108^FDTelephone^FS"));
            command.Append(string.Format("^FO240,108^FD:^FS"));
            command.Append(string.Format("^FO260,108^FD{0}^FS", addressLine3));
            command.Append(string.Format("^FO120,138^FDFax^FS"));
            command.Append(string.Format("^FO240,138^FD:^FS"));
            command.Append(string.Format("^FO260,138^FD{0}^FS", addressLine4));

            #region Report Title
            command.Append(string.Format("^CF036,36"));
            command.Append(string.Format("^FO270,210^FDCASHIER RECEIPT^FS"));
            command.Append(string.Format("^CF030,30"));
            command.Append(string.Format("^FO260,250^FDNo : {0}^FS", paymentNo));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,290^FDPerusahaan^FS"));
            command.Append(string.Format("^FO260,290^FD:^FS"));
            command.Append(string.Format("^FO280,290^FD{0}^FS", companyName));
            command.Append(string.Format("^FO30,320^FDNPWP^FS"));
            command.Append(string.Format("^FO260,320^FD:^FS"));
            command.Append(string.Format("^FO280,320^FD{0}^FS", taxRegistrantNo));
            #endregion

            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,330^FD_________________________________________________________________^FS"));
            vRegistration oRegistration = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", oPaymentHd.RegistrationID)).FirstOrDefault();
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,380^FDPatient Name^FS"));
            command.Append(string.Format("^FO260,380^FD:^FS"));
            command.Append(string.Format("^FO280,380^FD{0}^FS", oRegistration.PatientName));
            command.Append(string.Format("^FO30,410^FDDate of Birth^FS"));
            command.Append(string.Format("^FO260,410^FD:^FS"));
            command.Append(string.Format("^FO280,410^FD{0}^FS", oRegistration.DateOfBirthInString));
            command.Append(string.Format("^FO30,440^FDRegistration No.^FS"));
            command.Append(string.Format("^FO260,440^FD:^FS"));
            command.Append(string.Format("^FO280,440^FD{0}^FS", oRegistration.RegistrationNo));
            command.Append(string.Format("^FO30,470^FDRegistration Date^FS"));
            command.Append(string.Format("^FO260,470^FD:^FS"));
            command.Append(string.Format("^FO280,470^FD{0}^FS", oRegistration.RegistrationDateInString));
            command.Append(string.Format("^FO30,500^FDService Unit / Room^FS"));
            command.Append(string.Format("^FO260,500^FD:^FS"));
            command.Append(string.Format("^FO280,500^FD{0} / {1}^FS", oRegistration.ServiceUnitName, oRegistration.RoomCode));
            command.Append(string.Format("^FO30,530^FDPhysician^FS"));
            command.Append(string.Format("^FO260,530^FD:^FS"));
            command.Append(string.Format("^FO280,530^FD{0}^FS", oRegistration.ParamedicName));

            #region Table Title
            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,540^FD_________________________________________________________________^FS"));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,590^FDItem Name^FS"));
            command.Append(string.Format("^FO490,590^FDQuantity^FS"));
            command.Append(string.Format("^FO720,590^FDAmount^FS"));
            #endregion

            #region Transaction Detail
            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,600^FD_________________________________________________________________^FS"));
            command.Append(string.Format("^CFD"));

            int y = 660;
            decimal subTotalDrugSupplies = 0;
            foreach (vPatientChargesDtPayment item in lstItem)
            {
                if (item.ItemName1.Length > 35)
                    command.Append(string.Format("^FO30,{0}^FD{1}^FS", y.ToString(), item.ItemName1.Substring(0, 35)));
                else
                    command.Append(string.Format("^FO30,{0}^FD{1}^FS", y.ToString(), item.ItemName1));

                command.Append(String.Format("^FO490,{0}^FD{1} {2}^FS", y.ToString(), item.ChargedQuantity.ToString("N2").PadLeft(6, ' '), item.ItemUnit));
                command.Append(string.Format("^FO640,{0}^FD{1}^FS", y.ToString(), item.LineAmount.ToString("N0").PadLeft(14, ' ')));

                if (item.GCItemType == Constant.ItemType.OBAT_OBATAN || item.GCItemType == Constant.ItemType.BARANG_MEDIS)
                    subTotalDrugSupplies += item.LineAmount;
                y += 30;
            };

            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,{0}^FD_________________________________________________________________^FS", y.ToString()));

            #endregion

            List<vPatientBill> lstBill = BusinessLayer.GetvPatientBillList(string.Format("PaymentID = {0} AND GCTransactionStatus <> '{1}'", paymentID, Constant.TransactionStatus.VOID));
            decimal totalDiscount = lstBill.Sum(lst => (lst.PatientDiscountAmount + lst.PayerDiscountAmount));
            decimal totalTransaction = oPaymentHd.TotalBillAmount;
            decimal totalPayment = oPaymentHd.TotalPaymentAmount;
            decimal balanceAmount = totalTransaction - totalPayment;
            decimal _DPPAmount = 0;
            decimal _PPNAmount = 0;

            _DPPAmount = Convert.ToDecimal(subTotalDrugSupplies / Convert.ToDecimal(1.1));
            _PPNAmount = Convert.ToDecimal((_DPPAmount * 10) / 100);

            command.Append(string.Format("^CFD"));
            y += 50;
            command.Append(String.Format("^FO30,{0}^FDDisc. Global  :  {1}^FS", y.ToString(), totalDiscount.ToString("N0")));
            command.Append(String.Format("^FO460,{0}^FDTotal Amount^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), totalTransaction.ToString("N0").PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO460,{0}^FDTotal Payment^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), totalTransaction.ToString("N0").PadLeft(14, ' ')));
            y += 50;
            command.Append(String.Format("^FO460,{0}^FDDPP^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), _DPPAmount.ToString("N0").PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO460,{0}^FDPPN/VAT^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), _PPNAmount.ToString("N0").PadLeft(14, ' ')));
            //y += 10;
            //command.Append(String.Format("^CF024,24"));
            //command.Append(String.Format("^FO460,{0}^FD_____________________________^FS", y.ToString()));
            //command.Append(string.Format("^CFD"));
            //y += 30;
            //command.Append(String.Format("^FO460,{0}^FDBalance^FS", y.ToString()));
            //command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            //command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), balanceAmount.ToString().PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO30,{0}^FDNOTES : ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* This printed form also applies as Payment Receipt  ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* Printed by system, no signature needed  ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* Drugs and medical supplies price are included PPN/VAT^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^CF024,24"));
            command.Append(String.Format("^FO30,{0}^FD_________________________________________________________________^FS", y.ToString()));

            #region Report Footer
            y += 50;
            command.Append(string.Format("^CFD"));
            command.Append(String.Format("^FO30 ,{0}^FDPrint Date : {1} {2} ^FS", y.ToString(), DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
            command.Append(String.Format("^FO420,{0}^FDPrinted By : {1} ^FS", y.ToString(), AppSession.UserLogin.UserFullName));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));
            #endregion

            return command.ToString();
        }

        /// <summary>
        /// Bahasa Indonesia
        /// </summary>
        /// <param name="paymentID"></param>
        /// <returns></returns>
        private static string GenerateBuktiPembayaran2ZPL(int paymentID)
        {
            vPatientPaymentHd oPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentID = {0}", paymentID)).FirstOrDefault();
            string paymentNo = oPaymentHd.PaymentNo;

            vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
            string healthcareName = oHealthcare.HealthcareName;
            string addressLine1 = oHealthcare.AddressLine1;
            string addressLine2 = oHealthcare.AddressLine2;
            string addressLine3 = oHealthcare.PhoneNo1;
            string addressLine4 = oHealthcare.FaxNo1;
            string companyName = oHealthcare.CompanyName;
            string taxRegistrantNo = oHealthcare.TaxRegistrantNo;

            StringBuilder command = new StringBuilder();
            //string barcodeValue = oPatient.MedicalNo;

            List<vPatientChargesDtPayment> lstItem = BusinessLayer.GetvPatientChargesDtPaymentList(string.Format("PaymentID = {0} ORDER BY GCItemType,ItemCode ASC", paymentID));
            decimal length = Convert.ToDecimal(lstItem.Count * 120);

            if (length < 1200)
                length = 1200;

            command.Append(string.Format("^XA"));
            command.Append(string.Format("^POI"));
            command.Append(string.Format("^LL{0}", length));
            command.Append(string.Format("^PW900"));
            command.Append(string.Format("^LH2,1^MD10"));
            command.Append(string.Format("^FO30,30^GFA,790,790,10,O01C,O0FFC,N03FFE,N07IF,N0JF8,M01JFC,M01JFE,M03JFE,::M03KF,:::::M03JFE,::::::M03JFC,01PFC,07PFC,0QF8,1QF8,3QF,7QF,7PFE,7PFC,:QF8,QF,7OFE003FC7C,7OF803FF7FF8,7OF01FFDIFE,3NFC0IFBJF,3NF83NF81MFC07NF80MF01OFC03FFDFF803OFC007C7FI0PFCN01PFEN03PFEN07PFCN07IFELFCN0QFCM01QFCM01QF8M03QF,M03PFE,M07PFC,M07PF,M07JF8,M0KF8,::::::L01KF8,:::::M0KF8,::M0KF,M07JF,M03IFE,M01IFC,N0IF8,N07FE,O07,^FS"));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO120,18^FD{0}^FS", healthcareName));
            command.Append(string.Format("^FO120,48^FD{0}^FS", addressLine1));
            command.Append(string.Format("^FO120,78^FD{0}^FS", addressLine2));
            command.Append(string.Format("^FO120,108^FDTelephone^FS"));
            command.Append(string.Format("^FO240,108^FD:^FS"));
            command.Append(string.Format("^FO260,108^FD{0}^FS", addressLine3));
            command.Append(string.Format("^FO120,138^FDFax^FS"));
            command.Append(string.Format("^FO240,138^FD:^FS"));
            command.Append(string.Format("^FO260,138^FD{0}^FS", addressLine4));

            #region Report Title
            command.Append(string.Format("^CF036,36"));
            command.Append(string.Format("^FO270,210^FDBUKTI PEMBAYARAN^FS"));
            command.Append(string.Format("^CF030,30"));
            command.Append(string.Format("^FO260,250^FDNo : {0}^FS", paymentNo));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,290^FDPerusahaan^FS"));
            command.Append(string.Format("^FO260,290^FD:^FS"));
            command.Append(string.Format("^FO280,290^FD{0}^FS", companyName));
            command.Append(string.Format("^FO30,320^FDNPWP^FS"));
            command.Append(string.Format("^FO260,320^FD:^FS"));
            command.Append(string.Format("^FO280,320^FD{0}^FS", taxRegistrantNo));
            #endregion

            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,330^FD_________________________________________________________________^FS"));
            vRegistration oRegistration = BusinessLayer.GetvRegistrationList(string.Format("RegistrationID = {0}", oPaymentHd.RegistrationID)).FirstOrDefault();
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,380^FDNama Pasien^FS"));
            command.Append(string.Format("^FO260,380^FD:^FS"));
            command.Append(string.Format("^FO280,380^FD{0}^FS", oRegistration.PatientName));
            command.Append(string.Format("^FO30,410^FDTanggal Lahir^FS"));
            command.Append(string.Format("^FO260,410^FD:^FS"));
            command.Append(string.Format("^FO280,410^FD{0}^FS", oRegistration.DateOfBirthInString));
            command.Append(string.Format("^FO30,440^FDNo. Registrasi^FS"));
            command.Append(string.Format("^FO260,440^FD:^FS"));
            command.Append(string.Format("^FO280,440^FD{0}^FS", oRegistration.RegistrationNo));
            command.Append(string.Format("^FO30,470^FDTanggal Daftar^FS"));
            command.Append(string.Format("^FO260,470^FD:^FS"));
            command.Append(string.Format("^FO280,470^FD{0}^FS", oRegistration.RegistrationDateInString));
            command.Append(string.Format("^FO30,500^FDUnit Pelayanan^FS"));
            command.Append(string.Format("^FO260,500^FD:^FS"));
            command.Append(string.Format("^FO280,500^FD{0} / {1}^FS", oRegistration.ServiceUnitName, oRegistration.RoomCode));
            command.Append(string.Format("^FO30,530^FDDokter^FS"));
            command.Append(string.Format("^FO260,530^FD:^FS"));
            command.Append(string.Format("^FO280,530^FD{0}^FS", oRegistration.ParamedicName));

            #region Table Title
            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,540^FD_________________________________________________________________^FS"));
            command.Append(string.Format("^CFD"));
            command.Append(string.Format("^FO30,590^FDNama Item^FS"));
            command.Append(string.Format("^FO490,590^FDJumlah^FS"));
            command.Append(string.Format("^FO720,590^FDNilai^FS"));
            #endregion

            #region Transaction Detail
            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,600^FD_________________________________________________________________^FS"));
            command.Append(string.Format("^CFD"));

            int y = 660;
            decimal subTotalDrugSupplies = 0;
            foreach (vPatientChargesDtPayment item in lstItem)
            {
                if (item.ItemName1.Length > 35)
                    command.Append(string.Format("^FO30,{0}^FD{1}^FS", y.ToString(), item.ItemName1.Substring(0, 35)));
                else
                    command.Append(string.Format("^FO30,{0}^FD{1}^FS", y.ToString(), item.ItemName1));

                command.Append(String.Format("^FO490,{0}^FD{1} {2}^FS", y.ToString(), item.ChargedQuantity.ToString("N0").PadLeft(6, ' '), item.ItemUnit));
                command.Append(string.Format("^FO640,{0}^FD{1}^FS", y.ToString(), item.LineAmount.ToString("N0").PadLeft(14, ' ')));

                if (item.GCItemType == Constant.ItemType.OBAT_OBATAN || item.GCItemType == Constant.ItemType.BARANG_MEDIS)
                    subTotalDrugSupplies += item.LineAmount;
                y += 30;
            };

            command.Append(string.Format("^CF024,24"));
            command.Append(string.Format("^FO30,{0}^FD_________________________________________________________________^FS", y.ToString()));

            #endregion

            List<vPatientBill> lstBill = BusinessLayer.GetvPatientBillList(string.Format("PaymentID = {0} AND GCTransactionStatus <> '{1}'", paymentID, Constant.TransactionStatus.VOID));
            decimal totalDiscount = lstBill.Sum(lst => (lst.PatientDiscountAmount + lst.PayerDiscountAmount));
            decimal totalTransaction = oPaymentHd.TotalBillAmount;
            decimal totalPayment = oPaymentHd.TotalPaymentAmount;
            decimal balanceAmount = totalTransaction - totalPayment;
            decimal _DPPAmount = 0;
            decimal _PPNAmount = 0;

            _DPPAmount = Convert.ToDecimal(subTotalDrugSupplies / Convert.ToDecimal(1.1));
            _PPNAmount = Convert.ToDecimal((_DPPAmount * 10) / 100);

            command.Append(string.Format("^CFD"));
            y += 50;
            command.Append(String.Format("^FO30,{0}^FDDisc. Global  :  {1}^FS", y.ToString(), totalDiscount.ToString("N0")));
            command.Append(String.Format("^FO460,{0}^FDTotal Nilai^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), totalTransaction.ToString("N0").PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO460,{0}^FDTotal Bayar^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), totalTransaction.ToString("N0").PadLeft(14, ' ')));
            y += 50;
            command.Append(String.Format("^FO460,{0}^FDDPP^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), _DPPAmount.ToString("N0").PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO460,{0}^FDPPN/VAT^FS", y.ToString()));
            command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), _PPNAmount.ToString("N0").PadLeft(14, ' ')));
            //y += 10;
            //command.Append(String.Format("^CF024,24"));
            //command.Append(String.Format("^FO460,{0}^FD_____________________________^FS", y.ToString()));
            //command.Append(string.Format("^CFD"));
            //y += 30;
            //command.Append(String.Format("^FO460,{0}^FDBalance^FS", y.ToString()));
            //command.Append(String.Format("^FO620,{0}^FD:^FS", y.ToString()));
            //command.Append(String.Format("^FO640,{0}^FD{1}^FS", y.ToString(), balanceAmount.ToString().PadLeft(14, ' ')));
            y += 30;
            command.Append(String.Format("^FO30,{0}^FDNOTES : ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* Bukti pembayaran berlaku juga sebagai kwitansi ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* Dicetak oleh sistem, tidak memerlukan tanda tangan ^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^FO100,{0}^FD* Obat dan Persediaan Medis sudah termasuk PPn^FS", y.ToString()));
            y += 30;
            command.Append(String.Format("^CF024,24"));
            command.Append(String.Format("^FO30,{0}^FD_________________________________________________________________^FS", y.ToString()));

            #region Report Footer
            y += 50;
            command.Append(string.Format("^CFD"));
            command.Append(String.Format("^FO30 ,{0}^FDTgl Cetak : {1} {2} ^FS", y.ToString(), DateTime.Now.ToString(Constant.FormatString.DATE_FORMAT), DateTime.Now.ToString(Constant.FormatString.TIME_FORMAT)));
            command.Append(String.Format("^FO420,{0}^FDDicetak Oleh : {1} ^FS", y.ToString(), AppSession.UserLogin.UserFullName));
            command.Append(String.Format("^PR2"));
            command.Append(String.Format("^XZ"));
            #endregion

            return command.ToString();
        }

        private static string GenerateBuktiPembayaran1EPL(int paymentID)
        {
            vPatientPaymentHd oPaymentHd = BusinessLayer.GetvPatientPaymentHdList(string.Format("PaymentID = {0}", paymentID)).FirstOrDefault();
            string paymentNo = oPaymentHd.PaymentNo;

            vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
            string healthcareName = oHealthcare.HealthcareName;
            string addressLine1 = oHealthcare.AddressLine1;
            string addressLine2 = oHealthcare.AddressLine2;
            string addressLine3 = oHealthcare.PhoneNo1;
            string addressLine4 = oHealthcare.FaxNo1;
            string companyName = oHealthcare.CompanyName;
            string taxRegistrantNo = oHealthcare.TaxRegistrantNo;

            StringBuilder sb = new StringBuilder();
            //string barcodeValue = oPatient.MedicalNo;

            sb.AppendLine("q812");
            sb.AppendLine("Q100,0");
            int yPos = 100;
            string image = HttpContext.Current.Server.MapPath("~/libs/Images/logoBW.bmp");

            sb.AppendLine(string.Format("A0,0,0,2,1,1,N,\"{0}\"", "-"));
            sb.AppendLine(SendImageToPrinter(0, yPos, image));
            sb.AppendLine(string.Format("A110,{0},0,2,1,1,N,\"{1}\"", yPos, healthcareName));
            yPos += 20;
            sb.AppendLine(string.Format("A110,{0},0,2,1,1,N,\"{1}\"", yPos, addressLine1));
            yPos += 20;
            sb.AppendLine(string.Format("A110,{0},0,2,1,1,N,\"{1}\"", yPos, addressLine2));
            yPos += 20;
            sb.AppendLine(string.Format("A110,{0},0,2,1,1,N,\"{1}\"", yPos, addressLine3));
            yPos += 20;
            sb.AppendLine(string.Format("A110,{0},0,2,1,1,N,\"{1}\"", yPos, addressLine4));

            #region Report Title
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,3,1,1,N,\"{1}\"", yPos, PadBoth("CASHIER RECEIPT", 57)));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"{1}\"", yPos, PadBoth(paymentNo, 67)));
            yPos += 40;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Nama Perusahaan      : {1}\"", yPos, companyName));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"NPWP                 : {1}\"", yPos, taxRegistrantNo));
            yPos += 30;
            #endregion

            vRegistration oRegistration = BusinessLayer.GetvRegistrationList(string.Format("VisitID = {0}", oPaymentHd.RegistrationID)).FirstOrDefault();
            sb.AppendLine(string.Format("LO0,{0},812,4", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Patient Name         : {1}\"", yPos, oRegistration.PatientName));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Date of Birth        : {1}\"", yPos, oRegistration.DateOfBirthInString));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Registration No      : {1}\"", yPos, oRegistration.RegistrationNo));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Registration Date    : {1}\"", yPos, oRegistration.DateOfBirthInString));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Service Unit / Room  : {1} / {2}\"", yPos, oRegistration.ServiceUnitName, oRegistration.RoomCode));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Payment No           : {1}\"", yPos, oPaymentHd.PaymentNo));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Registered Physician : {1}\"", yPos, oRegistration.ParamedicName));

            #region Table Title
            yPos += 40;
            sb.AppendLine(string.Format("LO0,{0},812,4", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Item Name\"", yPos));
            sb.AppendLine(string.Format("A500,{0},0,2,1,1,N,\"Quantity\"", yPos));
            sb.AppendLine(string.Format("A700,{0},0,2,1,1,N,\"Amount\"", yPos));
            yPos += 40;
            sb.AppendLine(string.Format("LO0,{0},812,4", yPos));
            #endregion

            #region Transaction Detail
            sb.Append(string.Format("^CF024,24"));
            sb.Append(string.Format("^FO10,600^FD_________________________________________________________________^FS"));
            sb.Append(string.Format("^CFD"));

            List<vPatientChargesDtPayment> lstItem = BusinessLayer.GetvPatientChargesDtPaymentList(string.Format("PaymentID = {0} ORDER BY GCItemType,ItemCode ASC", paymentID));
            foreach (vPatientChargesDtPayment item in lstItem)
            {
                yPos += 20;
                sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"{1}\"", yPos, item.ItemName1));
                sb.AppendLine(string.Format("A463,{0},0,2,1,1,N,\"{1}\"", yPos, string.Format("{0} {1}", item.ChargedQuantity.ToString().PadLeft(6, ' '), item.ItemUnit)));
                sb.AppendLine(string.Format("A643,{0},0,2,1,1,N,\"{1}\"", yPos, item.LineAmount.ToString("N2").PadLeft(14, ' ')));
            };
            #endregion

            List<vPatientBill> lstBill = BusinessLayer.GetvPatientBillList(string.Format("PaymentID = {0} AND GCTransactionStatus <> '{1}'", paymentID, Constant.TransactionStatus.VOID));
            decimal totalDiscount = lstBill.Sum(lst => (lst.PatientDiscountAmount + lst.PayerDiscountAmount));
            decimal totalTransaction = oPaymentHd.TotalBillAmount;
            decimal totalPayment = oPaymentHd.TotalPaymentAmount;
            decimal balanceAmount = (totalTransaction - (totalPayment)) * -1;

            yPos += 40;
            sb.AppendLine(string.Format("LO0,{0},812,4", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"{1}\"", yPos, string.Format("Disc. Global : {0}", totalDiscount.ToString("N2"))));
            sb.AppendLine(string.Format("A380,{0},0,2,1,1,N,\"{1}\"", yPos, "Total Amount"));
            sb.AppendLine(string.Format("A631,{0},0,2,1,1,N,\"{1}\"", yPos, string.Format("{0}", totalTransaction.ToString("N2").PadLeft(14, ' '))));
            yPos += 20;
            sb.AppendLine(string.Format("A380,{0},0,2,1,1,N,\"{1}\"", yPos, "Total Payment"));
            sb.AppendLine(string.Format("A631,{0},0,2,1,1,N,\"{1}\"", yPos, string.Format("{0}", totalPayment.ToString("N2").PadLeft(14, ' '))));
            yPos += 40;
            sb.AppendLine(string.Format("LO380,{0},432,4", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A380,{0},0,2,1,1,N,\"{1}\"", yPos, "Change"));
            sb.AppendLine(string.Format("A631,{0},0,2,1,1,N,\"{1}\"", yPos, string.Format("{0}", balanceAmount.ToString().PadLeft(14, ' '))));

            yPos += 60;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Notes : * This printed form also applies as Payment Receipt\"", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"        * Printed by system , no signature needed\"", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("LO0,{0},812,4", yPos));
            yPos += 20;
            sb.AppendLine(string.Format("A0,{0},0,2,1,1,N,\"Print Date : {1:dd-MMM-yyyy HH:mm:ss} Printed By {2}\"", yPos, DateTime.Now, AppSession.UserLogin.UserFullName));

            return sb.ToString();
        }
        #endregion

        #region PrintSlipGizi
        /// <summary>
        /// Cetak Slip Gizi : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintSlipGizi(vNutritionOrder oNutrition, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                #region Print Detail
                sb.AppendLine(string.Format("No.Registrasi/No.RM    : {0} / {1}", oNutrition.RegistrationNo, oNutrition.MedicalNo));
                sb.AppendLine(string.Format("No.Tempat Tidur/Kelas  : {0} / {1}", oNutrition.BedCode, oNutrition.ClassName));
                sb.AppendLine(string.Format("Pasien                 : {0}", oNutrition.PatientName));
                sb.AppendLine(string.Format("Pasien                 : {0}", oNutrition.PatientName));
                sb.AppendLine(string.Format("Agama                  : {0}", oNutrition.Religion));
                sb.AppendLine(string.Format("Ruang                  : {0}", oNutrition.RoomName));
                sb.AppendLine(string.Format("No.Order               : {0}", oNutrition.NutritionOrderNo));
                sb.AppendLine(string.Format("Tanggal / Jam Order    : {0} / {1}", oNutrition.NutritionOrderDateInString, oNutrition.NutritionOrderTime));
                sb.AppendLine(string.Format("Diagnosis              : {0}", oNutrition.DiagnosisText));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion

        #region PrintNutritionWorklist
        /// <summary>
        /// Cetak Form Permintaan Makanan : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintNutritionWorklist(List<vNutritionWorkListInformation> nutritionWorkList, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                #region Print Detail
                sb.AppendLine(string.Format("               FORM PERMINTAAN MAKANAN"));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("   Bagian         : {0}", nutritionWorkList.FirstOrDefault().ServiceUnitName));
                sb.AppendLine(string.Format("   Tanggal        : {0}", nutritionWorkList.FirstOrDefault().cfScheduleDateInString));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("------------------------------------------------"));
                sb.AppendLine(string.Format("   JENIS MAKANAN                          PORSI "));
                sb.AppendLine(string.Format("------------------------------------------------"));
                foreach (vNutritionWorkListInformation oNutritionWorklist in nutritionWorkList)
                {
                    sb.AppendLine(string.Format("  {0} {1}", oNutritionWorklist.MealPlanName.PadRight(39, ' '), oNutritionWorklist.JumlahPorsi.ToString().PadLeft(5, ' ')));
                }
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("                                   Ka. Bag"));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("                                ______________"));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion

        #region PrintNutritionPatientOrder
        /// <summary>
        /// Cetak Form Permintaan Makanan : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintNutritionPatientOrder(List<vNutritionOrderDtWorkList1> nutritionWorkList, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                #region Print Detail
                sb.AppendLine(string.Format("               BON PEMESANAN MAKANAN"));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("   Untuk Tanggal         : {0}", nutritionWorkList.FirstOrDefault().cfScheduleDate));
                sb.AppendLine(string.Format("   Jadwal Makan          : {0}", nutritionWorkList.FirstOrDefault().MealTime));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("------------------------------------------------"));
                sb.AppendLine(string.Format("   JENIS MAKANAN                          PORSI "));
                sb.AppendLine(string.Format("------------------------------------------------"));

                foreach (vNutritionOrderDtWorkList1 oNutritionWorklist in nutritionWorkList)
                {
                    sb.AppendLine(string.Format("  {0} {1}", oNutritionWorklist.MealPlanName.PadRight(39, ' '), oNutritionWorklist.JumlahPorsi.ToString().PadLeft(5, ' ')));
                }
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("   Ka. Sub Bag Dapur          Petugas Distribusi"));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("    ______________              ______________"));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion

        #region PrintJobOrderLaboratory
        /// <summary>
        /// Cetak Form Permintaan Makanan : RSSBB
        /// </summary>
        /// <param name="oVisit"></param>
        /// <param name="printerUrl"></param>
        public static void PrintJobOrderLaboratory(List<vJobOrderLab> oOrder, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                #region Print Detail
                sb.AppendLine(string.Format("               JOB ORDER LABORATORIUM"));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("   No. RM            : {0}", oOrder.FirstOrDefault().MedicalNo));
                sb.AppendLine(string.Format("   NIK               : {0}", oOrder.FirstOrDefault().NIK));
                sb.AppendLine(string.Format("   Nama Pasien       : {0}", oOrder.FirstOrDefault().PatientName));
                sb.AppendLine(string.Format("   Tgl. Lahir        : {0}", oOrder.FirstOrDefault().DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT)));
                sb.AppendLine(string.Format("   No. Order         : {0}", oOrder.FirstOrDefault().TestOrderNo));
                sb.AppendLine(string.Format("   No. Registrasi    : {0}", oOrder.FirstOrDefault().RegistrationNo));
                sb.AppendLine(string.Format("   Dokter Perujuk    : {0}", oOrder.FirstOrDefault().ParamedicName));
                sb.AppendLine(string.Format("   Penunjang Medis   : {0}", oOrder.FirstOrDefault().ServiceUnitName));
                sb.AppendLine(string.Format("   Tgl. Order        : {0} {1}", oOrder.FirstOrDefault().TestOrderDate.ToString(Constant.FormatString.DATE_FORMAT), oOrder.FirstOrDefault().TestOrderTime));
                sb.AppendLine(string.Format("   Catatan           : {0}", oOrder.FirstOrDefault().Remarks));
                sb.AppendLine(string.Format("------------------------------------------------"));
                sb.AppendLine(string.Format("   NAMA ITEM                                    "));
                sb.AppendLine(string.Format("------------------------------------------------"));
                if (oOrder.Count >= 1)
                {
                    foreach (vJobOrderLab dt in oOrder)
                    {
                        sb.AppendLine(string.Format("   {0}", dt.ItemName1));
                    }
                }
                else
                {
                    sb.AppendLine(string.Format("   -"));
                }

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string GS = Convert.ToString((char)29);
                string ESC = Convert.ToString((char)29);

                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();
                #endregion
            }
        }

        #endregion

        #region Print Gizi BROS

        public static void PrintNutritionPatientRegistration(vLabelPatientRegistrationInfo oVisit, string printerUrl, string printFormat)
        {
            string printerName1 = printerUrl;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            if (!string.IsNullOrEmpty(printerName1))
            {
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.NutritionLabel, printFormat);

                List<string> lstField = GetMetadata(PrintingGroup.NutritionLabel);
                if (!string.IsNullOrEmpty(command))
                {
                    string filterExpression = string.Format("RegistrationID = {0}", oVisit.RegistrationID);
                    List<vLabelPatientRegistrationInfo> lstDetail = BusinessLayer.GetvLabelPatientRegistrationInfoList(filterExpression);
                    foreach (vLabelPatientRegistrationInfo item in lstDetail)
                    {
                        #region Get Header Information
                        string registrationno = item.RegistrationNo;
                        string patientLocation = string.Format("{0} {1}", item.ServiceUnitName, item.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string scheduleDate = "";
                        string patientName1 = "";
                        string stapleFood = "";
                        string numberOfCalories = "";

                        string mealPlanName = "";
                        string mealTime = "";
                        string multiDiet = "";
                        string cfDietNotes = "";
                        string cfDietNotes1 = "";
                        string remarksHd = "";

                        if (patientLocation.Length > 30)
                        {
                            patientLocation = patientLocation.Substring(0, 30);
                        }

                        patientName = item.PatientName;
                        medicalNo = item.MedicalNo;
                        dateOfBirth = item.DateOfBirthInString;
                        sex = item.GCGender == "0003^M" ? "L" : "P";

                        int count = item.PatientName.Count();
                        if (count > 26)
                        {
                            patientName1 = item.PatientName.Substring(0, 26);
                        }
                        else
                        {
                            patientName1 = item.PatientName;
                        }

                        cfPatientNameInLabel = item.PatientName; ;
                        string[] names = cfPatientNameInLabel.Split(' ');

                        if (names.Length >= 3)
                        {
                            cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                        }

                        if (cfPatientNameInLabel.Length > 25)
                        {
                            cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                        }

                        #endregion

                        var labelInfo = new Dictionary<string, string>();
                        labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                        labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                        labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                        labelInfo.Add("PatientName", patientName);
                        labelInfo.Add("PatientName1", patientName1);
                        labelInfo.Add("PatientNameInLabel", cfPatientNameInLabel);
                        labelInfo.Add("MedicalNo", medicalNo);
                        labelInfo.Add("RegistrationNo", registrationno);
                        labelInfo.Add("DateOfBirthInString", dateOfBirth);
                        labelInfo.Add("Sex", sex);
                        labelInfo.Add("MealPlanName", mealPlanName);
                        labelInfo.Add("MealTime", mealTime);
                        labelInfo.Add("MultiDiet", multiDiet);
                        labelInfo.Add("ScheduleDate", scheduleDate);
                        labelInfo.Add("ServiceUnitName", item.ServiceUnitName);
                        labelInfo.Add("BusinessPartnerName", item.BusinessPartnerName);
                        labelInfo.Add("RoomCode", item.RoomCode);
                        labelInfo.Add("RoomName", item.RoomName);
                        labelInfo.Add("BedCode", item.BedCode);
                        labelInfo.Add("cfDietNotes", cfDietNotes);
                        labelInfo.Add("cfDietNotes1", cfDietNotes1);
                        labelInfo.Add("RemarksHd", remarksHd);
                        labelInfo.Add("StapleFood", stapleFood);
                        labelInfo.Add("NumberOfCalories", numberOfCalories);

                        #region Replace Nutrition Label Information
                        string labelCommand = command;
                        foreach (string fieldName in lstField)
                        {
                            labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                        }
                        #endregion

                        #region Send Command to Printer

                        DirectPrinting printer = new DirectPrinting();
                        string printerName = printerName1;

                        printer.OpenPrinter(printerName);
                        printer.StartDocPrinter();
                        printer.Send("\n");
                        printer.Send("n\n");
                        printer.Send(labelCommand);
                        printer.Send("p1\n");
                        printer.EndDocPrinter();
                        #endregion
                    }
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }

        #endregion

        #region Print Gizi RSSES
        public static void formatMenuMakanan(string printerUrl)
        {

            #region Print Detail
            StringBuilder sb = new StringBuilder();
            string ESC = Convert.ToString((char)27);
            //Send Auto-Cut Command
            string GS = Convert.ToString((char)29);
            string t = Convert.ToString((char)116);
            string E = Convert.ToString((char)69);

            string BoldOn = ESC + GS + t;
            string BoldOff = ESC + GS + t;

            string fontBold = "\x1b\x45\x01";
            string fontBoldEnd = "\x1b\x45\x00";

            string fontDoubleHeight = "\x1b\x21\x10";
            string fontDoubleHeightEnd = "\x1b\x21\x00";

            const string GSs = "\u001D";
            string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
            string DoubleOff = GSs + "!" + "\0";

            string fontItalic = "\x1b\x34\x01";
            string fontItalicEnd = "\x1b\x34\x00";


            // sb.Append(ESC + "a0");

            sb.AppendLine(string.Format("               MENU UTAMA"));

            sb.Append(fontBold);
            sb.AppendLine(string.Format("ANGELA 1/315 1"));
            sb.AppendLine("");
            sb.AppendLine(string.Format("006253-22      29/06/2022      Siang"));
            sb.Append(fontBoldEnd);
            sb.AppendLine("");
            sb.AppendLine(string.Format("WIDAYANTI (06/08/1956)"));
            sb.AppendLine("");
            sb.AppendLine("Lunak 1900 kkal");
            sb.AppendLine("");
            sb.AppendLine("     Makanan Mohon Segera Dikonsumsi");
            sb.AppendLine("(tidak lebih dari 2 jam setelah disajikan)");



            //Append beberapa baris supaya bisa pas dengan cutter
            for (int i = 0; i <= 6; i++)
            {
                sb.AppendLine("");
            }



            string command = "";
            command = ESC + "@";
            command += GS + "V" + (char)1;
            sb.AppendLine(command);
            #endregion

            #region Send Command to Printer

            RawPrinterHelper print = new RawPrinterHelper();

            //Initialize Printer
            print.OpenPrint(printerUrl);
            print.SendStringToPrinter(sb.ToString());
            print.ClosePrint();

            #endregion
        }
        #endregion

        #region GetLabelCommand
        private static string GetLabelCommand(LabelGroup labelGroup = LabelGroup.DrugLabel, LabelSize labelSize = LabelSize.Label_8x3)
        {
            #region Get Label Format
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\label\{1}\{2}.zpl", filePath, labelGroup.ToString(), labelSize.ToString());
            IEnumerable<string> lstCommand = File.ReadAllLines(fileName);
            StringBuilder commandText = new StringBuilder();
            foreach (string command in lstCommand)
            {
                commandText.AppendLine(command);
            }
            string result = commandText.ToString();
            #endregion
            return result;
        }
        private static List<string> GetLabelMetadata(LabelGroup labelGroup)
        {
            List<string> metadata = new List<string>();
            string filePath = HttpContext.Current.Server.MapPath("~/Libs/App_Data");
            string fileName = string.Format(@"{0}\label\{1}\label.ddl", filePath, labelGroup.ToString());
            IEnumerable<string> lstField = File.ReadAllLines(fileName);
            metadata = lstField.ToList();
            return metadata;
        }

        #region Printer Label Template
        public static String GeneratePrintLabelTemplate1(vPrescriptionOrderHd prescriptionOrderHd)
        {
            StringBuilder command = new StringBuilder();
            command.Append(String.Format("^XA"));
            command.AppendLine(String.Format("^LL210"));
            command.AppendLine(String.Format("^PW600"));
            command.AppendLine(String.Format("^LH2,1^MD10"));
            command.AppendLine(String.Format("^CF018,20"));
            command.AppendLine(String.Format("^FO2,21^FD{0}^FS", AppSession.UserLogin.HealthcareName.ToUpper()));
            command.AppendLine(String.Format("^FO340,21^FD{0}^FS", "Tanggal"));
            command.AppendLine(String.Format("^FO420,21^FD{0}^FS", ":"));
            command.AppendLine(String.Format("^FO430,21^FD{0}^FS", prescriptionOrderHd.PrescriptionDateInString));//tanggal resep
            command.AppendLine(String.Format("^FO2,41^FD{0}^FS", "Apoteker"));
            command.AppendLine(String.Format("^FO92,41^FD{0}^FS", ":"));
            command.AppendLine(String.Format("^FO102,41^FD{0}^FS", prescriptionOrderHd.CreatedByName));//nama apotaker
            command.AppendLine(String.Format("^FO340,41^FD{0}^FS", "No.Resep"));
            command.AppendLine(String.Format("^FO420,41^FD{0}^FS", ":"));
            command.AppendLine(String.Format("^FO430,41^FD{0}^FS", prescriptionOrderHd.PrescriptionOrderNo));//no resep
            command.AppendLine(String.Format("^FO2,61^FD{0}^FS", "SIPA"));
            command.AppendLine(String.Format("^FO92,61^FD{0}^FS", ":"));
            command.AppendLine(String.Format("^FO102,61^FD{0}^FS", "123.456.7890"));
            command.AppendLine(String.Format("^FO340,61^FD{0}^FS", "No.RM"));
            command.AppendLine(String.Format("^FO420,61^FD{0}^FS", ":"));
            command.AppendLine(String.Format("^FO430,61^FD{0}^FS", prescriptionOrderHd.MedicalNo)); // no RM
            command.AppendLine(String.Format("^FO2,81^FD{0}^FS", "_".PadRight(70, '_')));
            command.AppendLine(String.Format("^CF024,24"));
            command.AppendLine(String.Format("^FO2,111^FD{0}: {1}  ({2})^FS", "Pro", prescriptionOrderHd.PatientName, prescriptionOrderHd.Sex));// Nama Jenis Kelamin
            command.AppendLine(String.Format("^CF018,20"));
            command.AppendLine(String.Format("^FO340,111^FD{0}^FS", "Umur"));
            command.AppendLine(String.Format("^FO420,111^FD{0}^FS", ":"));

            command.AppendLine(String.Format("^FO430,111^FD{0}^FS", prescriptionOrderHd.PatientAge));// umur thn bln hari
            command.AppendLine(String.Format("^CF028,28"));
            //command.AppendLine(String.Format("^FO2,151^FD{0}^FS", row("nmdesc1")));
            command.AppendLine(String.Format("^CF022,22"));
            //command.AppendLine(String.Format("^FO2,191^FD{0}^FS", row("ketaturan")));
            //command.AppendLine(String.Format("^FO2,211^FD{0}^FS", row("aturanLain")));
            command.AppendLine(String.Format("^CF026,26"));
            //command.AppendLine(String.Format("^FO400,191^FD{0}^FS", obtluar));
            command.AppendLine(String.Format("^XZ"));

            return command.ToString();
        }
        #endregion

        #region Nutrition
        #region PrintKitchenJobOrderByMealPlan1
        /// <summary>
        /// Cetak Bukti Job Order Dapur : Panel Menu
        /// </summary>
        /// <param name="vNutritionOrderDtMealPlan"></param>
        /// <param name="printerUrl"></param>
        public static void PrintKitchenJobOrderByMealPlan1(string scheduleDate, int mealPlanID, string mealTime, string printerUrl)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                string filterExpression = string.Format("ScheduleDate = '{0}' AND MealPlanID = {1} AND MealTime = '{2}'", scheduleDate, mealPlanID, mealTime);
                List<vNutritionOrderDtMealPlan> lstEntity = BusinessLayer.GetvNutritionOrderDtMealPlanList(filterExpression);

                sb.AppendLine(string.Format("Tanggal      : {0}", lstEntity[0].ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)));
                sb.AppendLine(string.Format("Panel Menu   : {0}", lstEntity[0].MealPlanName));
                sb.AppendLine(string.Format("Jadwal Makan : {0}", lstEntity[0].MealTime));
                sb.AppendLine("-".PadRight(48, '-'));
                sb.AppendLine(string.Format("{0} {1} {2}", "Menu".PadRight(30, ' '), "Order", "Realisasi"));
                sb.AppendLine("-".PadRight(48, '-'));
                foreach (var item in lstEntity)
                {
                    sb.AppendLine(string.Format("{0} {1} {2}", item.MealName.PadRight(30, ' '), item.JumlahPorsi.ToString().PadLeft(5), string.Empty));
                }
                sb.AppendLine("-".PadRight(48, '-'));

                #region Print Detail
                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 8; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                sb.AppendLine(CreateAutoCutCommand());
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }

        private static string CreateAutoCutCommand()
        {
            string GS = Convert.ToString((char)29);
            string ESC = Convert.ToString((char)29);
            string command = ESC + "@";
            command += GS + "V" + (char)1;
            return command;
        }
        #endregion

        #region PrintNutritionDistributionLabel1
        /// <summary>
        /// Cetak Label Distribusi Makan Pasien
        /// </summary>
        /// <param name="vNutritionOrderDtMealPlan"></param>
        /// <param name="printerUrl"></param>
        public static void PrintNutritionDistributionLabel1(int orderID, int detailID, string printerUrl, string expiredTime)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                string filterExpression = string.Format("NutritionOrderHdID = {0} AND NutritionOrderDtID = {1} ORDER BY BedCode", orderID, detailID);
                List<vNutritionOrderDtCustom> lstEntity = BusinessLayer.GetvNutritionOrderDtCustomList(filterExpression);

                sb.AppendLine(string.Format("Tanggal      : {0}", lstEntity[0].ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT)));
                sb.AppendLine(string.Format("Jadwal Makan : {0}", lstEntity[0].MealTime));
                sb.AppendLine(string.Format("No.Reg / MR  : {0} / {1}", lstEntity[0].RegistrationNo, lstEntity[0].MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien  : {0}", lstEntity[0].cfPatientNameSalutation));
                sb.AppendLine(string.Format("Jenis Kelamin: {0}", lstEntity[0].Gender));
                sb.AppendLine(String.Format("Tgl. Lahir   : {0}", lstEntity[0].DateOfBirthInString));
                //sb.AppendLine(string.Format("Ruangan / TT : {0} - {1} / {2}", lstEntity[0].ServiceUnitName.TrimEnd(), lstEntity[0].RoomName, lstEntity[0].BedCode));
                sb.AppendLine(String.Format("Jenis Diet   : {0}", lstEntity[0].MultiDiet));
                sb.AppendLine(string.Format("Panel Menu   : {0}", lstEntity[0].MealPlanName));
                sb.AppendLine(string.Format("Catatan      : {0} {1}", lstEntity[0].RemarksHd, lstEntity[0].Remarks));
                sb.AppendLine(String.Format(""));
                sb.AppendLine(String.Format("Jam Expired  : {0}", expiredTime));
                sb.AppendLine(String.Format(""));
                sb.AppendLine(String.Format("Tgl Cetak    : {0}", DateTime.Now.ToString("dd-MM-yyyy HH:mm")));
                //sb.AppendLine("-".PadRight(48, '-'));
                //sb.AppendLine(String.Format("  HA     LH     LN     SY     BH   Cairan"));
                //sb.AppendLine(String.Format("[    ] [    ] [    ] [    ] [    ] [    ]"));
                //sb.AppendLine(String.Format(""));
                //sb.AppendLine(String.Format("HABIS    1      2      3      4    UTUH"));
                //sb.AppendLine(String.Format("      <- - - - - - - - - - - - -> "));
                //sb.AppendLine(String.Format("0      10-25  25-50  50-75  75-100  100"));
                //sb.AppendLine(String.Format("      <- - - - - - - - - - - - -> "));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                sb.AppendLine(CreateAutoCutCommand());

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion

        #region PrintNutritionDistributionLabelRSSEBK
        /// <summary>
        /// Cetak Label Distribusi Makan Pasien
        /// </summary>
        /// <param name="vNutritionOrderDtMealPlan"></param>
        /// <param name="printerUrl"></param>
        public static void PrintNutritionDistributionLabelRSSEBK(int orderID, int detailID, string printerUrl, string expiredTime)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                StringBuilder sb = new StringBuilder();

                string filterExpression = string.Format("NutritionOrderHdID = {0} AND NutritionOrderDtID = {1} ORDER BY BedCode", orderID, detailID);
                List<vNutritionOrderDtCustom> lstEntity = BusinessLayer.GetvNutritionOrderDtCustomList(filterExpression);

                sb.AppendLine(String.Format("No.Reg      : {0}", lstEntity[0].RegistrationNo));
                sb.AppendLine(String.Format("No.RM       : {0}", lstEntity[0].MedicalNo));
                sb.AppendLine(String.Format("No.TT/Kelas : {0} - {1}", lstEntity[0].BedCode, lstEntity[0].ClassName));
                sb.AppendLine(String.Format("Nama Pasien : {0}", lstEntity[0].cfPatientNameSalutation));
                sb.AppendLine(String.Format("Tgl. Lahir  : {0}", lstEntity[0].DateOfBirthInString));
                sb.AppendLine(String.Format("Agama       : {0}", lstEntity[0].Religion));
                sb.AppendLine(String.Format("Nama Diit   : {0} - {1}", lstEntity[0].MealPlanCode, lstEntity[0].MealPlanName));
                sb.AppendLine(String.Format("Jam Makan   : {0}", lstEntity[0].MealTime));
                sb.AppendLine(String.Format("Keterangan  : {0} {1}", lstEntity[0].RemarksHd, lstEntity[0].Remarks));
                sb.AppendLine(String.Format("Ruang       : {0}", lstEntity[0].ServiceUnitName.TrimEnd()));
                sb.AppendLine(String.Format("Tgl. Order  : {0} {1}", lstEntity[0].NutritionOrderDate.ToString("dd-MM-yyyy"), lstEntity[0].NutritionOrderTime));
                sb.AppendLine(String.Format("Diagnosa    : {0}", lstEntity[0].Diagnose));
                sb.AppendLine(String.Format("Tgl Cetak   : {0}", DateTime.Now.ToString("dd-MM-yyyy HH:mm")));
                sb.AppendLine(String.Format(" HA    LH    LN    SY    BH   Cairan"));
                sb.AppendLine(String.Format("[   ] [   ] [   ] [   ] [   ] [   ]"));
                sb.AppendLine(String.Format("HABIS   1   2   3   4   5   UTUH"));
                sb.AppendLine(String.Format("     <--------------------->"));
                sb.AppendLine(String.Format("Note : Menu ini wajib dimakan paling"));
                sb.AppendLine(String.Format("       lama 1/2 jam setelah dihidangkan"));

                //Append beberapa baris supaya bisa pas dengan cutter
                for (int i = 0; i <= 5; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                sb.AppendLine(CreateAutoCutCommand());

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                //Initialize Printer
                print.OpenPrint(printerUrl);
                print.SendStringToPrinter(sb.ToString());
                print.ClosePrint();

                #endregion
            }
        }
        #endregion
        #endregion
        #endregion

        #region Epl Utilities
        public static string SendImageToPrinter(int top, int left, string source)
        {
            System.Drawing.Bitmap bitmap = (System.Drawing.Bitmap)System.Drawing.Image.FromFile(source);
            return SendImageToPrinter(top, left, bitmap.Height, bitmap);
        }

        private static string SendImageToPrinter(int top, int left, int height, System.Drawing.Bitmap bitmap)
        {
            string @string;
            using (System.IO.MemoryStream memoryStream = new System.IO.MemoryStream())
            {
                using (System.IO.BinaryWriter binaryWriter = new System.IO.BinaryWriter(memoryStream, System.Text.Encoding.ASCII))
                {
                    int num = (int)System.Math.Ceiling((double)bitmap.Width / 8.0);
                    binaryWriter.Write(System.Text.Encoding.ASCII.GetBytes(string.Format("GW{0},{1},{2},{3},", new object[]
			{
				top,
				left,
				num,
				height
			})));
                    int num2 = num * 8;
                    for (int i = 0; i < bitmap.Height; i++)
                    {
                        int j = 0;
                        while (j < num2)
                        {
                            byte b = 0;
                            int k = 0;
                            while (k < 8)
                            {
                                int num3 = 1;
                                if (j < bitmap.Width)
                                {
                                    System.Drawing.Color pixel = bitmap.GetPixel(j, i);
                                    int num4 = (int)((double)pixel.R * 0.3 + (double)pixel.G * 0.59 + (double)pixel.B * 0.11);
                                    num3 = ((num4 > 127) ? 1 : 0);
                                }
                                b |= (byte)(num3 << 7 - k);
                                k++;
                                j++;
                            }
                            binaryWriter.Write(b);
                        }
                    }
                    binaryWriter.Write("\n");
                    binaryWriter.Flush();
                    memoryStream.Position = 0L;
                    @string = System.Text.Encoding.GetEncoding(1252).GetString(memoryStream.ToArray());
                }
            }
            return @string;
        }

        private static string PadBoth(string str, int length)
        {
            int num = length - str.Length;
            int totalWidth = num / 2 + str.Length;
            return str.PadLeft(totalWidth).PadRight(length);
        }
        #endregion

        #region PrinterBixolon
        //Dibuat Oleh RA

        #region PrintMRLabelBixolon
        public static void PrintMRLabelBixolon(vLabelPatientRegistrationInfo oVisit, string printerUrl, string printFormat, int labelCount = 1)
        {
            RawPrinterHelper print = new RawPrinterHelper();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.PatientLabel, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.PatientLabel);

                if (!string.IsNullOrEmpty(command))
                {
                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    //Initialize Printer
                    for (int i = 0; i < labelCount; i++)
                    {
                        print.OpenPrint(printerUrl);
                        print.SendStringToPrinter(labelCommand);
                        print.ClosePrint();
                    }
                    #endregion
                }
            }
        }
        #endregion

        #region PrintWristbandBixolon
        public static void PrintWristbandBixolon(vConsultVisit oVisit, string printerUrl, string printFormat)
        {
            RawPrinterHelper print = new RawPrinterHelper();

            if (!string.IsNullOrEmpty(printerUrl))
            {
                //Get and Load Printer Command
                string command = string.Empty;
                command = GetPrintFormat(PrintingGroup.Wristband, printFormat);

                //Get Printing Metadata
                List<string> lstField = GetMetadata(PrintingGroup.Wristband);

                if (!string.IsNullOrEmpty(command))
                {

                    #region Store Tracer Information to Dictionary

                    var labelInfo = new Dictionary<string, string>();
                    labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                    foreach (string fieldName in lstField)
                    {
                        if (fieldName != "HealthcareName")
                            labelInfo.Add(fieldName, GetPropertyValue(oVisit, fieldName).ToString());
                    }
                    #endregion
                    #region Replace Command's Visit Information
                    string labelCommand = command;
                    foreach (string fieldName in lstField)
                    {
                        labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                    }
                    #endregion
                    #region Send Command to Printer
                    if (!printerUrl.Contains(':'))
                    {
                        print.OpenPrint(printerUrl);
                        print.SendStringToPrinter(labelCommand);
                        print.ClosePrint();
                    }
                    else
                    {
                        Helper.MedinfrasDirectPrintingTools(printerUrl, labelCommand);
                    }
                    #endregion
                }
            }
        }
        #endregion

        #region PrintDrugLabelBixolon
        public static void PrintDrugLabelBixolon(PrescriptionOrderHd oHeader, string printFormat, String lstPrescriptionOrderDtID = "", string printerUrl1 = "", string printerUrl2 = "", Boolean isPrintByType = false, string printFormat2 = "", string isUsedDispenseQty = "", bool isPrintCompoundDetailLabel = false, int labelCount = 0, string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            #region Baru
            if (!string.IsNullOrEmpty(printerName1))
            {
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).LastOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    if (isPrintByType)
                    {
                        if (oHeader.GCPrescriptionType != Constant.PrescriptionType.MEDICATION_ORDER)
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat2);
                        else
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }
                    else
                    {
                        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }

                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string prescriptionDate = "";
                        string prescriptionTime = "";
                        string storageRemarks = "";
                        string PharmacyPhoneNo = "";
                        string cfPrescriptionDateInString1 = "";
                        string compoundRSSES = "";

                        string ConsumeMethodEng = "";
                        if (patientLocation.Length > 30)
                        {
                            patientLocation = patientLocation.Substring(0, 30);
                        }

                        patientName = entity.PatientName; ;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        sex = entity.GCSex == "0003^M" ? "L" : "P";

                        cfPatientNameInLabel = entity.PatientName;
                        string[] names = cfPatientNameInLabel.Split(' ');

                        if (names.Length >= 3)
                        {
                            cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                        }

                        if (cfPatientNameInLabel.Length > 25)
                        {
                            cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                        }

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        cfPrescriptionDateInString1 = entity.cfPrescriptionDateInString1;
                        prescriptionTime = entity.PrescriptionTime;
                        string cfDispensaryInitial = "";
                        if (entity.TransactionNo != null)
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                            cfDispensaryInitial = string.Format("({0})", entity.ServiceUnitCode);
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}','{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();

                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0 AND ParentID IS NULL", entity.PrescriptionOrderID.ToString());
                        if (lstPrescriptionOrderDtID != string.Empty)
                        {
                            filterExpression += string.Format(" AND PrescriptionOrderDetailID IN ({0})", lstPrescriptionOrderDtID);
                        }

                        List<vPrintPrescriptionEtiket> lstDetail = BusinessLayer.GetvPrintPrescriptionEtiketList(filterExpression);
                        List<vPrintPrescriptionEtiket> lstCompoundDetail = new List<vPrintPrescriptionEtiket>();

                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        bool isUsingExpiredDate = !string.IsNullOrEmpty(lstExpiredDate);
                        bool isUsingPrintNo = !string.IsNullOrEmpty(lstExpiredDate);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;

                        foreach (vPrintPrescriptionEtiket item in lstDetail)
                        {
                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";
                                    if (isPrintCompoundDetailLabel == true)
                                    {
                                        lstCompoundDetail.Add(item);
                                    }
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }


                                }

                                string expiredDate = "";
                                if (item.ExpiredDate != null)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                    {
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                    }
                                    else
                                    {
                                        if (isUsingExpiredDate)
                                        {
                                            expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                        }
                                    }
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);


                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", entityHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", entity.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", entity.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationno);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", entity.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                if (item.IsInjection)
                                {
                                    if (!String.IsNullOrEmpty(defaultSigna))
                                    {
                                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
                                        if (signa != null)
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
                                        }
                                        else
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", "");
                                        }
                                    }
                                }
                                else
                                {
                                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                }


                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty = "";
                                if (isUsedDispenseQty == "True")
                                {
                                    isUsedQty = item.cfTakenQtyWithUnit;
                                }
                                else
                                {
                                    isUsedQty = item.cfDispenseQty;
                                }
                                string isUsedQty1 = "";
                                if (item.IsCompound == true)
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithUnit;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQty;
                                    }
                                }
                                else
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithForm;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQtyWithForm;
                                    }
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                labelInfo.Add("cfCompound1", "");
                                labelInfo.Add("cfCompound2", "");
                                labelInfo.Add("cfCompound3", "");
                                labelInfo.Add("cfCompound4", "");
                                labelInfo.Add("cfCompound5", "");
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfTakenQty);
                                labelInfo.Add("cfIsUsedDispenseQty", isUsedQty);
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", item.cfIsLASA);
                                labelInfo.Add("cfIsHAM", item.cfIsHAM);
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", cfPrescriptionDateInString1);
                                labelInfo.Add("cfDateOfBirthInString1", entity.cfDateOfBirthInString1);
                                labelInfo.Add("RoomName", entity.RoomName);
                                labelInfo.Add("cfTakenQtyWithUnit", entity.cfTakenQtyWithUnit);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);
                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);

                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = labelCount;
                                if (isUsingPrintNo)
                                {
                                    noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                }
                                RawPrinterHelper print = new RawPrinterHelper();

                                string printerName = printerName1;
                                if (item.IsExternalMedication)
                                    printerName = printerName2;

                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        print.OpenPrint(printerName);
                                        print.SendStringToPrinter(labelCommand);
                                        print.ClosePrint();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }

                                #endregion

                                compoundRSSES = "";

                                #region Compound Detail Printing
                                if (lstCompoundDetail.Count > 0)
                                {
                                    #region detail racikan
                                    //ditutup oleh Agustin 2019/08/09 : ubah konsep untuk cetakn detail Obat Racikan RSDO
                                    string filterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN ('{1}','{2}')",
                                    AppSession.UserLogin.HealthcareID, Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN, Constant.SettingParameter.FM_PRINT_ETIKET_DETAIL_OBAT_RACIKAN);
                                    List<vSettingParameterDt> lstParam = BusinessLayer.GetvSettingParameterDtList(filterExp);
                                    string printFormatRacikan = lstParam.Where(lst => lst.ParameterCode.Equals(Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN)).FirstOrDefault().ParameterValue;

                                    string labelFormat = string.Empty; //Read from Setting Parameter
                                    string ipAddress = HttpContext.Current.Request.UserHostAddress;

                                    filterExp = string.Format("IPAddress = '{0}' AND GCPrinterType IN ('{1}','{2}') AND IsDeleted=0",
                                        ipAddress, Constant.DirectPrintType.ETIKET_OBAT_DALAM, Constant.DirectPrintType.ETIKET_OBAT_LUAR);

                                    List<PrinterLocation> lstPrinter = BusinessLayer.GetPrinterLocationList(filterExp);
                                    string printerUrlRacikan1 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_DALAM).FirstOrDefault().PrinterName;
                                    string printerUrlRacikan2 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_LUAR).FirstOrDefault().PrinterName;

                                    PrescriptionOrderHd oHeaderRacikan = BusinessLayer.GetPrescriptionOrderHd(oHeader.PrescriptionOrderID);

                                    PrintCompoundDetailLabel(oHeaderRacikan, printFormatRacikan, lstCompoundDetail, printerUrlRacikan1, printerUrlRacikan2);
                                    lstCompoundDetail.Clear();
                                    #endregion
                                }
                                #endregion
                            }
                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

        }
        #endregion

        #region PrintDrugLabel1Bixolon
        //Default
        public static void PrintDrugLabel1Bixolon(PrescriptionOrderHd oHeader, string printFormat, String lstRecordID, string printerUrl1 = "", string printerUrl2 = "", Boolean isPrintByType = false, string printFormat2 = "", string isUsedDispenseQty = "", bool isPrintCompoundDetailLabel = false, int labelCount = 0, string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            #region Baru
            ////dibuat oleh Agustin 2020/04/07
            if (!string.IsNullOrEmpty(printerName1))
            {
                //vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).FirstOrDefault();
                vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", oHeader.VisitID.ToString(), oHeader.PrescriptionOrderID)).LastOrDefault();

                if (entity != null)
                {
                    string command = string.Empty;
                    if (isPrintByType)
                    {
                        if (oHeader.GCPrescriptionType != Constant.PrescriptionType.MEDICATION_ORDER)
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat2);
                        else
                            command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }
                    else
                    {
                        command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    }

                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = entity.RegistrationNo;
                        string physicianName = BusinessLayer.GetParamedicMaster(oHeader.ParamedicID).FullName;
                        string patientLocation = string.Format("{0} {1}", entity.ServiceUnitName, entity.BedCode);

                        string patientName = "";
                        string medicalNo = "";
                        string dateOfBirth = "";
                        string patientAge = "";
                        string sex = "";
                        string cfPatientNameInLabel = "";
                        string prescriptionDate = "";
                        string prescriptionTime = "";
                        string compoundRSSES = "";
                        if (patientLocation.Length > 30)
                        {
                            patientLocation = patientLocation.Substring(0, 30);
                        }

                        patientName = entity.PatientName; ;
                        medicalNo = entity.MedicalNo;
                        dateOfBirth = entity.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        patientAge = string.Format("{0}thn {1}bln {2}hr", entity.AgeInYear, entity.AgeInMonth, entity.AgeInDay);
                        sex = entity.GCSex == "0003^M" ? "L" : "P";

                        cfPatientNameInLabel = entity.PatientName; ;
                        string[] names = cfPatientNameInLabel.Split(' ');

                        if (names.Length >= 3)
                        {
                            cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                        }

                        if (cfPatientNameInLabel.Length > 25)
                        {
                            cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                        }

                        string prescriptionNo = entity.PrescriptionOrderNo;
                        prescriptionDate = entity.PrescriptionDate.ToString(Constant.FormatString.DATE_FORMAT);
                        prescriptionTime = entity.PrescriptionTime;
                        string cfDispensaryInitial = "";
                        if (entity.TransactionNo != null)
                        {
                            prescriptionNo = entity.TransactionNo;
                            prescriptionDate = entity.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            prescriptionTime = entity.TransactionTime;
                            cfDispensaryInitial = string.Format("({0})", entity.ServiceUnitCode);
                        }
                        #endregion

                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}', '{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);
                        string PharmacyPhoneNo = "";
                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        //string filterExpression = string.Format("PrescriptionOrderID = {0}", entity.PrescriptionOrderID.ToString());
                        //string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0", entity.PrescriptionOrderID.ToString());
                        string filterExpression = string.Format("PrescriptionOrderID = {0} AND IsUsingUDD = 0 AND ParentID IS NULL", entity.PrescriptionOrderID.ToString());
                        if (lstRecordID != string.Empty)
                        {
                            filterExpression += string.Format(" AND ID IN ({0}) ORDER BY ID", lstRecordID);
                        }

                        List<vPrintPrescriptionEtiket> lstDetail = BusinessLayer.GetvPrintPrescriptionEtiketList(filterExpression);
                        List<vPrintPrescriptionEtiket> lstCompoundDetail = new List<vPrintPrescriptionEtiket>();

                        vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                        bool isUsingExpiredDate = !string.IsNullOrEmpty(lstExpiredDate);
                        bool isUsingPrintNo = !string.IsNullOrEmpty(lstExpiredDate);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;

                        foreach (vPrintPrescriptionEtiket item in lstDetail)
                        {
                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";
                                    if (isPrintCompoundDetailLabel == true)
                                    {
                                        lstCompoundDetail.Add(item);
                                    }

                                    //if (!string.IsNullOrEmpty(item.MedicationLine))
                                    //{
                                    //    if (item.ParentID == 0)
                                    //    {
                                    //        compoundRSSES = item.MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //    else
                                    //    {
                                    //        compoundRSSES = lstDetail.Where(r => r.ParentID == 0 && r.PrescriptionOrderDetailID == item.ParentID).FirstOrDefault().MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //}
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }

                                }

                                string expiredDate = "";
                                if (item.ExpiredDate != null)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                    {
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                    }
                                    else
                                    {
                                        if (isUsingExpiredDate)
                                        {
                                            expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                        }
                                    }
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);


                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", entityHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", entity.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", entity.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationno);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", entity.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                if (item.IsInjection)
                                {
                                    if (!String.IsNullOrEmpty(defaultSigna))
                                    {
                                        Signa signa = BusinessLayer.GetSigna(Convert.ToInt16(defaultSigna));
                                        if (signa != null)
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", signa.SignaName1);
                                        }
                                        else
                                        {
                                            labelInfo.Add("AdditionalConsumeMethod", "");
                                        }
                                    }
                                }
                                else
                                {
                                    labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                }


                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty1 = "";
                                if (isUsedDispenseQty == "True")
                                {
                                    isUsedQty1 = item.cfTakenQtyWithForm;
                                }
                                else
                                {
                                    isUsedQty1 = item.cfDispenseQtyWithForm;
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                labelInfo.Add("cfCompound1", "");
                                labelInfo.Add("cfCompound2", "");
                                labelInfo.Add("cfCompound3", "");
                                labelInfo.Add("cfCompound4", "");
                                labelInfo.Add("cfCompound5", "");
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfTakenQtyWithDrugForm", item.cfTakenQtyWithDrugForm);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfTakenQty);
                                labelInfo.Add("cfIsUsedDispenseQty", "");
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithItemUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", item.cfDailyInformation);
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", item.cfMedicalAdministrationNonDaily);
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", item.cfIsLASA);
                                labelInfo.Add("cfIsHAM", item.cfIsHAM);
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", entity.cfPrescriptionDateInString1);
                                labelInfo.Add("cfDateOfBirthInString1", entity.cfDateOfBirthInString1);
                                labelInfo.Add("cfTakenQtyWithUnit", entity.cfTakenQtyWithUnit);
                                labelInfo.Add("RoomName", entity.RoomName);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);

                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = labelCount;
                                if (isUsingPrintNo)
                                {
                                    noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                }
                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        RawPrinterHelper print = new RawPrinterHelper();
                                        string printerName = printerName1;
                                        if (item.IsExternalMedication)
                                            printerName = printerName2;
                                        print.OpenPrint(printerName);
                                        print.SendStringToPrinter(labelCommand);
                                        print.ClosePrint();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }
                                #endregion

                                #region Compound Detail Printing
                                if (lstCompoundDetail.Count > 0)
                                {
                                    #region detail racikan
                                    //ditutup oleh Agustin 2019/08/09 : ubah konsep untuk cetakn detail Obat Racikan RSDO
                                    string filterExp = string.Format("HealthcareID = '{0}' AND ParameterCode IN ('{1}','{2}')",
                                    AppSession.UserLogin.HealthcareID, Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN, Constant.SettingParameter.FM_PRINT_ETIKET_DETAIL_OBAT_RACIKAN);
                                    List<vSettingParameterDt> lstParam = BusinessLayer.GetvSettingParameterDtList(filterExp);
                                    string printFormatRacikan = lstParam.Where(lst => lst.ParameterCode.Equals(Constant.SettingParameter.FM_FORMAT_CETAKAN_ETIKET_DETAIL_OBAT_RACIKAN)).FirstOrDefault().ParameterValue;

                                    string labelFormat = string.Empty; //Read from Setting Parameter
                                    string ipAddress = HttpContext.Current.Request.UserHostAddress;

                                    filterExp = string.Format("IPAddress = '{0}' AND GCPrinterType IN ('{1}','{2}') AND IsDeleted=0",
                                        ipAddress, Constant.DirectPrintType.ETIKET_OBAT_DALAM, Constant.DirectPrintType.ETIKET_OBAT_LUAR);

                                    List<PrinterLocation> lstPrinter = BusinessLayer.GetPrinterLocationList(filterExp);
                                    string printerUrlRacikan1 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_DALAM).FirstOrDefault().PrinterName;
                                    string printerUrlRacikan2 = lstPrinter.Where(lst => lst.GCPrinterType == Constant.DirectPrintType.ETIKET_OBAT_LUAR).FirstOrDefault().PrinterName;

                                    PrescriptionOrderHd oHeaderRacikan = BusinessLayer.GetPrescriptionOrderHd(oHeader.PrescriptionOrderID);

                                    PrintCompoundDetailLabel(oHeaderRacikan, printFormatRacikan, lstCompoundDetail, printerUrlRacikan1, printerUrlRacikan2);
                                    lstCompoundDetail.Clear();
                                    #endregion
                                }
                                #endregion
                            }
                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
            #endregion

        }
        #endregion

        #region PrintUDDDrugLabelBixolon
        public static void PrintUDDDrugLabelBixolon(int visitID, string transactionNo, string transactionDate, string printFormat, String lstScheduleID = "", string printerUrl1 = "", string printerUrl2 = "", string lstExpiredDate = "", string lstPrintNo = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            if (!string.IsNullOrEmpty(printerName1))
            {
                vConsultVisit1 oVisit = BusinessLayer.GetvConsultVisit1List(String.Format("VisitID = {0}", visitID.ToString())).FirstOrDefault();
                vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                if (oVisit != null)
                {
                    Registration oRegistration = BusinessLayer.GetRegistration(oVisit.RegistrationID);
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.UDD, printFormat);
                    List<string> lstField = GetMetadata(PrintingGroup.UDD);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Header Information
                        string registrationno = oRegistration.RegistrationNo;
                        Patient oPatient = BusinessLayer.GetPatient((int)oRegistration.MRN);
                        string patientName = oPatient.FullName;
                        string medicalNo = oPatient.MedicalNo;
                        string dateOfBirth = oPatient.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        string patientAge = string.Format("{0}thn {1}bln {2}hr", oRegistration.AgeInYear, oRegistration.AgeInMonth, oRegistration.AgeInDay);
                        string sex = oPatient.GCSex == "0003^M" ? "L" : "P";
                        string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

                        //ditutup oleh agustin 20210120, dipindah ke bawah
                        //string prescriptionDate = !string.IsNullOrEmpty(transactionDate) ? transactionDate : DateTime.Now.Date.ToString(Constant.FormatString.DATE_FORMAT);

                        #endregion
                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;

                        string paramCodeList = string.Format("('{0}','{1}','{2}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Detail Item Information
                        string filterExpression = string.Format("VisitID = {0} AND ID IN ({1})", visitID, lstScheduleID);
                        bool isUsingExpiredDate = lstExpiredDate != "";
                        bool isUsingPrintNo = lstPrintNo != "";
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');

                        int index = 0;
                        List<vMedicationSchedule> lstDetail = BusinessLayer.GetvMedicationScheduleList(filterExpression);
                        Healthcare oHealthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
                        string ConsumeMethodEng = "";
                        SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                        foreach (vMedicationSchedule item in lstDetail)
                        {
                            String filterPrescriptionEtiket = "";
                            if (item.PastMedicationID == 0)
                            {
                                filterPrescriptionEtiket = String.Format("VisitID = {0} AND PrescriptionOrderID = {1}", visitID.ToString(), item.PrescriptionOrderId);
                            }
                            else
                            {
                                filterPrescriptionEtiket = String.Format("VisitID = {0}", visitID.ToString());
                            }

                            string prescriptionDate = item.MedicationDate.ToString(Constant.FormatString.DATE_FORMAT);
                            string prescriptionTime = item.MedicationTime;

                            vPrintPrescriptionEtiket entity = BusinessLayer.GetvPrintPrescriptionEtiketList(filterPrescriptionEtiket).LastOrDefault();

                            string cfPatientNameInLabel = "";
                            string cfTransactionNo = "";
                            string cfServiceUnitCode = "";
                            string storageRemarks = "";

                            if (entity != null)
                            {
                                cfPatientNameInLabel = entity.PatientName;
                                cfTransactionNo = entity.TransactionNo;
                                cfServiceUnitCode = entity.ServiceUnitCode;
                            }
                            else
                            {
                                cfPatientNameInLabel = oVisit.PatientName;
                            }

                            string[] names = cfPatientNameInLabel.Split(' ');

                            if (names.Length >= 3)
                            {
                                cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                            }

                            if (cfPatientNameInLabel.Length > 25)
                            {
                                cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                            }

                            if (storageRemarks.Length > 55)
                            {
                                storageRemarks = storageRemarks.Substring(0, 55);
                            }

                            string physicianName = item.PhysicianName;

                            #region Store Drug Information to Dictionary
                            string homeMedication = item.IsInternalMedication ? "" : "*";
                            string drugName = string.Format("{0}{1}", homeMedication, item.DrugName);
                            string expiredDate = string.Format("ED: {0}", (isUsingExpiredDate ? expiredDateInfo[index] : string.Empty));
                            string beyondUseDate = string.Format("BUD: {0}", (isUsingExpiredDate ? expiredDateInfo[index] : string.Empty));
                            string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                            string prescriptionNo = cfTransactionNo;

                            if (prescriptionNo == null)
                            {
                                prescriptionNo = transactionNo;
                            }

                            var labelInfo = new Dictionary<string, string>();
                            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                            labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                            labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                            labelInfo.Add("ShortName", oHealthcare.ShortName);
                            labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
                            labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
                            labelInfo.Add("Pharmacist", pharmacistName);
                            labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                            labelInfo.Add("PrescriptionNo", prescriptionNo);
                            labelInfo.Add("PrescriptionDate", prescriptionDate);
                            labelInfo.Add("PrescriptionTime", prescriptionTime);
                            labelInfo.Add("PhysicianName", physicianName);
                            labelInfo.Add("RegistrationNo", registrationno);
                            labelInfo.Add("Salutation", oVisit.Salutation);
                            labelInfo.Add("MedicalNo", medicalNo);
                            labelInfo.Add("PatientFullName", patientName);
                            labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                            labelInfo.Add("Sex", sex);
                            labelInfo.Add("PatientAge", patientAge);
                            labelInfo.Add("DateOfBirth", dateOfBirth);
                            labelInfo.Add("ItemName", drugName);
                            labelInfo.Add("cfGenericName", item.cfGenericName);
                            labelInfo.Add("DoseUnit", doseUnit);

                            if (!String.IsNullOrEmpty(item.SignaName1))
                            {
                                labelInfo.Add("ConsumeMethod", item.SignaName1);
                            }
                            else
                            {
                                if (!item.IsAsRequired)
                                {
                                    string consumeMethod = "";
                                    switch (item.GCDosingFrequency)
                                    {
                                        case Constant.DosingFrequency.DAY:
                                            consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.WEEK:
                                            consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        case Constant.DosingFrequency.HOUR:
                                            consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                            break;
                                        default:
                                            break;
                                    }
                                    labelInfo.Add("ConsumeMethod", consumeMethod);
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                }
                            }
                            #region ConsumeMethodEng
                            if (paramdt.ParameterValue == "1")
                            {
                                if (item.IsAsRequired)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0} (If needed)", consumeMethod);
                                        labelInfo.Add("ConsumeMethodEng", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                    }
                                }
                            }
                            else
                            {
                                if (item.IsAsRequired)
                                {
                                    labelInfo.Add("ConsumeMethodEng", "If needed");
                                }
                                else
                                {
                                    labelInfo.Add("ConsumeMethodEng", "");
                                }
                            }
                            #endregion

                            labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                            labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                            labelInfo.Add("Route", item.Route);
                            labelInfo.Add("MedicationRoute", item.MedicationRoute);
                            labelInfo.Add("ExpiredDate", expiredDate);
                            labelInfo.Add("BeyondUseDate", beyondUseDate);
                            labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                            labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            if (item.IsInjection)
                            {
                                labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                            }
                            else if (item.IsExternalMedication)
                            {
                                labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                            }
                            else
                            {
                                labelInfo.Add("cfMedication", string.Empty);
                            }
                            labelInfo.Add("SequenceNo", item.SequenceNo);
                            labelInfo.Add("MedicationTime", item.MedicationTime);
                            labelInfo.Add("ChargeQuantity", Convert.ToString(item.ChargeQuantity));
                            labelInfo.Add("PatientLocation", patientLocation);
                            labelInfo.Add("cfDispensaryInitial", cfServiceUnitCode);
                            labelInfo.Add("cfDispenseQty", item.NumberOfDosage.ToString());
                            labelInfo.Add("cfTakenQty", item.NumberOfDosage.ToString());
                            labelInfo.Add("cfIsUsedDispenseQty", "");
                            labelInfo.Add("cfTakenQtyWithItemUnit", item.cfDosingQuantity);
                            labelInfo.Add("cfConsumeMethodRoute", "");
                            labelInfo.Add("cfCoenamRuleLabel", "");
                            labelInfo.Add("cfDailyInformation", "");
                            labelInfo.Add("MedicationLine", "");
                            labelInfo.Add("cfMedicalAdministrationNonDaily", "");
                            labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                            labelInfo.Add("StorageRemarks", storageRemarks);
                            labelInfo.Add("cfIsLASA", "");
                            labelInfo.Add("cfIsHAM", item.cfIsHAM);
                            labelInfo.Add("cfIsPRNIMM", "");
                            if (entity != null)
                            {
                                labelInfo.Add("cfDateOfBirthInString", entity.cfDateOfBirthInString);
                            }
                            labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                            labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                            #endregion

                            #region Replace Prescription Drug Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            int noOfPrint = 1;
                            if (isUsingPrintNo)
                                noOfPrint = Convert.ToInt16(printNoInfo[index]);
                            for (int i = 1; i <= noOfPrint; i++)
                            {
                                if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                {
                                    RawPrinterHelper print = new RawPrinterHelper();
                                    string printerName = printerName1;
                                    if (item.IsExternalMedication)
                                        printerName = printerName2;
                                    print.OpenPrint(printerName);
                                    print.SendStringToPrinter(labelCommand);
                                    print.ClosePrint();
                                }
                                else
                                {
                                    if (item.IsExternalMedication)
                                    {
                                        Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                    }
                                    else
                                    {
                                        Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                    }
                                }
                            }
                            #endregion

                            index += 1;
                        }
                        #endregion
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #region PrintDrugLabelFromChargesBixolon
        public static void PrintDrugLabelFromChargesBixolon(PatientChargesHd chargesHd, string printFormat, String lstRecordID, string printerUrl1 = "", string printerUrl2 = "", string lstExpiredDate = "", string lstPrintNo = "", string isUsedDispenseQty = "", bool isUsePrintingTools1 = false, bool isUsePrintingTools2 = false)
        {
            string printerName1 = printerUrl1;
            string printerName2 = printerUrl2;

            if (!string.IsNullOrEmpty(printerName1))
            {
                vConsultVisit9 oVisit = BusinessLayer.GetvConsultVisit9List(String.Format("VisitID = {0}", chargesHd.VisitID.ToString())).FirstOrDefault();
                vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = {0}", AppSession.UserLogin.HealthcareID))[0];
                if (oVisit != null)
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.DrugLabel, printFormat);
                    List<string> lstField = GetMetadata(PrintingGroup.DrugLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        #region Get Pharmacist Information
                        string pharmacistName = string.Empty;
                        string pharmacyLicenseNo = string.Empty;
                        string defaultSigna = string.Empty;
                        string compoundRSSES = "";
                        string PharmacyPhoneNo = "";
                        string ConsumeMethodEng = "";

                        string paramCodeList = string.Format("('{0}','{1}','{2}', '{3}')", Constant.SettingParameter.PHARMACIST,
                            Constant.SettingParameter.PHARMACIST_LICENSE_NO, Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI, Constant.SettingParameter.PH_PHONE_EXTENSION);
                        string paramFilterExp = string.Format("ParameterCode IN {0}", paramCodeList);

                        List<SettingParameterDt> param = BusinessLayer.GetSettingParameterDtList(paramFilterExp);
                        if (param != null)
                        {
                            pharmacistName = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST).FirstOrDefault().ParameterValue.ToString();
                            pharmacyLicenseNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PHARMACIST_LICENSE_NO).FirstOrDefault().ParameterValue.ToString();
                            defaultSigna = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.FM_DEFAULT_ATURAN_PAKAI).FirstOrDefault().ParameterValue.ToString();

                            PharmacyPhoneNo = param.Where(lst => lst.ParameterCode == Constant.SettingParameter.PH_PHONE_EXTENSION).FirstOrDefault().ParameterValue.ToString();
                        }
                        #endregion

                        #region Get Header Information
                        Healthcare oHealthcare = BusinessLayer.GetHealthcare(AppSession.UserLogin.HealthcareID);
                        string patientName = oVisit.PatientName;
                        string medicalNo = oVisit.MedicalNo;
                        string dateOfBirth = oVisit.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT);
                        string patientAge = string.Format("{0}", oVisit.PatientAge);
                        string sex = oVisit.GCGender == "0003^M" ? "L" : "P";
                        string patientLocation = string.Format("{0} {1}", oVisit.ServiceUnitName, oVisit.BedCode);

                        string prescriptionNo = string.Empty;
                        string prescriptionDate = string.Empty;
                        string prescriptionTime = string.Empty;
                        string registrationNo = oVisit.RegistrationNo;
                        string cfDispensaryInitial = "";

                        string cfPatientNameInLabel = oVisit.cfPatientNameInLabel;

                        #endregion

                        string filterExpression = string.Format("ID IN ({0}) ORDER BY ID", lstRecordID);
                        List<vChargesForDrugLabel> lstItem = BusinessLayer.GetvChargesForDrugLabelList(filterExpression);
                        string[] expiredDateInfo = lstExpiredDate.Split(',');
                        string[] printNoInfo = lstPrintNo.Split(',');
                        int index = 0;
                        foreach (vChargesForDrugLabel item in lstItem)
                        {
                            string physicianName = item.ParamedicName;
                            prescriptionNo = item.TransactionNo;
                            prescriptionDate = item.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT);
                            cfDispensaryInitial = item.ChargesServiceUnitCode;

                            if (item.IsRFlag)
                            {
                                #region Store Drug Information to Dictionary
                                string drugName = item.DrugName;
                                if (item.IsCompound)
                                {
                                    drugName = !string.IsNullOrEmpty(item.CompoundDrugname) ? item.CompoundDrugname : "OBAT RACIKAN";

                                    //if (!string.IsNullOrEmpty(item.MedicationLine))
                                    //{

                                    //    if (item.ParentID == 0)
                                    //    {
                                    //        compoundRSSES = item.MedicationLine.Replace(@"+", ",");

                                    //    }
                                    //    else
                                    //    {
                                    //        compoundRSSES = lstItem.Where(r => r.ParentID == 0 && r.PrescriptionOrderDetailID == item.ParentID).FirstOrDefault().MedicationLine.Replace(@"+", ",");

                                    //    }

                                    //}
                                    if (!String.IsNullOrEmpty(item.MedicationLine))
                                    {
                                        StringBuilder contents = new StringBuilder();
                                        string[] contentList = item.MedicationLine.Split('+');
                                        foreach (string rowItem in contentList)
                                        {
                                            contents.AppendLine(string.Format("{0},", rowItem.Trim()));
                                        }
                                        compoundRSSES = contents.ToString().Remove(contents.ToString().Length - 1);
                                    }
                                    else
                                    {
                                        compoundRSSES = string.Empty;
                                    }
                                }

                                string expiredDate = "";
                                if (((DateTime)item.ExpiredDate).Year != 1900)
                                {
                                    DateTime expDate = (DateTime)item.ExpiredDate;
                                    if (expDate.Date > DateTime.Now.Date)
                                        expiredDate = string.Format("{0}", ((DateTime)item.ExpiredDate).ToString(Constant.FormatString.DATE_FORMAT));
                                }
                                else
                                {
                                    expiredDate = string.Format("{0}", expiredDateInfo[index]);
                                }

                                string doseUnit = string.Format("{0} {1}", item.NumberOfDosage.ToString("G29"), item.DosingUnit);

                                var labelInfo = new Dictionary<string, string>();
                                labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                                labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                                labelInfo.Add("PharmacyPhoneNo", PharmacyPhoneNo);
                                labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                                labelInfo.Add("ShortName", oHealthcare.ShortName);
                                labelInfo.Add("ServiceUnitName", oVisit.ServiceUnitName);
                                labelInfo.Add("cfServiceUnitName", oVisit.cfServiceUnitName);
                                labelInfo.Add("Pharmacist", pharmacistName);
                                labelInfo.Add("PharmacistLicenseNo", pharmacyLicenseNo);
                                labelInfo.Add("PrescriptionNo", prescriptionNo);
                                labelInfo.Add("PrescriptionDate", prescriptionDate);
                                labelInfo.Add("PrescriptionTime", prescriptionTime);
                                labelInfo.Add("PhysicianName", physicianName);
                                labelInfo.Add("RegistrationNo", registrationNo);
                                labelInfo.Add("MedicalNo", medicalNo);
                                labelInfo.Add("Salutation", oVisit.Salutation);
                                labelInfo.Add("PatientFullName", patientName);
                                labelInfo.Add("cfPatientNameInLabel", cfPatientNameInLabel);
                                labelInfo.Add("Sex", sex);
                                labelInfo.Add("PatientAge", patientAge);
                                labelInfo.Add("DateOfBirth", dateOfBirth);
                                labelInfo.Add("ItemName", drugName);
                                labelInfo.Add("cfGenericName", item.cfGenericName);
                                labelInfo.Add("DoseUnit", doseUnit);

                                #region ConsumeMethod1
                                if (!String.IsNullOrEmpty(item.SignaName1))
                                {
                                    labelInfo.Add("ConsumeMethod1", item.SignaName1);
                                }
                                else
                                {
                                    if (!item.IsAsRequired)
                                    {
                                        string consumeMethod1 = "";
                                        switch (item.GCDosingFrequency)
                                        {
                                            case Constant.DosingFrequency.DAY:
                                                consumeMethod1 = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.WEEK:
                                                consumeMethod1 = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            case Constant.DosingFrequency.HOUR:
                                                consumeMethod1 = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                break;
                                            default:
                                                break;
                                        }
                                        labelInfo.Add("ConsumeMethod1", consumeMethod1);
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod1", "Jika diperlukan");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod2
                                SettingParameterDt paramdt = BusinessLayer.GetSettingParameterDtList(string.Format("parameterCode = '{0}'", Constant.SettingParameter.FM_IS_AS_REQUIRED)).FirstOrDefault();
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (Jika Diperlukan)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (Jika Diperlukan)", consumeMethod);
                                            labelInfo.Add("ConsumeMethod", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod", "Jika diperlukan");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod3
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0}", item.SignaName1);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0}", consumeMethod);
                                            labelInfo.Add("ConsumeMethod2", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethod2", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} x sehari {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} x seminggu {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("setiap {0} jam {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethod2", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethod2", "");
                                    }
                                }
                                #endregion

                                #region ConsumeMethod4
                                if (item.IsAsRequired && item.IsIMM)
                                {
                                    string route = string.Format("({0})", item.Route);
                                    labelInfo.Add("ConsumeMethod3", route);
                                }
                                else if (item.IsAsRequired && !item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else if (!item.IsAsRequired && item.IsIMM)
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                else
                                {
                                    if (!String.IsNullOrEmpty(item.SignaName1))
                                    {
                                        string signa = string.Format("{0} ({1})", item.SignaName1, item.Route);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                    else
                                    {
                                        string consumeMethod = "";
                                        if (item.Frequency > 0)
                                        {
                                            switch (item.GCDosingFrequency)
                                            {
                                                case Constant.DosingFrequency.DAY:
                                                    consumeMethod = string.Format("{0} x sehari {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.WEEK:
                                                    consumeMethod = string.Format("{0} x seminggu {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                case Constant.DosingFrequency.HOUR:
                                                    consumeMethod = string.Format("setiap {0} jam {1} {2} ({3})", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit, item.Route);
                                                    break;
                                                default:
                                                    break;
                                            }
                                        }
                                        string signa = string.Format("{0}", consumeMethod);
                                        labelInfo.Add("ConsumeMethod3", signa);
                                    }
                                }
                                #endregion

                                #region ConsumeMethodEng
                                if (paramdt.ParameterValue == "1")
                                {
                                    if (item.IsAsRequired)
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            string signa = string.Format("{0} (If Needed)", item.SignaName1);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            string signa = string.Format("{0} (If needed)", consumeMethod);
                                            labelInfo.Add("ConsumeMethodEng", signa);
                                        }
                                    }
                                    else
                                    {
                                        if (!String.IsNullOrEmpty(item.SignaName1))
                                        {
                                            labelInfo.Add("ConsumeMethodEng", item.SignaName1);
                                        }
                                        else
                                        {
                                            string consumeMethod = "";
                                            if (item.Frequency > 0)
                                            {
                                                switch (item.GCDosingFrequency)
                                                {
                                                    case Constant.DosingFrequency.DAY:
                                                        consumeMethod = string.Format("{0} time(s) a day {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.WEEK:
                                                        consumeMethod = string.Format("{0} time(s) a week {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    case Constant.DosingFrequency.HOUR:
                                                        consumeMethod = string.Format("every {0} hour(s) {1} {2}", item.Frequency.ToString("G29"), item.NumberOfDosage.ToString("G29"), item.DosingUnit);
                                                        break;
                                                    default:
                                                        break;
                                                }
                                            }
                                            labelInfo.Add("ConsumeMethodEng", consumeMethod);
                                        }
                                    }
                                }
                                else
                                {
                                    if (item.IsAsRequired)
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "If needed");
                                    }
                                    else
                                    {
                                        labelInfo.Add("ConsumeMethodEng", "");
                                    }
                                }
                                #endregion

                                labelInfo.Add("AdditionalConsumeMethod", string.Empty);
                                labelInfo.Add("CoenamRuleLabel", item.CoenamRuleLabel);
                                labelInfo.Add("Route", item.Route);
                                labelInfo.Add("MedicationRoute", item.MedicationRoute);
                                labelInfo.Add("ExpiredDate", expiredDate);
                                labelInfo.Add("MedicationAdministration", item.MedicationAdministration);
                                labelInfo.Add("ExternalMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                labelInfo.Add("InjectionMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                if (item.IsInjection)
                                {
                                    labelInfo.Add("cfMedication", item.IsInjection ? "OBAT INJEKSI" : string.Empty);
                                }
                                else if (item.IsExternalMedication)
                                {
                                    labelInfo.Add("cfMedication", item.IsExternalMedication ? "OBAT LUAR" : string.Empty);
                                }
                                else
                                {
                                    labelInfo.Add("cfMedication", string.Empty);
                                }
                                labelInfo.Add("PatientLocation", patientLocation);
                                labelInfo.Add("cfDispensaryInitial", cfDispensaryInitial);
                                string isUsedQty1 = "";
                                if (item.IsCompound == true)
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithUnit;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQty;
                                    }
                                }
                                else
                                {
                                    if (isUsedDispenseQty == "True")
                                    {
                                        isUsedQty1 = item.cfTakenQtyWithForm;
                                    }
                                    else
                                    {
                                        isUsedQty1 = item.cfDispenseQtyWithForm;
                                    }
                                }
                                string isUsedUDD = "";
                                if (item.IsUsingUDD == true)
                                {
                                    isUsedUDD = doseUnit;
                                }
                                else
                                {
                                    isUsedUDD = isUsedQty1;
                                }
                                string tempCompound1 = "", tempCompound2 = "", tempCompound3 = "", tempCompound4 = "", tempCompound5 = "";
                                labelInfo.Add("cfCompound1", tempCompound1);
                                labelInfo.Add("cfCompound2", tempCompound2);
                                labelInfo.Add("cfCompound3", tempCompound3);
                                labelInfo.Add("cfCompound4", tempCompound4);
                                labelInfo.Add("cfCompound5", tempCompound5);
                                labelInfo.Add("cfCompoundRSSES", compoundRSSES);
                                labelInfo.Add("cfDispenseQty", item.cfDispenseQty);
                                labelInfo.Add("cfTakenQty", item.cfChargeQty);
                                labelInfo.Add("cfIsUsedDispenseQty", item.cfChargeQty);
                                labelInfo.Add("cfIsUsedDispenseQty1", isUsedQty1);
                                labelInfo.Add("cfTakenQtyWithItemUnit", item.cfTakenQtyWithUnit);
                                labelInfo.Add("cfConsumeMethodRoute", item.cfConsumeMethodRoute);
                                labelInfo.Add("cfCoenamRuleLabel", item.cfCoenamRuleLabel);
                                labelInfo.Add("cfDailyInformation", "");
                                labelInfo.Add("MedicationLine", item.MedicationLine);
                                labelInfo.Add("cfMedicalAdministrationNonDaily", "");
                                labelInfo.Add("cfIsExternalMedication", item.cfIsExternalMedication);
                                labelInfo.Add("cfStorageRemarks", item.cfStorageRemarks);
                                labelInfo.Add("cfIsLASA", "");
                                labelInfo.Add("cfIsHAM", "");
                                labelInfo.Add("cfIsPRNIMM", item.cfIsPRNIMM);
                                labelInfo.Add("cfCustomMedicationPurpose", item.cfCustomMedicationPurpose);
                                labelInfo.Add("MedicationPurpose", item.MedicationPurpose);
                                labelInfo.Add("cfDateOfBirthInString", oVisit.DateOfBirthInString);
                                labelInfo.Add("cfPrescriptionDateInString1", item.TransactionDate.ToString(Constant.FormatString.DATE_FORMAT_1));
                                labelInfo.Add("cfDateOfBirthInString1", item.DateOfBirth.ToString(Constant.FormatString.DATE_FORMAT_1));
                                labelInfo.Add("RoomName", item.RoomName);
                                labelInfo.Add("cfTakenQtyWithUnit", item.cfTakenQtyWithUnit);
                                labelInfo.Add("cfIsUsedUDDQty", isUsedUDD);
                                #endregion

                                #region Replace Prescription Drug Information
                                string labelCommand = command;
                                foreach (string fieldName in lstField)
                                {
                                    labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                                }
                                #endregion

                                #region Send Command to Printer
                                int noOfPrint = Convert.ToInt16(printNoInfo[index]);
                                for (int i = 1; i <= noOfPrint; i++)
                                {
                                    if (!isUsePrintingTools1 || !isUsePrintingTools2)
                                    {
                                        RawPrinterHelper print = new RawPrinterHelper();
                                        string printerName = printerName1;
                                        if (item.IsExternalMedication)
                                            printerName = printerName2;
                                        print.OpenPrint(printerName);
                                        print.SendStringToPrinter(labelCommand);
                                        print.ClosePrint();
                                    }
                                    else
                                    {
                                        if (item.IsExternalMedication)
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName2, labelCommand);
                                        }
                                        else
                                        {
                                            Helper.MedinfrasDirectPrintingTools(printerName1, labelCommand);
                                        }
                                    }
                                }
                                #endregion
                            }

                            index += 1;
                        }
                    }
                    else
                    {
                        throw new Exception("Please setup the printer address in System Parameter!");
                    }
                }
                else
                {
                    throw new Exception("Cannot find Patient Visit Information!");
                }
            }
            else
            {
                throw new Exception("Please setup the printer address in System Parameter!");
            }
        }
        #endregion

        #region PrintNutritionLabelBixolon
        public static void PrintNutritionLabelBixolon(string printFormat, String lstNutritionOrderDtID = "", string printerUrl1 = "", int labelCount = 0, string lstExpiredDate = "")
        {
            string printerName1 = printerUrl1;
            vHealthcare entityHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID))[0];

            List<vNutritionOrderDtCustom> lstEntity = BusinessLayer.GetvNutritionOrderDtCustomList(String.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID));

            if (lstEntity.Count > 0)
            {
                if (!string.IsNullOrEmpty(printerName1))
                {
                    string command = string.Empty;
                    command = GetPrintFormat(PrintingGroup.NutritionLabel, printFormat);

                    List<string> lstField = GetMetadata(PrintingGroup.NutritionLabel);
                    if (!string.IsNullOrEmpty(command))
                    {
                        string filterExpression = string.Format("NutritionOrderDtID IN ({0}) AND StapleFood IS NOT NULL ORDER BY BedCode", lstNutritionOrderDtID.ToString());
                        List<vNutritionOrderDtCustom> lstDetail = BusinessLayer.GetvNutritionOrderDtCustomList(filterExpression);
                        foreach (vNutritionOrderDtCustom item in lstDetail)
                        {
                            #region Get Header Information
                            string registrationno = item.RegistrationNo;
                            string patientLocation = string.Format("{0} {1}", item.ServiceUnitName, item.BedCode);

                            string patientName = "";
                            string medicalNo = "";
                            string dateOfBirth = "";
                            string sex = "";
                            string cfPatientNameInLabel = "";
                            string scheduleDate = "";
                            string patientName1 = "";
                            string stapleFood = "";
                            string numberOfCalories = "";
                            string allergy = "";

                            if (patientLocation.Length > 30)
                            {
                                patientLocation = patientLocation.Substring(0, 30);
                            }

                            List<PatientAllergy> entityAllergyLst = new List<PatientAllergy>();
                            Healthcare entityHSU = BusinessLayer.GetHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                            if (entityHSU.Initial == "PHS")
                            {
                                entityAllergyLst = BusinessLayer.GetPatientAllergyList(string.Format("MRN = {0} AND IsDeleted = 0 AND GCAllergenType IN ('{1}','{2}')", item.MRN, Constant.AllergenType.DRUG, Constant.AllergenType.FOOD));
                            }
                            else
                            {
                                entityAllergyLst = BusinessLayer.GetPatientAllergyList(string.Format("MRN = {0} AND IsDeleted = 0 AND GCAllergenType = '{1}'", item.MRN, Constant.AllergenType.DRUG));
                            }

                            if (entityAllergyLst.Count() > 0)
                            {
                                allergy = entityAllergyLst.FirstOrDefault().Allergen;
                            }
                            else
                            {
                                allergy = "Tidak Ada";
                            }


                            patientName = item.PatientName;
                            medicalNo = item.MedicalNo;
                            dateOfBirth = item.DateOfBirthInString;
                            scheduleDate = item.ScheduleDate.ToString(Constant.FormatString.DATE_FORMAT);
                            sex = item.GCGender == "0003^M" ? "L" : "P";
                            numberOfCalories = item.NumberOfCalories.ToString("N2");

                            int count = item.PatientName.Count();
                            if (count > 26)
                            {
                                patientName1 = item.PatientName.Substring(0, 26);
                            }
                            else
                            {
                                patientName1 = item.PatientName;
                            }

                            cfPatientNameInLabel = item.PatientName; ;
                            string[] names = cfPatientNameInLabel.Split(' ');

                            if (names.Length >= 3)
                            {
                                cfPatientNameInLabel = string.Format("{0} {1} {2}", names[0], names[1], names[2]);
                            }

                            if (cfPatientNameInLabel.Length > 25)
                            {
                                cfPatientNameInLabel = cfPatientNameInLabel.Substring(0, 25);
                            }

                            if (item.StapleFood != null)
                            {
                                stapleFood = item.StapleFood;
                            }
                            #endregion

                            var labelInfo = new Dictionary<string, string>();
                            labelInfo.Add("HealthcareName", AppSession.UserLogin.HealthcareName);
                            labelInfo.Add("Phone", entityHealthcare.PhoneNo1);
                            labelInfo.Add("Fax", entityHealthcare.FaxNo1);
                            labelInfo.Add("PatientName", patientName);
                            labelInfo.Add("PatientName1", patientName1);
                            labelInfo.Add("PatientNameInLabel", cfPatientNameInLabel);
                            labelInfo.Add("cfPatientNameSalutation", item.cfPatientNameSalutation);
                            labelInfo.Add("MedicalNo", medicalNo);
                            labelInfo.Add("RegistrationNo", registrationno);
                            labelInfo.Add("DateOfBirthInString", dateOfBirth);
                            labelInfo.Add("Sex", sex);
                            labelInfo.Add("MealPlanName", item.MealPlanName);
                            labelInfo.Add("MealTime", item.MealTime);
                            labelInfo.Add("MultiDiet", item.MultiDiet);
                            labelInfo.Add("ScheduleDate", scheduleDate);
                            labelInfo.Add("ServiceUnitName", item.ServiceUnitName);
                            labelInfo.Add("CustomerType", item.CustomerType);
                            labelInfo.Add("BusinessPartnerName", item.BusinessPartnerName);
                            labelInfo.Add("ClassCode", item.ClassCode);
                            labelInfo.Add("ClassName", item.ClassName);
                            labelInfo.Add("RoomCode", item.RoomCode);
                            labelInfo.Add("RoomName", item.RoomName);
                            labelInfo.Add("BedCode", item.BedCode);
                            labelInfo.Add("cfDietNotes", item.cfDietNotes);
                            labelInfo.Add("cfDietNotes1", item.cfDietNotes1);
                            labelInfo.Add("Remarks", item.Remarks);
                            labelInfo.Add("RemarksHd", item.RemarksHd);
                            labelInfo.Add("StapleFood", stapleFood);
                            labelInfo.Add("NumberOfCalories", numberOfCalories);
                            labelInfo.Add("Allergy", allergy);
                            labelInfo.Add("ScheduleTime", item.ScheduleTime);

                            #region Replace Nutrition Label Information
                            string labelCommand = command;
                            foreach (string fieldName in lstField)
                            {
                                labelCommand = labelCommand.Replace("{" + fieldName + "}", labelInfo[fieldName]);
                            }
                            #endregion

                            #region Send Command to Printer
                            int a = 0;
                            int noOfPrint = 1;
                            int noOfPrintAll = labelCount;

                            if (labelCount > 1)
                            {
                                a = noOfPrintAll;
                            }
                            else
                            {
                                a = noOfPrint;
                            }

                            RawPrinterHelper print = new RawPrinterHelper();
                            string printerName = printerName1;
                            for (int i = 1; i <= a; i++)
                            {
                                print.OpenPrint(printerName);
                                print.SendStringToPrinter(labelCommand);
                                print.ClosePrint();
                            }
                            #endregion
                        }
                    }
                }
                else
                {
                    throw new Exception("Please setup the printer address in System Parameter!");
                }
            }
        }
        #endregion

        #region PrintBuktiPendaftaranBixolon
        public static void PrintBuktiPendaftaranBixolon(vConsultVisit oVisit9, string printerUrl, bool isUsePrintingTools = false)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                sb.AppendLine(string.Format("Kategori Pasien    : {0}", oVisit9.PatientCategory));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("*Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine(string.Format("*Apabila pasien tidak ada saat dipanggil maka nomor antrian akan dilewati 2 (orang) berikutnya"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                if (!isUsePrintingTools)
                {
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                }
                else
                {
                    Helper.MedinfrasDirectPrintingTools(printerUrl, sb.ToString());
                }

                #endregion
            }
        }
        #endregion

        #region PrintBuktiPendaftaranKunjunganBixolon
        public static void PrintBuktiPendaftaranKunjunganBixolon(vConsultVisit9 oVisit9, string printerUrl, bool isUsePrintingTools = false)
        {
            if (!string.IsNullOrEmpty(printerUrl))
            {
                const char NUL = '\x00';    // NUL 
                const char LF = '\x0A';     //LINE FEED
                const char ESC = '\x1B';    // ESCAPE
                const char FS = '\x1c';
                const char GS = '\x1D';     //GROUP SPARATOR
                const string GSs = "\u001D";

                const string DoubleOn = GSs + "!" + "\u0011";  // 2x sized text (double-high + double-wide)
                const string DoubleOff = GSs + "!" + "\0";

                string barcodeWidth = "\x1d\x77\x01";
                string barcodeHeight = "\x1d\x68\x32";
                string barcodeWidth1 = "\x1d\x77\x02";
                string barcodeHeight1 = "\x1d\x68\x50";
                string barcodeValues = "\x1d\x48\x32";

                string fontBold = "\x1b\x45\x01";
                string fontDoubleHeight = "\x1b\x21\x10";
                string fontBoldEnd = "\x1b\x45\x00";
                string fontDoubleHeightEnd = "\x1b\x21\x00";
                StringBuilder sb = new StringBuilder();

                vHealthcare oHealthcare = BusinessLayer.GetvHealthcareList(string.Format("HealthcareID = '{0}'", AppSession.UserLogin.HealthcareID)).FirstOrDefault();
                vRegistration5 reg = BusinessLayer.GetvRegistration5List(string.Format("RegistrationID = {0}", oVisit9.RegistrationID)).FirstOrDefault();

                string serviceUnit = "Unit Pelayanan";
                string gender = oVisit9.GCGender == Constant.Gender.FEMALE ? "(P)" : "(L)";

                #region Print Detail
                sb.Append(ESC + "a1");
                sb.Append(fontDoubleHeight);
                sb.Append(fontBold);
                sb.AppendLine("BUKTI PENDAFTARAN");
                sb.Append(fontBoldEnd);
                sb.Append(fontDoubleHeightEnd);
                sb.AppendLine("");

                #region Registration No Barcode
                string barcode = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationNo, NUL);
                sb.Append(barcodeWidth); //x01 = 1 x base width
                sb.Append(barcodeHeight); //x32 = 50 dots : 4 dots = 0.5mm
                sb.Append(barcodeValues);
                sb.Append(barcode);
                sb.AppendLine("");
                #endregion

                sb.Append(ESC + "a0");
                sb.AppendLine(string.Format("Tgl/Jam Registrasi : {0} / {1}", oVisit9.ActualVisitDateInString, oVisit9.ActualVisitTime));
                sb.AppendLine(string.Format("No. Rekam Medis    : {0}", oVisit9.MedicalNo));
                sb.AppendLine(string.Format("Nama Pasien / JK   : {0} {1} / {2}", oVisit9.Salutation, oVisit9.PatientName, gender));
                sb.AppendLine(string.Format("Tgl. Lahir / Umur  : {0} / {1}y {2}m {3}d", oVisit9.DateOfBirthInString, oVisit9.AgeInYear, oVisit9.AgeInMonth, oVisit9.AgeInDay));
                if (oVisit9.DepartmentID != Constant.Facility.EMERGENCY)
                    sb.AppendLine(string.Format("{0}: {1}", serviceUnit.PadRight(19, ' '), oVisit9.ServiceUnitName));
                sb.AppendLine(string.Format("Nama Dokter        : {0}", oVisit9.ParamedicName));
                sb.AppendLine(string.Format("Nama Ruang         : {0}", oVisit9.RoomName));
                sb.AppendLine(string.Format("Kiriman Dari       : -"));
                sb.AppendLine(string.Format("Penjamin Bayar     : {0}", oVisit9.BusinessPartner));
                if (oVisit9.DepartmentID == Constant.Facility.OUTPATIENT)
                {
                    if (string.IsNullOrEmpty(oVisit9.AppointmentNo))
                    {
                        sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                    }
                    else
                    {
                        Appointment app = BusinessLayer.GetAppointment(oVisit9.AppointmentID);
                        if (app.Notes.Contains("Registrasi Langsung"))
                        {
                            sb.AppendLine(string.Format("No. Antrian        : {0}", oVisit9.QueueNo));
                        }
                        else
                        {
                            sb.AppendLine(string.Format("No. Antrian        : *** {0} ***", oVisit9.QueueNo));
                        }
                    }
                }
                sb.AppendLine("");
                sb.AppendLine(string.Format("\n[ ]Farmasi  [ ]Laboratorium  [ ]Radiologi"));
                sb.AppendLine("");
                sb.AppendLine(string.Format("[ ] Lain-Lain ...................."));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("Petugas            : {0}", reg.CtreatedByName));
                sb.AppendLine(string.Format(""));
                sb.AppendLine(string.Format("*Mohon Bukti Pendaftaran ini jangan hilang"));
                sb.AppendLine(string.Format("*Apabila pasien tidak ada saat dipanggil maka nomor antrian akan dilewati 2 (orang) berikutnya"));
                sb.AppendLine("");
                #region Ticket No
                if (string.IsNullOrEmpty(oVisit9.RegistrationTicketNo))
                {

                    sb.AppendLine(string.Format("", string.Empty));
                }
                else
                {
                    sb.Append(ESC + "a1");
                    string ticketNo = string.Format("{0}k{1}{2}{3}", GS, (char)4, oVisit9.RegistrationTicketNo, NUL);
                    sb.Append(barcodeWidth1); //x01 = 1 x base width
                    sb.Append(barcodeHeight1); //x32 = 50 dots : 4 dots = 0.5mm
                    sb.Append(ticketNo);
                    sb.Append(barcodeValues);
                    sb.AppendLine("");
                }
                #endregion
                for (int i = 0; i <= 3; i++)
                {
                    sb.AppendLine("");
                }

                //Send Auto-Cut Command
                string command = "";
                command = ESC + "@";
                command += GS + "V" + (char)1;

                sb.AppendLine(command);
                #endregion

                #region Send Command to Printer

                RawPrinterHelper print = new RawPrinterHelper();

                if (!isUsePrintingTools)
                {
                    print.OpenPrint(printerUrl);
                    print.SendStringToPrinter(sb.ToString());
                    print.ClosePrint();
                }
                else
                {
                    Helper.MedinfrasDirectPrintingTools(printerUrl, sb.ToString());
                }

                #endregion
            }
        }
        #endregion

        #endregion
    }
}
        #endregion
